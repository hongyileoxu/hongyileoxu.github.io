<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hongyi Xu">
<meta name="dcterms.date" content="2025-03-10">

<title>Non-financial Liabilities and Restructuring</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="AFA_test_2005_PPE_clean_files/libs/clipboard/clipboard.min.js"></script>
<script src="AFA_test_2005_PPE_clean_files/libs/quarto-html/quarto.js"></script>
<script src="AFA_test_2005_PPE_clean_files/libs/quarto-html/popper.min.js"></script>
<script src="AFA_test_2005_PPE_clean_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="AFA_test_2005_PPE_clean_files/libs/quarto-html/anchor.min.js"></script>
<link href="AFA_test_2005_PPE_clean_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="AFA_test_2005_PPE_clean_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="AFA_test_2005_PPE_clean_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="AFA_test_2005_PPE_clean_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="AFA_test_2005_PPE_clean_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="AFA_test_2005_PPE_clean_files/libs/kePrint-0.0.1/kePrint.js"></script>

<link href="AFA_test_2005_PPE_clean_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-s1-raw-dataset" id="toc-sec-s1-raw-dataset" class="nav-link active" data-scroll-target="#sec-s1-raw-dataset">S1. Download and Load the Raw Dataset</a></li>
  <li><a href="#sec-s2-clean-prep" id="toc-sec-s2-clean-prep" class="nav-link" data-scroll-target="#sec-s2-clean-prep">S2. Data Cleaning and Prep</a>
  <ul>
  <li><a href="#s2.1.-summary-statistics" id="toc-s2.1.-summary-statistics" class="nav-link" data-scroll-target="#s2.1.-summary-statistics">s2.1. Summary Statistics</a></li>
  <li><a href="#s2.2.-plot-the-distribution-of-different-intensity-measures" id="toc-s2.2.-plot-the-distribution-of-different-intensity-measures" class="nav-link" data-scroll-target="#s2.2.-plot-the-distribution-of-different-intensity-measures">s2.2. plot the distribution of different intensity measures</a>
  <ul class="collapse">
  <li><a href="#contract_intensity" id="toc-contract_intensity" class="nav-link" data-scroll-target="#contract_intensity">contract_intensity</a></li>
  <li><a href="#ppe_lease_intensity" id="toc-ppe_lease_intensity" class="nav-link" data-scroll-target="#ppe_lease_intensity">ppe_lease_intensity</a></li>
  <li><a href="#building_intensity" id="toc-building_intensity" class="nav-link" data-scroll-target="#building_intensity">building_intensity</a></li>
  <li><a href="#land_intensity" id="toc-land_intensity" class="nav-link" data-scroll-target="#land_intensity">land_intensity</a></li>
  <li><a href="#bnl_intensity" id="toc-bnl_intensity" class="nav-link" data-scroll-target="#bnl_intensity">bnl_intensity</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-s3-difference-in-difference-examination" id="toc-sec-s3-difference-in-difference-examination" class="nav-link" data-scroll-target="#sec-s3-difference-in-difference-examination">S3. Difference-in-Difference Examination</a>
  <ul>
  <li><a href="#sec-s3z-executory-contract-intensity" id="toc-sec-s3z-executory-contract-intensity" class="nav-link" data-scroll-target="#sec-s3z-executory-contract-intensity">s3.0. Executory contract intensity</a></li>
  <li><a href="#sec-s3a-ppe-lease-intensity" id="toc-sec-s3a-ppe-lease-intensity" class="nav-link" data-scroll-target="#sec-s3a-ppe-lease-intensity">s3.1. PPE lease intensity</a></li>
  <li><a href="#sec-s3b-building-intensity" id="toc-sec-s3b-building-intensity" class="nav-link" data-scroll-target="#sec-s3b-building-intensity">s3.2. builing intensity</a>
  <ul class="collapse">
  <li><a href="#individual-year-treatment-plots" id="toc-individual-year-treatment-plots" class="nav-link" data-scroll-target="#individual-year-treatment-plots">Individual Year Treatment Plots</a></li>
  </ul></li>
  <li><a href="#sec-s3c-land-intensity" id="toc-sec-s3c-land-intensity" class="nav-link" data-scroll-target="#sec-s3c-land-intensity">s3.3. land intensity</a></li>
  <li><a href="#sec-s3c-building-and-land-intensity" id="toc-sec-s3c-building-and-land-intensity" class="nav-link" data-scroll-target="#sec-s3c-building-and-land-intensity">s3.4. builindg and land intensity</a></li>
  </ul></li>
  <li><a href="#sec-EndNotes" id="toc-sec-EndNotes" class="nav-link" data-scroll-target="#sec-EndNotes">EndNotes</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Non-financial Liabilities and Restructuring</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Empirical support from 2005 Reform with the North America sample</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Hongyi Xu </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 10, 2025</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">March 15, 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<style type="text/css">
body, td {
   font-size: 16px;
}
code.r{
  font-size: 12px;
}
pre { /* For appearance of output blocks */
  font-size: 12px;
  background-color: #f0f0f0; /* Light grey background */
  padding: 5px;
  <!-- border-radius: 5px; /* border corner */ -->
} 
.gt_table .gt_caption {
    font-size: 16px; 
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* Middle column: Main content */
.content-column {
  flex: 2; /* Takes remaining space */
  margin-right: 20px; /* Spacing between columns */
}

/* Right column: Outputs */
.output-column {
  flex: 0 0 10%; /* Fixed width for outputs */
  position: sticky;
  top: 0;
  height: 100vh; /* Full height */
  overflow-y: auto; /* Scrollable if content is long */
}
</style>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
This analysis is suggested by discussant Samuel Antill in 2025 AFA meeting.
</div>
</div>
<div class="callout-body-container callout-body">
<p>The previous versions can be found <a href="https://hongyileoxu.github.io/projects/">here</a>.</p>
</div>
</div>
<section id="sec-s1-raw-dataset" class="level2">
<h2 class="anchored" data-anchor-id="sec-s1-raw-dataset">S1. Download and Load the Raw Dataset</h2>
<p>We download the firm-level capital structure from Compustat-CapitalIQ North America. The first measure of executory contracts is from the accounting data which (under U.S. GAAP) cover leases and rental contracts. We use the variables “Debt Equivalent of Operating Leases”, “Capital Leases” and “Net Rental Expenses”.</p>
<ul>
<li><p><code>Debt - Capitalized Lease Obligations (dclo)</code>: This item represents long-term obligations due in respect of lease finances and hire purchase arrangements. This item includes:</p>
<ul>
<li>Long-term finance lease obligations</li>
<li>Long-term lease financing</li>
<li>Long-term hire purchase obligations</li>
<li>Non-current obligations under capital leases</li>
</ul></li>
<li><p><code>Rental Expense (xrent)</code>: This item represents all costs charged to operations for rental, lease, or hire of space and/or equipment. This item includes:</p>
<ul>
<li>Airlines’ landing fees</li>
<li>Contingent rentals associated with capitalized leases</li>
<li>Lease charges and plant hire</li>
</ul>
<p>In the main test, we construct a new variable called <code>total rent</code>, which is defined as the total rental commitment <code>mrc1 + mrc2 + mrc3 + mrc4 + mrc5 + mrct</code> reported in year <span class="math inline">t</span>.</p></li>
<li><p><code>Asset - Total (at)</code>: Book value of total assets.</p></li>
<li><p><code>Debt in Current Liabilities - Total (dlc)</code> is for the short-term debt and <code>Long-term debt - Total (dltt)</code> is for the long-term debt.</p></li>
<li><p><code>Earnings Before Interest (EBITDA)</code>: EBITDA.</p></li>
<li><p>Industry classifications: <code>naics</code>, <code>sic</code> and <code>spcindcd</code> + (Fama-French 30 Industry Classifiers, <mark><a href="https://github.com/Wenzhi-Ding/FamaFrenchIndustry">To Be Added</a> / <a href="https://mba.tuck.dartmouth.edu/pages/faculty/ken.french/Data_Library/det_30_ind_port.html">Definition</a></mark>).</p></li>
</ul>
<p><mark>In this version we add a set of new variables</mark>:</p>
<ul>
<li><p><code>Property, Plant, and Equipment - Leases at Cost (fatl)</code> is the capitalized value of leases and leasehold improvements included in property, plant, and equipment, excluding equipment leased to others, and is not applicable to banks or utilities. &gt; <a href="https://livehhsse-my.sharepoint.com/:u:/r/personal/65570_student_hhs_se/Documents/Projects_2024/BeckerJosephsonXu_2025/AFA_meeting_response/Test/2005_test/Variable%20Def%20Compustat/Wharton%20Research%20Data%20Services%20-%20fatl.html?csf=1&amp;web=1&amp;e=CdIDnC">Definition</a></p></li>
<li><p><code>Property, Plant, and Equipment - Buildings at Cost (fatb)</code>. &gt; <a href="https://livehhsse-my.sharepoint.com/:u:/r/personal/65570_student_hhs_se/Documents/Projects_2024/BeckerJosephsonXu_2025/AFA_meeting_response/Test/2005_test/Variable%20Def%20Compustat/Wharton%20Research%20Data%20Services%20-%20fatb.html?csf=1&amp;web=1&amp;e=mKw61J">Definition</a></p></li>
<li><p><code>Property, Plant, and Equipment - Land and Improvements at Cost (fatp)</code>.</p></li>
</ul>
<!-- -   `Property, Plant, and Equipment - Leases (Net) (ppenls)`. [no longer available]  -->
<ul>
<li><p><code>Property, Plant, and Equipment - Buildings (Net) (ppenb)</code>.</p></li>
<li><p><code>Property, Plant, and Equipment - Land and Improvements (Net) (ppenli)</code>.</p></li>
<li><p><code>Property, Plant and Equipment - Total (Gross) (ppegt)</code>.</p></li>
<li><p><code>Property, Plant and Equipment - Total (Net) (ppent)</code></p></li>
<li><p><code>Loans/Claims/Advances - Lease (lcal)</code>. &gt; <a href="https://livehhsse-my.sharepoint.com/:u:/g/personal/65570_student_hhs_se/EcYuzHO66GFCohXiCmFrdFMBPcI2FNxqePqRXsd5SwSZXg?e=muF6fe">Defintion</a> &gt;</p></li>
</ul>
<!-- ::: {#nte-company-location .callout-note .column-margin collapse="TRUE"} -->
<p>Given that the policy shock happens under the US jurisdiction, we expect more significant treatment effect to be detected in this sample. The period used in Samuel’s slides is between 2002 and 2007, which is after the doc.com bubble and before the GFC. The variables in the dataset are:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## create the data file path </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>data_file <span class="ot">&lt;-</span> <span class="st">"jpbdsuonrpztpw8t.csv"</span> </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>data_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(work_dir, <span class="st">"Data"</span>, data_file)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">## load the compustat_na data</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>compustat_na <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">read.csv</span>(<span class="at">file =</span> data_path) ) <span class="co"># %&gt;%</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(fic == "USA" | loc == "USA" ) ## keep only US related observations (| fic == "CAN" | loc == "CAN")</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="do">## data file record: </span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># | Mar 10, 2025 &gt; jpbdsuonrpztpw8t.csv</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># | Mar  9, 2025 &gt; nfmss2xkmjgfjonh.csv </span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># | Mar  5, 2025 &gt; e3cdfjocaz4aboqh.csv </span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># | Mar  3, 2025(2) &gt; tbrl8c4xqurukptl.csv &gt; more variables </span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># | Mar  3, 2025(1) &gt; evvvij0nqoe8sshv.csv</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># | Feb 24, 2025 &gt; azsyeo1yjmrb2q1v.csv </span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># | Jan 14, 2025 &gt; g4f68dkn3beu1iag.csv </span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="do">## load the FF_30ind data </span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>FF_30ind <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">read.csv</span>(<span class="at">file =</span> <span class="fu">file.path</span>(work_dir, <span class="st">"Data"</span>, <span class="st">"ff_30ind.csv"</span>)))</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="do">## check the variable names </span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables include:</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">names</span>(compustat_na)) </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Sample size: </span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(compustat_na)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Variables include:

 [1] "act"      "at"       "bkvlps"   "ceq"      "che"      "cik"     
 [7] "conm"     "consol"   "costat"   "csho"     "curcd"    "cusip"   
[13] "datadate" "datafmt"  "dclo"     "dlc"      "dltt"     "dp"      
[19] "dvc"      "dvp"      "ebit"     "ebitda"   "fatb"     "fatl"    
[25] "fatp"     "fic"      "fyear"    "fyr"      "fyrc"     "gvkey"   
[31] "ib"       "indfmt"   "lcal"     "lct"      "loc"      "lt"      
[37] "mrc1"     "mrc2"     "mrc3"     "mrc4"     "mrc5"     "mrct"    
[43] "mrcta"    "naics"    "ni"       "oibdp"    "popsrc"   "ppegt"   
[49] "ppenb"    "ppenli"   "ppenls"   "ppent"    "prcc_f"   "re"      
[55] "revt"     "seq"      "sic"      "spcindcd" "tic"      "txdb"    
[61] "wcap"     "xrent"   

Sample size: 

[1] 165122     62</code></pre>
</div>
</div>
</section>
<section id="sec-s2-clean-prep" class="level2">
<h2 class="anchored" data-anchor-id="sec-s2-clean-prep">S2. Data Cleaning and Prep</h2>
<p>Two dependent variables are constructed to measure firm’s leverage: (<u>cf.&nbsp;p18 and Table 2 of the paper</u>)</p>
<ul>
<li><p><code>Book leverage</code>: we define leverage as the ratio of the sum of short-term debt and long-term debt to assets (we drop observations where this is outside the [0,1] range)*.</p></li>
<li><p><code>Debt/EBITDA</code>: we define debt-to-EBITDA as the ratio of the long- and short-term debt to EBITDA (we drop observations where this is outside the [0,15] range)*.</p></li>
</ul>
<p>These restrictions are now imposed in all analyses. We use the full set of firms in the Compustat NA. We choose <code>fyear</code> - fiscal year - as the time variable of the dataset.</p>
<p>In this version, we set the <code>base_year == 2004</code> instead of <code>2005</code>, which is the year when the treatment happens. Based on the <a href="https://www.congress.gov/bill/109th-congress/senate-bill/256">S.256 - Bankruptcy Abuse Prevention and Consumer Protection Act of 2005</a>, the bill was first introduced on February 1, 2025 and was signed into law by President George W. Bush. on April 20, 2005. The act’s provisions applied to bankruptcy cases filed on or after October 17, 2005. <a href="https://en.wikipedia.org/wiki/Bankruptcy_Abuse_Prevention_and_Consumer_Protection_Act?utm_source=chatgpt.com">&gt; Wikipedia</a></p>
<p>Therefore, the treatment effects should first appear in the annual reports for the fiscal year 2005, as the treatment occurs in fiscal year 2004.</p>
<p>Then we create a list of variables required for the analysis:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## set the base year </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>base_year <span class="ot">&lt;-</span> <span class="dv">2004</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>period_start <span class="ot">&lt;-</span> <span class="dv">2002</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>period_end <span class="ot">&lt;-</span> <span class="dv">2007</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>intensity_measure_year <span class="ot">&lt;-</span> <span class="dv">2000</span> <span class="co"># choose the base year for the intensity measure </span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>n_pre <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># number of periods before the period_start in the iplot()  </span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="do">## create leverage and control variables </span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> compustat_na <span class="sc">%&gt;%</span> </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(at &gt;= 0) %&gt;%</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(indfmt <span class="sc">==</span> <span class="st">"INDL"</span>) <span class="sc">%&gt;%</span> <span class="do">## remove all financial firms</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## create the lagged `ppent` item: </span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gvkey) <span class="sc">%&gt;%</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(fyear) <span class="sc">%&gt;%</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ppent_lag1 =</span> <span class="fu">lag</span>(ppent, <span class="at">n =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="do">## create new variables: </span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="do">## leverage variables: </span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">book_leverage =</span> (dlc <span class="sc">+</span> dltt) <span class="sc">/</span> at, </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">debt_ebitda =</span> (dlc <span class="sc">+</span> dltt) <span class="sc">/</span> ebitda, </span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="do">## treatment intensity: </span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">totalrent =</span> <span class="fu">coalesce</span>(mrc1, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">coalesce</span>(mrc2, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">coalesce</span>(mrc3, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">coalesce</span>(mrc4, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">coalesce</span>(mrc5, <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">coalesce</span>(mrcta, <span class="dv">0</span>), <span class="co"># total rent w/o discount</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># contract_intensity = (dclo + xrent * 3) / at, # executory contract intensity</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">contract_intensity =</span> (<span class="fu">coalesce</span>(dclo, <span class="dv">0</span>) <span class="sc">+</span> totalrent) <span class="sc">/</span> at, <span class="co"># executory contract intensity</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="do">### for the total: </span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">ppe_lease_intensity =</span> fatl <span class="sc">/</span> at, <span class="co"># PPE lease intensity </span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">building_intensity =</span> fatb <span class="sc">/</span> at, <span class="co"># only for buildings (i.e. properties), but only not only leased ones</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">land_intensity =</span> fatp <span class="sc">/</span> at, <span class="co"># only land intensity </span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">bnl_intensity =</span> building_intensity <span class="sc">+</span> land_intensity, </span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="do">### for the net: </span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># net_lease_intensity = ppenls / at, # net PPE lease intensity [not available after 1998]</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># net_building_intensity = ppenb / at, # net PPE building intensity [not available after 1998]  </span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">net_land_intensity =</span> ppenli <span class="sc">/</span> at, <span class="co"># net PPE land intensity </span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    <span class="do">### for total PPE: </span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">net_PPE_intensity =</span> ppent <span class="sc">/</span> at, <span class="co"># net PPE intensity </span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">PPE_intensity =</span> ppegt <span class="sc">/</span> at, <span class="co"># gross PPE intensity </span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    <span class="do">### for lessors: </span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">lessor_lease_intensity =</span> lcal <span class="sc">/</span> at, <span class="co"># this is outstanding lease intensity to be received. </span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    <span class="do">## other variables and controls: </span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">dyear =</span> <span class="fu">as.integer</span>(<span class="fu">substr</span>(datadate, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">stop =</span> <span class="dv">4</span>)), <span class="co"># data year </span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">roa =</span> ni <span class="sc">/</span> at, <span class="co"># return on asset (ROA) </span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">tangibility =</span> ppent <span class="sc">/</span> at, <span class="co"># tangibility  </span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">altman_Z =</span> (<span class="fl">3.3</span> <span class="sc">*</span> revt <span class="sc">+</span> <span class="fl">1.4</span> <span class="sc">*</span> re <span class="sc">+</span> <span class="fl">1.2</span> <span class="sc">*</span> wcap) <span class="sc">/</span> at, <span class="co"># Altman Z-score</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">kz =</span> <span class="sc">-</span><span class="fl">1.001909</span> <span class="sc">*</span> ((ib <span class="sc">+</span> dp)<span class="sc">/</span>ppent_lag1) <span class="sc">+</span> <span class="fl">0.2826389</span> <span class="sc">*</span> ((at <span class="sc">+</span> prcc_f<span class="sc">*</span>csho <span class="sc">-</span> ceq <span class="sc">-</span> txdb)<span class="sc">/</span>at) <span class="sc">+</span> <span class="fl">3.139193</span> <span class="sc">*</span> ((dltt <span class="sc">+</span> dlc)<span class="sc">/</span>(dltt <span class="sc">+</span> dlc <span class="sc">+</span> seq)) <span class="sc">-</span> <span class="fl">39.3678</span> <span class="sc">*</span> ((dvc <span class="sc">+</span> dvp)<span class="sc">/</span>ppent_lag1) <span class="sc">-</span> <span class="fl">1.314759</span> <span class="sc">*</span> (che<span class="sc">/</span>ppent_lag1), <span class="co"># KZ index </span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># hw = , # financial contraints (HW) </span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">current_ratio =</span> act <span class="sc">/</span> lct, <span class="co"># current ratio: current asset / current liabilites </span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">market_book =</span> (prcc_f<span class="sc">*</span>csho) <span class="sc">/</span> (ceq <span class="sc">+</span> txdb) <span class="co"># market-to-book</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="do">## record the variable names </span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variables Created:</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">setdiff</span>(<span class="fu">names</span>(data), <span class="fu">names</span>(compustat_na))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Variables Created:

 [1] "altman_Z"               "bnl_intensity"          "book_leverage"         
 [4] "building_intensity"     "contract_intensity"     "current_ratio"         
 [7] "debt_ebitda"            "dyear"                  "kz"                    
[10] "land_intensity"         "lessor_lease_intensity" "market_book"           
[13] "net_land_intensity"     "net_PPE_intensity"      "PPE_intensity"         
[16] "ppe_lease_intensity"    "ppent_lag1"             "roa"                   
[19] "tangibility"            "totalrent"             </code></pre>
</div>
</div>
<p>We propose several noisy measures of the PPE lease contract intensity:</p>
<ul>
<li><p><code>ppe_lease_intensity</code>: calculated as the <code>Property, Plant, and Equipment - Leases at Cost (fatl)</code> normalized by the total asset for firm <span class="math inline">i</span> at year <span class="math inline">t</span>. It measures the future lease obligations in PPE, but it is a noisy measure as it also includes equipment.</p></li>
<li><p><code>building_intensity</code>: calculated as <code>Property, Plant, and Equipment - Buildings at Cost (fatb)</code> normalized by the total asset for firm <span class="math inline">i</span> at year <span class="math inline">t</span>.</p></li>
<li><p><code>land_intensity</code>: calculated as <code>Property, Plant, and Equipment - Land and Improvements at Cost (fatp)</code> normalized by the total asset for firm <span class="math inline">i</span> at year <span class="math inline">t</span>.</p></li>
<li><p><code>bnl_intensity</code>: calculated as the sum of <code>Property, Plant, and Equipment - Land and Improvements at Cost (fatp)</code> and <code>Property, Plant, and Equipment - Buildings at Cost (fatb)</code> normalized by the <code>total asset (at)</code> for firm <span class="math inline">i</span> at year <span class="math inline">t</span>.</p></li>
<li><p><code>oustanding_lease_intensity</code>: calculated as the <code>Loans/Claims/Advances - Lease (lcal)</code> normalized by the total asset for firm <span class="math inline">i</span> at year <span class="math inline">t</span>. It measures the amount of lease obgliations to be collected by firm <span class="math inline">i</span> in the future. You can view this sample as the lessor in the lease contract, while the previous variable, <code>ppe_lease_intensity</code>, captures the sample of lessees.</p></li>
</ul>
<p><mark>Although this will contain other items besides non-residential real property lease obligations, we believe that it is a potentially better measure for a firm’s exposure to this policy shock in 2005.</mark></p>
<p>For definitions of controls, please refer to <a href="#sec-EndNotes" class="quarto-xref">Section&nbsp;4</a>.</p>
<ul>
<li><code>kz</code>: KZ index:</li>
</ul>
<p><span class="math display">-1.001909 \left( \frac{ib + dp}{\text{lagged } ppent} \right) + 0.2826389 \left( \frac{at + \text{prcc_f} \times \text{csho} - ceq - txdb}{at} \right) + 3.139193 \left( \frac{dltt + dlc}{dltt + dlc + seq} \right) - 39.3678 \left( \frac{dvc + dvp}{\text{lagged } ppent} \right) - 1.314759 \left( \frac{che}{\text{lagged } ppent} \right)</span>.</p>
<section id="s2.1.-summary-statistics" class="level3">
<h3 class="anchored" data-anchor-id="s2.1.-summary-statistics">s2.1. Summary Statistics</h3>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## summary statistics: </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(at <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> ebitda <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> ppent_lag1 <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lct <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> (ceq <span class="sc">+</span> txdb) <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    book_leverage, debt_ebitda, </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    altman_Z, current_ratio, debt_ebitda, current_ratio, </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    debt_ebitda, kz, market_book, roa, tangibility, </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    contract_intensity, ppe_lease_intensity, bnl_intensity, </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    building_intensity, land_intensity, <span class="co"># lessor_lease_intensity </span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># net_land_intensity, net_PPE_intensity, PPE_intensity, ppent_lag1, </span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  psych<span class="sc">::</span><span class="fu">describe</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(n, mean, <span class="st">`</span><span class="at">trimmed mean</span><span class="st">`</span> <span class="ot">=</span> trimmed, median, sd) <span class="sc">%&gt;%</span> </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"Variable Name"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Table 1. Summary Statistics"</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">heading.align =</span> <span class="st">"left"</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_align</span>(</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">align =</span> <span class="st">"center"</span>,</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"n"</span>, <span class="st">"mean"</span>, <span class="st">"trimmed mean"</span>, <span class="st">"median"</span>, <span class="st">"sd"</span>)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="rgobawmbxf" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#rgobawmbxf table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#rgobawmbxf thead, #rgobawmbxf tbody, #rgobawmbxf tfoot, #rgobawmbxf tr, #rgobawmbxf td, #rgobawmbxf th {
  border-style: none;
}

#rgobawmbxf p {
  margin: 0;
  padding: 0;
}

#rgobawmbxf .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rgobawmbxf .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#rgobawmbxf .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rgobawmbxf .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rgobawmbxf .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rgobawmbxf .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rgobawmbxf .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rgobawmbxf .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rgobawmbxf .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rgobawmbxf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rgobawmbxf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rgobawmbxf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rgobawmbxf .gt_spanner_row {
  border-bottom-style: hidden;
}

#rgobawmbxf .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#rgobawmbxf .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rgobawmbxf .gt_from_md > :first-child {
  margin-top: 0;
}

#rgobawmbxf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rgobawmbxf .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rgobawmbxf .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rgobawmbxf .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rgobawmbxf .gt_row_group_first td {
  border-top-width: 2px;
}

#rgobawmbxf .gt_row_group_first th {
  border-top-width: 2px;
}

#rgobawmbxf .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rgobawmbxf .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rgobawmbxf .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rgobawmbxf .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rgobawmbxf .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rgobawmbxf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rgobawmbxf .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#rgobawmbxf .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rgobawmbxf .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rgobawmbxf .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rgobawmbxf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rgobawmbxf .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rgobawmbxf .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rgobawmbxf .gt_left {
  text-align: left;
}

#rgobawmbxf .gt_center {
  text-align: center;
}

#rgobawmbxf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rgobawmbxf .gt_font_normal {
  font-weight: normal;
}

#rgobawmbxf .gt_font_bold {
  font-weight: bold;
}

#rgobawmbxf .gt_font_italic {
  font-style: italic;
}

#rgobawmbxf .gt_super {
  font-size: 65%;
}

#rgobawmbxf .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#rgobawmbxf .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rgobawmbxf .gt_indent_1 {
  text-indent: 5px;
}

#rgobawmbxf .gt_indent_2 {
  text-indent: 10px;
}

#rgobawmbxf .gt_indent_3 {
  text-indent: 15px;
}

#rgobawmbxf .gt_indent_4 {
  text-indent: 20px;
}

#rgobawmbxf .gt_indent_5 {
  text-indent: 25px;
}

#rgobawmbxf .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#rgobawmbxf div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="6" class="gt_heading gt_title gt_font_normal gt_bottom_border">Table 1. Summary Statistics</th>
</tr>
<tr class="odd gt_col_headings">
<th id="Variable Name" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Variable Name</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">n</th>
<th id="mean" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">mean</th>
<th id="trimmed mean" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">trimmed mean</th>
<th id="median" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">median</th>
<th id="sd" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">sd</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Variable Name">book_leverage</td>
<td class="gt_row gt_center" headers="n">55396</td>
<td class="gt_row gt_center" headers="mean">0.23</td>
<td class="gt_row gt_center" headers="trimmed mean">0.22</td>
<td class="gt_row gt_center" headers="median">0.22</td>
<td class="gt_row gt_center" headers="sd">0.19</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Variable Name">debt_ebitda</td>
<td class="gt_row gt_center" headers="n">55396</td>
<td class="gt_row gt_center" headers="mean">4.24</td>
<td class="gt_row gt_center" headers="trimmed mean">1.99</td>
<td class="gt_row gt_center" headers="median">1.68</td>
<td class="gt_row gt_center" headers="sd">59.61</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable Name">altman_Z</td>
<td class="gt_row gt_center" headers="n">54046</td>
<td class="gt_row gt_center" headers="mean">3.92</td>
<td class="gt_row gt_center" headers="trimmed mean">3.64</td>
<td class="gt_row gt_center" headers="median">3.48</td>
<td class="gt_row gt_center" headers="sd">3.59</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Variable Name">current_ratio</td>
<td class="gt_row gt_center" headers="n">55210</td>
<td class="gt_row gt_center" headers="mean">2.53</td>
<td class="gt_row gt_center" headers="trimmed mean">1.95</td>
<td class="gt_row gt_center" headers="median">1.73</td>
<td class="gt_row gt_center" headers="sd">11.97</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable Name">kz</td>
<td class="gt_row gt_center" headers="n">50384</td>
<td class="gt_row gt_center" headers="mean">-37.00</td>
<td class="gt_row gt_center" headers="trimmed mean">-2.26</td>
<td class="gt_row gt_center" headers="median">-0.73</td>
<td class="gt_row gt_center" headers="sd">1823.05</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Variable Name">market_book</td>
<td class="gt_row gt_center" headers="n">50699</td>
<td class="gt_row gt_center" headers="mean">3.53</td>
<td class="gt_row gt_center" headers="trimmed mean">2.06</td>
<td class="gt_row gt_center" headers="median">1.75</td>
<td class="gt_row gt_center" headers="sd">46.93</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable Name">roa</td>
<td class="gt_row gt_center" headers="n">55395</td>
<td class="gt_row gt_center" headers="mean">0.04</td>
<td class="gt_row gt_center" headers="trimmed mean">0.04</td>
<td class="gt_row gt_center" headers="median">0.04</td>
<td class="gt_row gt_center" headers="sd">0.23</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Variable Name">tangibility</td>
<td class="gt_row gt_center" headers="n">55393</td>
<td class="gt_row gt_center" headers="mean">0.33</td>
<td class="gt_row gt_center" headers="trimmed mean">0.30</td>
<td class="gt_row gt_center" headers="median">0.26</td>
<td class="gt_row gt_center" headers="sd">0.26</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable Name">contract_intensity</td>
<td class="gt_row gt_center" headers="n">55396</td>
<td class="gt_row gt_center" headers="mean">0.12</td>
<td class="gt_row gt_center" headers="trimmed mean">0.06</td>
<td class="gt_row gt_center" headers="median">0.04</td>
<td class="gt_row gt_center" headers="sd">0.30</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Variable Name">ppe_lease_intensity</td>
<td class="gt_row gt_center" headers="n">34309</td>
<td class="gt_row gt_center" headers="mean">0.04</td>
<td class="gt_row gt_center" headers="trimmed mean">0.02</td>
<td class="gt_row gt_center" headers="median">0.01</td>
<td class="gt_row gt_center" headers="sd">0.10</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable Name">bnl_intensity</td>
<td class="gt_row gt_center" headers="n">37670</td>
<td class="gt_row gt_center" headers="mean">0.12</td>
<td class="gt_row gt_center" headers="trimmed mean">0.08</td>
<td class="gt_row gt_center" headers="median">0.06</td>
<td class="gt_row gt_center" headers="sd">0.18</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Variable Name">building_intensity</td>
<td class="gt_row gt_center" headers="n">37706</td>
<td class="gt_row gt_center" headers="mean">0.10</td>
<td class="gt_row gt_center" headers="trimmed mean">0.07</td>
<td class="gt_row gt_center" headers="median">0.05</td>
<td class="gt_row gt_center" headers="sd">0.14</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable Name">land_intensity</td>
<td class="gt_row gt_center" headers="n">37815</td>
<td class="gt_row gt_center" headers="mean">0.02</td>
<td class="gt_row gt_center" headers="trimmed mean">0.01</td>
<td class="gt_row gt_center" headers="median">0.01</td>
<td class="gt_row gt_center" headers="sd">0.06</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="s2.2.-plot-the-distribution-of-different-intensity-measures" class="level3 tabset">
<h3 class="tabset anchored" data-anchor-id="s2.2.-plot-the-distribution-of-different-intensity-measures">s2.2. plot the distribution of different intensity measures</h3>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>candidate_intensity_measure <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"contract_intensity"</span>, </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ppe_lease_intensity"</span>, </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"building_intensity"</span>, </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"land_intensity"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bnl_intensity"</span>) </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (measure <span class="cf">in</span> candidate_intensity_measure) {</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">'#### '</span>, measure, <span class="st">'   </span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">%&gt;%</span> </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(fic <span class="sc">==</span> <span class="st">"USA"</span> <span class="sc">|</span> loc <span class="sc">==</span> <span class="st">"USA"</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span> </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(at <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> ebitda <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> ppent_lag1 <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> lct <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> (ceq <span class="sc">+</span> txdb) <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>      gvkey, fyear, </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>      book_leverage, debt_ebitda, </span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>      altman_Z, current_ratio, debt_ebitda, current_ratio, </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>      debt_ebitda, kz, market_book, roa, tangibility, </span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>      contract_intensity, ppe_lease_intensity, bnl_intensity, </span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>      building_intensity, land_intensity, <span class="co"># lessor_lease_intensity </span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>      <span class="co"># net_land_intensity, net_PPE_intensity, PPE_intensity, ppent_lag1, </span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(contract_intensity <span class="sc">&gt;=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    .[[measure]] <span class="sc">%&gt;%</span> <span class="co"># selec the variable of interest </span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist</span>(., </span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">prob =</span> <span class="cn">TRUE</span>, <span class="co"># density plot</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"#E1DEFC"</span>,  </span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">"Density Histogram: data from Compustat NA"</span>, </span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="fu">paste</span>(measure),</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="st">"Density"</span>, </span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">breaks =</span> <span class="dv">100</span>, <span class="co"># xlim = c(0, 8) </span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>     ) </span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># jpeg(filename = paste("Figure1_", id.names[c], ".jpeg", sep = ""), width = 550, height = 350)</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>} </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<section id="contract_intensity" class="level4">
<h4 class="anchored" data-anchor-id="contract_intensity">contract_intensity</h4>
<p><img src="AFA_test_2005_PPE_clean_files/figure-html/s2-plots-1.png" class="img-fluid" width="672"></p>
</section>
<section id="ppe_lease_intensity" class="level4">
<h4 class="anchored" data-anchor-id="ppe_lease_intensity">ppe_lease_intensity</h4>
<p><img src="AFA_test_2005_PPE_clean_files/figure-html/s2-plots-2.png" class="img-fluid" width="672"></p>
</section>
<section id="building_intensity" class="level4">
<h4 class="anchored" data-anchor-id="building_intensity">building_intensity</h4>
<p><img src="AFA_test_2005_PPE_clean_files/figure-html/s2-plots-3.png" class="img-fluid" width="672"></p>
</section>
<section id="land_intensity" class="level4">
<h4 class="anchored" data-anchor-id="land_intensity">land_intensity</h4>
<p><img src="AFA_test_2005_PPE_clean_files/figure-html/s2-plots-4.png" class="img-fluid" width="672"></p>
</section>
<section id="bnl_intensity" class="level4">
<h4 class="anchored" data-anchor-id="bnl_intensity">bnl_intensity</h4>
<p><img src="AFA_test_2005_PPE_clean_files/figure-html/s2-plots-5.png" class="img-fluid" width="672"></p>
</section>
</section>
</section>
<section id="sec-s3-difference-in-difference-examination" class="level2">
<h2 class="anchored" data-anchor-id="sec-s3-difference-in-difference-examination">S3. Difference-in-Difference Examination</h2>
<p>Then, we construct the dataset for the difference-in-difference analysis.</p>
<p>In this section, we use all observations without missing values in subsequent analyses.</p>
<p>The original dataset (<code>data</code>) contains observations with fiscal year (<code>fyear</code>) range in [1996, 2009] and we restrict the sample to the fiscal year in [2002, 2007].</p>
<section id="sec-s3z-executory-contract-intensity" class="level3">
<h3 class="anchored" data-anchor-id="sec-s3z-executory-contract-intensity">s3.0. Executory contract intensity</h3>
<p><code>contract_intensity</code> is chosen to measure a firm’s executory contract intensity, which was expected to be impacted by the change in the bankruptcy code in 2005.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## choose the group definition: </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>intensity_measure_name <span class="ot">&lt;-</span> candidate_intensity_measure[<span class="dv">1</span>]</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>data_firm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">==</span> intensity_measure_year) <span class="sc">%&gt;%</span> <span class="co"># use `fyear` may create multiple observations for the same firm. E.g. filter(gvkey == 23535, dyear == 2005) </span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fyear) <span class="sc">%&gt;%</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## identify large and small firms based on its total asset in the year 2000 </span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">median_at =</span> <span class="fu">median</span>(at, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">large =</span> <span class="fu">ifelse</span>(at <span class="sc">&gt;</span> median_at, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, <span class="at">intensity_2000 =</span> <span class="fu">all_of</span>(intensity_measure_name), large) </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>data_did <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="do">## merge the grouping variable </span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> data_firm, <span class="at">by =</span> <span class="fu">join_by</span>(gvkey) ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="do">## merge the FF 30 industry classifiaction </span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> FF_30ind, <span class="at">by =</span> <span class="fu">join_by</span>(sic)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="do">## exclude certain industries </span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    ff_30ind <span class="sc">!=</span> <span class="dv">20</span>, <span class="co"># exclude Utiltiy (number 20) </span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span>(sic <span class="sc">&gt;=</span> <span class="dv">6000</span> <span class="sc">&amp;</span> sic <span class="sc">&lt;=</span> <span class="dv">6199</span>) <span class="co"># exclude banks under Banking, Insurance, Real Estate, Trading (number 29)</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## pre- &amp; post- </span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">indexyear =</span> (fyear <span class="sc">-</span> base_year), <span class="co"># year index with 2005 as base 0.</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">post_2005 =</span> <span class="fu">as.numeric</span>(fyear <span class="sc">&gt;</span> base_year)  <span class="co"># whether it is after the 2005 reform </span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="do">## gvkey(s) for balanced panel": </span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>data_did_balanced_id <span class="ot">&lt;-</span> data_did <span class="sc">%&gt;%</span> </span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">-</span> n_pre <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span> </span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gvkey) <span class="sc">%&gt;%</span> </span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count_obs =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(book_leverage) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(intensity_2000))) <span class="sc">%&gt;%</span> </span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(count_obs <span class="sc">==</span> period_end <span class="sc">-</span> period_start <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> n_pre) <span class="sc">%&gt;%</span> </span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span>gvkey </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>DiD Analysis:</p>
<p>Variable <code>treated</code> is defined as whether the firm has a positive contract_intensity in year 2004.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(intensity_measure_name); <span class="fu">cat</span>(<span class="st">": </span><span class="sc">\n</span><span class="st">"</span>); </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>did_model_s3z_a <span class="ot">&lt;-</span> data_did <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, fyear, intensity_2000, post_2005, book_leverage, debt_ebitda, sic, ff_30ind_name, large) <span class="sc">%&gt;%</span> </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span> </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">gvkey =</span> <span class="fu">as.factor</span>(gvkey), </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">fyear =</span> <span class="fu">as.factor</span>(fyear), </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated =</span> <span class="fu">as.numeric</span>(intensity_2000 <span class="sc">&gt;</span> <span class="dv">0</span>) </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  fixest<span class="sc">::</span><span class="fu">feols</span>(<span class="at">fml =</span> book_leverage <span class="sc">~</span> treated<span class="sc">*</span>post_2005<span class="sc">*</span>large <span class="sc">|</span> gvkey <span class="sc">+</span> fyear <span class="sc">+</span> ff_30ind_name<span class="sc">^</span>fyear, <span class="at">data =</span> ., <span class="at">cluster =</span> <span class="fu">c</span>(<span class="st">"gvkey"</span>, <span class="st">"ff_30ind_name"</span>)) </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>did_model_s3z_b <span class="ot">&lt;-</span> data_did <span class="sc">%&gt;%</span> </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, fyear, intensity_2000, post_2005, book_leverage, debt_ebitda, sic, ff_30ind_name, large) <span class="sc">%&gt;%</span> </span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span> </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">gvkey =</span> <span class="fu">as.factor</span>(gvkey), </span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">fyear =</span> <span class="fu">as.factor</span>(fyear), </span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated =</span> <span class="fu">as.numeric</span>(intensity_2000 <span class="sc">&gt;</span> <span class="dv">0</span>) </span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  fixest<span class="sc">::</span><span class="fu">feols</span>(<span class="at">fml =</span> book_leverage <span class="sc">~</span> intensity_2000<span class="sc">*</span>post_2005<span class="sc">*</span>large <span class="sc">|</span> gvkey <span class="sc">+</span> fyear <span class="sc">+</span> ff_30ind_name<span class="sc">^</span>fyear, <span class="at">data =</span> ., <span class="at">cluster =</span> <span class="fu">c</span>(<span class="st">"gvkey"</span>, <span class="st">"ff_30ind_name"</span>)) </span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="fu">mget</span>(<span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"did_model_s3z_"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">names&lt;-</span><span class="st">`</span>(<span class="at">value =</span> <span class="fu">c</span>(<span class="st">"(a) treatment"</span>, <span class="st">"(b) intensity"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">etable</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>, <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"DiD Results with `"</span>, intensity_measure_name, <span class="st">"`"</span>, <span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">font_size =</span> <span class="dv">8</span>,       <span class="co"># Smaller font (default is 16px)</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>,   <span class="co"># Table width fits content </span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"condensed"</span>)</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>contract_intensity: </code></pre>
</div>
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>DiD Results with `contract_intensity`</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(a) treatment</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(b) intensity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Dependent Var.:</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">treated x post_2005</td>
<td style="text-align: left;">-0.0079 (0.0071)</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">post_2005 x large</td>
<td style="text-align: left;">-0.0112 (0.0089)</td>
<td style="text-align: left;">-0.0059 (0.0049)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">treated x post_2005 x large</td>
<td style="text-align: left;">0.0074 (0.0082)</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">intensity_2000 x post_2005</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0010 (0.0040)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">intensity_2000 x post_2005 x large</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0035 (0.0058)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fixed-Effects:</td>
<td style="text-align: left;">----------------</td>
<td style="text-align: left;">----------------</td>
</tr>
<tr class="odd">
<td style="text-align: left;">gvkey</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">fyear</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ff_30ind_name-fyear</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">__________________________________</td>
<td style="text-align: left;">________________</td>
<td style="text-align: left;">________________</td>
</tr>
<tr class="odd">
<td style="text-align: left;">S.E.: Clustered</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Observations</td>
<td style="text-align: left;">36,900</td>
<td style="text-align: left;">36,890</td>
</tr>
<tr class="odd">
<td style="text-align: left;">R2</td>
<td style="text-align: left;">0.80304</td>
<td style="text-align: left;">0.80314</td>
</tr>
<tr class="even">
<td style="text-align: left;">Within R2</td>
<td style="text-align: left;">0.00025</td>
<td style="text-align: left;">0.00015</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="sec-s3a-ppe-lease-intensity" class="level3">
<h3 class="anchored" data-anchor-id="sec-s3a-ppe-lease-intensity">s3.1. PPE lease intensity</h3>
<p><code>ppe_lease_intensity</code> is chosen to measure a firm’s long-term exposure to lease contracts, especially non-residential real property lease obligations, which was expected to be impacted by the change in the bankruptcy code in 2005.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">## choose the group definition:</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>intensity_measure_name <span class="ot">&lt;-</span> candidate_intensity_measure[<span class="dv">2</span>]</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>data_firm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">==</span> intensity_measure_year) <span class="sc">%&gt;%</span> <span class="co"># use `fyear` may create multiple observations for the same firm. E.g. filter(gvkey == 23535, dyear == 2005)</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fyear) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">median_at =</span> <span class="fu">median</span>(at, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">large =</span> <span class="fu">ifelse</span>(at <span class="sc">&gt;</span> median_at, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, <span class="at">intensity_2000 =</span> <span class="fu">all_of</span>(intensity_measure_name), large)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>data_did <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="do">## merge the grouping variable</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> data_firm, <span class="at">by =</span> <span class="fu">join_by</span>(gvkey) ) <span class="sc">%&gt;%</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="do">## merge the FF 30 industry classifiaction</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> FF_30ind, <span class="at">by =</span> <span class="fu">join_by</span>(sic)) <span class="sc">%&gt;%</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="do">## exclude certain industries</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    ff_30ind <span class="sc">!=</span> <span class="dv">20</span>, <span class="co"># exclude Utiltiy (number 20)</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span>(sic <span class="sc">&gt;=</span> <span class="dv">6000</span> <span class="sc">&amp;</span> sic <span class="sc">&lt;=</span> <span class="dv">6199</span>) <span class="co"># exclude banks under Banking, Insurance, Real Estate, Trading (number 29)</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">## pre- &amp; post-</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">indexyear =</span> (fyear <span class="sc">-</span> base_year), <span class="co"># year index with 2005 as base 0.</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">post_2005 =</span> <span class="fu">as.numeric</span>(fyear <span class="sc">&gt;</span> base_year)  <span class="co"># whether it is after the 2005 reform</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="do">## gvkey(s) for balanced panel":</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>data_did_balanced_id <span class="ot">&lt;-</span> data_did <span class="sc">%&gt;%</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">-</span> n_pre <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gvkey) <span class="sc">%&gt;%</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count_obs =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(book_leverage) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(intensity_2000))) <span class="sc">%&gt;%</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(count_obs <span class="sc">==</span> period_end <span class="sc">-</span> period_start <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> n_pre) <span class="sc">%&gt;%</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span>gvkey</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>DiD Analysis:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(intensity_measure_name); <span class="fu">cat</span>(<span class="st">": </span><span class="sc">\n</span><span class="st">"</span>);</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>did_model_s3a_a <span class="ot">&lt;-</span> data_did <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, fyear, intensity_2000, post_2005, book_leverage, debt_ebitda, sic, ff_30ind_name, large) <span class="sc">%&gt;%</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">gvkey =</span> <span class="fu">as.factor</span>(gvkey),</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">fyear =</span> <span class="fu">as.factor</span>(fyear),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated =</span> <span class="fu">as.numeric</span>(intensity_2000 <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  fixest<span class="sc">::</span><span class="fu">feols</span>(<span class="at">fml =</span> book_leverage <span class="sc">~</span> treated<span class="sc">*</span>post_2005<span class="sc">*</span>large <span class="sc">|</span> gvkey <span class="sc">+</span> fyear <span class="sc">+</span> ff_30ind_name<span class="sc">^</span>fyear, <span class="at">data =</span> ., <span class="at">cluster =</span> <span class="fu">c</span>(<span class="st">"gvkey"</span>, <span class="st">"ff_30ind_name"</span>))</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>did_model_s3a_b <span class="ot">&lt;-</span> data_did <span class="sc">%&gt;%</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, fyear, intensity_2000, post_2005, book_leverage, debt_ebitda, sic, ff_30ind_name, large) <span class="sc">%&gt;%</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">gvkey =</span> <span class="fu">as.factor</span>(gvkey),</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">fyear =</span> <span class="fu">as.factor</span>(fyear),</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated =</span> <span class="fu">as.numeric</span>(intensity_2000 <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  fixest<span class="sc">::</span><span class="fu">feols</span>(<span class="at">fml =</span> book_leverage <span class="sc">~</span> intensity_2000<span class="sc">*</span>post_2005<span class="sc">*</span>large <span class="sc">|</span> gvkey <span class="sc">+</span> fyear <span class="sc">+</span> ff_30ind_name<span class="sc">^</span>fyear, <span class="at">data =</span> ., <span class="at">cluster =</span> <span class="fu">c</span>(<span class="st">"gvkey"</span>, <span class="st">"ff_30ind_name"</span>))</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="fu">mget</span>(<span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">"did_model_s3a_"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">names&lt;-</span><span class="st">`</span>(<span class="at">value =</span> <span class="fu">c</span>(<span class="st">"(a) treatment"</span>, <span class="st">"(b) intensity"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">etable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>, <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"DiD Results with `"</span>, intensity_measure_name, <span class="st">"`"</span>, <span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">font_size =</span> <span class="dv">8</span>,       <span class="co"># Smaller font (default is 16px)</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>,   <span class="co"># Table width fits content</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"condensed"</span>)</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>ppe_lease_intensity: </code></pre>
</div>
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>DiD Results with `ppe_lease_intensity`</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(a) treatment</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(b) intensity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Dependent Var.:</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">treated x post_2005</td>
<td style="text-align: left;">-0.0079 (0.0077)</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">post_2005 x large</td>
<td style="text-align: left;">-0.0122 (0.0088)</td>
<td style="text-align: left;">-0.0057 (0.0048)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">treated x post_2005 x large</td>
<td style="text-align: left;">0.0149 (0.0101)</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">intensity_2000 x post_2005</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0312 (0.0218)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">intensity_2000 x post_2005 x large</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0982* (0.0367)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fixed-Effects:</td>
<td style="text-align: left;">----------------</td>
<td style="text-align: left;">----------------</td>
</tr>
<tr class="odd">
<td style="text-align: left;">gvkey</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">fyear</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ff_30ind_name-fyear</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">__________________________________</td>
<td style="text-align: left;">________________</td>
<td style="text-align: left;">________________</td>
</tr>
<tr class="odd">
<td style="text-align: left;">S.E.: Clustered</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Observations</td>
<td style="text-align: left;">24,775</td>
<td style="text-align: left;">24,775</td>
</tr>
<tr class="odd">
<td style="text-align: left;">R2</td>
<td style="text-align: left;">0.78916</td>
<td style="text-align: left;">0.78917</td>
</tr>
<tr class="even">
<td style="text-align: left;">Within R2</td>
<td style="text-align: left;">0.00029</td>
<td style="text-align: left;">0.00033</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="sec-s3b-building-intensity" class="level3">
<h3 class="anchored" data-anchor-id="sec-s3b-building-intensity">s3.2. builing intensity</h3>
<p><code>building_intensity</code> is chosen to measure a firm’s long-term exposure to buildings at cost under the PPE.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## choose the group definition:</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>intensity_measure_name <span class="ot">&lt;-</span> candidate_intensity_measure[<span class="dv">3</span>]</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>data_firm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">==</span> intensity_measure_year) <span class="sc">%&gt;%</span> <span class="co"># use `fyear` may create multiple observations for the same firm. E.g. filter(gvkey == 23535, dyear == 2005)</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fyear) <span class="sc">%&gt;%</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">median_at =</span> <span class="fu">median</span>(at, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">large =</span> <span class="fu">ifelse</span>(at <span class="sc">&gt;</span> median_at, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, <span class="at">intensity_2000 =</span> <span class="fu">all_of</span>(intensity_measure_name), large)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>data_did <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="do">## merge the grouping variable</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> data_firm, <span class="at">by =</span> <span class="fu">join_by</span>(gvkey) ) <span class="sc">%&gt;%</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="do">## merge the FF 30 industry classifiaction</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> FF_30ind, <span class="at">by =</span> <span class="fu">join_by</span>(sic)) <span class="sc">%&gt;%</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="do">## exclude certain industries</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    ff_30ind <span class="sc">!=</span> <span class="dv">20</span>, <span class="co"># exclude Utiltiy (number 20)</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span>(sic <span class="sc">&gt;=</span> <span class="dv">6000</span> <span class="sc">&amp;</span> sic <span class="sc">&lt;=</span> <span class="dv">6199</span>) <span class="co"># exclude banks under Banking, Insurance, Real Estate, Trading (number 29)</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">## pre- &amp; post-</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">indexyear =</span> (fyear <span class="sc">-</span> base_year), <span class="co"># year index with 2005 as base 0.</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">post_2005 =</span> <span class="fu">as.numeric</span>(fyear <span class="sc">&gt;</span> base_year)  <span class="co"># whether it is after the 2005 reform</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="do">## gvkey(s) for balanced panel":</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>data_did_balanced_id <span class="ot">&lt;-</span> data_did <span class="sc">%&gt;%</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">-</span> n_pre <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gvkey) <span class="sc">%&gt;%</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count_obs =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(book_leverage) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(intensity_2000))) <span class="sc">%&gt;%</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(count_obs <span class="sc">==</span> period_end <span class="sc">-</span> period_start <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> n_pre) <span class="sc">%&gt;%</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span>gvkey</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>DiD Analysis:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(intensity_measure_name); <span class="fu">cat</span>(<span class="st">": </span><span class="sc">\n</span><span class="st">"</span>);</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="do">## create the combinations of parameters:</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>fml_parameters <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">choice_treatment =</span> <span class="fu">c</span>(<span class="st">"intensity_2000"</span>, <span class="st">"treated"</span>), <span class="co"># what is the treatment measure: continuous/binary</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">controls_inclusion =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>),<span class="co"># whether to include controls</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">balanced_panel =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>), <span class="co"># whether keep a balanced panel</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(balanced_panel) <span class="sc">%&gt;%</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind.data.frame</span>(.,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">fml =</span> <span class="fu">apply</span>(<span class="at">X =</span> ., <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(parameters) {</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>      <span class="do">## parameters:</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>      choice_treatment <span class="ot">&lt;-</span> parameters[<span class="dv">1</span>]</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>      add_controls <span class="ot">&lt;-</span> parameters[<span class="dv">2</span>]</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>      is_balanced <span class="ot">&lt;-</span> parameters[<span class="dv">3</span>]</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>      <span class="do">## inputs:</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>      fml_base <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"book_leverage ~ post_2005*"</span>, choice_treatment, <span class="at">sep =</span> <span class="st">""</span>) <span class="co"># the baseline model</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>      fml_base_controls <span class="ot">&lt;-</span> <span class="st">" + roa + ebitda_at + log(at_thousand) + altman_Z + tangibility + current_ratio"</span> <span class="co"># the potential controls</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>      fml_base_fe <span class="ot">&lt;-</span> <span class="st">" | gvkey + indexyear + ff_30ind_name^indexyear"</span> <span class="co"># fixed effects</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>      <span class="do">## output formula:</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>      fml_output <span class="ot">&lt;-</span> <span class="fu">paste</span>(</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>        fml_base,</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ifelse</span>(add_controls <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">yes =</span> fml_base_controls, <span class="at">no =</span> <span class="st">""</span>),</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>        fml_base_fe,</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(fml_output)</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  <span class="do">## assign a name for each regression:</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">paste</span>(<span class="st">"("</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.), <span class="st">")"</span>, <span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, <span class="fu">everything</span>())</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="do">## construct the data used for the loop:</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>data_did_loop <span class="ot">&lt;-</span> data_did <span class="sc">%&gt;%</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, fyear, indexyear, intensity_2000, post_2005,</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>         book_leverage, debt_ebitda, sic, ff_30ind_name,</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>         altman_Z, kz, market_book, tangibility, current_ratio) <span class="sc">%&gt;%</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(intensity_2000) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(at)) <span class="sc">%&gt;%</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">gvkey =</span> <span class="fu">as.factor</span>(gvkey),</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">fyear =</span> <span class="fu">as.factor</span>(fyear),</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated =</span> <span class="fu">ifelse</span>(intensity_2000 <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">ebitda_at =</span> ebitda <span class="sc">/</span> at,</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">at_thousand =</span> at <span class="sc">*</span> <span class="dv">10</span><span class="sc">^-</span><span class="dv">3</span>,</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">large =</span> <span class="fu">ifelse</span>(large, <span class="at">yes =</span> <span class="st">"Large"</span>, <span class="at">no =</span> <span class="st">"Small"</span>),</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">tangiblity_exbnl =</span> tangibility <span class="sc">-</span> bnl_intensity,</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">bnl =</span> bnl_intensity <span class="sc">*</span> at,</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated_large =</span> <span class="fu">paste</span>(treated, large, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>data_did_loop_balanced <span class="ot">&lt;-</span> data_did <span class="sc">%&gt;%</span></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gvkey <span class="sc">%in%</span> data_did_balanced_id) <span class="sc">%&gt;%</span></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, fyear, indexyear, intensity_2000, post_2005,</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>         book_leverage, debt_ebitda, sic, ff_30ind_name,</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>         altman_Z, kz, market_book, tangibility, current_ratio) <span class="sc">%&gt;%</span></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(intensity_2000) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(at)) <span class="sc">%&gt;%</span></span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">gvkey =</span> <span class="fu">as.factor</span>(gvkey),</span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">fyear =</span> <span class="fu">as.factor</span>(fyear),</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated =</span> <span class="fu">ifelse</span>(intensity_2000 <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">ebitda_at =</span> ebitda <span class="sc">/</span> at,</span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">at_thousand =</span> at <span class="sc">*</span> <span class="dv">10</span><span class="sc">^-</span><span class="dv">3</span>,</span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">large =</span> <span class="fu">ifelse</span>(large, <span class="at">yes =</span> <span class="st">"Large"</span>, <span class="at">no =</span> <span class="st">"Small"</span>),</span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">tangiblity_exbnl =</span> tangibility <span class="sc">-</span> bnl_intensity,</span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">bnl =</span> bnl_intensity <span class="sc">*</span> at,</span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated_large =</span> <span class="fu">paste</span>(treated, large, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a><span class="do">## store all results</span></span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a>fml_results <span class="ot">&lt;-</span> fml_parameters <span class="sc">%&gt;%</span></span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(<span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(parameters) {</span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>    <span class="do">## parameters:</span></span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a>    is_balanced <span class="ot">&lt;-</span> parameters[<span class="dv">4</span>]</span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a>    fml_formula <span class="ot">&lt;-</span> parameters[<span class="dv">5</span>]</span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a>    <span class="do">## data:</span></span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (is_balanced <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data_did_loop_balanced</span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data_did_loop</span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a>    <span class="do">## regression:</span></span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a>    did_model <span class="ot">&lt;-</span> fixest<span class="sc">::</span><span class="fu">feols</span>(<span class="at">fml =</span> <span class="fu">formula</span>(fml_formula),</span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> data,</span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cluster =</span> <span class="fu">c</span>(<span class="st">"gvkey"</span>, <span class="st">"ff_30ind_name"</span>)</span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(did_model)</span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb14-108"><a href="#cb14-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-109"><a href="#cb14-109" aria-hidden="true" tabindex="-1"></a><span class="do">### DiD result using post-:</span></span>
<span id="cb14-110"><a href="#cb14-110" aria-hidden="true" tabindex="-1"></a>fml_results <span class="sc">%&gt;%</span></span>
<span id="cb14-111"><a href="#cb14-111" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">names&lt;-</span><span class="st">`</span>(<span class="at">value =</span> <span class="fu">unlist</span>(fml_parameters[,<span class="dv">1</span>])) <span class="sc">%&gt;%</span></span>
<span id="cb14-112"><a href="#cb14-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">etable</span>(</span>
<span id="cb14-113"><a href="#cb14-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">order =</span> <span class="st">"post"</span>,</span>
<span id="cb14-114"><a href="#cb14-114" aria-hidden="true" tabindex="-1"></a>    <span class="co"># keep = "post",</span></span>
<span id="cb14-115"><a href="#cb14-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">extralines =</span> <span class="fu">list</span>(</span>
<span id="cb14-116"><a href="#cb14-116" aria-hidden="true" tabindex="-1"></a>      <span class="do">## Controls:</span></span>
<span id="cb14-117"><a href="#cb14-117" aria-hidden="true" tabindex="-1"></a>      <span class="st">"^_Controls"</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">unlist</span>(fml_parameters[,<span class="dv">3</span>]), <span class="at">yes =</span> <span class="st">"Yes"</span>, <span class="at">no =</span> <span class="st">"No"</span>),</span>
<span id="cb14-118"><a href="#cb14-118" aria-hidden="true" tabindex="-1"></a>      <span class="do">## the identity of the sample:</span></span>
<span id="cb14-119"><a href="#cb14-119" aria-hidden="true" tabindex="-1"></a>      <span class="st">"__Sample"</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">unlist</span>(fml_parameters[,<span class="dv">4</span>]), <span class="at">yes =</span> <span class="st">"Balanced Panel"</span>, <span class="at">no =</span> <span class="st">"Full Sample"</span>) <span class="co"># whether used a balanced panel or a full sample.</span></span>
<span id="cb14-120"><a href="#cb14-120" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb14-121"><a href="#cb14-121" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>, <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"DiD Results with `"</span>, intensity_measure_name, <span class="st">"`"</span>, <span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-122"><a href="#cb14-122" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(</span>
<span id="cb14-123"><a href="#cb14-123" aria-hidden="true" tabindex="-1"></a>    <span class="at">font_size =</span> <span class="dv">8</span>,       <span class="co"># Smaller font (default is 16px)</span></span>
<span id="cb14-124"><a href="#cb14-124" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>,   <span class="co"># Table width fits content</span></span>
<span id="cb14-125"><a href="#cb14-125" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"condensed"</span>)</span>
<span id="cb14-126"><a href="#cb14-126" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>building_intensity: </code></pre>
</div>
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>DiD Results with `building_intensity`</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(1)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(2)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(3)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(4)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(5)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(6)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(7)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(8)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Dependent Var.:</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">post_2005 x intensity_2000</td>
<td style="text-align: left;">-0.0732*** (0.0152)</td>
<td style="text-align: left;">-0.0466* (0.0174)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0831*** (0.0134)</td>
<td style="text-align: left;">-0.0524*** (0.0142)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">post_2005 x treated</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0220*** (0.0033)</td>
<td style="text-align: left;">-0.0158*** (0.0033)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0170*** (0.0039)</td>
<td style="text-align: left;">-0.0099* (0.0045)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">roa</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">6.82e-5* (2.81e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">7.08e-5* (2.83e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0047*** (0.0011)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0047*** (0.0011)</td>
</tr>
<tr class="even">
<td style="text-align: left;">ebitda_at</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">3.97e-5 (9.89e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">3.65e-5 (9.97e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0017** (0.0006)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0017** (0.0006)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">log(at_thousand)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0090. (0.0051)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0087 (0.0051)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0193** (0.0061)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0194** (0.0062)</td>
</tr>
<tr class="even">
<td style="text-align: left;">altman_Z</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">6.9e-6. (3.93e-6)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">7.08e-6. (3.92e-6)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">8.84e-5* (3.79e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">8.78e-5* (3.79e-5)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tangibility</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.2109*** (0.0284)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.2110*** (0.0285)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.1954*** (0.0247)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.1978*** (0.0244)</td>
</tr>
<tr class="even">
<td style="text-align: left;">current_ratio</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-9.55e-5** (3.31e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-9.56e-5** (3.28e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-5.92e-5** (2.12e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-5.94e-5** (2.12e-5)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Controls</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fixed-Effects:</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">--------------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">--------------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">--------------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">--------------------</td>
</tr>
<tr class="odd">
<td style="text-align: left;">gvkey</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">indexyear</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ff_30ind_name-indexyear</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">__________________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">____________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">____________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">____________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">____________________</td>
</tr>
<tr class="odd">
<td style="text-align: left;">S.E.: Clustered</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Observations</td>
<td style="text-align: left;">26,682</td>
<td style="text-align: left;">24,922</td>
<td style="text-align: left;">26,682</td>
<td style="text-align: left;">24,922</td>
<td style="text-align: left;">19,500</td>
<td style="text-align: left;">18,198</td>
<td style="text-align: left;">19,500</td>
<td style="text-align: left;">18,198</td>
</tr>
<tr class="odd">
<td style="text-align: left;">R2</td>
<td style="text-align: left;">0.79236</td>
<td style="text-align: left;">0.78408</td>
<td style="text-align: left;">0.79244</td>
<td style="text-align: left;">0.78417</td>
<td style="text-align: left;">0.78470</td>
<td style="text-align: left;">0.77398</td>
<td style="text-align: left;">0.78448</td>
<td style="text-align: left;">0.77388</td>
</tr>
<tr class="even">
<td style="text-align: left;">Within R2</td>
<td style="text-align: left;">0.00167</td>
<td style="text-align: left;">0.02047</td>
<td style="text-align: left;">0.00206</td>
<td style="text-align: left;">0.02090</td>
<td style="text-align: left;">0.00271</td>
<td style="text-align: left;">0.02412</td>
<td style="text-align: left;">0.00167</td>
<td style="text-align: left;">0.02370</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Balanced Panel</td>
<td style="text-align: left;">Balanced Panel</td>
<td style="text-align: left;">Balanced Panel</td>
<td style="text-align: left;">Balanced Panel</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>All treatment effect estimates are significantly negative across all specifications.</p>
<p>Next we estimate the yearly treatment effects.</p>
<section id="individual-year-treatment-plots" class="level4">
<h4 class="anchored" data-anchor-id="individual-year-treatment-plots">Individual Year Treatment Plots</h4>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">## create the combinations of parameters:</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>fml_parameters <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">choice_treatment =</span> <span class="fu">c</span>(<span class="st">"intensity_2000"</span>, <span class="st">"treated"</span>), <span class="co"># what is the treatment measure: continuous/binary</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">controls_inclusion =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>),<span class="co"># whether to include controls</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">balanced_panel =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>), <span class="co"># whether keep a balanced panel</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(balanced_panel) <span class="sc">%&gt;%</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind.data.frame</span>(.,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">fml =</span> <span class="fu">apply</span>(<span class="at">X =</span> ., <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(parameters) {</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>      <span class="do">## parameters:</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>      choice_treatment <span class="ot">&lt;-</span> parameters[<span class="dv">1</span>]</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>      add_controls <span class="ot">&lt;-</span> parameters[<span class="dv">2</span>]</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>      is_balanced <span class="ot">&lt;-</span> parameters[<span class="dv">3</span>]</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>      <span class="do">## inputs:</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>      fml_base <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"book_leverage ~ i(indexyear, "</span>, choice_treatment, <span class="st">", ref = -1)"</span>, <span class="at">sep =</span> <span class="st">""</span>) <span class="co"># the baseline model</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>      fml_base_controls <span class="ot">&lt;-</span> <span class="st">" + roa + ebitda_at + log(at_thousand) + altman_Z + tangibility + current_ratio"</span> <span class="co"># the potential controls</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>      fml_base_fe <span class="ot">&lt;-</span> <span class="st">" | gvkey + indexyear + ff_30ind_name^indexyear"</span> <span class="co"># fixed effects</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>      <span class="do">## output formula:</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>      fml_output <span class="ot">&lt;-</span> <span class="fu">paste</span>(</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>        fml_base,</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ifelse</span>(add_controls <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">yes =</span> fml_base_controls, <span class="at">no =</span> <span class="st">""</span>),</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>        fml_base_fe,</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(fml_output)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>  <span class="do">## assign a name for each regression:</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">paste</span>(<span class="st">"("</span>, letters[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.)], <span class="st">")"</span>, <span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, <span class="fu">everything</span>())</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>fml_parameters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
  name  choice_treatment controls_inclusion balanced_panel fml                  
  &lt;chr&gt; &lt;chr&gt;            &lt;lgl&gt;              &lt;lgl&gt;          &lt;chr&gt;                
1 (a)   intensity_2000   FALSE              FALSE          book_leverage ~ i(in…
2 (b)   intensity_2000   TRUE               FALSE          book_leverage ~ i(in…
3 (c)   treated          FALSE              FALSE          book_leverage ~ i(in…
4 (d)   treated          TRUE               FALSE          book_leverage ~ i(in…
5 (e)   intensity_2000   FALSE              TRUE           book_leverage ~ i(in…
6 (f)   intensity_2000   TRUE               TRUE           book_leverage ~ i(in…
7 (g)   treated          FALSE              TRUE           book_leverage ~ i(in…
8 (h)   treated          TRUE               TRUE           book_leverage ~ i(in…</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="do">## construct the data used for the loop:</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>data_did_loop <span class="ot">&lt;-</span> data_did <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, fyear, indexyear, intensity_2000, post_2005,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>         book_leverage, debt_ebitda, sic, ff_30ind_name,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>         altman_Z, kz, market_book, tangibility, current_ratio) <span class="sc">%&gt;%</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">-</span> n_pre <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(intensity_2000) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(at)) <span class="sc">%&gt;%</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">gvkey =</span> <span class="fu">as.factor</span>(gvkey),</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">fyear =</span> <span class="fu">as.factor</span>(fyear),</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated =</span> <span class="fu">ifelse</span>(intensity_2000 <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">ebitda_at =</span> ebitda <span class="sc">/</span> at,</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">at_thousand =</span> at <span class="sc">*</span> <span class="dv">10</span><span class="sc">^-</span><span class="dv">3</span>,</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">large =</span> <span class="fu">ifelse</span>(large, <span class="at">yes =</span> <span class="st">"Large"</span>, <span class="at">no =</span> <span class="st">"Small"</span>),</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">tangiblity_exbnl =</span> tangibility <span class="sc">-</span> bnl_intensity,</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">bnl =</span> bnl_intensity <span class="sc">*</span> at,</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated_large =</span> <span class="fu">paste</span>(treated, large, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>data_did_loop_balanced <span class="ot">&lt;-</span> data_did <span class="sc">%&gt;%</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gvkey <span class="sc">%in%</span> data_did_balanced_id) <span class="sc">%&gt;%</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, fyear, indexyear, intensity_2000, post_2005,</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>         book_leverage, debt_ebitda, sic, ff_30ind_name,</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>         altman_Z, kz, market_book, tangibility, current_ratio) <span class="sc">%&gt;%</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">-</span> n_pre <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(intensity_2000) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(at)) <span class="sc">%&gt;%</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">gvkey =</span> <span class="fu">as.factor</span>(gvkey),</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">fyear =</span> <span class="fu">as.factor</span>(fyear),</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated =</span> <span class="fu">ifelse</span>(intensity_2000 <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">ebitda_at =</span> ebitda <span class="sc">/</span> at,</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">at_thousand =</span> at <span class="sc">*</span> <span class="dv">10</span><span class="sc">^-</span><span class="dv">3</span>,</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">large =</span> <span class="fu">ifelse</span>(large, <span class="at">yes =</span> <span class="st">"Large"</span>, <span class="at">no =</span> <span class="st">"Small"</span>),</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">tangiblity_exbnl =</span> tangibility <span class="sc">-</span> bnl_intensity,</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">bnl =</span> bnl_intensity <span class="sc">*</span> at,</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated_large =</span> <span class="fu">paste</span>(treated, large, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a><span class="do">## store all results</span></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>fml_results <span class="ot">&lt;-</span> fml_parameters <span class="sc">%&gt;%</span></span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(<span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(parameters) {</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>    <span class="do">## parameters:</span></span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>    is_balanced <span class="ot">&lt;-</span> parameters[<span class="dv">4</span>]</span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>    fml_formula <span class="ot">&lt;-</span> parameters[<span class="dv">5</span>]</span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>    <span class="do">## data:</span></span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (is_balanced <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data_did_loop_balanced</span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data_did_loop</span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>    <span class="do">## regression:</span></span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>    did_model <span class="ot">&lt;-</span> fixest<span class="sc">::</span><span class="fu">feols</span>(<span class="at">fml =</span> <span class="fu">formula</span>(fml_formula),</span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> data,</span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cluster =</span> <span class="fu">c</span>(<span class="st">"gvkey"</span>, <span class="st">"ff_30ind_name"</span>)</span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(did_model)</span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a>  })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 2,197 observations removed because of NA and infinite values (RHS: 2,197).
NOTE: 2,197 observations removed because of NA and infinite values (RHS: 2,197).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 1,539 observations removed because of NA and infinite values (RHS: 1,539).
NOTE: 1,539 observations removed because of NA and infinite values (RHS: 1,539).</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="do">### create the table:</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>fml_results <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">names&lt;-</span><span class="st">`</span>(<span class="at">value =</span> <span class="fu">unlist</span>(fml_parameters[,<span class="dv">1</span>])) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">etable</span>(</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">order =</span> <span class="st">"indexyear"</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># keep = "post",</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">extralines =</span> <span class="fu">list</span>(</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>      <span class="do">## Controls:</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"^_Controls"</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">unlist</span>(fml_parameters[,<span class="dv">3</span>]), <span class="at">yes =</span> <span class="st">"Yes"</span>, <span class="at">no =</span> <span class="st">"No"</span>),</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>      <span class="do">## the identity of the sample:</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">"__Sample"</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">unlist</span>(fml_parameters[,<span class="dv">4</span>]), <span class="at">yes =</span> <span class="st">"Balanced Panel"</span>, <span class="at">no =</span> <span class="st">"Full Sample"</span>) <span class="co"># whether used a balanced panel or a full sample.</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>, <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"DiD Results with `"</span>, intensity_measure_name, <span class="st">"`"</span>, <span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">font_size =</span> <span class="dv">8</span>,       <span class="co"># Smaller font (default is 16px)</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>,   <span class="co"># Table width fits content</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"condensed"</span>)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>DiD Results with `building_intensity`</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(a)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(b)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(c)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(d)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(e)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(f)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(g)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(h)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Dependent Var.:</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">intensity_2000 x indexyear = -3</td>
<td style="text-align: left;">0.0378. (0.0187)</td>
<td style="text-align: left;">0.0265 (0.0164)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0248 (0.0311)</td>
<td style="text-align: left;">0.0142 (0.0349)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">intensity_2000 x indexyear = -2</td>
<td style="text-align: left;">0.0066 (0.0113)</td>
<td style="text-align: left;">-0.0092 (0.0147)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0070 (0.0159)</td>
<td style="text-align: left;">0.0018 (0.0160)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">intensity_2000 x indexyear = 0</td>
<td style="text-align: left;">-0.0454* (0.0165)</td>
<td style="text-align: left;">-0.0482** (0.0160)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0564** (0.0179)</td>
<td style="text-align: left;">-0.0528** (0.0145)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">intensity_2000 x indexyear = 1</td>
<td style="text-align: left;">-0.0889*** (0.0155)</td>
<td style="text-align: left;">-0.0751*** (0.0159)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0942*** (0.0142)</td>
<td style="text-align: left;">-0.0720*** (0.0146)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">intensity_2000 x indexyear = 2</td>
<td style="text-align: left;">-0.0806*** (0.0214)</td>
<td style="text-align: left;">-0.0531. (0.0261)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.1115*** (0.0165)</td>
<td style="text-align: left;">-0.0783*** (0.0195)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">intensity_2000 x indexyear = 3</td>
<td style="text-align: left;">-0.0785** (0.0262)</td>
<td style="text-align: left;">-0.0516 (0.0318)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0930*** (0.0209)</td>
<td style="text-align: left;">-0.0644* (0.0265)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">treated x indexyear = -3</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0283*** (0.0055)</td>
<td style="text-align: left;">0.0282*** (0.0053)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0190*** (0.0049)</td>
<td style="text-align: left;">0.0194** (0.0055)</td>
</tr>
<tr class="even">
<td style="text-align: left;">treated x indexyear = -2</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0038 (0.0031)</td>
<td style="text-align: left;">0.0030 (0.0035)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0040 (0.0037)</td>
<td style="text-align: left;">0.0041 (0.0040)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">treated x indexyear = 0</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0082* (0.0032)</td>
<td style="text-align: left;">-0.0077. (0.0038)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0109** (0.0034)</td>
<td style="text-align: left;">-0.0101** (0.0034)</td>
</tr>
<tr class="even">
<td style="text-align: left;">treated x indexyear = 1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0244*** (0.0045)</td>
<td style="text-align: left;">-0.0202*** (0.0047)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0162** (0.0053)</td>
<td style="text-align: left;">-0.0108. (0.0058)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">treated x indexyear = 2</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0203*** (0.0049)</td>
<td style="text-align: left;">-0.0123* (0.0049)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0209** (0.0060)</td>
<td style="text-align: left;">-0.0126. (0.0063)</td>
</tr>
<tr class="even">
<td style="text-align: left;">treated x indexyear = 3</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0183** (0.0056)</td>
<td style="text-align: left;">-0.0115. (0.0064)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0208*** (0.0055)</td>
<td style="text-align: left;">-0.0141* (0.0059)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">roa</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">3.61e-5 (3.24e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">3.71e-5 (3.22e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0053*** (0.0011)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0053*** (0.0012)</td>
</tr>
<tr class="even">
<td style="text-align: left;">ebitda_at</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">3.23e-5 (8.17e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">3.23e-5 (8.39e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0026** (0.0008)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0026** (0.0008)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">log(at_thousand)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0065 (0.0050)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0061 (0.0051)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0159** (0.0053)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0158** (0.0053)</td>
</tr>
<tr class="even">
<td style="text-align: left;">altman_Z</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">6.05e-6. (3.46e-6)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">6.46e-6. (3.38e-6)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">8.97e-5* (4.09e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">9e-5* (4.12e-5)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tangibility</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.2177*** (0.0238)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.2171*** (0.0240)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.1838*** (0.0218)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.1853*** (0.0217)</td>
</tr>
<tr class="even">
<td style="text-align: left;">current_ratio</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0001* (4.84e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0001* (4.75e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-7.68e-5* (3.09e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-7.8e-5* (3.03e-5)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Controls</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fixed-Effects:</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">-------------------</td>
</tr>
<tr class="odd">
<td style="text-align: left;">gvkey</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">indexyear</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ff_30ind_name-indexyear</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">___________________</td>
</tr>
<tr class="odd">
<td style="text-align: left;">S.E.: Clustered</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Observations</td>
<td style="text-align: left;">32,714</td>
<td style="text-align: left;">30,517</td>
<td style="text-align: left;">32,714</td>
<td style="text-align: left;">30,517</td>
<td style="text-align: left;">22,750</td>
<td style="text-align: left;">21,211</td>
<td style="text-align: left;">22,750</td>
<td style="text-align: left;">21,211</td>
</tr>
<tr class="odd">
<td style="text-align: left;">R2</td>
<td style="text-align: left;">0.77520</td>
<td style="text-align: left;">0.76777</td>
<td style="text-align: left;">0.77569</td>
<td style="text-align: left;">0.76832</td>
<td style="text-align: left;">0.76307</td>
<td style="text-align: left;">0.75267</td>
<td style="text-align: left;">0.76310</td>
<td style="text-align: left;">0.75288</td>
</tr>
<tr class="even">
<td style="text-align: left;">Within R2</td>
<td style="text-align: left;">0.00242</td>
<td style="text-align: left;">0.02258</td>
<td style="text-align: left;">0.00460</td>
<td style="text-align: left;">0.02487</td>
<td style="text-align: left;">0.00380</td>
<td style="text-align: left;">0.02356</td>
<td style="text-align: left;">0.00393</td>
<td style="text-align: left;">0.02442</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Balanced Panel</td>
<td style="text-align: left;">Balanced Panel</td>
<td style="text-align: left;">Balanced Panel</td>
<td style="text-align: left;">Balanced Panel</td>
</tr>
</tbody>
</table>


</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="do">### create the plots:</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># fml_parameters[which(unlist(fml_parameters$balanced_panel)), ]</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>fml_results[<span class="fu">which</span>(<span class="fu">unlist</span>(fml_parameters<span class="sc">$</span>balanced_panel))] <span class="sc">%&gt;%</span> <span class="co"># choose the balanced panel</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">iplot</span>(.,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="fu">paste</span>(<span class="st">"Time to treatment (Year; 0 = "</span>, base_year, <span class="st">")"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Treatment Effects by fiscal year: `"</span>, intensity_measure_name, <span class="st">"`"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">sub =</span> <span class="st">"Data: Balanced Panel"</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ref.line =</span> <span class="cn">FALSE</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">ref.line.par =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>),</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">pt.join =</span> <span class="cn">FALSE</span>,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">3.5</span>, <span class="fl">3.5</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        ); <span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="sc">-</span><span class="dv">3</span><span class="sc">:</span><span class="dv">3</span>); <span class="fu">abline</span>(<span class="at">v =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">3</span>); <span class="fu">legend</span>(<span class="st">'bottomleft'</span>, <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">17</span>, <span class="dv">15</span>, <span class="dv">21</span>), <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">'intensity'</span>, <span class="st">'intensity + controls'</span>, <span class="st">'dummy'</span>, <span class="st">'dummy + controls'</span>));</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AFA_test_2005_PPE_clean_files/figure-html/s3b-did-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>fml_results[<span class="fu">which</span>(<span class="sc">!</span><span class="fu">unlist</span>(fml_parameters<span class="sc">$</span>balanced_panel))] <span class="sc">%&gt;%</span> <span class="co"># choose full sample</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">iplot</span>(.,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="fu">paste</span>(<span class="st">"Time to treatment (Year; 0 = "</span>, base_year, <span class="st">")"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Treatment Effect by fiscal year: `"</span>, intensity_measure_name, <span class="st">"`"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">sub =</span> <span class="st">"Data: Full Sample"</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">ref.line =</span> <span class="cn">FALSE</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">ref.line.par =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>),</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">pt.join =</span> <span class="cn">FALSE</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">3.5</span>, <span class="fl">3.5</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>        ); <span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="sc">-</span><span class="dv">3</span><span class="sc">:</span><span class="dv">3</span>); <span class="fu">abline</span>(<span class="at">v =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">3</span>); <span class="fu">legend</span>(<span class="st">'bottomleft'</span>, <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">17</span>, <span class="dv">15</span>, <span class="dv">21</span>), <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">'intensity'</span>, <span class="st">'intensity + controls'</span>, <span class="st">'dummy'</span>, <span class="st">'dummy + controls'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AFA_test_2005_PPE_clean_files/figure-html/s3b-did-plot-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We plot the yearly treatment effect estimates with different model specifications using both the balanced panel and the full sample. As the full sample will contain some firms with extremely high leverage and high <code>building intensity</code> before 2004, we believe that it is more reasonable to use a balanced sample for the analysis.</p>
<p>We conclude that the pre-trend assumption is not violated and we can see a significant negative treatment effect around 2005 (end of fiscal year 2004) and after 2005.</p>
</section>
</section>
<section id="sec-s3c-land-intensity" class="level3">
<h3 class="anchored" data-anchor-id="sec-s3c-land-intensity">s3.3. land intensity</h3>
<p><code>land_intensity</code> is chosen to measure a firm’s long-term exposure to land and improvements at cost under the PPE.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">## choose the group definition:</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>intensity_measure_name <span class="ot">&lt;-</span> candidate_intensity_measure[<span class="dv">4</span>]</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>data_firm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">==</span> intensity_measure_year) <span class="sc">%&gt;%</span> <span class="co"># use `fyear` may create multiple observations for the same firm. E.g. filter(gvkey == 23535, dyear == 2005)</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fyear) <span class="sc">%&gt;%</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">median_at =</span> <span class="fu">median</span>(at, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">large =</span> <span class="fu">ifelse</span>(at <span class="sc">&gt;</span> median_at, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, <span class="at">intensity_2000 =</span> <span class="fu">all_of</span>(intensity_measure_name), large)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>data_did <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="do">## merge the grouping variable</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> data_firm, <span class="at">by =</span> <span class="fu">join_by</span>(gvkey) ) <span class="sc">%&gt;%</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="do">## merge the FF 30 industry classifiaction</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> FF_30ind, <span class="at">by =</span> <span class="fu">join_by</span>(sic)) <span class="sc">%&gt;%</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="do">## exclude certain industries</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    ff_30ind <span class="sc">!=</span> <span class="dv">20</span>, <span class="co"># exclude Utiltiy (number 20)</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span>(sic <span class="sc">&gt;=</span> <span class="dv">6000</span> <span class="sc">&amp;</span> sic <span class="sc">&lt;=</span> <span class="dv">6199</span>) <span class="co"># exclude banks under Banking, Insurance, Real Estate, Trading (number 29)</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">## pre- &amp; post-</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">indexyear =</span> (fyear <span class="sc">-</span> base_year), <span class="co"># year index with 2005 as base 0.</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">post_2005 =</span> <span class="fu">as.numeric</span>(fyear <span class="sc">&gt;</span> base_year)  <span class="co"># whether it is after the 2005 reform</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="do">## gvkey(s) for balanced panel":</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>data_did_balanced_id <span class="ot">&lt;-</span> data_did <span class="sc">%&gt;%</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">-</span> n_pre <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gvkey) <span class="sc">%&gt;%</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count_obs =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(book_leverage) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(intensity_2000))) <span class="sc">%&gt;%</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(count_obs <span class="sc">==</span> period_end <span class="sc">-</span> period_start <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> n_pre) <span class="sc">%&gt;%</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span>gvkey</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>DiD Analysis:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(intensity_measure_name); <span class="fu">cat</span>(<span class="st">": </span><span class="sc">\n</span><span class="st">"</span>);</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="do">## create the combinations of parameters:</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>fml_parameters <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">choice_treatment =</span> <span class="fu">c</span>(<span class="st">"intensity_2000"</span>, <span class="st">"treated"</span>), <span class="co"># what is the treatment measure: continuous/binary</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">controls_inclusion =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>),<span class="co"># whether to include controls</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">balanced_panel =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>), <span class="co"># whether keep a balanced panel</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(balanced_panel) <span class="sc">%&gt;%</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind.data.frame</span>(.,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">fml =</span> <span class="fu">apply</span>(<span class="at">X =</span> ., <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(parameters) {</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>      <span class="do">## parameters:</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>      choice_treatment <span class="ot">&lt;-</span> parameters[<span class="dv">1</span>]</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>      add_controls <span class="ot">&lt;-</span> parameters[<span class="dv">2</span>]</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>      is_balanced <span class="ot">&lt;-</span> parameters[<span class="dv">3</span>]</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>      <span class="do">## inputs:</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>      fml_base <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"book_leverage ~ post_2005*"</span>, choice_treatment, <span class="at">sep =</span> <span class="st">""</span>) <span class="co"># the baseline model</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>      fml_base_controls <span class="ot">&lt;-</span> <span class="st">" + roa + ebitda_at + log(at_thousand) + altman_Z + tangibility + current_ratio"</span> <span class="co"># the potential controls</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>      fml_base_fe <span class="ot">&lt;-</span> <span class="st">" | gvkey + indexyear + ff_30ind_name^indexyear"</span> <span class="co"># fixed effects</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>      <span class="do">## output formula:</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>      fml_output <span class="ot">&lt;-</span> <span class="fu">paste</span>(</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>        fml_base,</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ifelse</span>(add_controls <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">yes =</span> fml_base_controls, <span class="at">no =</span> <span class="st">""</span>),</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>        fml_base_fe,</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(fml_output)</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>  <span class="do">## assign a name for each regression:</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">paste</span>(<span class="st">"("</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.), <span class="st">")"</span>, <span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, <span class="fu">everything</span>())</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a><span class="do">## construct the data used for the loop:</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>data_did_loop <span class="ot">&lt;-</span> data_did <span class="sc">%&gt;%</span></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, fyear, indexyear, intensity_2000, post_2005,</span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>         book_leverage, debt_ebitda, sic, ff_30ind_name,</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>         altman_Z, kz, market_book, tangibility, current_ratio) <span class="sc">%&gt;%</span></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(intensity_2000) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(at)) <span class="sc">%&gt;%</span></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">gvkey =</span> <span class="fu">as.factor</span>(gvkey),</span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">fyear =</span> <span class="fu">as.factor</span>(fyear),</span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated =</span> <span class="fu">ifelse</span>(intensity_2000 <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">ebitda_at =</span> ebitda <span class="sc">/</span> at,</span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">at_thousand =</span> at <span class="sc">*</span> <span class="dv">10</span><span class="sc">^-</span><span class="dv">3</span>,</span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">large =</span> <span class="fu">ifelse</span>(large, <span class="at">yes =</span> <span class="st">"Large"</span>, <span class="at">no =</span> <span class="st">"Small"</span>),</span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">tangiblity_exbnl =</span> tangibility <span class="sc">-</span> bnl_intensity,</span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">bnl =</span> bnl_intensity <span class="sc">*</span> at,</span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated_large =</span> <span class="fu">paste</span>(treated, large, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a>data_did_loop_balanced <span class="ot">&lt;-</span> data_did <span class="sc">%&gt;%</span></span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gvkey <span class="sc">%in%</span> data_did_balanced_id) <span class="sc">%&gt;%</span></span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, fyear, indexyear, intensity_2000, post_2005,</span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a>         book_leverage, debt_ebitda, sic, ff_30ind_name,</span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a>         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a>         altman_Z, kz, market_book, tangibility, current_ratio) <span class="sc">%&gt;%</span></span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span></span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(intensity_2000) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(at)) <span class="sc">%&gt;%</span></span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">gvkey =</span> <span class="fu">as.factor</span>(gvkey),</span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">fyear =</span> <span class="fu">as.factor</span>(fyear),</span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated =</span> <span class="fu">ifelse</span>(intensity_2000 <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">ebitda_at =</span> ebitda <span class="sc">/</span> at,</span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">at_thousand =</span> at <span class="sc">*</span> <span class="dv">10</span><span class="sc">^-</span><span class="dv">3</span>,</span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">large =</span> <span class="fu">ifelse</span>(large, <span class="at">yes =</span> <span class="st">"Large"</span>, <span class="at">no =</span> <span class="st">"Small"</span>),</span>
<span id="cb25-81"><a href="#cb25-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">tangiblity_exbnl =</span> tangibility <span class="sc">-</span> bnl_intensity,</span>
<span id="cb25-82"><a href="#cb25-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">bnl =</span> bnl_intensity <span class="sc">*</span> at,</span>
<span id="cb25-83"><a href="#cb25-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb25-84"><a href="#cb25-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated_large =</span> <span class="fu">paste</span>(treated, large, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb25-85"><a href="#cb25-85" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-86"><a href="#cb25-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-87"><a href="#cb25-87" aria-hidden="true" tabindex="-1"></a><span class="do">## store all results</span></span>
<span id="cb25-88"><a href="#cb25-88" aria-hidden="true" tabindex="-1"></a>fml_results <span class="ot">&lt;-</span> fml_parameters <span class="sc">%&gt;%</span></span>
<span id="cb25-89"><a href="#cb25-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(<span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(parameters) {</span>
<span id="cb25-90"><a href="#cb25-90" aria-hidden="true" tabindex="-1"></a>    <span class="do">## parameters:</span></span>
<span id="cb25-91"><a href="#cb25-91" aria-hidden="true" tabindex="-1"></a>    is_balanced <span class="ot">&lt;-</span> parameters[<span class="dv">4</span>]</span>
<span id="cb25-92"><a href="#cb25-92" aria-hidden="true" tabindex="-1"></a>    fml_formula <span class="ot">&lt;-</span> parameters[<span class="dv">5</span>]</span>
<span id="cb25-93"><a href="#cb25-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-94"><a href="#cb25-94" aria-hidden="true" tabindex="-1"></a>    <span class="do">## data:</span></span>
<span id="cb25-95"><a href="#cb25-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (is_balanced <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb25-96"><a href="#cb25-96" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data_did_loop_balanced</span>
<span id="cb25-97"><a href="#cb25-97" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb25-98"><a href="#cb25-98" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data_did_loop</span>
<span id="cb25-99"><a href="#cb25-99" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-100"><a href="#cb25-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-101"><a href="#cb25-101" aria-hidden="true" tabindex="-1"></a>    <span class="do">## regression:</span></span>
<span id="cb25-102"><a href="#cb25-102" aria-hidden="true" tabindex="-1"></a>    did_model <span class="ot">&lt;-</span> fixest<span class="sc">::</span><span class="fu">feols</span>(<span class="at">fml =</span> <span class="fu">formula</span>(fml_formula),</span>
<span id="cb25-103"><a href="#cb25-103" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> data,</span>
<span id="cb25-104"><a href="#cb25-104" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cluster =</span> <span class="fu">c</span>(<span class="st">"gvkey"</span>, <span class="st">"ff_30ind_name"</span>)</span>
<span id="cb25-105"><a href="#cb25-105" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb25-106"><a href="#cb25-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(did_model)</span>
<span id="cb25-107"><a href="#cb25-107" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb25-108"><a href="#cb25-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-109"><a href="#cb25-109" aria-hidden="true" tabindex="-1"></a><span class="do">### DiD result using post-:</span></span>
<span id="cb25-110"><a href="#cb25-110" aria-hidden="true" tabindex="-1"></a>fml_results <span class="sc">%&gt;%</span></span>
<span id="cb25-111"><a href="#cb25-111" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">names&lt;-</span><span class="st">`</span>(<span class="at">value =</span> <span class="fu">unlist</span>(fml_parameters[,<span class="dv">1</span>])) <span class="sc">%&gt;%</span></span>
<span id="cb25-112"><a href="#cb25-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">etable</span>(</span>
<span id="cb25-113"><a href="#cb25-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">order =</span> <span class="st">"post"</span>,</span>
<span id="cb25-114"><a href="#cb25-114" aria-hidden="true" tabindex="-1"></a>    <span class="co"># keep = "post",</span></span>
<span id="cb25-115"><a href="#cb25-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">extralines =</span> <span class="fu">list</span>(</span>
<span id="cb25-116"><a href="#cb25-116" aria-hidden="true" tabindex="-1"></a>      <span class="do">## Controls:</span></span>
<span id="cb25-117"><a href="#cb25-117" aria-hidden="true" tabindex="-1"></a>      <span class="st">"^_Controls"</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">unlist</span>(fml_parameters[,<span class="dv">3</span>]), <span class="at">yes =</span> <span class="st">"Yes"</span>, <span class="at">no =</span> <span class="st">"No"</span>),</span>
<span id="cb25-118"><a href="#cb25-118" aria-hidden="true" tabindex="-1"></a>      <span class="do">## the identity of the sample:</span></span>
<span id="cb25-119"><a href="#cb25-119" aria-hidden="true" tabindex="-1"></a>      <span class="st">"__Sample"</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">unlist</span>(fml_parameters[,<span class="dv">4</span>]), <span class="at">yes =</span> <span class="st">"Balanced Panel"</span>, <span class="at">no =</span> <span class="st">"Full Sample"</span>) <span class="co"># whether used a balanced panel or a full sample.</span></span>
<span id="cb25-120"><a href="#cb25-120" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb25-121"><a href="#cb25-121" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>, <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"DiD Results with `"</span>, intensity_measure_name, <span class="st">"`"</span>, <span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-122"><a href="#cb25-122" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(</span>
<span id="cb25-123"><a href="#cb25-123" aria-hidden="true" tabindex="-1"></a>    <span class="at">font_size =</span> <span class="dv">8</span>,       <span class="co"># Smaller font (default is 16px)</span></span>
<span id="cb25-124"><a href="#cb25-124" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>,   <span class="co"># Table width fits content</span></span>
<span id="cb25-125"><a href="#cb25-125" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"condensed"</span>)</span>
<span id="cb25-126"><a href="#cb25-126" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>land_intensity: </code></pre>
</div>
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>DiD Results with `land_intensity`</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(1)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(2)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(3)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(4)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(5)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(6)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(7)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(8)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Dependent Var.:</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">post_2005 x intensity_2000</td>
<td style="text-align: left;">-0.0294 (0.0302)</td>
<td style="text-align: left;">-0.0321 (0.0543)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0095 (0.0333)</td>
<td style="text-align: left;">-0.0078 (0.0484)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">post_2005 x treated</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0205*** (0.0033)</td>
<td style="text-align: left;">-0.0140*** (0.0033)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0138*** (0.0033)</td>
<td style="text-align: left;">-0.0067. (0.0035)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">roa</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">6.77e-5* (2.87e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">7.01e-5* (2.82e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0047*** (0.0011)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0047*** (0.0011)</td>
</tr>
<tr class="even">
<td style="text-align: left;">ebitda_at</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">4.34e-5 (9.8e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">3.79e-5 (9.99e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0016** (0.0006)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0017** (0.0006)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">log(at_thousand)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0092. (0.0052)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0088 (0.0052)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0199** (0.0063)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0196** (0.0063)</td>
</tr>
<tr class="even">
<td style="text-align: left;">altman_Z</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">6.73e-6. (3.88e-6)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">7e-6. (3.9e-6)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">8.77e-5* (3.8e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">8.79e-5* (3.81e-5)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tangibility</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.2144*** (0.0286)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.2117*** (0.0286)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.2005*** (0.0247)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.1989*** (0.0247)</td>
</tr>
<tr class="even">
<td style="text-align: left;">current_ratio</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-9.6e-5** (3.33e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-9.61e-5** (3.31e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-5.95e-5** (2.14e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-5.97e-5** (2.14e-5)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Controls</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fixed-Effects:</td>
<td style="text-align: left;">----------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">--------------------</td>
<td style="text-align: left;">----------------</td>
<td style="text-align: left;">--------------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">--------------------</td>
</tr>
<tr class="odd">
<td style="text-align: left;">gvkey</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">indexyear</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ff_30ind_name-indexyear</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">__________________________</td>
<td style="text-align: left;">________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">____________________</td>
<td style="text-align: left;">________________</td>
<td style="text-align: left;">____________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">____________________</td>
</tr>
<tr class="odd">
<td style="text-align: left;">S.E.: Clustered</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Observations</td>
<td style="text-align: left;">26,763</td>
<td style="text-align: left;">24,979</td>
<td style="text-align: left;">26,763</td>
<td style="text-align: left;">24,979</td>
<td style="text-align: left;">19,560</td>
<td style="text-align: left;">18,240</td>
<td style="text-align: left;">19,560</td>
<td style="text-align: left;">18,240</td>
</tr>
<tr class="odd">
<td style="text-align: left;">R2</td>
<td style="text-align: left;">0.79302</td>
<td style="text-align: left;">0.78432</td>
<td style="text-align: left;">0.79338</td>
<td style="text-align: left;">0.78449</td>
<td style="text-align: left;">0.78508</td>
<td style="text-align: left;">0.77382</td>
<td style="text-align: left;">0.78531</td>
<td style="text-align: left;">0.77388</td>
</tr>
<tr class="even">
<td style="text-align: left;">Within R2</td>
<td style="text-align: left;">4.63e-5</td>
<td style="text-align: left;">0.01994</td>
<td style="text-align: left;">0.00179</td>
<td style="text-align: left;">0.02073</td>
<td style="text-align: left;">7.66e-6</td>
<td style="text-align: left;">0.02321</td>
<td style="text-align: left;">0.00110</td>
<td style="text-align: left;">0.02346</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Balanced Panel</td>
<td style="text-align: left;">Balanced Panel</td>
<td style="text-align: left;">Balanced Panel</td>
<td style="text-align: left;">Balanced Panel</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>From the table results using <code>land_intensity</code>, the treatment effect is indifferent from zero if using the intensity measure and the it is significantly negative if we use the treatment dummy, which is one if the intensity is positive and zero otherwise.</p>
<p>DiD plot:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">## create the combinations of parameters:</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>fml_parameters <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">choice_treatment =</span> <span class="fu">c</span>(<span class="st">"intensity_2000"</span>, <span class="st">"treated"</span>), <span class="co"># what is the treatment measure: continuous/binary</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">controls_inclusion =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>),<span class="co"># whether to include controls</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">balanced_panel =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>), <span class="co"># whether keep a balanced panel</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(balanced_panel) <span class="sc">%&gt;%</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind.data.frame</span>(.,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">fml =</span> <span class="fu">apply</span>(<span class="at">X =</span> ., <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(parameters) {</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>      <span class="do">## parameters:</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>      choice_treatment <span class="ot">&lt;-</span> parameters[<span class="dv">1</span>]</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>      add_controls <span class="ot">&lt;-</span> parameters[<span class="dv">2</span>]</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>      is_balanced <span class="ot">&lt;-</span> parameters[<span class="dv">3</span>]</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>      <span class="do">## inputs:</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>      fml_base <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"book_leverage ~ i(indexyear, "</span>, choice_treatment, <span class="st">", ref = -1)"</span>, <span class="at">sep =</span> <span class="st">""</span>) <span class="co"># the baseline model</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>      fml_base_controls <span class="ot">&lt;-</span> <span class="st">" + roa + ebitda_at + log(at_thousand) + altman_Z + tangibility + current_ratio"</span> <span class="co"># the potential controls</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>      fml_base_fe <span class="ot">&lt;-</span> <span class="st">" | gvkey + indexyear + ff_30ind_name^indexyear"</span> <span class="co"># fixed effects</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>      <span class="do">## output formula:</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>      fml_output <span class="ot">&lt;-</span> <span class="fu">paste</span>(</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>        fml_base,</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ifelse</span>(add_controls <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">yes =</span> fml_base_controls, <span class="at">no =</span> <span class="st">""</span>),</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>        fml_base_fe,</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(fml_output)</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>  <span class="do">## assign a name for each regression:</span></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">paste</span>(<span class="st">"("</span>, letters[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.)], <span class="st">")"</span>, <span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, <span class="fu">everything</span>())</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>fml_parameters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
  name  choice_treatment controls_inclusion balanced_panel fml                  
  &lt;chr&gt; &lt;chr&gt;            &lt;lgl&gt;              &lt;lgl&gt;          &lt;chr&gt;                
1 (a)   intensity_2000   FALSE              FALSE          book_leverage ~ i(in…
2 (b)   intensity_2000   TRUE               FALSE          book_leverage ~ i(in…
3 (c)   treated          FALSE              FALSE          book_leverage ~ i(in…
4 (d)   treated          TRUE               FALSE          book_leverage ~ i(in…
5 (e)   intensity_2000   FALSE              TRUE           book_leverage ~ i(in…
6 (f)   intensity_2000   TRUE               TRUE           book_leverage ~ i(in…
7 (g)   treated          FALSE              TRUE           book_leverage ~ i(in…
8 (h)   treated          TRUE               TRUE           book_leverage ~ i(in…</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="do">## construct the data used for the loop:</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>data_did_loop <span class="ot">&lt;-</span> data_did <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, fyear, indexyear, intensity_2000, post_2005,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>         book_leverage, debt_ebitda, sic, ff_30ind_name,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>         altman_Z, kz, market_book, tangibility, current_ratio) <span class="sc">%&gt;%</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">-</span> n_pre <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(intensity_2000) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(at)) <span class="sc">%&gt;%</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">gvkey =</span> <span class="fu">as.factor</span>(gvkey),</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">fyear =</span> <span class="fu">as.factor</span>(fyear),</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated =</span> <span class="fu">ifelse</span>(intensity_2000 <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">ebitda_at =</span> ebitda <span class="sc">/</span> at,</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">at_thousand =</span> at <span class="sc">*</span> <span class="dv">10</span><span class="sc">^-</span><span class="dv">3</span>,</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">large =</span> <span class="fu">ifelse</span>(large, <span class="at">yes =</span> <span class="st">"Large"</span>, <span class="at">no =</span> <span class="st">"Small"</span>),</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">tangiblity_exbnl =</span> tangibility <span class="sc">-</span> bnl_intensity,</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">bnl =</span> bnl_intensity <span class="sc">*</span> at,</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated_large =</span> <span class="fu">paste</span>(treated, large, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>data_did_loop_balanced <span class="ot">&lt;-</span> data_did <span class="sc">%&gt;%</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gvkey <span class="sc">%in%</span> data_did_balanced_id) <span class="sc">%&gt;%</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, fyear, indexyear, intensity_2000, post_2005,</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>         book_leverage, debt_ebitda, sic, ff_30ind_name,</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>         altman_Z, kz, market_book, tangibility, current_ratio) <span class="sc">%&gt;%</span></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">-</span> n_pre <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(intensity_2000) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(at)) <span class="sc">%&gt;%</span></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">gvkey =</span> <span class="fu">as.factor</span>(gvkey),</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">fyear =</span> <span class="fu">as.factor</span>(fyear),</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated =</span> <span class="fu">ifelse</span>(intensity_2000 <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">ebitda_at =</span> ebitda <span class="sc">/</span> at,</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">at_thousand =</span> at <span class="sc">*</span> <span class="dv">10</span><span class="sc">^-</span><span class="dv">3</span>,</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">large =</span> <span class="fu">ifelse</span>(large, <span class="at">yes =</span> <span class="st">"Large"</span>, <span class="at">no =</span> <span class="st">"Small"</span>),</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">tangiblity_exbnl =</span> tangibility <span class="sc">-</span> bnl_intensity,</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">bnl =</span> bnl_intensity <span class="sc">*</span> at,</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated_large =</span> <span class="fu">paste</span>(treated, large, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a><span class="do">## store all results</span></span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>fml_results <span class="ot">&lt;-</span> fml_parameters <span class="sc">%&gt;%</span></span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(<span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(parameters) {</span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a>    <span class="do">## parameters:</span></span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a>    is_balanced <span class="ot">&lt;-</span> parameters[<span class="dv">4</span>]</span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a>    fml_formula <span class="ot">&lt;-</span> parameters[<span class="dv">5</span>]</span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a>    <span class="do">## data:</span></span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (is_balanced <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data_did_loop_balanced</span>
<span id="cb29-60"><a href="#cb29-60" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb29-61"><a href="#cb29-61" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data_did_loop</span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a>    <span class="do">## regression:</span></span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a>    did_model <span class="ot">&lt;-</span> fixest<span class="sc">::</span><span class="fu">feols</span>(<span class="at">fml =</span> <span class="fu">formula</span>(fml_formula),</span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> data,</span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cluster =</span> <span class="fu">c</span>(<span class="st">"gvkey"</span>, <span class="st">"ff_30ind_name"</span>)</span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(did_model)</span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a>  })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 2,227 observations removed because of NA and infinite values (RHS: 2,227).
NOTE: 2,227 observations removed because of NA and infinite values (RHS: 2,227).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 1,560 observations removed because of NA and infinite values (RHS: 1,560).
NOTE: 1,560 observations removed because of NA and infinite values (RHS: 1,560).</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="do">### create the table:</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>fml_results <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">names&lt;-</span><span class="st">`</span>(<span class="at">value =</span> <span class="fu">unlist</span>(fml_parameters[,<span class="dv">1</span>])) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">etable</span>(</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">order =</span> <span class="st">"indexyear"</span>,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># keep = "post",</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">extralines =</span> <span class="fu">list</span>(</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>      <span class="do">## Controls:</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"^_Controls"</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">unlist</span>(fml_parameters[,<span class="dv">3</span>]), <span class="at">yes =</span> <span class="st">"Yes"</span>, <span class="at">no =</span> <span class="st">"No"</span>),</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>      <span class="do">## the identity of the sample:</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">"__Sample"</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">unlist</span>(fml_parameters[,<span class="dv">4</span>]), <span class="at">yes =</span> <span class="st">"Balanced Panel"</span>, <span class="at">no =</span> <span class="st">"Full Sample"</span>) <span class="co"># whether used a balanced panel or a full sample.</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>, <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"DiD Results with `"</span>, intensity_measure_name, <span class="st">"`"</span>, <span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">font_size =</span> <span class="dv">8</span>,       <span class="co"># Smaller font (default is 16px)</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>,   <span class="co"># Table width fits content</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"condensed"</span>)</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>DiD Results with `land_intensity`</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(a)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(b)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(c)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(d)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(e)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(f)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(g)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(h)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Dependent Var.:</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">intensity_2000 x indexyear = -3</td>
<td style="text-align: left;">0.0177 (0.0387)</td>
<td style="text-align: left;">-0.0363 (0.0664)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0426 (0.0540)</td>
<td style="text-align: left;">-0.1362 (0.0919)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">intensity_2000 x indexyear = -2</td>
<td style="text-align: left;">-0.0020 (0.0184)</td>
<td style="text-align: left;">-0.0347 (0.0323)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0311 (0.0278)</td>
<td style="text-align: left;">-0.0606 (0.0388)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">intensity_2000 x indexyear = 0</td>
<td style="text-align: left;">0.0345 (0.0351)</td>
<td style="text-align: left;">0.0227 (0.0659)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0156 (0.0241)</td>
<td style="text-align: left;">-0.0012 (0.0615)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">intensity_2000 x indexyear = 1</td>
<td style="text-align: left;">-0.0273 (0.0406)</td>
<td style="text-align: left;">-0.0283 (0.0883)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0162 (0.0418)</td>
<td style="text-align: left;">-0.0250 (0.0896)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">intensity_2000 x indexyear = 2</td>
<td style="text-align: left;">-0.0327 (0.0344)</td>
<td style="text-align: left;">-0.0388 (0.0614)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0328 (0.0339)</td>
<td style="text-align: left;">-0.0566 (0.0550)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">intensity_2000 x indexyear = 3</td>
<td style="text-align: left;">0.0111 (0.0390)</td>
<td style="text-align: left;">0.0147 (0.0709)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0049 (0.0304)</td>
<td style="text-align: left;">-0.0106 (0.0531)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">treated x indexyear = -3</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0294*** (0.0060)</td>
<td style="text-align: left;">0.0294*** (0.0057)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0223*** (0.0057)</td>
<td style="text-align: left;">0.0226** (0.0063)</td>
</tr>
<tr class="even">
<td style="text-align: left;">treated x indexyear = -2</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0031 (0.0033)</td>
<td style="text-align: left;">0.0018 (0.0033)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0034 (0.0043)</td>
<td style="text-align: left;">0.0037 (0.0047)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">treated x indexyear = 0</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0123*** (0.0033)</td>
<td style="text-align: left;">-0.0120** (0.0038)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0123*** (0.0032)</td>
<td style="text-align: left;">-0.0116*** (0.0029)</td>
</tr>
<tr class="even">
<td style="text-align: left;">treated x indexyear = 1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0253*** (0.0042)</td>
<td style="text-align: left;">-0.0210*** (0.0044)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0140** (0.0049)</td>
<td style="text-align: left;">-0.0087 (0.0053)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">treated x indexyear = 2</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0217*** (0.0050)</td>
<td style="text-align: left;">-0.0136* (0.0051)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0193** (0.0056)</td>
<td style="text-align: left;">-0.0111. (0.0058)</td>
</tr>
<tr class="even">
<td style="text-align: left;">treated x indexyear = 3</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0166** (0.0052)</td>
<td style="text-align: left;">-0.0091 (0.0058)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0168*** (0.0044)</td>
<td style="text-align: left;">-0.0097. (0.0048)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">roa</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">3.26e-5 (3.31e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">4e-5 (3.26e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0052*** (0.0011)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0053*** (0.0012)</td>
</tr>
<tr class="even">
<td style="text-align: left;">ebitda_at</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">3.09e-5 (8.24e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">2.98e-5 (8.42e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0025** (0.0008)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0026** (0.0008)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">log(at_thousand)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0068 (0.0051)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0063 (0.0051)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0166** (0.0055)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0161** (0.0054)</td>
</tr>
<tr class="even">
<td style="text-align: left;">altman_Z</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">5.81e-6 (3.44e-6)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">6.41e-6. (3.4e-6)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">8.72e-5* (4.02e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">8.97e-5* (4.11e-5)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tangibility</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.2238*** (0.0235)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.2177*** (0.0239)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.1920*** (0.0216)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.1858*** (0.0218)</td>
</tr>
<tr class="even">
<td style="text-align: left;">current_ratio</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0001* (4.92e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0001* (4.77e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-7.57e-5* (3.19e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-7.82e-5* (3.06e-5)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Controls</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fixed-Effects:</td>
<td style="text-align: left;">----------------</td>
<td style="text-align: left;">------------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">----------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">-------------------</td>
</tr>
<tr class="odd">
<td style="text-align: left;">gvkey</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">indexyear</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ff_30ind_name-indexyear</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________________</td>
<td style="text-align: left;">________________</td>
<td style="text-align: left;">__________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">___________________</td>
</tr>
<tr class="odd">
<td style="text-align: left;">S.E.: Clustered</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Observations</td>
<td style="text-align: left;">32,814</td>
<td style="text-align: left;">30,587</td>
<td style="text-align: left;">32,814</td>
<td style="text-align: left;">30,587</td>
<td style="text-align: left;">22,820</td>
<td style="text-align: left;">21,260</td>
<td style="text-align: left;">22,820</td>
<td style="text-align: left;">21,260</td>
</tr>
<tr class="odd">
<td style="text-align: left;">R2</td>
<td style="text-align: left;">0.77545</td>
<td style="text-align: left;">0.76763</td>
<td style="text-align: left;">0.77655</td>
<td style="text-align: left;">0.76853</td>
<td style="text-align: left;">0.76320</td>
<td style="text-align: left;">0.75226</td>
<td style="text-align: left;">0.76410</td>
<td style="text-align: left;">0.75288</td>
</tr>
<tr class="even">
<td style="text-align: left;">Within R2</td>
<td style="text-align: left;">9.82e-5</td>
<td style="text-align: left;">0.02160</td>
<td style="text-align: left;">0.00498</td>
<td style="text-align: left;">0.02540</td>
<td style="text-align: left;">0.00013</td>
<td style="text-align: left;">0.02213</td>
<td style="text-align: left;">0.00394</td>
<td style="text-align: left;">0.02458</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Balanced Panel</td>
<td style="text-align: left;">Balanced Panel</td>
<td style="text-align: left;">Balanced Panel</td>
<td style="text-align: left;">Balanced Panel</td>
</tr>
</tbody>
</table>


</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="do">### create the plots:</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># fml_parameters[which(unlist(fml_parameters$balanced_panel)), ]</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>fml_results[<span class="fu">which</span>(<span class="fu">unlist</span>(fml_parameters<span class="sc">$</span>balanced_panel))] <span class="sc">%&gt;%</span> <span class="co"># choose the balanced panel</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">iplot</span>(.,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="fu">paste</span>(<span class="st">"Time to treatment (Year; 0 = "</span>, base_year, <span class="st">")"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Treatment Effects by fiscal year: `"</span>, intensity_measure_name, <span class="st">"`"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">sub =</span> <span class="st">"Data: Balanced Panel"</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ref.line =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">ref.line.par =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>),</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">pt.join =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">3.5</span>, <span class="fl">3.5</span>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>        ); <span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="sc">-</span><span class="dv">3</span><span class="sc">:</span><span class="dv">3</span>); <span class="fu">abline</span>(<span class="at">v =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">3</span>); <span class="fu">legend</span>(<span class="st">'bottomleft'</span>, <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">17</span>, <span class="dv">15</span>, <span class="dv">21</span>), <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">'intensity'</span>, <span class="st">'intensity + controls'</span>, <span class="st">'dummy'</span>, <span class="st">'dummy + controls'</span>));</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AFA_test_2005_PPE_clean_files/figure-html/s3c-did-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>fml_results[<span class="fu">which</span>(<span class="sc">!</span><span class="fu">unlist</span>(fml_parameters<span class="sc">$</span>balanced_panel))] <span class="sc">%&gt;%</span> <span class="co"># choose full sample</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">iplot</span>(.,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="fu">paste</span>(<span class="st">"Time to treatment (Year; 0 = "</span>, base_year, <span class="st">")"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Treatment Effect by fiscal year: `"</span>, intensity_measure_name, <span class="st">"`"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">sub =</span> <span class="st">"Data: Full Sample"</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">ref.line =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">ref.line.par =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>),</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">pt.join =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">3.5</span>, <span class="fl">3.5</span>)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>        ); <span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="sc">-</span><span class="dv">3</span><span class="sc">:</span><span class="dv">3</span>); <span class="fu">abline</span>(<span class="at">v =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">3</span>); <span class="fu">legend</span>(<span class="st">'bottomleft'</span>, <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">17</span>, <span class="dv">15</span>, <span class="dv">21</span>), <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">'intensity'</span>, <span class="st">'intensity + controls'</span>, <span class="st">'dummy'</span>, <span class="st">'dummy + controls'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AFA_test_2005_PPE_clean_files/figure-html/s3c-did-plot-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Results using <code>land_intensity</code> are much noisier. The treatment effects are indifferent from zero when using the intensity measure and are negative when using the treatment dummy. However, there seems to be a pre-trend before the time of treatment. This is further shown in the plots.</p>
</section>
<section id="sec-s3c-building-and-land-intensity" class="level3">
<h3 class="anchored" data-anchor-id="sec-s3c-building-and-land-intensity">s3.4. builindg and land intensity</h3>
<p><code>bnl_intensity</code> is chosen to measure a firm’s long-term exposure to buildings, land and their improvements at cost under the PPE.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="do">## choose the group definition:</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>intensity_measure_name <span class="ot">&lt;-</span> candidate_intensity_measure[<span class="dv">5</span>]</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>data_firm <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">==</span> intensity_measure_year) <span class="sc">%&gt;%</span> <span class="co"># use `fyear` may create multiple observations for the same firm. E.g. filter(gvkey == 23535, dyear == 2005)</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fyear) <span class="sc">%&gt;%</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_at =</span> <span class="fu">median</span>(at, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># median_cf = median(debt_ebitda, na.rm = TRUE)</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## different grouping variables in DDD analysis:</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">large =</span> <span class="fu">ifelse</span>(at <span class="sc">&gt;</span> median_at, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># tangible = ifelse(tangibility &gt; 0, yes = "tangible", no = "non-tangible"),</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># high_cf = ifelse(debt_ebitda &lt; median_cf, yes = "high CF", no = "low CF")</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, <span class="at">intensity_2000 =</span> <span class="fu">all_of</span>(intensity_measure_name), large)</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>data_did <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  <span class="do">## merge the grouping variable</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> data_firm, <span class="at">by =</span> <span class="fu">join_by</span>(gvkey) ) <span class="sc">%&gt;%</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## merge the FF 30 industry classifiaction</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> FF_30ind, <span class="at">by =</span> <span class="fu">join_by</span>(sic)) <span class="sc">%&gt;%</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>  <span class="do">## exclude certain industries</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>    ff_30ind <span class="sc">!=</span> <span class="dv">20</span>, <span class="co"># exclude Utiltiy (number 20)</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span>(sic <span class="sc">&gt;=</span> <span class="dv">6000</span> <span class="sc">&amp;</span> sic <span class="sc">&lt;=</span> <span class="dv">6199</span>) <span class="co"># exclude banks under Banking, Insurance, Real Estate, Trading (number 29)</span></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>  <span class="do">## pre- &amp; post-</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">indexyear =</span> (fyear <span class="sc">-</span> base_year), <span class="co"># year index with 2005 as base 0.</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">post_2005 =</span> <span class="fu">as.numeric</span>(fyear <span class="sc">&gt;</span> base_year)  <span class="co"># whether it is after the 2005 reform</span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a><span class="do">## gvkey(s) for balanced panel":</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>data_did_balanced_id <span class="ot">&lt;-</span> data_did <span class="sc">%&gt;%</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">-</span> n_pre <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gvkey) <span class="sc">%&gt;%</span></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count_obs =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(book_leverage) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(intensity_2000))) <span class="sc">%&gt;%</span></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(count_obs <span class="sc">==</span> period_end <span class="sc">-</span> period_start <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> n_pre) <span class="sc">%&gt;%</span></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span>gvkey</span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>data_intensity_panel <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&lt;</span> <span class="dv">2007</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, fyear, <span class="fu">all_of</span>(intensity_measure_name)) <span class="sc">%&gt;%</span></span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> fyear, <span class="at">values_from =</span> <span class="fu">all_of</span>(intensity_measure_name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>DiD Analysis:</p>
<p>In this part of the analysis, I also added the firm-year controls in the DiD and triple difference analyses. The first is called <code>àt_thousand</code>, which is the total asset of firm <span class="math inline">i</span> in fiscal year <span class="math inline">t</span> in thousand of dollars. The second is the <code>ebitda_at</code>, which is the EBITDA of firm <span class="math inline">i</span> in fiscal year <span class="math inline">t</span> divided by its total asset. Adding both controls positively correlated with the book leverage, they do not have a significant impact on the coefficient estimate of interest, which is the coefficient on <code>treated x post_2005</code> and <code>intensity_2000 x post_2005</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(intensity_measure_name); <span class="fu">cat</span>(<span class="st">": </span><span class="sc">\n</span><span class="st">"</span>);</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="do">## create the combinations of parameters:</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>fml_parameters <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">choice_treatment =</span> <span class="fu">c</span>(<span class="st">"intensity_2000"</span>, <span class="st">"treated"</span>), <span class="co"># what is the treatment measure: continuous/binary</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">controls_inclusion =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>),<span class="co"># whether to include controls</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">balanced_panel =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>), <span class="co"># whether keep a balanced panel</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(balanced_panel) <span class="sc">%&gt;%</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind.data.frame</span>(.,</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">fml =</span> <span class="fu">apply</span>(<span class="at">X =</span> ., <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(parameters) {</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>      <span class="do">## parameters:</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>      choice_treatment <span class="ot">&lt;-</span> parameters[<span class="dv">1</span>]</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>      add_controls <span class="ot">&lt;-</span> parameters[<span class="dv">2</span>]</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>      is_balanced <span class="ot">&lt;-</span> parameters[<span class="dv">3</span>]</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>      <span class="do">## inputs:</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>      fml_base <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"book_leverage ~ post_2005*"</span>, choice_treatment, <span class="at">sep =</span> <span class="st">""</span>) <span class="co"># the baseline model</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>      fml_base_controls <span class="ot">&lt;-</span> <span class="st">" + roa + ebitda_at + log(at_thousand) + altman_Z + tangibility + current_ratio"</span> <span class="co"># the potential controls</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>      fml_base_fe <span class="ot">&lt;-</span> <span class="st">" | gvkey + indexyear + ff_30ind_name^indexyear"</span> <span class="co"># fixed effects</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>      <span class="do">## output formula:</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>      fml_output <span class="ot">&lt;-</span> <span class="fu">paste</span>(</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>        fml_base,</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ifelse</span>(add_controls <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">yes =</span> fml_base_controls, <span class="at">no =</span> <span class="st">""</span>),</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>        fml_base_fe,</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(fml_output)</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>  <span class="do">## assign a name for each regression:</span></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">paste</span>(<span class="st">"("</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.), <span class="st">")"</span>, <span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, <span class="fu">everything</span>())</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a><span class="do">## construct the data used for the loop:</span></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>data_did_loop <span class="ot">&lt;-</span> data_did <span class="sc">%&gt;%</span></span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, fyear, indexyear, intensity_2000, post_2005,</span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>         book_leverage, debt_ebitda, sic, ff_30ind_name,</span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>         altman_Z, kz, market_book, tangibility, current_ratio) <span class="sc">%&gt;%</span></span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span></span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(intensity_2000) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(at)) <span class="sc">%&gt;%</span></span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">gvkey =</span> <span class="fu">as.factor</span>(gvkey),</span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">fyear =</span> <span class="fu">as.factor</span>(fyear),</span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated =</span> <span class="fu">ifelse</span>(intensity_2000 <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">ebitda_at =</span> ebitda <span class="sc">/</span> at,</span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">at_thousand =</span> at <span class="sc">*</span> <span class="dv">10</span><span class="sc">^-</span><span class="dv">3</span>,</span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">large =</span> <span class="fu">ifelse</span>(large, <span class="at">yes =</span> <span class="st">"Large"</span>, <span class="at">no =</span> <span class="st">"Small"</span>),</span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">tangiblity_exbnl =</span> tangibility <span class="sc">-</span> bnl_intensity,</span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">bnl =</span> bnl_intensity <span class="sc">*</span> at,</span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated_large =</span> <span class="fu">paste</span>(treated, large, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a>data_did_loop_balanced <span class="ot">&lt;-</span> data_did <span class="sc">%&gt;%</span></span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gvkey <span class="sc">%in%</span> data_did_balanced_id) <span class="sc">%&gt;%</span></span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, fyear, indexyear, intensity_2000, post_2005,</span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a>         book_leverage, debt_ebitda, sic, ff_30ind_name,</span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a>         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span>
<span id="cb36-70"><a href="#cb36-70" aria-hidden="true" tabindex="-1"></a>         altman_Z, kz, market_book, tangibility, current_ratio) <span class="sc">%&gt;%</span></span>
<span id="cb36-71"><a href="#cb36-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span></span>
<span id="cb36-72"><a href="#cb36-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(intensity_2000) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(at)) <span class="sc">%&gt;%</span></span>
<span id="cb36-73"><a href="#cb36-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-74"><a href="#cb36-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">gvkey =</span> <span class="fu">as.factor</span>(gvkey),</span>
<span id="cb36-75"><a href="#cb36-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">fyear =</span> <span class="fu">as.factor</span>(fyear),</span>
<span id="cb36-76"><a href="#cb36-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb36-77"><a href="#cb36-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated =</span> <span class="fu">ifelse</span>(intensity_2000 <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb36-78"><a href="#cb36-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">ebitda_at =</span> ebitda <span class="sc">/</span> at,</span>
<span id="cb36-79"><a href="#cb36-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">at_thousand =</span> at <span class="sc">*</span> <span class="dv">10</span><span class="sc">^-</span><span class="dv">3</span>,</span>
<span id="cb36-80"><a href="#cb36-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">large =</span> <span class="fu">ifelse</span>(large, <span class="at">yes =</span> <span class="st">"Large"</span>, <span class="at">no =</span> <span class="st">"Small"</span>),</span>
<span id="cb36-81"><a href="#cb36-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">tangiblity_exbnl =</span> tangibility <span class="sc">-</span> bnl_intensity,</span>
<span id="cb36-82"><a href="#cb36-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">bnl =</span> bnl_intensity <span class="sc">*</span> at,</span>
<span id="cb36-83"><a href="#cb36-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb36-84"><a href="#cb36-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated_large =</span> <span class="fu">paste</span>(treated, large, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb36-85"><a href="#cb36-85" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-86"><a href="#cb36-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-87"><a href="#cb36-87" aria-hidden="true" tabindex="-1"></a><span class="do">## store all results</span></span>
<span id="cb36-88"><a href="#cb36-88" aria-hidden="true" tabindex="-1"></a>fml_results <span class="ot">&lt;-</span> fml_parameters <span class="sc">%&gt;%</span></span>
<span id="cb36-89"><a href="#cb36-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(<span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(parameters) {</span>
<span id="cb36-90"><a href="#cb36-90" aria-hidden="true" tabindex="-1"></a>    <span class="do">## parameters:</span></span>
<span id="cb36-91"><a href="#cb36-91" aria-hidden="true" tabindex="-1"></a>    is_balanced <span class="ot">&lt;-</span> parameters[<span class="dv">4</span>]</span>
<span id="cb36-92"><a href="#cb36-92" aria-hidden="true" tabindex="-1"></a>    fml_formula <span class="ot">&lt;-</span> parameters[<span class="dv">5</span>]</span>
<span id="cb36-93"><a href="#cb36-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-94"><a href="#cb36-94" aria-hidden="true" tabindex="-1"></a>    <span class="do">## data:</span></span>
<span id="cb36-95"><a href="#cb36-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (is_balanced <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb36-96"><a href="#cb36-96" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data_did_loop_balanced</span>
<span id="cb36-97"><a href="#cb36-97" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb36-98"><a href="#cb36-98" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data_did_loop</span>
<span id="cb36-99"><a href="#cb36-99" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-100"><a href="#cb36-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-101"><a href="#cb36-101" aria-hidden="true" tabindex="-1"></a>    <span class="do">## regression:</span></span>
<span id="cb36-102"><a href="#cb36-102" aria-hidden="true" tabindex="-1"></a>    did_model <span class="ot">&lt;-</span> fixest<span class="sc">::</span><span class="fu">feols</span>(<span class="at">fml =</span> <span class="fu">formula</span>(fml_formula),</span>
<span id="cb36-103"><a href="#cb36-103" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> data,</span>
<span id="cb36-104"><a href="#cb36-104" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cluster =</span> <span class="fu">c</span>(<span class="st">"gvkey"</span>, <span class="st">"ff_30ind_name"</span>)</span>
<span id="cb36-105"><a href="#cb36-105" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb36-106"><a href="#cb36-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(did_model)</span>
<span id="cb36-107"><a href="#cb36-107" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb36-108"><a href="#cb36-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-109"><a href="#cb36-109" aria-hidden="true" tabindex="-1"></a><span class="do">### DiD result using post-:</span></span>
<span id="cb36-110"><a href="#cb36-110" aria-hidden="true" tabindex="-1"></a>fml_results <span class="sc">%&gt;%</span></span>
<span id="cb36-111"><a href="#cb36-111" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">names&lt;-</span><span class="st">`</span>(<span class="at">value =</span> <span class="fu">unlist</span>(fml_parameters[,<span class="dv">1</span>])) <span class="sc">%&gt;%</span></span>
<span id="cb36-112"><a href="#cb36-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">etable</span>(</span>
<span id="cb36-113"><a href="#cb36-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">order =</span> <span class="st">"post"</span>,</span>
<span id="cb36-114"><a href="#cb36-114" aria-hidden="true" tabindex="-1"></a>    <span class="co"># keep = "post",</span></span>
<span id="cb36-115"><a href="#cb36-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">extralines =</span> <span class="fu">list</span>(</span>
<span id="cb36-116"><a href="#cb36-116" aria-hidden="true" tabindex="-1"></a>      <span class="do">## Controls:</span></span>
<span id="cb36-117"><a href="#cb36-117" aria-hidden="true" tabindex="-1"></a>      <span class="st">"^_Controls"</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">unlist</span>(fml_parameters[,<span class="dv">3</span>]), <span class="at">yes =</span> <span class="st">"Yes"</span>, <span class="at">no =</span> <span class="st">"No"</span>),</span>
<span id="cb36-118"><a href="#cb36-118" aria-hidden="true" tabindex="-1"></a>      <span class="do">## the identity of the sample:</span></span>
<span id="cb36-119"><a href="#cb36-119" aria-hidden="true" tabindex="-1"></a>      <span class="st">"__Sample"</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">unlist</span>(fml_parameters[,<span class="dv">4</span>]), <span class="at">yes =</span> <span class="st">"Balanced Panel"</span>, <span class="at">no =</span> <span class="st">"Full Sample"</span>) <span class="co"># whether used a balanced panel or a full sample.</span></span>
<span id="cb36-120"><a href="#cb36-120" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb36-121"><a href="#cb36-121" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>, <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"DiD Results with `"</span>, intensity_measure_name, <span class="st">"`"</span>, <span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-122"><a href="#cb36-122" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(</span>
<span id="cb36-123"><a href="#cb36-123" aria-hidden="true" tabindex="-1"></a>    <span class="at">font_size =</span> <span class="dv">8</span>,       <span class="co"># Smaller font (default is 16px)</span></span>
<span id="cb36-124"><a href="#cb36-124" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>,   <span class="co"># Table width fits content</span></span>
<span id="cb36-125"><a href="#cb36-125" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"condensed"</span>)</span>
<span id="cb36-126"><a href="#cb36-126" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb36-127"><a href="#cb36-127" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">footnote</span>(</span>
<span id="cb36-128"><a href="#cb36-128" aria-hidden="true" tabindex="-1"></a>    <span class="at">general =</span> <span class="st">"Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1"</span>,</span>
<span id="cb36-129"><a href="#cb36-129" aria-hidden="true" tabindex="-1"></a>    <span class="at">general_title =</span> <span class="st">"Note:"</span></span>
<span id="cb36-130"><a href="#cb36-130" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>bnl_intensity: </code></pre>
</div>
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>DiD Results with `bnl_intensity`</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(1)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(2)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(3)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(4)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(5)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(6)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(7)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(8)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Dependent Var.:</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">post_2005 x intensity_2000</td>
<td style="text-align: left;">-0.0535*** (0.0116)</td>
<td style="text-align: left;">-0.0362* (0.0147)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0554*** (0.0119)</td>
<td style="text-align: left;">-0.0379** (0.0125)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">post_2005 x treated</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0215*** (0.0036)</td>
<td style="text-align: left;">-0.0154*** (0.0037)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0156*** (0.0038)</td>
<td style="text-align: left;">-0.0086. (0.0047)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">roa</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">6.82e-5* (2.81e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">7.07e-5* (2.83e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0047*** (0.0011)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0047*** (0.0011)</td>
</tr>
<tr class="even">
<td style="text-align: left;">ebitda_at</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">3.92e-5 (9.88e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">3.65e-5 (9.96e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0017** (0.0006)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0017** (0.0006)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">log(at_thousand)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0090. (0.0051)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0086 (0.0052)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0194** (0.0062)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0194** (0.0062)</td>
</tr>
<tr class="even">
<td style="text-align: left;">altman_Z</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">6.89e-6. (3.93e-6)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">7.09e-6. (3.92e-6)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">8.81e-5* (3.79e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">8.77e-5* (3.79e-5)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tangibility</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.2116*** (0.0284)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.2115*** (0.0287)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.1969*** (0.0245)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.1989*** (0.0244)</td>
</tr>
<tr class="even">
<td style="text-align: left;">current_ratio</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-9.55e-5** (3.31e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-9.57e-5** (3.29e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-5.92e-5** (2.12e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-5.94e-5** (2.13e-5)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Controls</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fixed-Effects:</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">--------------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">--------------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">--------------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">--------------------</td>
</tr>
<tr class="odd">
<td style="text-align: left;">gvkey</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">indexyear</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ff_30ind_name-indexyear</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">__________________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">____________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">____________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">____________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">____________________</td>
</tr>
<tr class="odd">
<td style="text-align: left;">S.E.: Clustered</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Observations</td>
<td style="text-align: left;">26,664</td>
<td style="text-align: left;">24,904</td>
<td style="text-align: left;">26,664</td>
<td style="text-align: left;">24,904</td>
<td style="text-align: left;">19,482</td>
<td style="text-align: left;">18,180</td>
<td style="text-align: left;">19,482</td>
<td style="text-align: left;">18,180</td>
</tr>
<tr class="odd">
<td style="text-align: left;">R2</td>
<td style="text-align: left;">0.79229</td>
<td style="text-align: left;">0.78407</td>
<td style="text-align: left;">0.79243</td>
<td style="text-align: left;">0.78417</td>
<td style="text-align: left;">0.78451</td>
<td style="text-align: left;">0.77392</td>
<td style="text-align: left;">0.78441</td>
<td style="text-align: left;">0.77384</td>
</tr>
<tr class="even">
<td style="text-align: left;">Within R2</td>
<td style="text-align: left;">0.00131</td>
<td style="text-align: left;">0.02041</td>
<td style="text-align: left;">0.00196</td>
<td style="text-align: left;">0.02088</td>
<td style="text-align: left;">0.00187</td>
<td style="text-align: left;">0.02394</td>
<td style="text-align: left;">0.00139</td>
<td style="text-align: left;">0.02362</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Balanced Panel</td>
<td style="text-align: left;">Balanced Panel</td>
<td style="text-align: left;">Balanced Panel</td>
<td style="text-align: left;">Balanced Panel</td>
</tr>
</tbody><tfoot>
<tr class="even">
<td style="text-align: left; padding: 0;"><span style="font-style: italic;">Note:</span></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0;"><sup></sup> Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tfoot>

</table>


</div>
</div>
<p>DiD analysis:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="do">## create the combinations of parameters:</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>fml_parameters <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">choice_treatment =</span> <span class="fu">c</span>(<span class="st">"intensity_2000"</span>, <span class="st">"treated"</span>), <span class="co"># what is the treatment measure: continuous/binary</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">controls_inclusion =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>),<span class="co"># whether to include controls</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">balanced_panel =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>), <span class="co"># whether keep a balanced panel</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(balanced_panel) <span class="sc">%&gt;%</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind.data.frame</span>(.,</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">fml =</span> <span class="fu">apply</span>(<span class="at">X =</span> ., <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(parameters) {</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>      <span class="do">## parameters:</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>      choice_treatment <span class="ot">&lt;-</span> parameters[<span class="dv">1</span>]</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>      add_controls <span class="ot">&lt;-</span> parameters[<span class="dv">2</span>]</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>      is_balanced <span class="ot">&lt;-</span> parameters[<span class="dv">3</span>]</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>      <span class="do">## inputs:</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>      fml_base <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"book_leverage ~ i(indexyear, "</span>, choice_treatment, <span class="st">", ref = -1)"</span>, <span class="at">sep =</span> <span class="st">""</span>) <span class="co"># the baseline model</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>      fml_base_controls <span class="ot">&lt;-</span> <span class="st">" + roa + ebitda_at + log(at_thousand) + altman_Z + tangibility + current_ratio"</span> <span class="co"># the potential controls</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>      fml_base_fe <span class="ot">&lt;-</span> <span class="st">" | gvkey + indexyear + ff_30ind_name^indexyear"</span> <span class="co"># fixed effects</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>      <span class="do">## output formula:</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>      fml_output <span class="ot">&lt;-</span> <span class="fu">paste</span>(</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>        fml_base,</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ifelse</span>(add_controls <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">yes =</span> fml_base_controls, <span class="at">no =</span> <span class="st">""</span>),</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>        fml_base_fe,</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(fml_output)</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>  <span class="do">## assign a name for each regression:</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">paste</span>(<span class="st">"("</span>, letters[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.)], <span class="st">")"</span>, <span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, <span class="fu">everything</span>())</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>fml_parameters</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
  name  choice_treatment controls_inclusion balanced_panel fml                  
  &lt;chr&gt; &lt;chr&gt;            &lt;lgl&gt;              &lt;lgl&gt;          &lt;chr&gt;                
1 (a)   intensity_2000   FALSE              FALSE          book_leverage ~ i(in…
2 (b)   intensity_2000   TRUE               FALSE          book_leverage ~ i(in…
3 (c)   treated          FALSE              FALSE          book_leverage ~ i(in…
4 (d)   treated          TRUE               FALSE          book_leverage ~ i(in…
5 (e)   intensity_2000   FALSE              TRUE           book_leverage ~ i(in…
6 (f)   intensity_2000   TRUE               TRUE           book_leverage ~ i(in…
7 (g)   treated          FALSE              TRUE           book_leverage ~ i(in…
8 (h)   treated          TRUE               TRUE           book_leverage ~ i(in…</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="do">## construct the data used for the loop:</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>data_did_loop <span class="ot">&lt;-</span> data_did <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, fyear, indexyear, intensity_2000, post_2005,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>         book_leverage, debt_ebitda, sic, ff_30ind_name,</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>         altman_Z, kz, market_book, tangibility, current_ratio) <span class="sc">%&gt;%</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">-</span> n_pre <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(intensity_2000) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(at)) <span class="sc">%&gt;%</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">gvkey =</span> <span class="fu">as.factor</span>(gvkey),</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">fyear =</span> <span class="fu">as.factor</span>(fyear),</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated =</span> <span class="fu">ifelse</span>(intensity_2000 <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">ebitda_at =</span> ebitda <span class="sc">/</span> at,</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">at_thousand =</span> at <span class="sc">*</span> <span class="dv">10</span><span class="sc">^-</span><span class="dv">3</span>,</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">large =</span> <span class="fu">ifelse</span>(large, <span class="at">yes =</span> <span class="st">"Large"</span>, <span class="at">no =</span> <span class="st">"Small"</span>),</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">tangiblity_exbnl =</span> tangibility <span class="sc">-</span> bnl_intensity,</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">bnl =</span> bnl_intensity <span class="sc">*</span> at,</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated_large =</span> <span class="fu">paste</span>(treated, large, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>data_did_loop_balanced <span class="ot">&lt;-</span> data_did <span class="sc">%&gt;%</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gvkey <span class="sc">%in%</span> data_did_balanced_id) <span class="sc">%&gt;%</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, fyear, indexyear, intensity_2000, post_2005,</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>         book_leverage, debt_ebitda, sic, ff_30ind_name,</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>         altman_Z, kz, market_book, tangibility, current_ratio) <span class="sc">%&gt;%</span></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">-</span> n_pre <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(intensity_2000) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(at)) <span class="sc">%&gt;%</span></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">gvkey =</span> <span class="fu">as.factor</span>(gvkey),</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">fyear =</span> <span class="fu">as.factor</span>(fyear),</span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated =</span> <span class="fu">ifelse</span>(intensity_2000 <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">ebitda_at =</span> ebitda <span class="sc">/</span> at,</span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">at_thousand =</span> at <span class="sc">*</span> <span class="dv">10</span><span class="sc">^-</span><span class="dv">3</span>,</span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">tangiblity_exbnl =</span> tangibility <span class="sc">-</span> bnl_intensity,</span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">bnl =</span> bnl_intensity <span class="sc">*</span> at,</span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">treated_large =</span> <span class="fu">paste</span>(treated, large, <span class="at">sep =</span> <span class="st">"_"</span>),</span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>    <span class="do">## grouping variables</span></span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">large =</span> <span class="fu">ifelse</span>(large, <span class="at">yes =</span> <span class="st">"Large"</span>, <span class="at">no =</span> <span class="st">"Small"</span>)</span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a><span class="do">## store all results</span></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a>fml_results <span class="ot">&lt;-</span> fml_parameters <span class="sc">%&gt;%</span></span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(<span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="at">FUN =</span> <span class="cf">function</span>(parameters) {</span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a>    <span class="do">## parameters:</span></span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a>    is_balanced <span class="ot">&lt;-</span> parameters[<span class="dv">4</span>]</span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a>    fml_formula <span class="ot">&lt;-</span> parameters[<span class="dv">5</span>]</span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a>    <span class="do">## data:</span></span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (is_balanced <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data_did_loop_balanced</span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data_did_loop</span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a>    <span class="do">## regression:</span></span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a>    did_model <span class="ot">&lt;-</span> fixest<span class="sc">::</span><span class="fu">feols</span>(<span class="at">fml =</span> <span class="fu">formula</span>(fml_formula),</span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> data,</span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cluster =</span> <span class="fu">c</span>(<span class="st">"gvkey"</span>, <span class="st">"ff_30ind_name"</span>)</span>
<span id="cb40-68"><a href="#cb40-68" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb40-69"><a href="#cb40-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(did_model)</span>
<span id="cb40-70"><a href="#cb40-70" aria-hidden="true" tabindex="-1"></a>  })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 2,197 observations removed because of NA and infinite values (RHS: 2,197).
NOTE: 2,197 observations removed because of NA and infinite values (RHS: 2,197).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>NOTE: 1,539 observations removed because of NA and infinite values (RHS: 1,539).
NOTE: 1,539 observations removed because of NA and infinite values (RHS: 1,539).</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="do">### create the table:</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>fml_results <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">names&lt;-</span><span class="st">`</span>(<span class="at">value =</span> <span class="fu">unlist</span>(fml_parameters[,<span class="dv">1</span>])) <span class="sc">%&gt;%</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">etable</span>(</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">order =</span> <span class="st">"indexyear"</span>,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># keep = "post",</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">extralines =</span> <span class="fu">list</span>(</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>      <span class="do">## Controls:</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"^_Controls"</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">unlist</span>(fml_parameters[,<span class="dv">3</span>]), <span class="at">yes =</span> <span class="st">"Yes"</span>, <span class="at">no =</span> <span class="st">"No"</span>),</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>      <span class="do">## the identity of the sample:</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">"__Sample"</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">unlist</span>(fml_parameters[,<span class="dv">4</span>]), <span class="at">yes =</span> <span class="st">"Balanced Panel"</span>, <span class="at">no =</span> <span class="st">"Full Sample"</span>) <span class="co"># whether used a balanced panel or a full sample.</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>, <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"DiD Results with `"</span>, intensity_measure_name, <span class="st">"`"</span>, <span class="at">sep =</span> <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">font_size =</span> <span class="dv">8</span>,       <span class="co"># Smaller font (default is 16px)</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>,   <span class="co"># Table width fits content</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"condensed"</span>)</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>DiD Results with `bnl_intensity`</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(a)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(b)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(c)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(d)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(e)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(f)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(g)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">(h)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Dependent Var.:</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
<td style="text-align: left;">book_leverage</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">intensity_2000 x indexyear = -3</td>
<td style="text-align: left;">0.0277 (0.0164)</td>
<td style="text-align: left;">0.0172 (0.0156)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0105 (0.0247)</td>
<td style="text-align: left;">0.0011 (0.0300)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">intensity_2000 x indexyear = -2</td>
<td style="text-align: left;">0.0037 (0.0076)</td>
<td style="text-align: left;">-0.0088 (0.0112)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0006 (0.0120)</td>
<td style="text-align: left;">-0.0028 (0.0132)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">intensity_2000 x indexyear = 0</td>
<td style="text-align: left;">-0.0279* (0.0128)</td>
<td style="text-align: left;">-0.0337** (0.0117)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0348* (0.0133)</td>
<td style="text-align: left;">-0.0380*** (0.0090)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">intensity_2000 x indexyear = 1</td>
<td style="text-align: left;">-0.0643*** (0.0144)</td>
<td style="text-align: left;">-0.0560** (0.0156)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0636*** (0.0113)</td>
<td style="text-align: left;">-0.0524*** (0.0113)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">intensity_2000 x indexyear = 2</td>
<td style="text-align: left;">-0.0592*** (0.0150)</td>
<td style="text-align: left;">-0.0412. (0.0214)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0771*** (0.0145)</td>
<td style="text-align: left;">-0.0600** (0.0166)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">intensity_2000 x indexyear = 3</td>
<td style="text-align: left;">-0.0510* (0.0190)</td>
<td style="text-align: left;">-0.0356 (0.0268)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0598** (0.0169)</td>
<td style="text-align: left;">-0.0468* (0.0213)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">treated x indexyear = -3</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0291*** (0.0058)</td>
<td style="text-align: left;">0.0288*** (0.0057)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0201*** (0.0053)</td>
<td style="text-align: left;">0.0204** (0.0060)</td>
</tr>
<tr class="even">
<td style="text-align: left;">treated x indexyear = -2</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0031 (0.0032)</td>
<td style="text-align: left;">0.0024 (0.0036)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0025 (0.0040)</td>
<td style="text-align: left;">0.0026 (0.0044)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">treated x indexyear = 0</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0079* (0.0031)</td>
<td style="text-align: left;">-0.0075* (0.0036)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0113** (0.0034)</td>
<td style="text-align: left;">-0.0106** (0.0033)</td>
</tr>
<tr class="even">
<td style="text-align: left;">treated x indexyear = 1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0233*** (0.0046)</td>
<td style="text-align: left;">-0.0192*** (0.0049)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0150** (0.0051)</td>
<td style="text-align: left;">-0.0098 (0.0058)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">treated x indexyear = 2</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0201*** (0.0049)</td>
<td style="text-align: left;">-0.0119* (0.0050)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0199** (0.0057)</td>
<td style="text-align: left;">-0.0115. (0.0064)</td>
</tr>
<tr class="even">
<td style="text-align: left;">treated x indexyear = 3</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0190** (0.0052)</td>
<td style="text-align: left;">-0.0123. (0.0061)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0206*** (0.0051)</td>
<td style="text-align: left;">-0.0141* (0.0057)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">roa</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">3.57e-5 (3.23e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">3.7e-5 (3.22e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0052*** (0.0011)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0053*** (0.0012)</td>
</tr>
<tr class="even">
<td style="text-align: left;">ebitda_at</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">3.19e-5 (8.16e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">3.31e-5 (8.39e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0026** (0.0008)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0026** (0.0008)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">log(at_thousand)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0065 (0.0050)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0061 (0.0051)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0160** (0.0053)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.0158** (0.0053)</td>
</tr>
<tr class="even">
<td style="text-align: left;">altman_Z</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">6.01e-6. (3.46e-6)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">6.48e-6. (3.38e-6)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">8.91e-5* (4.08e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">8.97e-5* (4.13e-5)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tangibility</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.2185*** (0.0237)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.2173*** (0.0243)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.1860*** (0.0214)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.1863*** (0.0218)</td>
</tr>
<tr class="even">
<td style="text-align: left;">current_ratio</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0001* (4.86e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.0001* (4.77e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-7.65e-5* (3.1e-5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-7.83e-5* (3.04e-5)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Controls</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fixed-Effects:</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">------------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">-------------------</td>
<td style="text-align: left;">-------------------</td>
</tr>
<tr class="odd">
<td style="text-align: left;">gvkey</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">indexyear</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ff_30ind_name-indexyear</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">__________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">___________________</td>
<td style="text-align: left;">___________________</td>
</tr>
<tr class="odd">
<td style="text-align: left;">S.E.: Clustered</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
<td style="text-align: left;">by: gvkey &amp; ff_3.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Observations</td>
<td style="text-align: left;">32,693</td>
<td style="text-align: left;">30,496</td>
<td style="text-align: left;">32,693</td>
<td style="text-align: left;">30,496</td>
<td style="text-align: left;">22,729</td>
<td style="text-align: left;">21,190</td>
<td style="text-align: left;">22,729</td>
<td style="text-align: left;">21,190</td>
</tr>
<tr class="odd">
<td style="text-align: left;">R2</td>
<td style="text-align: left;">0.77506</td>
<td style="text-align: left;">0.76770</td>
<td style="text-align: left;">0.77570</td>
<td style="text-align: left;">0.76833</td>
<td style="text-align: left;">0.76272</td>
<td style="text-align: left;">0.75250</td>
<td style="text-align: left;">0.76306</td>
<td style="text-align: left;">0.75286</td>
</tr>
<tr class="even">
<td style="text-align: left;">Within R2</td>
<td style="text-align: left;">0.00181</td>
<td style="text-align: left;">0.02228</td>
<td style="text-align: left;">0.00465</td>
<td style="text-align: left;">0.02494</td>
<td style="text-align: left;">0.00241</td>
<td style="text-align: left;">0.02305</td>
<td style="text-align: left;">0.00385</td>
<td style="text-align: left;">0.02448</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Full Sample</td>
<td style="text-align: left;">Balanced Panel</td>
<td style="text-align: left;">Balanced Panel</td>
<td style="text-align: left;">Balanced Panel</td>
<td style="text-align: left;">Balanced Panel</td>
</tr>
</tbody>
</table>


</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="do">### create the plots:</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># fml_parameters[which(unlist(fml_parameters$balanced_panel)), ]</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>fml_results[<span class="fu">which</span>(<span class="fu">unlist</span>(fml_parameters<span class="sc">$</span>balanced_panel))] <span class="sc">%&gt;%</span> <span class="co"># choose the balanced panel</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">iplot</span>(.,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="fu">paste</span>(<span class="st">"Time to treatment (Year; 0 = "</span>, base_year, <span class="st">")"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Treatment Effects by fiscal year: `"</span>, intensity_measure_name, <span class="st">"`"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">sub =</span> <span class="st">"Data: Balanced Panel"</span>,</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ref.line =</span> <span class="cn">FALSE</span>,</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">ref.line.par =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>),</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">pt.join =</span> <span class="cn">FALSE</span>,</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">3.5</span>, <span class="fl">3.5</span>)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>        ); <span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="sc">-</span><span class="dv">3</span><span class="sc">:</span><span class="dv">3</span>); <span class="fu">abline</span>(<span class="at">v =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">3</span>); <span class="fu">legend</span>(<span class="st">'bottomleft'</span>, <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">17</span>, <span class="dv">15</span>, <span class="dv">21</span>), <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">'intensity'</span>, <span class="st">'intensity + controls'</span>, <span class="st">'dummy'</span>, <span class="st">'dummy + controls'</span>));</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AFA_test_2005_PPE_clean_files/figure-html/s3d-did-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>fml_results[<span class="fu">which</span>(<span class="sc">!</span><span class="fu">unlist</span>(fml_parameters<span class="sc">$</span>balanced_panel))] <span class="sc">%&gt;%</span> <span class="co"># choose full sample</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">iplot</span>(.,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="fu">paste</span>(<span class="st">"Time to treatment (Year; 0 = "</span>, base_year, <span class="st">")"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Treatment Effect by fiscal year: `"</span>, intensity_measure_name, <span class="st">"`"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">sub =</span> <span class="st">"Data: Full Sample"</span>,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">ref.line =</span> <span class="cn">FALSE</span>,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">ref.line.par =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>),</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">pt.join =</span> <span class="cn">FALSE</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">3.5</span>, <span class="fl">3.5</span>)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>        ); <span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="sc">-</span><span class="dv">3</span><span class="sc">:</span><span class="dv">3</span>); <span class="fu">abline</span>(<span class="at">v =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">3</span>); <span class="fu">legend</span>(<span class="st">'bottomleft'</span>, <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">17</span>, <span class="dv">15</span>, <span class="dv">21</span>), <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">'intensity'</span>, <span class="st">'intensity + controls'</span>, <span class="st">'dummy'</span>, <span class="st">'dummy + controls'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="AFA_test_2005_PPE_clean_files/figure-html/s3d-did-plot-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<!-- Other tests and summary stat: -->
<!-- ```{r s3d-test-run, echo=TRUE, results='asis'} -->
<!-- cat('#### ', "Big versus Small", '   \n') -->
<!-- did_model_subsample <- data_did_loop_balanced %>% -->
<!--   fixest::feols(fml = book_leverage ~ i(fyear, intensity_2000, ref = base_year - 1) + -->
<!--                   roa + ebitda_at + log(at_thousand) + -->
<!--                   altman_Z + tangibility + current_ratio | -->
<!--                   gvkey + fyear + ff_30ind_name^fyear, -->
<!--                 data = ., -->
<!--                 cluster = c("gvkey", "ff_30ind_name"), -->
<!--                 split = ~ large # large -->
<!--                 ) -->
<!-- did_model_subsample %>% etable(se.below = TRUE) -->
<!-- { -->
<!--   # Calculate the Wald statistics -->
<!--   model_large <- did_model_subsample[[1]] -->
<!--   model_small <- did_model_subsample[[2]] -->
<!--   ## get the name of the coefficnet of interests -->
<!--   coef_names <- names(model_large$coefficients) %>% -->
<!--     .[str_detect(string = ., pattern = "::")] -->
<!--   coef_large <- coef(model_large)[coef_names] -->
<!--   coef_small <- coef(model_small)[coef_names] -->
<!--   # Difference in treatment effects -->
<!--   diff_coef <- coef_large - coef_small -->
<!--   # Variance of the difference -->
<!--   var_diff <- vcov(model_large)[coef_names, coef_names] + vcov(model_small)[coef_names, coef_names] -->
<!--   # Wald statistic for each treatment effect estimate -->
<!--   wald_stat <- (diff_coef)^2 / diag(var_diff) -->
<!--   wald_stat_vector <- c(t(diff_coef) %*% solve(var_diff) %*% (diff_coef)) -->
<!--   # Degrees of freedom -->
<!--   df <- 1 -->
<!--   df_vector <- length(diff_coef) -->
<!--   # P-value -->
<!--   p_value <- 1 - pchisq(wald_stat, df) -->
<!--   p_value_vector <- 1 - pchisq(wald_stat_vector, df_vector) -->
<!-- } -->
<!-- convert_p_to_stars <- function(p_values) { -->
<!--   # Initialize a character vector to store the significance stars -->
<!--   stars <- character(length(p_values)) -->
<!--   # Assign stars based on p-value thresholds -->
<!--   stars[p_values < 0.001] <- "***" -->
<!--   stars[p_values >= 0.001 & p_values < 0.01] <- "**" -->
<!--   stars[p_values >= 0.01 & p_values < 0.05] <- "*" -->
<!--   stars[p_values >= 0.05 & p_values < 0.1] <- "." -->
<!--   stars[p_values >= 0.1] <- "" -->
<!--   return(stars) -->
<!-- } -->
<!-- # Output results -->
<!-- cat("Wald test for the difference in the treatment effect\n between the Large firms and Small firms: \n\n"); -->
<!-- data.frame( -->
<!--   Diff = diff_coef, -->
<!--   `Std. Error` = sqrt(diag(var_diff)), -->
<!--   `Wald stat` = wald_stat, -->
<!--   `P value` = p_value, -->
<!--   Star = convert_p_to_stars(p_value) -->
<!-- ) -->
<!-- cat("Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 \n") -->
<!-- ## Interacting with Large/Small: -->
<!-- data_did_loop_balanced %>% -->
<!--   fixest::feols(fml = book_leverage ~ intensity_2000 + post_2005 + large + post_2005*large + intensity_2000*large + intensity_2000:post_2005:i(large) -->
<!--                 + roa + ebitda_at + log(at_thousand) + altman_Z + tangibility + current_ratio -->
<!--                 | -->
<!--                   gvkey + fyear + ff_30ind_name^fyear, data = ., cluster = c("gvkey", "ff_30ind_name")) %>% -->
<!--   etable() -->
<!-- ``` -->
<p>Check the trend of movement in the intensity measure:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Observation summary:</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"#### Number of Observations in Each Group over time (Full Sample): </span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>#### Number of Observations in Each Group over time (Full Sample): </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>data_did <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, fyear, indexyear, intensity_2000, post_2005, book_leverage, debt_ebitda, sic, ff_30ind_name, at, ebitda, large, roa) <span class="sc">%&gt;%</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(intensity_2000) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(at)) <span class="sc">%&gt;%</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">gvkey =</span> <span class="fu">as.factor</span>(gvkey),</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">fyear =</span> <span class="fu">as.factor</span>(fyear),</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">treated =</span> <span class="fu">ifelse</span>(intensity_2000 <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Treated"</span>, <span class="st">"Untreated"</span>),</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># treated = ifelse(intensity_2000 &gt; 0, 1, 0),</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">ebitda_at =</span> ebitda <span class="sc">/</span> at,</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">at_thousand =</span> at <span class="sc">*</span> <span class="dv">10</span><span class="sc">^-</span><span class="dv">3</span>,</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">large =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(large, <span class="at">yes =</span> <span class="st">"Large"</span>, <span class="at">no =</span> <span class="st">"Small"</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Large"</span>, <span class="st">"Small"</span>) ),</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">treated_large =</span> <span class="fu">paste</span>(treated, large, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treated_large, fyear) <span class="sc">%&gt;%</span></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   Treated = str_extract(string = treated_large, pattern = "^[^_]+"),</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   Size = str_extract(string = treated_large, pattern = "[^_]+$")</span></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   ) %&gt;%</span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> treated_large, <span class="at">values_from =</span> n) <span class="sc">%&gt;%</span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">caption =</span> <span class="st">"Number of Observations in each group between 2002 and 2007"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">size =</span> <span class="st">"x-small"</span>),  <span class="co"># Reduce font size</span></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_column_labels</span>(<span class="at">columns =</span> <span class="fu">everything</span>()) <span class="co"># reduce the size of tab headers</span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">size =</span> <span class="st">"x-small"</span>),  <span class="co"># Reduce font size</span></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_body</span>()</span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="zmdxordbvr" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#zmdxordbvr table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#zmdxordbvr thead, #zmdxordbvr tbody, #zmdxordbvr tfoot, #zmdxordbvr tr, #zmdxordbvr td, #zmdxordbvr th {
  border-style: none;
}

#zmdxordbvr p {
  margin: 0;
  padding: 0;
}

#zmdxordbvr .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#zmdxordbvr .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#zmdxordbvr .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#zmdxordbvr .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#zmdxordbvr .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zmdxordbvr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zmdxordbvr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zmdxordbvr .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#zmdxordbvr .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#zmdxordbvr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#zmdxordbvr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#zmdxordbvr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#zmdxordbvr .gt_spanner_row {
  border-bottom-style: hidden;
}

#zmdxordbvr .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#zmdxordbvr .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#zmdxordbvr .gt_from_md > :first-child {
  margin-top: 0;
}

#zmdxordbvr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#zmdxordbvr .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#zmdxordbvr .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#zmdxordbvr .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#zmdxordbvr .gt_row_group_first td {
  border-top-width: 2px;
}

#zmdxordbvr .gt_row_group_first th {
  border-top-width: 2px;
}

#zmdxordbvr .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zmdxordbvr .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#zmdxordbvr .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#zmdxordbvr .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zmdxordbvr .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zmdxordbvr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#zmdxordbvr .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#zmdxordbvr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#zmdxordbvr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zmdxordbvr .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zmdxordbvr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zmdxordbvr .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zmdxordbvr .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zmdxordbvr .gt_left {
  text-align: left;
}

#zmdxordbvr .gt_center {
  text-align: center;
}

#zmdxordbvr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#zmdxordbvr .gt_font_normal {
  font-weight: normal;
}

#zmdxordbvr .gt_font_bold {
  font-weight: bold;
}

#zmdxordbvr .gt_font_italic {
  font-style: italic;
}

#zmdxordbvr .gt_super {
  font-size: 65%;
}

#zmdxordbvr .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#zmdxordbvr .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#zmdxordbvr .gt_indent_1 {
  text-indent: 5px;
}

#zmdxordbvr .gt_indent_2 {
  text-indent: 10px;
}

#zmdxordbvr .gt_indent_3 {
  text-indent: 15px;
}

#zmdxordbvr .gt_indent_4 {
  text-indent: 20px;
}

#zmdxordbvr .gt_indent_5 {
  text-indent: 25px;
}

#zmdxordbvr .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#zmdxordbvr div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<caption>Number of Observations in each group between 2002 and 2007</caption>
<thead>
<tr class="header gt_col_headings">
<th id="fyear" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-size: x-small" scope="col">fyear</th>
<th id="Treated_Large" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-size: x-small" scope="col">Treated_Large</th>
<th id="Treated_Small" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-size: x-small" scope="col">Treated_Small</th>
<th id="Untreated_Large" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-size: x-small" scope="col">Untreated_Large</th>
<th id="Untreated_Small" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-size: x-small" scope="col">Untreated_Small</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="fyear" style="font-size: x-small">2002</td>
<td class="gt_row gt_right" headers="Treated_Large" style="font-size: x-small">1863</td>
<td class="gt_row gt_right" headers="Treated_Small" style="font-size: x-small">948</td>
<td class="gt_row gt_right" headers="Untreated_Large" style="font-size: x-small">555</td>
<td class="gt_row gt_right" headers="Untreated_Small" style="font-size: x-small">2050</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="fyear" style="font-size: x-small">2003</td>
<td class="gt_row gt_right" headers="Treated_Large" style="font-size: x-small">1761</td>
<td class="gt_row gt_right" headers="Treated_Small" style="font-size: x-small">859</td>
<td class="gt_row gt_right" headers="Untreated_Large" style="font-size: x-small">495</td>
<td class="gt_row gt_right" headers="Untreated_Small" style="font-size: x-small">1826</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="fyear" style="font-size: x-small">2004</td>
<td class="gt_row gt_right" headers="Treated_Large" style="font-size: x-small">1666</td>
<td class="gt_row gt_right" headers="Treated_Small" style="font-size: x-small">791</td>
<td class="gt_row gt_right" headers="Untreated_Large" style="font-size: x-small">449</td>
<td class="gt_row gt_right" headers="Untreated_Small" style="font-size: x-small">1693</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="fyear" style="font-size: x-small">2005</td>
<td class="gt_row gt_right" headers="Treated_Large" style="font-size: x-small">1555</td>
<td class="gt_row gt_right" headers="Treated_Small" style="font-size: x-small">725</td>
<td class="gt_row gt_right" headers="Untreated_Large" style="font-size: x-small">422</td>
<td class="gt_row gt_right" headers="Untreated_Small" style="font-size: x-small">1549</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="fyear" style="font-size: x-small">2006</td>
<td class="gt_row gt_right" headers="Treated_Large" style="font-size: x-small">1452</td>
<td class="gt_row gt_right" headers="Treated_Small" style="font-size: x-small">671</td>
<td class="gt_row gt_right" headers="Untreated_Large" style="font-size: x-small">371</td>
<td class="gt_row gt_right" headers="Untreated_Small" style="font-size: x-small">1403</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="fyear" style="font-size: x-small">2007</td>
<td class="gt_row gt_right" headers="Treated_Large" style="font-size: x-small">1333</td>
<td class="gt_row gt_right" headers="Treated_Small" style="font-size: x-small">617</td>
<td class="gt_row gt_right" headers="Untreated_Large" style="font-size: x-small">340</td>
<td class="gt_row gt_right" headers="Untreated_Small" style="font-size: x-small">1270</td>
</tr>
</tbody>
</table>

</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"#### Number of Observations in Each Group over time (Balanced Panel): </span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>#### Number of Observations in Each Group over time (Balanced Panel): </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>data_did <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gvkey <span class="sc">%in%</span> data_did_balanced_id) <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, fyear, indexyear, intensity_2000, post_2005, book_leverage, debt_ebitda, sic, ff_30ind_name, at, ebitda, large, roa) <span class="sc">%&gt;%</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> period_start <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(intensity_2000) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(at)) <span class="sc">%&gt;%</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">gvkey =</span> <span class="fu">as.factor</span>(gvkey),</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">fyear =</span> <span class="fu">as.factor</span>(fyear),</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">treated =</span> <span class="fu">ifelse</span>(intensity_2000 <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Treated"</span>, <span class="st">"Untreated"</span>),</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># treated = ifelse(intensity_2000 &gt; 0, 1, 0),</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">ebitda_at =</span> ebitda <span class="sc">/</span> at,</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">at_thousand =</span> at <span class="sc">*</span> <span class="dv">10</span><span class="sc">^-</span><span class="dv">3</span>,</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">large =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(large, <span class="at">yes =</span> <span class="st">"Large"</span>, <span class="at">no =</span> <span class="st">"Small"</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Large"</span>, <span class="st">"Small"</span>) ),</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">treated_large =</span> <span class="fu">paste</span>(treated, large, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treated_large, fyear) <span class="sc">%&gt;%</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> treated_large, <span class="at">values_from =</span> n) <span class="sc">%&gt;%</span></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">caption =</span> <span class="st">"Number of Observations in each group between 2002 and 2007"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">size =</span> <span class="st">"x-small"</span>),  <span class="co"># Reduce font size</span></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_column_labels</span>(<span class="at">columns =</span> <span class="fu">everything</span>()) <span class="co"># reduce the size of tab headers</span></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">size =</span> <span class="st">"x-small"</span>),  <span class="co"># Reduce font size</span></span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_body</span>()</span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="izeskhnmgr" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#izeskhnmgr table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#izeskhnmgr thead, #izeskhnmgr tbody, #izeskhnmgr tfoot, #izeskhnmgr tr, #izeskhnmgr td, #izeskhnmgr th {
  border-style: none;
}

#izeskhnmgr p {
  margin: 0;
  padding: 0;
}

#izeskhnmgr .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#izeskhnmgr .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#izeskhnmgr .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#izeskhnmgr .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#izeskhnmgr .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#izeskhnmgr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#izeskhnmgr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#izeskhnmgr .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#izeskhnmgr .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#izeskhnmgr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#izeskhnmgr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#izeskhnmgr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#izeskhnmgr .gt_spanner_row {
  border-bottom-style: hidden;
}

#izeskhnmgr .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#izeskhnmgr .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#izeskhnmgr .gt_from_md > :first-child {
  margin-top: 0;
}

#izeskhnmgr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#izeskhnmgr .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#izeskhnmgr .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#izeskhnmgr .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#izeskhnmgr .gt_row_group_first td {
  border-top-width: 2px;
}

#izeskhnmgr .gt_row_group_first th {
  border-top-width: 2px;
}

#izeskhnmgr .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#izeskhnmgr .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#izeskhnmgr .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#izeskhnmgr .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#izeskhnmgr .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#izeskhnmgr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#izeskhnmgr .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#izeskhnmgr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#izeskhnmgr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#izeskhnmgr .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#izeskhnmgr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#izeskhnmgr .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#izeskhnmgr .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#izeskhnmgr .gt_left {
  text-align: left;
}

#izeskhnmgr .gt_center {
  text-align: center;
}

#izeskhnmgr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#izeskhnmgr .gt_font_normal {
  font-weight: normal;
}

#izeskhnmgr .gt_font_bold {
  font-weight: bold;
}

#izeskhnmgr .gt_font_italic {
  font-style: italic;
}

#izeskhnmgr .gt_super {
  font-size: 65%;
}

#izeskhnmgr .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#izeskhnmgr .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#izeskhnmgr .gt_indent_1 {
  text-indent: 5px;
}

#izeskhnmgr .gt_indent_2 {
  text-indent: 10px;
}

#izeskhnmgr .gt_indent_3 {
  text-indent: 15px;
}

#izeskhnmgr .gt_indent_4 {
  text-indent: 20px;
}

#izeskhnmgr .gt_indent_5 {
  text-indent: 25px;
}

#izeskhnmgr .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#izeskhnmgr div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<caption>Number of Observations in each group between 2002 and 2007</caption>
<thead>
<tr class="header gt_col_headings">
<th id="fyear" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-size: x-small" scope="col">fyear</th>
<th id="Treated_Large" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-size: x-small" scope="col">Treated_Large</th>
<th id="Treated_Small" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-size: x-small" scope="col">Treated_Small</th>
<th id="Untreated_Large" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-size: x-small" scope="col">Untreated_Large</th>
<th id="Untreated_Small" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-size: x-small" scope="col">Untreated_Small</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="fyear" style="font-size: x-small">2002</td>
<td class="gt_row gt_right" headers="Treated_Large" style="font-size: x-small">1280</td>
<td class="gt_row gt_right" headers="Treated_Small" style="font-size: x-small">576</td>
<td class="gt_row gt_right" headers="Untreated_Large" style="font-size: x-small">324</td>
<td class="gt_row gt_right" headers="Untreated_Small" style="font-size: x-small">1067</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="fyear" style="font-size: x-small">2003</td>
<td class="gt_row gt_right" headers="Treated_Large" style="font-size: x-small">1280</td>
<td class="gt_row gt_right" headers="Treated_Small" style="font-size: x-small">576</td>
<td class="gt_row gt_right" headers="Untreated_Large" style="font-size: x-small">324</td>
<td class="gt_row gt_right" headers="Untreated_Small" style="font-size: x-small">1067</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="fyear" style="font-size: x-small">2004</td>
<td class="gt_row gt_right" headers="Treated_Large" style="font-size: x-small">1280</td>
<td class="gt_row gt_right" headers="Treated_Small" style="font-size: x-small">576</td>
<td class="gt_row gt_right" headers="Untreated_Large" style="font-size: x-small">324</td>
<td class="gt_row gt_right" headers="Untreated_Small" style="font-size: x-small">1067</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="fyear" style="font-size: x-small">2005</td>
<td class="gt_row gt_right" headers="Treated_Large" style="font-size: x-small">1280</td>
<td class="gt_row gt_right" headers="Treated_Small" style="font-size: x-small">576</td>
<td class="gt_row gt_right" headers="Untreated_Large" style="font-size: x-small">324</td>
<td class="gt_row gt_right" headers="Untreated_Small" style="font-size: x-small">1067</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="fyear" style="font-size: x-small">2006</td>
<td class="gt_row gt_right" headers="Treated_Large" style="font-size: x-small">1280</td>
<td class="gt_row gt_right" headers="Treated_Small" style="font-size: x-small">576</td>
<td class="gt_row gt_right" headers="Untreated_Large" style="font-size: x-small">324</td>
<td class="gt_row gt_right" headers="Untreated_Small" style="font-size: x-small">1067</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="fyear" style="font-size: x-small">2007</td>
<td class="gt_row gt_right" headers="Treated_Large" style="font-size: x-small">1280</td>
<td class="gt_row gt_right" headers="Treated_Small" style="font-size: x-small">576</td>
<td class="gt_row gt_right" headers="Untreated_Large" style="font-size: x-small">324</td>
<td class="gt_row gt_right" headers="Untreated_Small" style="font-size: x-small">1067</td>
</tr>
</tbody>
</table>

</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"`bnl_intensity`: </span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>`bnl_intensity`: </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> intensity_measure_year <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, fyear, <span class="fu">all_of</span>(intensity_measure_name)) <span class="sc">%&gt;%</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> fyear, <span class="at">values_from =</span> <span class="fu">all_of</span>(intensity_measure_name)) <span class="sc">%&gt;%</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"gvkey"</span>) <span class="sc">%&gt;%</span> <span class="co"># convert into rownames</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         2000     2001     2002     2003     2004     2005     2006     2007
1004 0.109925 0.108170 0.108367 0.090809 0.080233 0.064026 0.069679 0.084466
1021 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000
1034 0.095755 0.085633 0.098100 0.109003 0.128727 0.061396 0.115526 0.096297
1050 0.131387 0.136394 0.155087 0.135856 0.128910 0.131329 0.089732 0.060413
1062 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000
1072 0.106598 0.129059 0.137992 0.146348 0.160801 0.160973 0.156375 0.168714
1078 0.143917 0.110799 0.112253 0.112998 0.099345 0.103850 0.102737 0.102812
1082 0.375528 0.661385 0.818204 0.667496 0.611982 0.599924 0.709494 0.489888
1094 0.000000 0.000000 0.000000 0.000000 0.002178 0.022419 0.000018 0.015997
1096 0.828436 0.785170 0.869140 0.862246 0.879633 0.891396 0.746847 0.773825
1097 0.141147 0.146789 0.131890 0.121762 0.117395 0.123977 0.132147 0.141016
1104 0.103561 0.111139 0.141933 0.143785 0.132426 0.110165 0.083864 0.074511
1109 0.172354 0.170392 0.203393 0.202864 0.140946 0.130897 0.166074 0.111574
1111 0.011718 0.007991 0.007761 0.005095 0.004037 0.003540 0.003081 0.002584
1117 0.000000 0.005561 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000
1161 0.251989 0.264631 0.254025 0.329692 0.322195 0.144987 0.111280 0.094026
1173 0.182648 0.181556 0.241647 0.225388 0.238369 0.222096 0.258697 0.128344
1209 0.098277 0.100494 0.101460 0.102376 0.095156 0.096130 0.090790 0.087199
1228 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000
1234 0.189732 0.191952 0.167563 0.174638 0.158038 0.245521 0.357150 0.346692</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"`book_leverage`: </span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>`book_leverage`: </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book_leverage <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> book_leverage <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fyear <span class="sc">&gt;=</span> intensity_measure_year <span class="sc">&amp;</span> fyear <span class="sc">&lt;=</span> period_end) <span class="sc">%&gt;%</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, fyear, book_leverage) <span class="sc">%&gt;%</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> fyear, <span class="at">values_from =</span> book_leverage) <span class="sc">%&gt;%</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"gvkey"</span>) <span class="sc">%&gt;%</span> <span class="co"># convert into rownames</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         2000     2001     2002     2003     2004     2005     2006     2007
1004 0.275896 0.366410 0.374171 0.355366 0.315344 0.327808 0.307087 0.389800
1013 0.011334 0.001880 0.023160 0.314828 0.280302 0.260782 0.248231 0.227335
1021 0.436768 0.464968 0.366115 0.458637 0.268054 0.082792 0.000000 0.234036
1034 0.326074 0.443761 0.390025 0.350821 0.350195 0.256678 0.000000 0.241454
1045 0.239194 0.322950 0.435392 0.474940 0.498036 0.498220 0.459427 0.389976
1050 0.534511 0.403809 0.392527 0.376197 0.370203 0.336014 0.245173 0.048760
1062 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000
1072 0.013737 0.009064 0.002012 0.000016 0.000000 0.000000 0.000000 0.000000
1075 0.349877 0.401539 0.387488 0.357503 0.330733 0.265757 0.285440 0.322986
1078 0.101799 0.312873 0.264751 0.224204 0.235704 0.227633 0.343050 0.307542
1082 0.531551 0.550577 0.489912 0.463896 0.464892 0.428487 0.456049 0.388829
1094 0.017597 0.116427 0.065755 0.026603 0.006680 0.004201 0.003001 0.002785
1096 0.544320 0.553017 0.562115 0.565844 0.569743 0.651411 0.632386 0.644374
1097 0.246810 0.224277 0.176378 0.144280 0.117324 0.102331 0.087648 0.071132
1104 0.355763 0.283349 0.290962 0.246117 0.064149 0.198163 0.292025 0.241343
1109 0.307899 0.399875 0.329045 0.244701 0.257918 0.098786 0.180593 0.208470
1111 0.204558 0.005908 0.003998 0.000000 0.000000 0.000000 0.000000 0.000000
1117 0.390891 0.403337 0.398258 0.361599 0.035546 0.000000 0.000000 0.000000
1121 0.026560 0.054949 0.056773 0.054575 0.048042 0.036701 0.010370 0.000000
1161 0.224966 0.177900 0.345518 0.295015 0.237002 0.188026 0.288811 0.456190</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="sec-EndNotes" class="level2">
<h2 class="anchored" data-anchor-id="sec-EndNotes">EndNotes</h2>
<ul>
<li><p><label><input type="checkbox">If the land and building lease obligations (<code>bnl_lease</code>) are not constantly renewed, it will decrease over time. Therefore, the lease intensity should go down over time as well. Relative to those untreated firms, i.e.&nbsp;w/o <code>bnl_lease</code>, treated firms should generally have a higher leverage.</label></p></li>
<li><p>Use small firms with zero <code>bnl_lease</code> as the benchmark.</p>
<ul>
<li><p>big firms with zero <code>bnl_lease</code> have similar level of leverage over time.</p></li>
<li><p>small firms with positive <code>bnl_lease</code> have significantly higher leverage before the treatment and significantly lower leverage afterwards.</p></li>
<li><p>big firms with positive <code>bnl_lease</code> have significantly higher leverage before the treatment and are indifferent from the benchmark after the treatment.</p></li>
<li><p>parallel trend assumption should hold.</p></li>
</ul></li>
<li><p>For nice plots: <a href="https://grantmcdermott.com/ggfixest/articles/ggiplot.html"><code>ggiplot()</code></a></p></li>
<li><p>Measures for financial constraints are from <a href="https://academic.oup.com/rfs/article/29/2/271/1902640?searchresult=1#114343035">Appendix A.2</a> &gt; <a href="#sec-s2-clean-prep" class="quarto-xref">Section&nbsp;2</a></p>
<ul>
<li>Joan Farre-Mensa, Alexander Ljungqvist, Do Measures of Financial Constraints Measure Financial Constraints?, The Review of Financial Studies, Volume 29, Issue 2, February 2016, Pages 271–308, <a href="https://doi.org/10.1093/rfs/hhv052" class="uri">https://doi.org/10.1093/rfs/hhv052</a></li>
</ul></li>
<li><p><label><input type="checkbox">Should we still use <code>fyear = 2005</code> as the base year with <code>indexyear = 0</code>? As it came into effect in Oct 2005, most of the treatment effect will show up in 2005. <mark>Should we choose 2004 as the base year</mark>?</label></p></li>
</ul>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb60" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Non-financial Liabilities and Restructuring" </span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Empirical support from 2005 Reform with the North America sample" </span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Hongyi Xu"</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "March 10, 2025"</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="an">date-modified:</span><span class="co"> last-modified </span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: flatly</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true </span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 4  # Add this line to include 3 levels of TOC</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Show the code"</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="co">    html-math-method: katex</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left </span></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a><span class="co">    code-block-bg: true</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a><span class="co">    code-block-border-left: "#31BAE9" </span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a><span class="co">  output: true</span></span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;style type="text/css"&gt;</span></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a><span class="in">body, td {</span></span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a><span class="in">   font-size: 16px;</span></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a><span class="in">code.r{</span></span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a><span class="in">  font-size: 12px;</span></span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a><span class="in">pre { /* For appearance of output blocks */</span></span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a><span class="in">  font-size: 12px;</span></span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a><span class="in">  background-color: #f0f0f0; /* Light grey background */</span></span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a><span class="in">  padding: 5px;</span></span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a><span class="in">  &lt;!-- border-radius: 5px; /* border corner */ --&gt;</span></span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a><span class="in">} </span></span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true" tabindex="-1"></a><span class="in">.gt_table .gt_caption {</span></span>
<span id="cb60-41"><a href="#cb60-41" aria-hidden="true" tabindex="-1"></a><span class="in">    font-size: 16px; </span></span>
<span id="cb60-42"><a href="#cb60-42" aria-hidden="true" tabindex="-1"></a><span class="in">    display: flex;</span></span>
<span id="cb60-43"><a href="#cb60-43" aria-hidden="true" tabindex="-1"></a><span class="in">    justify-content: space-between;</span></span>
<span id="cb60-44"><a href="#cb60-44" aria-hidden="true" tabindex="-1"></a><span class="in">    align-items: center;</span></span>
<span id="cb60-45"><a href="#cb60-45" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb60-46"><a href="#cb60-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-47"><a href="#cb60-47" aria-hidden="true" tabindex="-1"></a><span class="in">/* Middle column: Main content */</span></span>
<span id="cb60-48"><a href="#cb60-48" aria-hidden="true" tabindex="-1"></a><span class="in">.content-column {</span></span>
<span id="cb60-49"><a href="#cb60-49" aria-hidden="true" tabindex="-1"></a><span class="in">  flex: 2; /* Takes remaining space */</span></span>
<span id="cb60-50"><a href="#cb60-50" aria-hidden="true" tabindex="-1"></a><span class="in">  margin-right: 20px; /* Spacing between columns */</span></span>
<span id="cb60-51"><a href="#cb60-51" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb60-52"><a href="#cb60-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-53"><a href="#cb60-53" aria-hidden="true" tabindex="-1"></a><span class="in">/* Right column: Outputs */</span></span>
<span id="cb60-54"><a href="#cb60-54" aria-hidden="true" tabindex="-1"></a><span class="in">.output-column {</span></span>
<span id="cb60-55"><a href="#cb60-55" aria-hidden="true" tabindex="-1"></a><span class="in">  flex: 0 0 10%; /* Fixed width for outputs */</span></span>
<span id="cb60-56"><a href="#cb60-56" aria-hidden="true" tabindex="-1"></a><span class="in">  position: sticky;</span></span>
<span id="cb60-57"><a href="#cb60-57" aria-hidden="true" tabindex="-1"></a><span class="in">  top: 0;</span></span>
<span id="cb60-58"><a href="#cb60-58" aria-hidden="true" tabindex="-1"></a><span class="in">  height: 100vh; /* Full height */</span></span>
<span id="cb60-59"><a href="#cb60-59" aria-hidden="true" tabindex="-1"></a><span class="in">  overflow-y: auto; /* Scrollable if content is long */</span></span>
<span id="cb60-60"><a href="#cb60-60" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb60-61"><a href="#cb60-61" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/style&gt;</span></span>
<span id="cb60-62"><a href="#cb60-62" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-63"><a href="#cb60-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-64"><a href="#cb60-64" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb60-65"><a href="#cb60-65" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(echo = TRUE)</span></span>
<span id="cb60-66"><a href="#cb60-66" aria-hidden="true" tabindex="-1"></a><span class="in">rm(list = ls())</span></span>
<span id="cb60-67"><a href="#cb60-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-68"><a href="#cb60-68" aria-hidden="true" tabindex="-1"></a><span class="in">library(haven) </span></span>
<span id="cb60-69"><a href="#cb60-69" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse) </span></span>
<span id="cb60-70"><a href="#cb60-70" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2) </span></span>
<span id="cb60-71"><a href="#cb60-71" aria-hidden="true" tabindex="-1"></a><span class="in">library(scales) </span></span>
<span id="cb60-72"><a href="#cb60-72" aria-hidden="true" tabindex="-1"></a><span class="in">library(gt)</span></span>
<span id="cb60-73"><a href="#cb60-73" aria-hidden="true" tabindex="-1"></a><span class="in">library(fixest)</span></span>
<span id="cb60-74"><a href="#cb60-74" aria-hidden="true" tabindex="-1"></a><span class="in">library(patchwork) </span></span>
<span id="cb60-75"><a href="#cb60-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-76"><a href="#cb60-76" aria-hidden="true" tabindex="-1"></a><span class="in"># Get system information</span></span>
<span id="cb60-77"><a href="#cb60-77" aria-hidden="true" tabindex="-1"></a><span class="in">sys_info &lt;- Sys.info()</span></span>
<span id="cb60-78"><a href="#cb60-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-79"><a href="#cb60-79" aria-hidden="true" tabindex="-1"></a><span class="in"># Check the operating system</span></span>
<span id="cb60-80"><a href="#cb60-80" aria-hidden="true" tabindex="-1"></a><span class="in">if (sys_info['sysname'] == 'Windows') {</span></span>
<span id="cb60-81"><a href="#cb60-81" aria-hidden="true" tabindex="-1"></a><span class="in">  work_dir &lt;- "C:/Users/13613/OneDrive - Handelshögskolan i Stockholm/Projects_2024/BeckerJosephsonXu_2025/AFA_meeting_response" </span></span>
<span id="cb60-82"><a href="#cb60-82" aria-hidden="true" tabindex="-1"></a><span class="in">  print("You are running R on Windows.")</span></span>
<span id="cb60-83"><a href="#cb60-83" aria-hidden="true" tabindex="-1"></a><span class="in">} else if (sys_info['sysname'] == 'Darwin') {</span></span>
<span id="cb60-84"><a href="#cb60-84" aria-hidden="true" tabindex="-1"></a><span class="in">  work_dir &lt;- "~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/BeckerJosephsonXu_2025/AFA_meeting_response" </span></span>
<span id="cb60-85"><a href="#cb60-85" aria-hidden="true" tabindex="-1"></a><span class="in">  print("You are running R on Mac.")</span></span>
<span id="cb60-86"><a href="#cb60-86" aria-hidden="true" tabindex="-1"></a><span class="in">} else {</span></span>
<span id="cb60-87"><a href="#cb60-87" aria-hidden="true" tabindex="-1"></a><span class="in">  print("You are running R on a different operating system.") </span></span>
<span id="cb60-88"><a href="#cb60-88" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb60-89"><a href="#cb60-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-90"><a href="#cb60-90" aria-hidden="true" tabindex="-1"></a><span class="in">setwd(work_dir)</span></span>
<span id="cb60-91"><a href="#cb60-91" aria-hidden="true" tabindex="-1"></a><span class="in">list.files()</span></span>
<span id="cb60-92"><a href="#cb60-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-93"><a href="#cb60-93" aria-hidden="true" tabindex="-1"></a><span class="in">## &gt; Windows: C:/Users/13613/OneDrive - Handelshögskolan i Stockholm/Projects_2024</span></span>
<span id="cb60-94"><a href="#cb60-94" aria-hidden="true" tabindex="-1"></a><span class="in">## &gt; Mac: ~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024</span></span>
<span id="cb60-95"><a href="#cb60-95" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-96"><a href="#cb60-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-97"><a href="#cb60-97" aria-hidden="true" tabindex="-1"></a>::: callout-important</span>
<span id="cb60-98"><a href="#cb60-98" aria-hidden="true" tabindex="-1"></a><span class="fu">#### This analysis is suggested by discussant Samuel Antill in 2025 AFA meeting.</span></span>
<span id="cb60-99"><a href="#cb60-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-100"><a href="#cb60-100" aria-hidden="true" tabindex="-1"></a>The previous versions can be found <span class="co">[</span><span class="ot">here</span><span class="co">](https://hongyileoxu.github.io/projects/)</span>.</span>
<span id="cb60-101"><a href="#cb60-101" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb60-102"><a href="#cb60-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-103"><a href="#cb60-103" aria-hidden="true" tabindex="-1"></a><span class="fu">## S1. Download and Load the Raw Dataset {#sec-s1-raw-dataset}</span></span>
<span id="cb60-104"><a href="#cb60-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-105"><a href="#cb60-105" aria-hidden="true" tabindex="-1"></a>We download the firm-level capital structure from Compustat-CapitalIQ North America. The first measure of executory contracts is from the accounting data which (under U.S. GAAP) cover leases and rental contracts. We use the variables “Debt Equivalent of Operating Leases”, “Capital Leases” and “Net Rental Expenses”.</span>
<span id="cb60-106"><a href="#cb60-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-107"><a href="#cb60-107" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Debt - Capitalized Lease Obligations (dclo)`</span>: This item represents long-term obligations due in respect of lease finances and hire purchase arrangements. This item includes:</span>
<span id="cb60-108"><a href="#cb60-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-109"><a href="#cb60-109" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Long-term finance lease obligations</span>
<span id="cb60-110"><a href="#cb60-110" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Long-term lease financing</span>
<span id="cb60-111"><a href="#cb60-111" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Long-term hire purchase obligations</span>
<span id="cb60-112"><a href="#cb60-112" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Non-current obligations under capital leases</span>
<span id="cb60-113"><a href="#cb60-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-114"><a href="#cb60-114" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Rental Expense (xrent)`</span>: This item represents all costs charged to operations for rental, lease, or hire of space and/or equipment. This item includes:</span>
<span id="cb60-115"><a href="#cb60-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-116"><a href="#cb60-116" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Airlines' landing fees</span>
<span id="cb60-117"><a href="#cb60-117" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Contingent rentals associated with capitalized leases</span>
<span id="cb60-118"><a href="#cb60-118" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Lease charges and plant hire</span>
<span id="cb60-119"><a href="#cb60-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-120"><a href="#cb60-120" aria-hidden="true" tabindex="-1"></a>    In the main test, we construct a new variable called <span class="in">`total rent`</span>, which is defined as the total rental commitment <span class="in">`mrc1 + mrc2 + mrc3 + mrc4 + mrc5 + mrct`</span> reported in year $t$.</span>
<span id="cb60-121"><a href="#cb60-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-122"><a href="#cb60-122" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Asset - Total (at)`</span>: Book value of total assets.</span>
<span id="cb60-123"><a href="#cb60-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-124"><a href="#cb60-124" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Debt in Current Liabilities - Total (dlc)`</span> is for the short-term debt and <span class="in">`Long-term debt - Total (dltt)`</span> is for the long-term debt.</span>
<span id="cb60-125"><a href="#cb60-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-126"><a href="#cb60-126" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Earnings Before Interest (EBITDA)`</span>: EBITDA.</span>
<span id="cb60-127"><a href="#cb60-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-128"><a href="#cb60-128" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Industry classifications: <span class="in">`naics`</span>, <span class="in">`sic`</span> and <span class="in">`spcindcd`</span> + (Fama-French 30 Industry Classifiers, &lt;mark&gt;<span class="co">[</span><span class="ot">To Be Added</span><span class="co">](https://github.com/Wenzhi-Ding/FamaFrenchIndustry)</span> / <span class="co">[</span><span class="ot">Definition</span><span class="co">](https://mba.tuck.dartmouth.edu/pages/faculty/ken.french/Data_Library/det_30_ind_port.html)</span>&lt;/mark&gt;).</span>
<span id="cb60-129"><a href="#cb60-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-130"><a href="#cb60-130" aria-hidden="true" tabindex="-1"></a>&lt;mark&gt;In this version we add a set of new variables&lt;/mark&gt;:</span>
<span id="cb60-131"><a href="#cb60-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-132"><a href="#cb60-132" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Property, Plant, and Equipment - Leases at Cost (fatl)`</span> is the capitalized value of leases and leasehold improvements included in property, plant, and equipment, excluding equipment leased to others, and is not applicable to banks or utilities. <span class="sc">\&gt;</span> <span class="co">[</span><span class="ot">Definition</span><span class="co">](https://livehhsse-my.sharepoint.com/:u:/r/personal/65570_student_hhs_se/Documents/Projects_2024/BeckerJosephsonXu_2025/AFA_meeting_response/Test/2005_test/Variable%20Def%20Compustat/Wharton%20Research%20Data%20Services%20-%20fatl.html?csf=1&amp;web=1&amp;e=CdIDnC)</span></span>
<span id="cb60-133"><a href="#cb60-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-134"><a href="#cb60-134" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Property, Plant, and Equipment - Buildings at Cost (fatb)`</span>. <span class="sc">\&gt;</span> <span class="co">[</span><span class="ot">Definition</span><span class="co">](https://livehhsse-my.sharepoint.com/:u:/r/personal/65570_student_hhs_se/Documents/Projects_2024/BeckerJosephsonXu_2025/AFA_meeting_response/Test/2005_test/Variable%20Def%20Compustat/Wharton%20Research%20Data%20Services%20-%20fatb.html?csf=1&amp;web=1&amp;e=mKw61J)</span></span>
<span id="cb60-135"><a href="#cb60-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-136"><a href="#cb60-136" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Property, Plant, and Equipment - Land and Improvements at Cost (fatp)`</span>.</span>
<span id="cb60-137"><a href="#cb60-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-138"><a href="#cb60-138" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- -   `Property, Plant, and Equipment - Leases (Net) (ppenls)`. [no longer available]  --&gt;</span></span>
<span id="cb60-139"><a href="#cb60-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-140"><a href="#cb60-140" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Property, Plant, and Equipment - Buildings (Net) (ppenb)`</span>.</span>
<span id="cb60-141"><a href="#cb60-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-142"><a href="#cb60-142" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Property, Plant, and Equipment - Land and Improvements (Net) (ppenli)`</span>.</span>
<span id="cb60-143"><a href="#cb60-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-144"><a href="#cb60-144" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Property, Plant and Equipment - Total (Gross) (ppegt)`</span>.</span>
<span id="cb60-145"><a href="#cb60-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-146"><a href="#cb60-146" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Property, Plant and Equipment - Total (Net) (ppent)`</span></span>
<span id="cb60-147"><a href="#cb60-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-148"><a href="#cb60-148" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Loans/Claims/Advances - Lease (lcal)`</span>. <span class="sc">\&gt;</span> <span class="co">[</span><span class="ot">Defintion</span><span class="co">](https://livehhsse-my.sharepoint.com/:u:/g/personal/65570_student_hhs_se/EcYuzHO66GFCohXiCmFrdFMBPcI2FNxqePqRXsd5SwSZXg?e=muF6fe)</span> <span class="sc">\&gt;</span></span>
<span id="cb60-149"><a href="#cb60-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-150"><a href="#cb60-150" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ::: {#nte-company-location .callout-note .column-margin collapse="TRUE"} --&gt;</span></span>
<span id="cb60-151"><a href="#cb60-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-152"><a href="#cb60-152" aria-hidden="true" tabindex="-1"></a>Given that the policy shock happens under the US jurisdiction, we expect more significant treatment effect to be detected in this sample. The period used in Samuel's slides is between 2002 and 2007, which is after the doc.com bubble and before the GFC. The variables in the dataset are:</span>
<span id="cb60-153"><a href="#cb60-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-154"><a href="#cb60-154" aria-hidden="true" tabindex="-1"></a><span class="in">```{r s1-load-data, echo=TRUE, results='hold'}</span></span>
<span id="cb60-155"><a href="#cb60-155" aria-hidden="true" tabindex="-1"></a><span class="in">## create the data file path </span></span>
<span id="cb60-156"><a href="#cb60-156" aria-hidden="true" tabindex="-1"></a><span class="in">data_file &lt;- "jpbdsuonrpztpw8t.csv" </span></span>
<span id="cb60-157"><a href="#cb60-157" aria-hidden="true" tabindex="-1"></a><span class="in">data_path &lt;- file.path(work_dir, "Data", data_file)</span></span>
<span id="cb60-158"><a href="#cb60-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-159"><a href="#cb60-159" aria-hidden="true" tabindex="-1"></a><span class="in">## load the compustat_na data</span></span>
<span id="cb60-160"><a href="#cb60-160" aria-hidden="true" tabindex="-1"></a><span class="in">compustat_na &lt;- as_tibble(read.csv(file = data_path) ) # %&gt;%</span></span>
<span id="cb60-161"><a href="#cb60-161" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(fic == "USA" | loc == "USA" ) ## keep only US related observations (| fic == "CAN" | loc == "CAN")</span></span>
<span id="cb60-162"><a href="#cb60-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-163"><a href="#cb60-163" aria-hidden="true" tabindex="-1"></a><span class="in">## data file record: </span></span>
<span id="cb60-164"><a href="#cb60-164" aria-hidden="true" tabindex="-1"></a><span class="in"># | Mar 10, 2025 &gt; jpbdsuonrpztpw8t.csv</span></span>
<span id="cb60-165"><a href="#cb60-165" aria-hidden="true" tabindex="-1"></a><span class="in"># | Mar  9, 2025 &gt; nfmss2xkmjgfjonh.csv </span></span>
<span id="cb60-166"><a href="#cb60-166" aria-hidden="true" tabindex="-1"></a><span class="in"># | Mar  5, 2025 &gt; e3cdfjocaz4aboqh.csv </span></span>
<span id="cb60-167"><a href="#cb60-167" aria-hidden="true" tabindex="-1"></a><span class="in"># | Mar  3, 2025(2) &gt; tbrl8c4xqurukptl.csv &gt; more variables </span></span>
<span id="cb60-168"><a href="#cb60-168" aria-hidden="true" tabindex="-1"></a><span class="in"># | Mar  3, 2025(1) &gt; evvvij0nqoe8sshv.csv</span></span>
<span id="cb60-169"><a href="#cb60-169" aria-hidden="true" tabindex="-1"></a><span class="in"># | Feb 24, 2025 &gt; azsyeo1yjmrb2q1v.csv </span></span>
<span id="cb60-170"><a href="#cb60-170" aria-hidden="true" tabindex="-1"></a><span class="in"># | Jan 14, 2025 &gt; g4f68dkn3beu1iag.csv </span></span>
<span id="cb60-171"><a href="#cb60-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-172"><a href="#cb60-172" aria-hidden="true" tabindex="-1"></a><span class="in">## load the FF_30ind data </span></span>
<span id="cb60-173"><a href="#cb60-173" aria-hidden="true" tabindex="-1"></a><span class="in">FF_30ind &lt;- as_tibble(read.csv(file = file.path(work_dir, "Data", "ff_30ind.csv")))</span></span>
<span id="cb60-174"><a href="#cb60-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-175"><a href="#cb60-175" aria-hidden="true" tabindex="-1"></a><span class="in">## check the variable names </span></span>
<span id="cb60-176"><a href="#cb60-176" aria-hidden="true" tabindex="-1"></a><span class="in">cat("Variables include:\n\n")</span></span>
<span id="cb60-177"><a href="#cb60-177" aria-hidden="true" tabindex="-1"></a><span class="in">sort(names(compustat_na)) </span></span>
<span id="cb60-178"><a href="#cb60-178" aria-hidden="true" tabindex="-1"></a><span class="in">cat("\nSample size: \n\n")</span></span>
<span id="cb60-179"><a href="#cb60-179" aria-hidden="true" tabindex="-1"></a><span class="in">dim(compustat_na)</span></span>
<span id="cb60-180"><a href="#cb60-180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-181"><a href="#cb60-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-182"><a href="#cb60-182" aria-hidden="true" tabindex="-1"></a><span class="fu">## S2. Data Cleaning and Prep {#sec-s2-clean-prep}</span></span>
<span id="cb60-183"><a href="#cb60-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-184"><a href="#cb60-184" aria-hidden="true" tabindex="-1"></a>Two dependent variables are constructed to measure firm's leverage: (&lt;u&gt;cf. p18 and Table 2 of the paper&lt;/u&gt;)</span>
<span id="cb60-185"><a href="#cb60-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-186"><a href="#cb60-186" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Book leverage`</span>: we define leverage as the ratio of the sum of short-term debt and long-term debt to assets (we drop observations where this is outside the <span class="sc">\[</span>0,1<span class="sc">\]</span> range)<span class="sc">\*</span>.</span>
<span id="cb60-187"><a href="#cb60-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-188"><a href="#cb60-188" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Debt/EBITDA`</span>: we define debt-to-EBITDA as the ratio of the long- and short-term debt to EBITDA (we drop observations where this is outside the <span class="sc">\[</span>0,15<span class="sc">\]</span> range)<span class="sc">\*</span>.</span>
<span id="cb60-189"><a href="#cb60-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-190"><a href="#cb60-190" aria-hidden="true" tabindex="-1"></a>These restrictions are now imposed in all analyses. We use the full set of firms in the Compustat NA. We choose <span class="in">`fyear`</span> - fiscal year - as the time variable of the dataset.</span>
<span id="cb60-191"><a href="#cb60-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-192"><a href="#cb60-192" aria-hidden="true" tabindex="-1"></a>In this version, we set the <span class="in">`base_year == 2004`</span> instead of <span class="in">`2005`</span>, which is the year when the treatment happens. Based on the <span class="co">[</span><span class="ot">S.256 - Bankruptcy Abuse Prevention and Consumer Protection Act of 2005</span><span class="co">](https://www.congress.gov/bill/109th-congress/senate-bill/256)</span>, the bill was first introduced on February 1, 2025 and was signed into law by President George W. Bush. on April 20, 2005. The act’s provisions applied to bankruptcy cases filed on or after October 17, 2005. <span class="co">[</span><span class="ot">\&gt; Wikipedia</span><span class="co">](https://en.wikipedia.org/wiki/Bankruptcy_Abuse_Prevention_and_Consumer_Protection_Act?utm_source=chatgpt.com)</span></span>
<span id="cb60-193"><a href="#cb60-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-194"><a href="#cb60-194" aria-hidden="true" tabindex="-1"></a>Therefore, the treatment effects should first appear in the annual reports for the fiscal year 2005, as the treatment occurs in fiscal year 2004.</span>
<span id="cb60-195"><a href="#cb60-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-196"><a href="#cb60-196" aria-hidden="true" tabindex="-1"></a>Then we create a list of variables required for the analysis:</span>
<span id="cb60-197"><a href="#cb60-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-198"><a href="#cb60-198" aria-hidden="true" tabindex="-1"></a><span class="in">```{r s2-clean-prep, echo=TRUE, results='hold'}</span></span>
<span id="cb60-199"><a href="#cb60-199" aria-hidden="true" tabindex="-1"></a><span class="in">## set the base year </span></span>
<span id="cb60-200"><a href="#cb60-200" aria-hidden="true" tabindex="-1"></a><span class="in">base_year &lt;- 2004 </span></span>
<span id="cb60-201"><a href="#cb60-201" aria-hidden="true" tabindex="-1"></a><span class="in">period_start &lt;- 2002</span></span>
<span id="cb60-202"><a href="#cb60-202" aria-hidden="true" tabindex="-1"></a><span class="in">period_end &lt;- 2007</span></span>
<span id="cb60-203"><a href="#cb60-203" aria-hidden="true" tabindex="-1"></a><span class="in">intensity_measure_year &lt;- 2000 # choose the base year for the intensity measure </span></span>
<span id="cb60-204"><a href="#cb60-204" aria-hidden="true" tabindex="-1"></a><span class="in">n_pre &lt;- 1 # number of periods before the period_start in the iplot()  </span></span>
<span id="cb60-205"><a href="#cb60-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-206"><a href="#cb60-206" aria-hidden="true" tabindex="-1"></a><span class="in">## create leverage and control variables </span></span>
<span id="cb60-207"><a href="#cb60-207" aria-hidden="true" tabindex="-1"></a><span class="in">data &lt;- compustat_na %&gt;% </span></span>
<span id="cb60-208"><a href="#cb60-208" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(at &gt;= 0) %&gt;%</span></span>
<span id="cb60-209"><a href="#cb60-209" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(indfmt == "INDL") %&gt;% ## remove all financial firms</span></span>
<span id="cb60-210"><a href="#cb60-210" aria-hidden="true" tabindex="-1"></a><span class="in">  ## create the lagged `ppent` item: </span></span>
<span id="cb60-211"><a href="#cb60-211" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(gvkey) %&gt;%</span></span>
<span id="cb60-212"><a href="#cb60-212" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(fyear) %&gt;%</span></span>
<span id="cb60-213"><a href="#cb60-213" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(ppent_lag1 = lag(ppent, n = 1)) %&gt;% </span></span>
<span id="cb60-214"><a href="#cb60-214" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb60-215"><a href="#cb60-215" aria-hidden="true" tabindex="-1"></a><span class="in">  ## create new variables: </span></span>
<span id="cb60-216"><a href="#cb60-216" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-217"><a href="#cb60-217" aria-hidden="true" tabindex="-1"></a><span class="in">    ## leverage variables: </span></span>
<span id="cb60-218"><a href="#cb60-218" aria-hidden="true" tabindex="-1"></a><span class="in">    book_leverage = (dlc + dltt) / at, </span></span>
<span id="cb60-219"><a href="#cb60-219" aria-hidden="true" tabindex="-1"></a><span class="in">    debt_ebitda = (dlc + dltt) / ebitda, </span></span>
<span id="cb60-220"><a href="#cb60-220" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb60-221"><a href="#cb60-221" aria-hidden="true" tabindex="-1"></a><span class="in">    ## treatment intensity: </span></span>
<span id="cb60-222"><a href="#cb60-222" aria-hidden="true" tabindex="-1"></a><span class="in">    totalrent = coalesce(mrc1, 0) + coalesce(mrc2, 0) + coalesce(mrc3, 0) + coalesce(mrc4, 0) + coalesce(mrc5, 0) + coalesce(mrcta, 0), # total rent w/o discount</span></span>
<span id="cb60-223"><a href="#cb60-223" aria-hidden="true" tabindex="-1"></a><span class="in">    # contract_intensity = (dclo + xrent * 3) / at, # executory contract intensity</span></span>
<span id="cb60-224"><a href="#cb60-224" aria-hidden="true" tabindex="-1"></a><span class="in">    contract_intensity = (coalesce(dclo, 0) + totalrent) / at, # executory contract intensity</span></span>
<span id="cb60-225"><a href="#cb60-225" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb60-226"><a href="#cb60-226" aria-hidden="true" tabindex="-1"></a><span class="in">    ### for the total: </span></span>
<span id="cb60-227"><a href="#cb60-227" aria-hidden="true" tabindex="-1"></a><span class="in">    ppe_lease_intensity = fatl / at, # PPE lease intensity </span></span>
<span id="cb60-228"><a href="#cb60-228" aria-hidden="true" tabindex="-1"></a><span class="in">    building_intensity = fatb / at, # only for buildings (i.e. properties), but only not only leased ones</span></span>
<span id="cb60-229"><a href="#cb60-229" aria-hidden="true" tabindex="-1"></a><span class="in">    land_intensity = fatp / at, # only land intensity </span></span>
<span id="cb60-230"><a href="#cb60-230" aria-hidden="true" tabindex="-1"></a><span class="in">    bnl_intensity = building_intensity + land_intensity, </span></span>
<span id="cb60-231"><a href="#cb60-231" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb60-232"><a href="#cb60-232" aria-hidden="true" tabindex="-1"></a><span class="in">    ### for the net: </span></span>
<span id="cb60-233"><a href="#cb60-233" aria-hidden="true" tabindex="-1"></a><span class="in">    # net_lease_intensity = ppenls / at, # net PPE lease intensity [not available after 1998]</span></span>
<span id="cb60-234"><a href="#cb60-234" aria-hidden="true" tabindex="-1"></a><span class="in">    # net_building_intensity = ppenb / at, # net PPE building intensity [not available after 1998]  </span></span>
<span id="cb60-235"><a href="#cb60-235" aria-hidden="true" tabindex="-1"></a><span class="in">    net_land_intensity = ppenli / at, # net PPE land intensity </span></span>
<span id="cb60-236"><a href="#cb60-236" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb60-237"><a href="#cb60-237" aria-hidden="true" tabindex="-1"></a><span class="in">    ### for total PPE: </span></span>
<span id="cb60-238"><a href="#cb60-238" aria-hidden="true" tabindex="-1"></a><span class="in">    net_PPE_intensity = ppent / at, # net PPE intensity </span></span>
<span id="cb60-239"><a href="#cb60-239" aria-hidden="true" tabindex="-1"></a><span class="in">    PPE_intensity = ppegt / at, # gross PPE intensity </span></span>
<span id="cb60-240"><a href="#cb60-240" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb60-241"><a href="#cb60-241" aria-hidden="true" tabindex="-1"></a><span class="in">    ### for lessors: </span></span>
<span id="cb60-242"><a href="#cb60-242" aria-hidden="true" tabindex="-1"></a><span class="in">    lessor_lease_intensity = lcal / at, # this is outstanding lease intensity to be received. </span></span>
<span id="cb60-243"><a href="#cb60-243" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb60-244"><a href="#cb60-244" aria-hidden="true" tabindex="-1"></a><span class="in">    ## other variables and controls: </span></span>
<span id="cb60-245"><a href="#cb60-245" aria-hidden="true" tabindex="-1"></a><span class="in">    dyear = as.integer(substr(datadate, start = 1, stop = 4)), # data year </span></span>
<span id="cb60-246"><a href="#cb60-246" aria-hidden="true" tabindex="-1"></a><span class="in">    roa = ni / at, # return on asset (ROA) </span></span>
<span id="cb60-247"><a href="#cb60-247" aria-hidden="true" tabindex="-1"></a><span class="in">    tangibility = ppent / at, # tangibility  </span></span>
<span id="cb60-248"><a href="#cb60-248" aria-hidden="true" tabindex="-1"></a><span class="in">    altman_Z = (3.3 * revt + 1.4 * re + 1.2 * wcap) / at, # Altman Z-score</span></span>
<span id="cb60-249"><a href="#cb60-249" aria-hidden="true" tabindex="-1"></a><span class="in">    kz = -1.001909 * ((ib + dp)/ppent_lag1) + 0.2826389 * ((at + prcc_f*csho - ceq - txdb)/at) + 3.139193 * ((dltt + dlc)/(dltt + dlc + seq)) - 39.3678 * ((dvc + dvp)/ppent_lag1) - 1.314759 * (che/ppent_lag1), # KZ index </span></span>
<span id="cb60-250"><a href="#cb60-250" aria-hidden="true" tabindex="-1"></a><span class="in">    # hw = , # financial contraints (HW) </span></span>
<span id="cb60-251"><a href="#cb60-251" aria-hidden="true" tabindex="-1"></a><span class="in">    current_ratio = act / lct, # current ratio: current asset / current liabilites </span></span>
<span id="cb60-252"><a href="#cb60-252" aria-hidden="true" tabindex="-1"></a><span class="in">    market_book = (prcc_f*csho) / (ceq + txdb) # market-to-book</span></span>
<span id="cb60-253"><a href="#cb60-253" aria-hidden="true" tabindex="-1"></a><span class="in">  ) </span></span>
<span id="cb60-254"><a href="#cb60-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-255"><a href="#cb60-255" aria-hidden="true" tabindex="-1"></a><span class="in">## record the variable names </span></span>
<span id="cb60-256"><a href="#cb60-256" aria-hidden="true" tabindex="-1"></a><span class="in">cat("Variables Created:\n\n")</span></span>
<span id="cb60-257"><a href="#cb60-257" aria-hidden="true" tabindex="-1"></a><span class="in">sort(setdiff(names(data), names(compustat_na))) </span></span>
<span id="cb60-258"><a href="#cb60-258" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-259"><a href="#cb60-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-260"><a href="#cb60-260" aria-hidden="true" tabindex="-1"></a>We propose several noisy measures of the PPE lease contract intensity:</span>
<span id="cb60-261"><a href="#cb60-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-262"><a href="#cb60-262" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`ppe_lease_intensity`</span>: calculated as the <span class="in">`Property, Plant, and Equipment - Leases at Cost (fatl)`</span> normalized by the total asset for firm $i$ at year $t$. It measures the future lease obligations in PPE, but it is a noisy measure as it also includes equipment.</span>
<span id="cb60-263"><a href="#cb60-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-264"><a href="#cb60-264" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`building_intensity`</span>: calculated as <span class="in">`Property, Plant, and Equipment - Buildings at Cost (fatb)`</span> normalized by the total asset for firm $i$ at year $t$.</span>
<span id="cb60-265"><a href="#cb60-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-266"><a href="#cb60-266" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`land_intensity`</span>: calculated as <span class="in">`Property, Plant, and Equipment - Land and Improvements at Cost (fatp)`</span> normalized by the total asset for firm $i$ at year $t$.</span>
<span id="cb60-267"><a href="#cb60-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-268"><a href="#cb60-268" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`bnl_intensity`</span>: calculated as the sum of <span class="in">`Property, Plant, and Equipment - Land and Improvements at Cost (fatp)`</span> and <span class="in">`Property, Plant, and Equipment - Buildings at Cost (fatb)`</span> normalized by the <span class="in">`total asset (at)`</span> for firm $i$ at year $t$.</span>
<span id="cb60-269"><a href="#cb60-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-270"><a href="#cb60-270" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`oustanding_lease_intensity`</span>: calculated as the <span class="in">`Loans/Claims/Advances - Lease (lcal)`</span> normalized by the total asset for firm $i$ at year $t$. It measures the amount of lease obgliations to be collected by firm $i$ in the future. You can view this sample as the lessor in the lease contract, while the previous variable, <span class="in">`ppe_lease_intensity`</span>, captures the sample of lessees.</span>
<span id="cb60-271"><a href="#cb60-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-272"><a href="#cb60-272" aria-hidden="true" tabindex="-1"></a>&lt;mark&gt;Although this will contain other items besides non-residential real property lease obligations, we believe that it is a potentially better measure for a firm's exposure to this policy shock in 2005.&lt;/mark&gt;</span>
<span id="cb60-273"><a href="#cb60-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-274"><a href="#cb60-274" aria-hidden="true" tabindex="-1"></a>For definitions of controls, please refer to @sec-EndNotes.</span>
<span id="cb60-275"><a href="#cb60-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-276"><a href="#cb60-276" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`kz`</span>: KZ index:</span>
<span id="cb60-277"><a href="#cb60-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-278"><a href="#cb60-278" aria-hidden="true" tabindex="-1"></a>$$-1.001909 \left( \frac{ib + dp}{\text{lagged } ppent} \right) + 0.2826389 \left( \frac{at + \text{prcc_f} \times \text{csho} - ceq - txdb}{at} \right) + 3.139193 \left( \frac{dltt + dlc}{dltt + dlc + seq} \right) - 39.3678 \left( \frac{dvc + dvp}{\text{lagged } ppent} \right) - 1.314759 \left( \frac{che}{\text{lagged } ppent} \right)$$.</span>
<span id="cb60-279"><a href="#cb60-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-280"><a href="#cb60-280" aria-hidden="true" tabindex="-1"></a><span class="fu">### s2.1. Summary Statistics</span></span>
<span id="cb60-281"><a href="#cb60-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-282"><a href="#cb60-282" aria-hidden="true" tabindex="-1"></a><span class="in">```{r s2-summary-stat, echo=TRUE}</span></span>
<span id="cb60-283"><a href="#cb60-283" aria-hidden="true" tabindex="-1"></a><span class="in">## summary statistics: </span></span>
<span id="cb60-284"><a href="#cb60-284" aria-hidden="true" tabindex="-1"></a><span class="in">data %&gt;% </span></span>
<span id="cb60-285"><a href="#cb60-285" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;% </span></span>
<span id="cb60-286"><a href="#cb60-286" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(at &gt; 0 &amp; ebitda &gt; 0 &amp; ppent_lag1 &gt; 0 &amp; lct &gt; 0 &amp; (ceq + txdb) &gt; 0) %&gt;% </span></span>
<span id="cb60-287"><a href="#cb60-287" aria-hidden="true" tabindex="-1"></a><span class="in">  select(</span></span>
<span id="cb60-288"><a href="#cb60-288" aria-hidden="true" tabindex="-1"></a><span class="in">    book_leverage, debt_ebitda, </span></span>
<span id="cb60-289"><a href="#cb60-289" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb60-290"><a href="#cb60-290" aria-hidden="true" tabindex="-1"></a><span class="in">    altman_Z, current_ratio, debt_ebitda, current_ratio, </span></span>
<span id="cb60-291"><a href="#cb60-291" aria-hidden="true" tabindex="-1"></a><span class="in">    debt_ebitda, kz, market_book, roa, tangibility, </span></span>
<span id="cb60-292"><a href="#cb60-292" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb60-293"><a href="#cb60-293" aria-hidden="true" tabindex="-1"></a><span class="in">    contract_intensity, ppe_lease_intensity, bnl_intensity, </span></span>
<span id="cb60-294"><a href="#cb60-294" aria-hidden="true" tabindex="-1"></a><span class="in">    building_intensity, land_intensity, # lessor_lease_intensity </span></span>
<span id="cb60-295"><a href="#cb60-295" aria-hidden="true" tabindex="-1"></a><span class="in">    # net_land_intensity, net_PPE_intensity, PPE_intensity, ppent_lag1, </span></span>
<span id="cb60-296"><a href="#cb60-296" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb60-297"><a href="#cb60-297" aria-hidden="true" tabindex="-1"></a><span class="in">  psych::describe(na.rm = TRUE) %&gt;% </span></span>
<span id="cb60-298"><a href="#cb60-298" aria-hidden="true" tabindex="-1"></a><span class="in">  select(n, mean, `trimmed mean` = trimmed, median, sd) %&gt;% </span></span>
<span id="cb60-299"><a href="#cb60-299" aria-hidden="true" tabindex="-1"></a><span class="in">  round(digits = 2) %&gt;% </span></span>
<span id="cb60-300"><a href="#cb60-300" aria-hidden="true" tabindex="-1"></a><span class="in">  rownames_to_column(var = "Variable Name") %&gt;% </span></span>
<span id="cb60-301"><a href="#cb60-301" aria-hidden="true" tabindex="-1"></a><span class="in">  gt() %&gt;% </span></span>
<span id="cb60-302"><a href="#cb60-302" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_header(</span></span>
<span id="cb60-303"><a href="#cb60-303" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "Table 1. Summary Statistics"</span></span>
<span id="cb60-304"><a href="#cb60-304" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb60-305"><a href="#cb60-305" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_options(</span></span>
<span id="cb60-306"><a href="#cb60-306" aria-hidden="true" tabindex="-1"></a><span class="in">    heading.align = "left"</span></span>
<span id="cb60-307"><a href="#cb60-307" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb60-308"><a href="#cb60-308" aria-hidden="true" tabindex="-1"></a><span class="in">  cols_align(</span></span>
<span id="cb60-309"><a href="#cb60-309" aria-hidden="true" tabindex="-1"></a><span class="in">    align = "center",</span></span>
<span id="cb60-310"><a href="#cb60-310" aria-hidden="true" tabindex="-1"></a><span class="in">    columns = c("n", "mean", "trimmed mean", "median", "sd")</span></span>
<span id="cb60-311"><a href="#cb60-311" aria-hidden="true" tabindex="-1"></a><span class="in">  ) </span></span>
<span id="cb60-312"><a href="#cb60-312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-313"><a href="#cb60-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-314"><a href="#cb60-314" aria-hidden="true" tabindex="-1"></a><span class="fu">### s2.2. plot the distribution of different intensity measures {.tabset}</span></span>
<span id="cb60-315"><a href="#cb60-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-316"><a href="#cb60-316" aria-hidden="true" tabindex="-1"></a><span class="in">```{r s2-plots, echo=TRUE, results='asis'}</span></span>
<span id="cb60-317"><a href="#cb60-317" aria-hidden="true" tabindex="-1"></a><span class="in">candidate_intensity_measure &lt;- c(</span></span>
<span id="cb60-318"><a href="#cb60-318" aria-hidden="true" tabindex="-1"></a><span class="in">  "contract_intensity", </span></span>
<span id="cb60-319"><a href="#cb60-319" aria-hidden="true" tabindex="-1"></a><span class="in">  "ppe_lease_intensity", </span></span>
<span id="cb60-320"><a href="#cb60-320" aria-hidden="true" tabindex="-1"></a><span class="in">  "building_intensity", </span></span>
<span id="cb60-321"><a href="#cb60-321" aria-hidden="true" tabindex="-1"></a><span class="in">  "land_intensity",</span></span>
<span id="cb60-322"><a href="#cb60-322" aria-hidden="true" tabindex="-1"></a><span class="in">  "bnl_intensity") </span></span>
<span id="cb60-323"><a href="#cb60-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-324"><a href="#cb60-324" aria-hidden="true" tabindex="-1"></a><span class="in">for (measure in candidate_intensity_measure) {</span></span>
<span id="cb60-325"><a href="#cb60-325" aria-hidden="true" tabindex="-1"></a><span class="in">  cat('\n')</span></span>
<span id="cb60-326"><a href="#cb60-326" aria-hidden="true" tabindex="-1"></a><span class="in">  cat('#### ', measure, '   \n')</span></span>
<span id="cb60-327"><a href="#cb60-327" aria-hidden="true" tabindex="-1"></a><span class="in">  cat('\n')</span></span>
<span id="cb60-328"><a href="#cb60-328" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb60-329"><a href="#cb60-329" aria-hidden="true" tabindex="-1"></a><span class="in">  data %&gt;% </span></span>
<span id="cb60-330"><a href="#cb60-330" aria-hidden="true" tabindex="-1"></a><span class="in">    filter(fic == "USA" | loc == "USA" ) %&gt;% </span></span>
<span id="cb60-331"><a href="#cb60-331" aria-hidden="true" tabindex="-1"></a><span class="in">    filter(fyear &gt;= period_start &amp; fyear &lt;= period_end) %&gt;% </span></span>
<span id="cb60-332"><a href="#cb60-332" aria-hidden="true" tabindex="-1"></a><span class="in">    filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;% </span></span>
<span id="cb60-333"><a href="#cb60-333" aria-hidden="true" tabindex="-1"></a><span class="in">    filter(at &gt; 0 &amp; ebitda &gt; 0 &amp; ppent_lag1 &gt; 0 &amp; lct &gt; 0 &amp; (ceq + txdb) &gt; 0) %&gt;% </span></span>
<span id="cb60-334"><a href="#cb60-334" aria-hidden="true" tabindex="-1"></a><span class="in">    select(</span></span>
<span id="cb60-335"><a href="#cb60-335" aria-hidden="true" tabindex="-1"></a><span class="in">      gvkey, fyear, </span></span>
<span id="cb60-336"><a href="#cb60-336" aria-hidden="true" tabindex="-1"></a><span class="in">      book_leverage, debt_ebitda, </span></span>
<span id="cb60-337"><a href="#cb60-337" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb60-338"><a href="#cb60-338" aria-hidden="true" tabindex="-1"></a><span class="in">      altman_Z, current_ratio, debt_ebitda, current_ratio, </span></span>
<span id="cb60-339"><a href="#cb60-339" aria-hidden="true" tabindex="-1"></a><span class="in">      debt_ebitda, kz, market_book, roa, tangibility, </span></span>
<span id="cb60-340"><a href="#cb60-340" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb60-341"><a href="#cb60-341" aria-hidden="true" tabindex="-1"></a><span class="in">      contract_intensity, ppe_lease_intensity, bnl_intensity, </span></span>
<span id="cb60-342"><a href="#cb60-342" aria-hidden="true" tabindex="-1"></a><span class="in">      building_intensity, land_intensity, # lessor_lease_intensity </span></span>
<span id="cb60-343"><a href="#cb60-343" aria-hidden="true" tabindex="-1"></a><span class="in">      # net_land_intensity, net_PPE_intensity, PPE_intensity, ppent_lag1, </span></span>
<span id="cb60-344"><a href="#cb60-344" aria-hidden="true" tabindex="-1"></a><span class="in">    ) %&gt;% </span></span>
<span id="cb60-345"><a href="#cb60-345" aria-hidden="true" tabindex="-1"></a><span class="in">    na.omit() %&gt;% </span></span>
<span id="cb60-346"><a href="#cb60-346" aria-hidden="true" tabindex="-1"></a><span class="in">    filter(contract_intensity &gt;= 0) %&gt;% </span></span>
<span id="cb60-347"><a href="#cb60-347" aria-hidden="true" tabindex="-1"></a><span class="in">    .[[measure]] %&gt;% # selec the variable of interest </span></span>
<span id="cb60-348"><a href="#cb60-348" aria-hidden="true" tabindex="-1"></a><span class="in">    hist(., </span></span>
<span id="cb60-349"><a href="#cb60-349" aria-hidden="true" tabindex="-1"></a><span class="in">       prob = TRUE, # density plot</span></span>
<span id="cb60-350"><a href="#cb60-350" aria-hidden="true" tabindex="-1"></a><span class="in">       col = "#E1DEFC",  </span></span>
<span id="cb60-351"><a href="#cb60-351" aria-hidden="true" tabindex="-1"></a><span class="in">       main = "Density Histogram: data from Compustat NA", </span></span>
<span id="cb60-352"><a href="#cb60-352" aria-hidden="true" tabindex="-1"></a><span class="in">       xlab = paste(measure),</span></span>
<span id="cb60-353"><a href="#cb60-353" aria-hidden="true" tabindex="-1"></a><span class="in">       ylab = "Density", </span></span>
<span id="cb60-354"><a href="#cb60-354" aria-hidden="true" tabindex="-1"></a><span class="in">       breaks = 100, # xlim = c(0, 8) </span></span>
<span id="cb60-355"><a href="#cb60-355" aria-hidden="true" tabindex="-1"></a><span class="in">     ) </span></span>
<span id="cb60-356"><a href="#cb60-356" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb60-357"><a href="#cb60-357" aria-hidden="true" tabindex="-1"></a><span class="in">  # jpeg(filename = paste("Figure1_", id.names[c], ".jpeg", sep = ""), width = 550, height = 350)</span></span>
<span id="cb60-358"><a href="#cb60-358" aria-hidden="true" tabindex="-1"></a><span class="in">  cat('\n')</span></span>
<span id="cb60-359"><a href="#cb60-359" aria-hidden="true" tabindex="-1"></a><span class="in">} </span></span>
<span id="cb60-360"><a href="#cb60-360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-361"><a href="#cb60-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-362"><a href="#cb60-362" aria-hidden="true" tabindex="-1"></a><span class="fu">## S3. Difference-in-Difference Examination {#sec-s3-difference-in-difference-examination}</span></span>
<span id="cb60-363"><a href="#cb60-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-364"><a href="#cb60-364" aria-hidden="true" tabindex="-1"></a>Then, we construct the dataset for the difference-in-difference analysis.</span>
<span id="cb60-365"><a href="#cb60-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-366"><a href="#cb60-366" aria-hidden="true" tabindex="-1"></a>In this section, we use all observations without missing values in subsequent analyses.</span>
<span id="cb60-367"><a href="#cb60-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-368"><a href="#cb60-368" aria-hidden="true" tabindex="-1"></a>The original dataset (<span class="in">`data`</span>) contains observations with fiscal year (<span class="in">`fyear`</span>) range in <span class="in">`r paste("[", paste(range(data$fyear, na.rm = TRUE), collapse = ", "), "]", sep = "")`</span> and we restrict the sample to the fiscal year in <span class="sc">\[</span>2002, 2007<span class="sc">\]</span>.</span>
<span id="cb60-369"><a href="#cb60-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-370"><a href="#cb60-370" aria-hidden="true" tabindex="-1"></a><span class="fu">### s3.0. Executory contract intensity {#sec-s3z-executory-contract-intensity}</span></span>
<span id="cb60-371"><a href="#cb60-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-372"><a href="#cb60-372" aria-hidden="true" tabindex="-1"></a><span class="in">`contract_intensity`</span> is chosen to measure a firm's executory contract intensity, which was expected to be impacted by the change in the bankruptcy code in 2005.</span>
<span id="cb60-373"><a href="#cb60-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-374"><a href="#cb60-374" aria-hidden="true" tabindex="-1"></a><span class="in">```{r s3z-did-data, echo=TRUE, results='hold'}</span></span>
<span id="cb60-375"><a href="#cb60-375" aria-hidden="true" tabindex="-1"></a><span class="in">## choose the group definition: </span></span>
<span id="cb60-376"><a href="#cb60-376" aria-hidden="true" tabindex="-1"></a><span class="in">intensity_measure_name &lt;- candidate_intensity_measure[1]</span></span>
<span id="cb60-377"><a href="#cb60-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-378"><a href="#cb60-378" aria-hidden="true" tabindex="-1"></a><span class="in">data_firm &lt;- data %&gt;% </span></span>
<span id="cb60-379"><a href="#cb60-379" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear == intensity_measure_year) %&gt;% # use `fyear` may create multiple observations for the same firm. E.g. filter(gvkey == 23535, dyear == 2005) </span></span>
<span id="cb60-380"><a href="#cb60-380" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(fyear) %&gt;% </span></span>
<span id="cb60-381"><a href="#cb60-381" aria-hidden="true" tabindex="-1"></a><span class="in">  ## identify large and small firms based on its total asset in the year 2000 </span></span>
<span id="cb60-382"><a href="#cb60-382" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(median_at = median(at, na.rm = TRUE)) %&gt;% </span></span>
<span id="cb60-383"><a href="#cb60-383" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb60-384"><a href="#cb60-384" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(large = ifelse(at &gt; median_at, 1, 0)) %&gt;% </span></span>
<span id="cb60-385"><a href="#cb60-385" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, intensity_2000 = all_of(intensity_measure_name), large) </span></span>
<span id="cb60-386"><a href="#cb60-386" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb60-387"><a href="#cb60-387" aria-hidden="true" tabindex="-1"></a><span class="in">data_did &lt;- data %&gt;% </span></span>
<span id="cb60-388"><a href="#cb60-388" aria-hidden="true" tabindex="-1"></a><span class="in">  ## merge the grouping variable </span></span>
<span id="cb60-389"><a href="#cb60-389" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(y = data_firm, by = join_by(gvkey) ) %&gt;% </span></span>
<span id="cb60-390"><a href="#cb60-390" aria-hidden="true" tabindex="-1"></a><span class="in">  ## merge the FF 30 industry classifiaction </span></span>
<span id="cb60-391"><a href="#cb60-391" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(y = FF_30ind, by = join_by(sic)) %&gt;% </span></span>
<span id="cb60-392"><a href="#cb60-392" aria-hidden="true" tabindex="-1"></a><span class="in">  ## exclude certain industries </span></span>
<span id="cb60-393"><a href="#cb60-393" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(</span></span>
<span id="cb60-394"><a href="#cb60-394" aria-hidden="true" tabindex="-1"></a><span class="in">    ff_30ind != 20, # exclude Utiltiy (number 20) </span></span>
<span id="cb60-395"><a href="#cb60-395" aria-hidden="true" tabindex="-1"></a><span class="in">    !(sic &gt;= 6000 &amp; sic &lt;= 6199) # exclude banks under Banking, Insurance, Real Estate, Trading (number 29)</span></span>
<span id="cb60-396"><a href="#cb60-396" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb60-397"><a href="#cb60-397" aria-hidden="true" tabindex="-1"></a><span class="in">  ## pre- &amp; post- </span></span>
<span id="cb60-398"><a href="#cb60-398" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-399"><a href="#cb60-399" aria-hidden="true" tabindex="-1"></a><span class="in">    indexyear = (fyear - base_year), # year index with 2005 as base 0.</span></span>
<span id="cb60-400"><a href="#cb60-400" aria-hidden="true" tabindex="-1"></a><span class="in">    post_2005 = as.numeric(fyear &gt; base_year)  # whether it is after the 2005 reform </span></span>
<span id="cb60-401"><a href="#cb60-401" aria-hidden="true" tabindex="-1"></a><span class="in">  ) </span></span>
<span id="cb60-402"><a href="#cb60-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-403"><a href="#cb60-403" aria-hidden="true" tabindex="-1"></a><span class="in">## gvkey(s) for balanced panel": </span></span>
<span id="cb60-404"><a href="#cb60-404" aria-hidden="true" tabindex="-1"></a><span class="in">data_did_balanced_id &lt;- data_did %&gt;% </span></span>
<span id="cb60-405"><a href="#cb60-405" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;% </span></span>
<span id="cb60-406"><a href="#cb60-406" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= period_start - n_pre &amp; fyear &lt;= period_end) %&gt;% </span></span>
<span id="cb60-407"><a href="#cb60-407" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(gvkey) %&gt;% </span></span>
<span id="cb60-408"><a href="#cb60-408" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(count_obs = sum(!is.na(book_leverage) &amp; !is.na(intensity_2000))) %&gt;% </span></span>
<span id="cb60-409"><a href="#cb60-409" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb60-410"><a href="#cb60-410" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(count_obs == period_end - period_start + 1 + n_pre) %&gt;% </span></span>
<span id="cb60-411"><a href="#cb60-411" aria-hidden="true" tabindex="-1"></a><span class="in">  .$gvkey </span></span>
<span id="cb60-412"><a href="#cb60-412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-413"><a href="#cb60-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-414"><a href="#cb60-414" aria-hidden="true" tabindex="-1"></a>DiD Analysis:</span>
<span id="cb60-415"><a href="#cb60-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-416"><a href="#cb60-416" aria-hidden="true" tabindex="-1"></a>Variable <span class="in">`treated`</span> is defined as whether the firm has a positive <span class="in">`r intensity_measure_name`</span> in year <span class="in">`r base_year`</span>.</span>
<span id="cb60-417"><a href="#cb60-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-418"><a href="#cb60-418" aria-hidden="true" tabindex="-1"></a><span class="in">```{r s3z-did-test, echo=TRUE, warning=FALSE, message=FALSE, results='hold'}</span></span>
<span id="cb60-419"><a href="#cb60-419" aria-hidden="true" tabindex="-1"></a><span class="in">cat(intensity_measure_name); cat(": \n"); </span></span>
<span id="cb60-420"><a href="#cb60-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-421"><a href="#cb60-421" aria-hidden="true" tabindex="-1"></a><span class="in">did_model_s3z_a &lt;- data_did %&gt;% </span></span>
<span id="cb60-422"><a href="#cb60-422" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;% </span></span>
<span id="cb60-423"><a href="#cb60-423" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb60-424"><a href="#cb60-424" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb60-425"><a href="#cb60-425" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, fyear, intensity_2000, post_2005, book_leverage, debt_ebitda, sic, ff_30ind_name, large) %&gt;% </span></span>
<span id="cb60-426"><a href="#cb60-426" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= period_start &amp; fyear &lt;= period_end) %&gt;% </span></span>
<span id="cb60-427"><a href="#cb60-427" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate( </span></span>
<span id="cb60-428"><a href="#cb60-428" aria-hidden="true" tabindex="-1"></a><span class="in">    gvkey = as.factor(gvkey), </span></span>
<span id="cb60-429"><a href="#cb60-429" aria-hidden="true" tabindex="-1"></a><span class="in">    fyear = as.factor(fyear), </span></span>
<span id="cb60-430"><a href="#cb60-430" aria-hidden="true" tabindex="-1"></a><span class="in">    treated = as.numeric(intensity_2000 &gt; 0) </span></span>
<span id="cb60-431"><a href="#cb60-431" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb60-432"><a href="#cb60-432" aria-hidden="true" tabindex="-1"></a><span class="in">  fixest::feols(fml = book_leverage ~ treated*post_2005*large | gvkey + fyear + ff_30ind_name^fyear, data = ., cluster = c("gvkey", "ff_30ind_name")) </span></span>
<span id="cb60-433"><a href="#cb60-433" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb60-434"><a href="#cb60-434" aria-hidden="true" tabindex="-1"></a><span class="in">did_model_s3z_b &lt;- data_did %&gt;% </span></span>
<span id="cb60-435"><a href="#cb60-435" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;% </span></span>
<span id="cb60-436"><a href="#cb60-436" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb60-437"><a href="#cb60-437" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb60-438"><a href="#cb60-438" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, fyear, intensity_2000, post_2005, book_leverage, debt_ebitda, sic, ff_30ind_name, large) %&gt;% </span></span>
<span id="cb60-439"><a href="#cb60-439" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= period_start &amp; fyear &lt;= period_end) %&gt;% </span></span>
<span id="cb60-440"><a href="#cb60-440" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate( </span></span>
<span id="cb60-441"><a href="#cb60-441" aria-hidden="true" tabindex="-1"></a><span class="in">    gvkey = as.factor(gvkey), </span></span>
<span id="cb60-442"><a href="#cb60-442" aria-hidden="true" tabindex="-1"></a><span class="in">    fyear = as.factor(fyear), </span></span>
<span id="cb60-443"><a href="#cb60-443" aria-hidden="true" tabindex="-1"></a><span class="in">    treated = as.numeric(intensity_2000 &gt; 0) </span></span>
<span id="cb60-444"><a href="#cb60-444" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb60-445"><a href="#cb60-445" aria-hidden="true" tabindex="-1"></a><span class="in">  fixest::feols(fml = book_leverage ~ intensity_2000*post_2005*large | gvkey + fyear + ff_30ind_name^fyear, data = ., cluster = c("gvkey", "ff_30ind_name")) </span></span>
<span id="cb60-446"><a href="#cb60-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-447"><a href="#cb60-447" aria-hidden="true" tabindex="-1"></a><span class="in">mget(ls(pattern = "did_model_s3z_")) %&gt;% </span></span>
<span id="cb60-448"><a href="#cb60-448" aria-hidden="true" tabindex="-1"></a><span class="in">  `names&lt;-`(value = c("(a) treatment", "(b) intensity")) %&gt;% </span></span>
<span id="cb60-449"><a href="#cb60-449" aria-hidden="true" tabindex="-1"></a><span class="in">  etable() %&gt;% </span></span>
<span id="cb60-450"><a href="#cb60-450" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::kable(format = "html", caption = paste("DiD Results with `", intensity_measure_name, "`", sep = "")) %&gt;% </span></span>
<span id="cb60-451"><a href="#cb60-451" aria-hidden="true" tabindex="-1"></a><span class="in">  kableExtra::kable_styling(</span></span>
<span id="cb60-452"><a href="#cb60-452" aria-hidden="true" tabindex="-1"></a><span class="in">    font_size = 8,       # Smaller font (default is 16px)</span></span>
<span id="cb60-453"><a href="#cb60-453" aria-hidden="true" tabindex="-1"></a><span class="in">    full_width = FALSE,   # Table width fits content </span></span>
<span id="cb60-454"><a href="#cb60-454" aria-hidden="true" tabindex="-1"></a><span class="in">    bootstrap_options = c("striped", "condensed")</span></span>
<span id="cb60-455"><a href="#cb60-455" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-456"><a href="#cb60-456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-457"><a href="#cb60-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-458"><a href="#cb60-458" aria-hidden="true" tabindex="-1"></a><span class="fu">### s3.1. PPE lease intensity {#sec-s3a-ppe-lease-intensity}</span></span>
<span id="cb60-459"><a href="#cb60-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-460"><a href="#cb60-460" aria-hidden="true" tabindex="-1"></a><span class="in">`ppe_lease_intensity`</span> is chosen to measure a firm's long-term exposure to lease contracts, especially non-residential real property lease obligations, which was expected to be impacted by the change in the bankruptcy code in 2005.</span>
<span id="cb60-461"><a href="#cb60-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-462"><a href="#cb60-462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r s3a-did-data, echo=TRUE, results='hold'}</span></span>
<span id="cb60-463"><a href="#cb60-463" aria-hidden="true" tabindex="-1"></a><span class="in">## choose the group definition:</span></span>
<span id="cb60-464"><a href="#cb60-464" aria-hidden="true" tabindex="-1"></a><span class="in">intensity_measure_name &lt;- candidate_intensity_measure[2]</span></span>
<span id="cb60-465"><a href="#cb60-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-466"><a href="#cb60-466" aria-hidden="true" tabindex="-1"></a><span class="in">data_firm &lt;- data %&gt;%</span></span>
<span id="cb60-467"><a href="#cb60-467" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear == intensity_measure_year) %&gt;% # use `fyear` may create multiple observations for the same firm. E.g. filter(gvkey == 23535, dyear == 2005)</span></span>
<span id="cb60-468"><a href="#cb60-468" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(fyear) %&gt;%</span></span>
<span id="cb60-469"><a href="#cb60-469" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(median_at = median(at, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb60-470"><a href="#cb60-470" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;%</span></span>
<span id="cb60-471"><a href="#cb60-471" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(large = ifelse(at &gt; median_at, 1, 0)) %&gt;%</span></span>
<span id="cb60-472"><a href="#cb60-472" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, intensity_2000 = all_of(intensity_measure_name), large)</span></span>
<span id="cb60-473"><a href="#cb60-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-474"><a href="#cb60-474" aria-hidden="true" tabindex="-1"></a><span class="in">data_did &lt;- data %&gt;%</span></span>
<span id="cb60-475"><a href="#cb60-475" aria-hidden="true" tabindex="-1"></a><span class="in">  ## merge the grouping variable</span></span>
<span id="cb60-476"><a href="#cb60-476" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(y = data_firm, by = join_by(gvkey) ) %&gt;%</span></span>
<span id="cb60-477"><a href="#cb60-477" aria-hidden="true" tabindex="-1"></a><span class="in">  ## merge the FF 30 industry classifiaction</span></span>
<span id="cb60-478"><a href="#cb60-478" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(y = FF_30ind, by = join_by(sic)) %&gt;%</span></span>
<span id="cb60-479"><a href="#cb60-479" aria-hidden="true" tabindex="-1"></a><span class="in">  ## exclude certain industries</span></span>
<span id="cb60-480"><a href="#cb60-480" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(</span></span>
<span id="cb60-481"><a href="#cb60-481" aria-hidden="true" tabindex="-1"></a><span class="in">    ff_30ind != 20, # exclude Utiltiy (number 20)</span></span>
<span id="cb60-482"><a href="#cb60-482" aria-hidden="true" tabindex="-1"></a><span class="in">    !(sic &gt;= 6000 &amp; sic &lt;= 6199) # exclude banks under Banking, Insurance, Real Estate, Trading (number 29)</span></span>
<span id="cb60-483"><a href="#cb60-483" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb60-484"><a href="#cb60-484" aria-hidden="true" tabindex="-1"></a><span class="in">  ## pre- &amp; post-</span></span>
<span id="cb60-485"><a href="#cb60-485" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-486"><a href="#cb60-486" aria-hidden="true" tabindex="-1"></a><span class="in">    indexyear = (fyear - base_year), # year index with 2005 as base 0.</span></span>
<span id="cb60-487"><a href="#cb60-487" aria-hidden="true" tabindex="-1"></a><span class="in">    post_2005 = as.numeric(fyear &gt; base_year)  # whether it is after the 2005 reform</span></span>
<span id="cb60-488"><a href="#cb60-488" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-489"><a href="#cb60-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-490"><a href="#cb60-490" aria-hidden="true" tabindex="-1"></a><span class="in">## gvkey(s) for balanced panel":</span></span>
<span id="cb60-491"><a href="#cb60-491" aria-hidden="true" tabindex="-1"></a><span class="in">data_did_balanced_id &lt;- data_did %&gt;%</span></span>
<span id="cb60-492"><a href="#cb60-492" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;%</span></span>
<span id="cb60-493"><a href="#cb60-493" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= period_start - n_pre &amp; fyear &lt;= period_end) %&gt;%</span></span>
<span id="cb60-494"><a href="#cb60-494" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(gvkey) %&gt;%</span></span>
<span id="cb60-495"><a href="#cb60-495" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(count_obs = sum(!is.na(book_leverage) &amp; !is.na(intensity_2000))) %&gt;%</span></span>
<span id="cb60-496"><a href="#cb60-496" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;%</span></span>
<span id="cb60-497"><a href="#cb60-497" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(count_obs == period_end - period_start + 1 + n_pre) %&gt;%</span></span>
<span id="cb60-498"><a href="#cb60-498" aria-hidden="true" tabindex="-1"></a><span class="in">  .$gvkey</span></span>
<span id="cb60-499"><a href="#cb60-499" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-500"><a href="#cb60-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-501"><a href="#cb60-501" aria-hidden="true" tabindex="-1"></a>DiD Analysis:</span>
<span id="cb60-502"><a href="#cb60-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-503"><a href="#cb60-503" aria-hidden="true" tabindex="-1"></a><span class="in">```{r s3a-did-test, echo=TRUE, warning=FALSE, message=FALSE, results='hold'}</span></span>
<span id="cb60-504"><a href="#cb60-504" aria-hidden="true" tabindex="-1"></a><span class="in">cat(intensity_measure_name); cat(": \n");</span></span>
<span id="cb60-505"><a href="#cb60-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-506"><a href="#cb60-506" aria-hidden="true" tabindex="-1"></a><span class="in">did_model_s3a_a &lt;- data_did %&gt;%</span></span>
<span id="cb60-507"><a href="#cb60-507" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;%</span></span>
<span id="cb60-508"><a href="#cb60-508" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb60-509"><a href="#cb60-509" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb60-510"><a href="#cb60-510" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, fyear, intensity_2000, post_2005, book_leverage, debt_ebitda, sic, ff_30ind_name, large) %&gt;%</span></span>
<span id="cb60-511"><a href="#cb60-511" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= period_start &amp; fyear &lt;= period_end) %&gt;%</span></span>
<span id="cb60-512"><a href="#cb60-512" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-513"><a href="#cb60-513" aria-hidden="true" tabindex="-1"></a><span class="in">    gvkey = as.factor(gvkey),</span></span>
<span id="cb60-514"><a href="#cb60-514" aria-hidden="true" tabindex="-1"></a><span class="in">    fyear = as.factor(fyear),</span></span>
<span id="cb60-515"><a href="#cb60-515" aria-hidden="true" tabindex="-1"></a><span class="in">    treated = as.numeric(intensity_2000 &gt; 0)</span></span>
<span id="cb60-516"><a href="#cb60-516" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb60-517"><a href="#cb60-517" aria-hidden="true" tabindex="-1"></a><span class="in">  fixest::feols(fml = book_leverage ~ treated*post_2005*large | gvkey + fyear + ff_30ind_name^fyear, data = ., cluster = c("gvkey", "ff_30ind_name"))</span></span>
<span id="cb60-518"><a href="#cb60-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-519"><a href="#cb60-519" aria-hidden="true" tabindex="-1"></a><span class="in">did_model_s3a_b &lt;- data_did %&gt;%</span></span>
<span id="cb60-520"><a href="#cb60-520" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;%</span></span>
<span id="cb60-521"><a href="#cb60-521" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb60-522"><a href="#cb60-522" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb60-523"><a href="#cb60-523" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, fyear, intensity_2000, post_2005, book_leverage, debt_ebitda, sic, ff_30ind_name, large) %&gt;%</span></span>
<span id="cb60-524"><a href="#cb60-524" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= period_start &amp; fyear &lt;= period_end) %&gt;%</span></span>
<span id="cb60-525"><a href="#cb60-525" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-526"><a href="#cb60-526" aria-hidden="true" tabindex="-1"></a><span class="in">    gvkey = as.factor(gvkey),</span></span>
<span id="cb60-527"><a href="#cb60-527" aria-hidden="true" tabindex="-1"></a><span class="in">    fyear = as.factor(fyear),</span></span>
<span id="cb60-528"><a href="#cb60-528" aria-hidden="true" tabindex="-1"></a><span class="in">    treated = as.numeric(intensity_2000 &gt; 0)</span></span>
<span id="cb60-529"><a href="#cb60-529" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb60-530"><a href="#cb60-530" aria-hidden="true" tabindex="-1"></a><span class="in">  fixest::feols(fml = book_leverage ~ intensity_2000*post_2005*large | gvkey + fyear + ff_30ind_name^fyear, data = ., cluster = c("gvkey", "ff_30ind_name"))</span></span>
<span id="cb60-531"><a href="#cb60-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-532"><a href="#cb60-532" aria-hidden="true" tabindex="-1"></a><span class="in">mget(ls(pattern = "did_model_s3a_")) %&gt;%</span></span>
<span id="cb60-533"><a href="#cb60-533" aria-hidden="true" tabindex="-1"></a><span class="in">  `names&lt;-`(value = c("(a) treatment", "(b) intensity")) %&gt;%</span></span>
<span id="cb60-534"><a href="#cb60-534" aria-hidden="true" tabindex="-1"></a><span class="in">  etable() %&gt;%</span></span>
<span id="cb60-535"><a href="#cb60-535" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::kable(format = "html", caption = paste("DiD Results with `", intensity_measure_name, "`", sep = "")) %&gt;%</span></span>
<span id="cb60-536"><a href="#cb60-536" aria-hidden="true" tabindex="-1"></a><span class="in">  kableExtra::kable_styling(</span></span>
<span id="cb60-537"><a href="#cb60-537" aria-hidden="true" tabindex="-1"></a><span class="in">    font_size = 8,       # Smaller font (default is 16px)</span></span>
<span id="cb60-538"><a href="#cb60-538" aria-hidden="true" tabindex="-1"></a><span class="in">    full_width = FALSE,   # Table width fits content</span></span>
<span id="cb60-539"><a href="#cb60-539" aria-hidden="true" tabindex="-1"></a><span class="in">    bootstrap_options = c("striped", "condensed")</span></span>
<span id="cb60-540"><a href="#cb60-540" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-541"><a href="#cb60-541" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-542"><a href="#cb60-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-543"><a href="#cb60-543" aria-hidden="true" tabindex="-1"></a><span class="fu">### s3.2. builing intensity {#sec-s3b-building-intensity}</span></span>
<span id="cb60-544"><a href="#cb60-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-545"><a href="#cb60-545" aria-hidden="true" tabindex="-1"></a><span class="in">`building_intensity`</span> is chosen to measure a firm's long-term exposure to buildings at cost under the PPE.</span>
<span id="cb60-546"><a href="#cb60-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-547"><a href="#cb60-547" aria-hidden="true" tabindex="-1"></a><span class="in">```{r s3b-did-data, echo=TRUE, results='hold'}</span></span>
<span id="cb60-548"><a href="#cb60-548" aria-hidden="true" tabindex="-1"></a><span class="in">## choose the group definition:</span></span>
<span id="cb60-549"><a href="#cb60-549" aria-hidden="true" tabindex="-1"></a><span class="in">intensity_measure_name &lt;- candidate_intensity_measure[3]</span></span>
<span id="cb60-550"><a href="#cb60-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-551"><a href="#cb60-551" aria-hidden="true" tabindex="-1"></a><span class="in">data_firm &lt;- data %&gt;%</span></span>
<span id="cb60-552"><a href="#cb60-552" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear == intensity_measure_year) %&gt;% # use `fyear` may create multiple observations for the same firm. E.g. filter(gvkey == 23535, dyear == 2005)</span></span>
<span id="cb60-553"><a href="#cb60-553" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(fyear) %&gt;%</span></span>
<span id="cb60-554"><a href="#cb60-554" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(median_at = median(at, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb60-555"><a href="#cb60-555" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;%</span></span>
<span id="cb60-556"><a href="#cb60-556" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(large = ifelse(at &gt; median_at, 1, 0)) %&gt;%</span></span>
<span id="cb60-557"><a href="#cb60-557" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, intensity_2000 = all_of(intensity_measure_name), large)</span></span>
<span id="cb60-558"><a href="#cb60-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-559"><a href="#cb60-559" aria-hidden="true" tabindex="-1"></a><span class="in">data_did &lt;- data %&gt;%</span></span>
<span id="cb60-560"><a href="#cb60-560" aria-hidden="true" tabindex="-1"></a><span class="in">  ## merge the grouping variable</span></span>
<span id="cb60-561"><a href="#cb60-561" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(y = data_firm, by = join_by(gvkey) ) %&gt;%</span></span>
<span id="cb60-562"><a href="#cb60-562" aria-hidden="true" tabindex="-1"></a><span class="in">  ## merge the FF 30 industry classifiaction</span></span>
<span id="cb60-563"><a href="#cb60-563" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(y = FF_30ind, by = join_by(sic)) %&gt;%</span></span>
<span id="cb60-564"><a href="#cb60-564" aria-hidden="true" tabindex="-1"></a><span class="in">  ## exclude certain industries</span></span>
<span id="cb60-565"><a href="#cb60-565" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(</span></span>
<span id="cb60-566"><a href="#cb60-566" aria-hidden="true" tabindex="-1"></a><span class="in">    ff_30ind != 20, # exclude Utiltiy (number 20)</span></span>
<span id="cb60-567"><a href="#cb60-567" aria-hidden="true" tabindex="-1"></a><span class="in">    !(sic &gt;= 6000 &amp; sic &lt;= 6199) # exclude banks under Banking, Insurance, Real Estate, Trading (number 29)</span></span>
<span id="cb60-568"><a href="#cb60-568" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb60-569"><a href="#cb60-569" aria-hidden="true" tabindex="-1"></a><span class="in">  ## pre- &amp; post-</span></span>
<span id="cb60-570"><a href="#cb60-570" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-571"><a href="#cb60-571" aria-hidden="true" tabindex="-1"></a><span class="in">    indexyear = (fyear - base_year), # year index with 2005 as base 0.</span></span>
<span id="cb60-572"><a href="#cb60-572" aria-hidden="true" tabindex="-1"></a><span class="in">    post_2005 = as.numeric(fyear &gt; base_year)  # whether it is after the 2005 reform</span></span>
<span id="cb60-573"><a href="#cb60-573" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-574"><a href="#cb60-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-575"><a href="#cb60-575" aria-hidden="true" tabindex="-1"></a><span class="in">## gvkey(s) for balanced panel":</span></span>
<span id="cb60-576"><a href="#cb60-576" aria-hidden="true" tabindex="-1"></a><span class="in">data_did_balanced_id &lt;- data_did %&gt;%</span></span>
<span id="cb60-577"><a href="#cb60-577" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;%</span></span>
<span id="cb60-578"><a href="#cb60-578" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= period_start - n_pre &amp; fyear &lt;= period_end) %&gt;%</span></span>
<span id="cb60-579"><a href="#cb60-579" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(gvkey) %&gt;%</span></span>
<span id="cb60-580"><a href="#cb60-580" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(count_obs = sum(!is.na(book_leverage) &amp; !is.na(intensity_2000))) %&gt;%</span></span>
<span id="cb60-581"><a href="#cb60-581" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;%</span></span>
<span id="cb60-582"><a href="#cb60-582" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(count_obs == period_end - period_start + 1 + n_pre) %&gt;%</span></span>
<span id="cb60-583"><a href="#cb60-583" aria-hidden="true" tabindex="-1"></a><span class="in">  .$gvkey</span></span>
<span id="cb60-584"><a href="#cb60-584" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-585"><a href="#cb60-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-586"><a href="#cb60-586" aria-hidden="true" tabindex="-1"></a>DiD Analysis:</span>
<span id="cb60-587"><a href="#cb60-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-588"><a href="#cb60-588" aria-hidden="true" tabindex="-1"></a><span class="in">```{r s3b-did-test, echo=TRUE, warning=FALSE, message=FALSE, results='hold'}</span></span>
<span id="cb60-589"><a href="#cb60-589" aria-hidden="true" tabindex="-1"></a><span class="in">cat(intensity_measure_name); cat(": \n");</span></span>
<span id="cb60-590"><a href="#cb60-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-591"><a href="#cb60-591" aria-hidden="true" tabindex="-1"></a><span class="in">## create the combinations of parameters:</span></span>
<span id="cb60-592"><a href="#cb60-592" aria-hidden="true" tabindex="-1"></a><span class="in">fml_parameters &lt;- expand_grid(</span></span>
<span id="cb60-593"><a href="#cb60-593" aria-hidden="true" tabindex="-1"></a><span class="in">  choice_treatment = c("intensity_2000", "treated"), # what is the treatment measure: continuous/binary</span></span>
<span id="cb60-594"><a href="#cb60-594" aria-hidden="true" tabindex="-1"></a><span class="in">  controls_inclusion = c(FALSE, TRUE),# whether to include controls</span></span>
<span id="cb60-595"><a href="#cb60-595" aria-hidden="true" tabindex="-1"></a><span class="in">  balanced_panel = c(FALSE, TRUE), # whether keep a balanced panel</span></span>
<span id="cb60-596"><a href="#cb60-596" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;%</span></span>
<span id="cb60-597"><a href="#cb60-597" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(balanced_panel) %&gt;%</span></span>
<span id="cb60-598"><a href="#cb60-598" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind.data.frame(.,</span></span>
<span id="cb60-599"><a href="#cb60-599" aria-hidden="true" tabindex="-1"></a><span class="in">    fml = apply(X = ., MARGIN = 1, FUN = function(parameters) {</span></span>
<span id="cb60-600"><a href="#cb60-600" aria-hidden="true" tabindex="-1"></a><span class="in">      ## parameters:</span></span>
<span id="cb60-601"><a href="#cb60-601" aria-hidden="true" tabindex="-1"></a><span class="in">      choice_treatment &lt;- parameters[1]</span></span>
<span id="cb60-602"><a href="#cb60-602" aria-hidden="true" tabindex="-1"></a><span class="in">      add_controls &lt;- parameters[2]</span></span>
<span id="cb60-603"><a href="#cb60-603" aria-hidden="true" tabindex="-1"></a><span class="in">      is_balanced &lt;- parameters[3]</span></span>
<span id="cb60-604"><a href="#cb60-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-605"><a href="#cb60-605" aria-hidden="true" tabindex="-1"></a><span class="in">      ## inputs:</span></span>
<span id="cb60-606"><a href="#cb60-606" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_base &lt;- paste("book_leverage ~ post_2005*", choice_treatment, sep = "") # the baseline model</span></span>
<span id="cb60-607"><a href="#cb60-607" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_base_controls &lt;- " + roa + ebitda_at + log(at_thousand) + altman_Z + tangibility + current_ratio" # the potential controls</span></span>
<span id="cb60-608"><a href="#cb60-608" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_base_fe &lt;- " | gvkey + indexyear + ff_30ind_name^indexyear" # fixed effects</span></span>
<span id="cb60-609"><a href="#cb60-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-610"><a href="#cb60-610" aria-hidden="true" tabindex="-1"></a><span class="in">      ## output formula:</span></span>
<span id="cb60-611"><a href="#cb60-611" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_output &lt;- paste(</span></span>
<span id="cb60-612"><a href="#cb60-612" aria-hidden="true" tabindex="-1"></a><span class="in">        fml_base,</span></span>
<span id="cb60-613"><a href="#cb60-613" aria-hidden="true" tabindex="-1"></a><span class="in">        ifelse(add_controls == TRUE, yes = fml_base_controls, no = ""),</span></span>
<span id="cb60-614"><a href="#cb60-614" aria-hidden="true" tabindex="-1"></a><span class="in">        fml_base_fe,</span></span>
<span id="cb60-615"><a href="#cb60-615" aria-hidden="true" tabindex="-1"></a><span class="in">        sep = ""</span></span>
<span id="cb60-616"><a href="#cb60-616" aria-hidden="true" tabindex="-1"></a><span class="in">      )</span></span>
<span id="cb60-617"><a href="#cb60-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-618"><a href="#cb60-618" aria-hidden="true" tabindex="-1"></a><span class="in">      return(fml_output)</span></span>
<span id="cb60-619"><a href="#cb60-619" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb60-620"><a href="#cb60-620" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb60-621"><a href="#cb60-621" aria-hidden="true" tabindex="-1"></a><span class="in">  as_tibble() %&gt;%</span></span>
<span id="cb60-622"><a href="#cb60-622" aria-hidden="true" tabindex="-1"></a><span class="in">  ## assign a name for each regression:</span></span>
<span id="cb60-623"><a href="#cb60-623" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(name = paste("(", 1:nrow(.), ")", sep = "")) %&gt;%</span></span>
<span id="cb60-624"><a href="#cb60-624" aria-hidden="true" tabindex="-1"></a><span class="in">  select(name, everything())</span></span>
<span id="cb60-625"><a href="#cb60-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-626"><a href="#cb60-626" aria-hidden="true" tabindex="-1"></a><span class="in">## construct the data used for the loop:</span></span>
<span id="cb60-627"><a href="#cb60-627" aria-hidden="true" tabindex="-1"></a><span class="in">data_did_loop &lt;- data_did %&gt;%</span></span>
<span id="cb60-628"><a href="#cb60-628" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;%</span></span>
<span id="cb60-629"><a href="#cb60-629" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb60-630"><a href="#cb60-630" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb60-631"><a href="#cb60-631" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, fyear, indexyear, intensity_2000, post_2005,</span></span>
<span id="cb60-632"><a href="#cb60-632" aria-hidden="true" tabindex="-1"></a><span class="in">         book_leverage, debt_ebitda, sic, ff_30ind_name,</span></span>
<span id="cb60-633"><a href="#cb60-633" aria-hidden="true" tabindex="-1"></a><span class="in">         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span></span>
<span id="cb60-634"><a href="#cb60-634" aria-hidden="true" tabindex="-1"></a><span class="in">         altman_Z, kz, market_book, tangibility, current_ratio) %&gt;%</span></span>
<span id="cb60-635"><a href="#cb60-635" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= period_start &amp; fyear &lt;= period_end) %&gt;%</span></span>
<span id="cb60-636"><a href="#cb60-636" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(intensity_2000) &amp; !is.na(at)) %&gt;%</span></span>
<span id="cb60-637"><a href="#cb60-637" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-638"><a href="#cb60-638" aria-hidden="true" tabindex="-1"></a><span class="in">    gvkey = as.factor(gvkey),</span></span>
<span id="cb60-639"><a href="#cb60-639" aria-hidden="true" tabindex="-1"></a><span class="in">    fyear = as.factor(fyear),</span></span>
<span id="cb60-640"><a href="#cb60-640" aria-hidden="true" tabindex="-1"></a><span class="in">    # treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb60-641"><a href="#cb60-641" aria-hidden="true" tabindex="-1"></a><span class="in">    treated = ifelse(intensity_2000 &gt; 0, 1, 0),</span></span>
<span id="cb60-642"><a href="#cb60-642" aria-hidden="true" tabindex="-1"></a><span class="in">    ebitda_at = ebitda / at,</span></span>
<span id="cb60-643"><a href="#cb60-643" aria-hidden="true" tabindex="-1"></a><span class="in">    at_thousand = at * 10^-3,</span></span>
<span id="cb60-644"><a href="#cb60-644" aria-hidden="true" tabindex="-1"></a><span class="in">    large = ifelse(large, yes = "Large", no = "Small"),</span></span>
<span id="cb60-645"><a href="#cb60-645" aria-hidden="true" tabindex="-1"></a><span class="in">    tangiblity_exbnl = tangibility - bnl_intensity,</span></span>
<span id="cb60-646"><a href="#cb60-646" aria-hidden="true" tabindex="-1"></a><span class="in">    bnl = bnl_intensity * at,</span></span>
<span id="cb60-647"><a href="#cb60-647" aria-hidden="true" tabindex="-1"></a><span class="in">    # large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb60-648"><a href="#cb60-648" aria-hidden="true" tabindex="-1"></a><span class="in">    treated_large = paste(treated, large, sep = "_")</span></span>
<span id="cb60-649"><a href="#cb60-649" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-650"><a href="#cb60-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-651"><a href="#cb60-651" aria-hidden="true" tabindex="-1"></a><span class="in">data_did_loop_balanced &lt;- data_did %&gt;%</span></span>
<span id="cb60-652"><a href="#cb60-652" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;%</span></span>
<span id="cb60-653"><a href="#cb60-653" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb60-654"><a href="#cb60-654" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb60-655"><a href="#cb60-655" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, fyear, indexyear, intensity_2000, post_2005,</span></span>
<span id="cb60-656"><a href="#cb60-656" aria-hidden="true" tabindex="-1"></a><span class="in">         book_leverage, debt_ebitda, sic, ff_30ind_name,</span></span>
<span id="cb60-657"><a href="#cb60-657" aria-hidden="true" tabindex="-1"></a><span class="in">         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span></span>
<span id="cb60-658"><a href="#cb60-658" aria-hidden="true" tabindex="-1"></a><span class="in">         altman_Z, kz, market_book, tangibility, current_ratio) %&gt;%</span></span>
<span id="cb60-659"><a href="#cb60-659" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= period_start &amp; fyear &lt;= period_end) %&gt;%</span></span>
<span id="cb60-660"><a href="#cb60-660" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(intensity_2000) &amp; !is.na(at)) %&gt;%</span></span>
<span id="cb60-661"><a href="#cb60-661" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-662"><a href="#cb60-662" aria-hidden="true" tabindex="-1"></a><span class="in">    gvkey = as.factor(gvkey),</span></span>
<span id="cb60-663"><a href="#cb60-663" aria-hidden="true" tabindex="-1"></a><span class="in">    fyear = as.factor(fyear),</span></span>
<span id="cb60-664"><a href="#cb60-664" aria-hidden="true" tabindex="-1"></a><span class="in">    # treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb60-665"><a href="#cb60-665" aria-hidden="true" tabindex="-1"></a><span class="in">    treated = ifelse(intensity_2000 &gt; 0, 1, 0),</span></span>
<span id="cb60-666"><a href="#cb60-666" aria-hidden="true" tabindex="-1"></a><span class="in">    ebitda_at = ebitda / at,</span></span>
<span id="cb60-667"><a href="#cb60-667" aria-hidden="true" tabindex="-1"></a><span class="in">    at_thousand = at * 10^-3,</span></span>
<span id="cb60-668"><a href="#cb60-668" aria-hidden="true" tabindex="-1"></a><span class="in">    large = ifelse(large, yes = "Large", no = "Small"),</span></span>
<span id="cb60-669"><a href="#cb60-669" aria-hidden="true" tabindex="-1"></a><span class="in">    tangiblity_exbnl = tangibility - bnl_intensity,</span></span>
<span id="cb60-670"><a href="#cb60-670" aria-hidden="true" tabindex="-1"></a><span class="in">    bnl = bnl_intensity * at,</span></span>
<span id="cb60-671"><a href="#cb60-671" aria-hidden="true" tabindex="-1"></a><span class="in">    # large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb60-672"><a href="#cb60-672" aria-hidden="true" tabindex="-1"></a><span class="in">    treated_large = paste(treated, large, sep = "_")</span></span>
<span id="cb60-673"><a href="#cb60-673" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-674"><a href="#cb60-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-675"><a href="#cb60-675" aria-hidden="true" tabindex="-1"></a><span class="in">## store all results</span></span>
<span id="cb60-676"><a href="#cb60-676" aria-hidden="true" tabindex="-1"></a><span class="in">fml_results &lt;- fml_parameters %&gt;%</span></span>
<span id="cb60-677"><a href="#cb60-677" aria-hidden="true" tabindex="-1"></a><span class="in">  apply(MARGIN = 1, FUN = function(parameters) {</span></span>
<span id="cb60-678"><a href="#cb60-678" aria-hidden="true" tabindex="-1"></a><span class="in">    ## parameters:</span></span>
<span id="cb60-679"><a href="#cb60-679" aria-hidden="true" tabindex="-1"></a><span class="in">    is_balanced &lt;- parameters[4]</span></span>
<span id="cb60-680"><a href="#cb60-680" aria-hidden="true" tabindex="-1"></a><span class="in">    fml_formula &lt;- parameters[5]</span></span>
<span id="cb60-681"><a href="#cb60-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-682"><a href="#cb60-682" aria-hidden="true" tabindex="-1"></a><span class="in">    ## data:</span></span>
<span id="cb60-683"><a href="#cb60-683" aria-hidden="true" tabindex="-1"></a><span class="in">    if (is_balanced == TRUE) {</span></span>
<span id="cb60-684"><a href="#cb60-684" aria-hidden="true" tabindex="-1"></a><span class="in">      data &lt;- data_did_loop_balanced</span></span>
<span id="cb60-685"><a href="#cb60-685" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb60-686"><a href="#cb60-686" aria-hidden="true" tabindex="-1"></a><span class="in">      data &lt;- data_did_loop</span></span>
<span id="cb60-687"><a href="#cb60-687" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb60-688"><a href="#cb60-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-689"><a href="#cb60-689" aria-hidden="true" tabindex="-1"></a><span class="in">    ## regression:</span></span>
<span id="cb60-690"><a href="#cb60-690" aria-hidden="true" tabindex="-1"></a><span class="in">    did_model &lt;- fixest::feols(fml = formula(fml_formula),</span></span>
<span id="cb60-691"><a href="#cb60-691" aria-hidden="true" tabindex="-1"></a><span class="in">                  data = data,</span></span>
<span id="cb60-692"><a href="#cb60-692" aria-hidden="true" tabindex="-1"></a><span class="in">                  cluster = c("gvkey", "ff_30ind_name")</span></span>
<span id="cb60-693"><a href="#cb60-693" aria-hidden="true" tabindex="-1"></a><span class="in">                  )</span></span>
<span id="cb60-694"><a href="#cb60-694" aria-hidden="true" tabindex="-1"></a><span class="in">    return(did_model)</span></span>
<span id="cb60-695"><a href="#cb60-695" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb60-696"><a href="#cb60-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-697"><a href="#cb60-697" aria-hidden="true" tabindex="-1"></a><span class="in">### DiD result using post-:</span></span>
<span id="cb60-698"><a href="#cb60-698" aria-hidden="true" tabindex="-1"></a><span class="in">fml_results %&gt;%</span></span>
<span id="cb60-699"><a href="#cb60-699" aria-hidden="true" tabindex="-1"></a><span class="in">  `names&lt;-`(value = unlist(fml_parameters[,1])) %&gt;%</span></span>
<span id="cb60-700"><a href="#cb60-700" aria-hidden="true" tabindex="-1"></a><span class="in">  etable(</span></span>
<span id="cb60-701"><a href="#cb60-701" aria-hidden="true" tabindex="-1"></a><span class="in">    order = "post",</span></span>
<span id="cb60-702"><a href="#cb60-702" aria-hidden="true" tabindex="-1"></a><span class="in">    # keep = "post",</span></span>
<span id="cb60-703"><a href="#cb60-703" aria-hidden="true" tabindex="-1"></a><span class="in">    extralines = list(</span></span>
<span id="cb60-704"><a href="#cb60-704" aria-hidden="true" tabindex="-1"></a><span class="in">      ## Controls:</span></span>
<span id="cb60-705"><a href="#cb60-705" aria-hidden="true" tabindex="-1"></a><span class="in">      "^_Controls" = ifelse(unlist(fml_parameters[,3]), yes = "Yes", no = "No"),</span></span>
<span id="cb60-706"><a href="#cb60-706" aria-hidden="true" tabindex="-1"></a><span class="in">      ## the identity of the sample:</span></span>
<span id="cb60-707"><a href="#cb60-707" aria-hidden="true" tabindex="-1"></a><span class="in">      "__Sample" = ifelse(unlist(fml_parameters[,4]), yes = "Balanced Panel", no = "Full Sample") # whether used a balanced panel or a full sample.</span></span>
<span id="cb60-708"><a href="#cb60-708" aria-hidden="true" tabindex="-1"></a><span class="in">  )) %&gt;%</span></span>
<span id="cb60-709"><a href="#cb60-709" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::kable(format = "html", caption = paste("DiD Results with `", intensity_measure_name, "`", sep = "")) %&gt;%</span></span>
<span id="cb60-710"><a href="#cb60-710" aria-hidden="true" tabindex="-1"></a><span class="in">  kableExtra::kable_styling(</span></span>
<span id="cb60-711"><a href="#cb60-711" aria-hidden="true" tabindex="-1"></a><span class="in">    font_size = 8,       # Smaller font (default is 16px)</span></span>
<span id="cb60-712"><a href="#cb60-712" aria-hidden="true" tabindex="-1"></a><span class="in">    full_width = FALSE,   # Table width fits content</span></span>
<span id="cb60-713"><a href="#cb60-713" aria-hidden="true" tabindex="-1"></a><span class="in">    bootstrap_options = c("striped", "condensed")</span></span>
<span id="cb60-714"><a href="#cb60-714" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-715"><a href="#cb60-715" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-716"><a href="#cb60-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-717"><a href="#cb60-717" aria-hidden="true" tabindex="-1"></a>All treatment effect estimates are significantly negative across all specifications.</span>
<span id="cb60-718"><a href="#cb60-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-719"><a href="#cb60-719" aria-hidden="true" tabindex="-1"></a>Next we estimate the yearly treatment effects.</span>
<span id="cb60-720"><a href="#cb60-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-721"><a href="#cb60-721" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Individual Year Treatment Plots</span></span>
<span id="cb60-722"><a href="#cb60-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-723"><a href="#cb60-723" aria-hidden="true" tabindex="-1"></a><span class="in">```{r s3b-did-plot, echo=TRUE}</span></span>
<span id="cb60-724"><a href="#cb60-724" aria-hidden="true" tabindex="-1"></a><span class="in">## create the combinations of parameters:</span></span>
<span id="cb60-725"><a href="#cb60-725" aria-hidden="true" tabindex="-1"></a><span class="in">fml_parameters &lt;- expand_grid(</span></span>
<span id="cb60-726"><a href="#cb60-726" aria-hidden="true" tabindex="-1"></a><span class="in">  choice_treatment = c("intensity_2000", "treated"), # what is the treatment measure: continuous/binary</span></span>
<span id="cb60-727"><a href="#cb60-727" aria-hidden="true" tabindex="-1"></a><span class="in">  controls_inclusion = c(FALSE, TRUE),# whether to include controls</span></span>
<span id="cb60-728"><a href="#cb60-728" aria-hidden="true" tabindex="-1"></a><span class="in">  balanced_panel = c(FALSE, TRUE), # whether keep a balanced panel</span></span>
<span id="cb60-729"><a href="#cb60-729" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;%</span></span>
<span id="cb60-730"><a href="#cb60-730" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(balanced_panel) %&gt;%</span></span>
<span id="cb60-731"><a href="#cb60-731" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind.data.frame(.,</span></span>
<span id="cb60-732"><a href="#cb60-732" aria-hidden="true" tabindex="-1"></a><span class="in">    fml = apply(X = ., MARGIN = 1, FUN = function(parameters) {</span></span>
<span id="cb60-733"><a href="#cb60-733" aria-hidden="true" tabindex="-1"></a><span class="in">      ## parameters:</span></span>
<span id="cb60-734"><a href="#cb60-734" aria-hidden="true" tabindex="-1"></a><span class="in">      choice_treatment &lt;- parameters[1]</span></span>
<span id="cb60-735"><a href="#cb60-735" aria-hidden="true" tabindex="-1"></a><span class="in">      add_controls &lt;- parameters[2]</span></span>
<span id="cb60-736"><a href="#cb60-736" aria-hidden="true" tabindex="-1"></a><span class="in">      is_balanced &lt;- parameters[3]</span></span>
<span id="cb60-737"><a href="#cb60-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-738"><a href="#cb60-738" aria-hidden="true" tabindex="-1"></a><span class="in">      ## inputs:</span></span>
<span id="cb60-739"><a href="#cb60-739" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_base &lt;- paste("book_leverage ~ i(indexyear, ", choice_treatment, ", ref = -1)", sep = "") # the baseline model</span></span>
<span id="cb60-740"><a href="#cb60-740" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_base_controls &lt;- " + roa + ebitda_at + log(at_thousand) + altman_Z + tangibility + current_ratio" # the potential controls</span></span>
<span id="cb60-741"><a href="#cb60-741" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_base_fe &lt;- " | gvkey + indexyear + ff_30ind_name^indexyear" # fixed effects</span></span>
<span id="cb60-742"><a href="#cb60-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-743"><a href="#cb60-743" aria-hidden="true" tabindex="-1"></a><span class="in">      ## output formula:</span></span>
<span id="cb60-744"><a href="#cb60-744" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_output &lt;- paste(</span></span>
<span id="cb60-745"><a href="#cb60-745" aria-hidden="true" tabindex="-1"></a><span class="in">        fml_base,</span></span>
<span id="cb60-746"><a href="#cb60-746" aria-hidden="true" tabindex="-1"></a><span class="in">        ifelse(add_controls == TRUE, yes = fml_base_controls, no = ""),</span></span>
<span id="cb60-747"><a href="#cb60-747" aria-hidden="true" tabindex="-1"></a><span class="in">        fml_base_fe,</span></span>
<span id="cb60-748"><a href="#cb60-748" aria-hidden="true" tabindex="-1"></a><span class="in">        sep = ""</span></span>
<span id="cb60-749"><a href="#cb60-749" aria-hidden="true" tabindex="-1"></a><span class="in">      )</span></span>
<span id="cb60-750"><a href="#cb60-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-751"><a href="#cb60-751" aria-hidden="true" tabindex="-1"></a><span class="in">      return(fml_output)</span></span>
<span id="cb60-752"><a href="#cb60-752" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb60-753"><a href="#cb60-753" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb60-754"><a href="#cb60-754" aria-hidden="true" tabindex="-1"></a><span class="in">  as_tibble() %&gt;%</span></span>
<span id="cb60-755"><a href="#cb60-755" aria-hidden="true" tabindex="-1"></a><span class="in">  ## assign a name for each regression:</span></span>
<span id="cb60-756"><a href="#cb60-756" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(name = paste("(", letters[1:nrow(.)], ")", sep = "")) %&gt;%</span></span>
<span id="cb60-757"><a href="#cb60-757" aria-hidden="true" tabindex="-1"></a><span class="in">  select(name, everything())</span></span>
<span id="cb60-758"><a href="#cb60-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-759"><a href="#cb60-759" aria-hidden="true" tabindex="-1"></a><span class="in">fml_parameters</span></span>
<span id="cb60-760"><a href="#cb60-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-761"><a href="#cb60-761" aria-hidden="true" tabindex="-1"></a><span class="in">## construct the data used for the loop:</span></span>
<span id="cb60-762"><a href="#cb60-762" aria-hidden="true" tabindex="-1"></a><span class="in">data_did_loop &lt;- data_did %&gt;%</span></span>
<span id="cb60-763"><a href="#cb60-763" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;%</span></span>
<span id="cb60-764"><a href="#cb60-764" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb60-765"><a href="#cb60-765" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb60-766"><a href="#cb60-766" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, fyear, indexyear, intensity_2000, post_2005,</span></span>
<span id="cb60-767"><a href="#cb60-767" aria-hidden="true" tabindex="-1"></a><span class="in">         book_leverage, debt_ebitda, sic, ff_30ind_name,</span></span>
<span id="cb60-768"><a href="#cb60-768" aria-hidden="true" tabindex="-1"></a><span class="in">         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span></span>
<span id="cb60-769"><a href="#cb60-769" aria-hidden="true" tabindex="-1"></a><span class="in">         altman_Z, kz, market_book, tangibility, current_ratio) %&gt;%</span></span>
<span id="cb60-770"><a href="#cb60-770" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= period_start - n_pre &amp; fyear &lt;= period_end) %&gt;%</span></span>
<span id="cb60-771"><a href="#cb60-771" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(intensity_2000) &amp; !is.na(at)) %&gt;%</span></span>
<span id="cb60-772"><a href="#cb60-772" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-773"><a href="#cb60-773" aria-hidden="true" tabindex="-1"></a><span class="in">    gvkey = as.factor(gvkey),</span></span>
<span id="cb60-774"><a href="#cb60-774" aria-hidden="true" tabindex="-1"></a><span class="in">    fyear = as.factor(fyear),</span></span>
<span id="cb60-775"><a href="#cb60-775" aria-hidden="true" tabindex="-1"></a><span class="in">    # treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb60-776"><a href="#cb60-776" aria-hidden="true" tabindex="-1"></a><span class="in">    treated = ifelse(intensity_2000 &gt; 0, 1, 0),</span></span>
<span id="cb60-777"><a href="#cb60-777" aria-hidden="true" tabindex="-1"></a><span class="in">    ebitda_at = ebitda / at,</span></span>
<span id="cb60-778"><a href="#cb60-778" aria-hidden="true" tabindex="-1"></a><span class="in">    at_thousand = at * 10^-3,</span></span>
<span id="cb60-779"><a href="#cb60-779" aria-hidden="true" tabindex="-1"></a><span class="in">    large = ifelse(large, yes = "Large", no = "Small"),</span></span>
<span id="cb60-780"><a href="#cb60-780" aria-hidden="true" tabindex="-1"></a><span class="in">    tangiblity_exbnl = tangibility - bnl_intensity,</span></span>
<span id="cb60-781"><a href="#cb60-781" aria-hidden="true" tabindex="-1"></a><span class="in">    bnl = bnl_intensity * at,</span></span>
<span id="cb60-782"><a href="#cb60-782" aria-hidden="true" tabindex="-1"></a><span class="in">    # large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb60-783"><a href="#cb60-783" aria-hidden="true" tabindex="-1"></a><span class="in">    treated_large = paste(treated, large, sep = "_")</span></span>
<span id="cb60-784"><a href="#cb60-784" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-785"><a href="#cb60-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-786"><a href="#cb60-786" aria-hidden="true" tabindex="-1"></a><span class="in">data_did_loop_balanced &lt;- data_did %&gt;%</span></span>
<span id="cb60-787"><a href="#cb60-787" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;%</span></span>
<span id="cb60-788"><a href="#cb60-788" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb60-789"><a href="#cb60-789" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb60-790"><a href="#cb60-790" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, fyear, indexyear, intensity_2000, post_2005,</span></span>
<span id="cb60-791"><a href="#cb60-791" aria-hidden="true" tabindex="-1"></a><span class="in">         book_leverage, debt_ebitda, sic, ff_30ind_name,</span></span>
<span id="cb60-792"><a href="#cb60-792" aria-hidden="true" tabindex="-1"></a><span class="in">         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span></span>
<span id="cb60-793"><a href="#cb60-793" aria-hidden="true" tabindex="-1"></a><span class="in">         altman_Z, kz, market_book, tangibility, current_ratio) %&gt;%</span></span>
<span id="cb60-794"><a href="#cb60-794" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= period_start - n_pre &amp; fyear &lt;= period_end) %&gt;%</span></span>
<span id="cb60-795"><a href="#cb60-795" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(intensity_2000) &amp; !is.na(at)) %&gt;%</span></span>
<span id="cb60-796"><a href="#cb60-796" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-797"><a href="#cb60-797" aria-hidden="true" tabindex="-1"></a><span class="in">    gvkey = as.factor(gvkey),</span></span>
<span id="cb60-798"><a href="#cb60-798" aria-hidden="true" tabindex="-1"></a><span class="in">    fyear = as.factor(fyear),</span></span>
<span id="cb60-799"><a href="#cb60-799" aria-hidden="true" tabindex="-1"></a><span class="in">    # treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb60-800"><a href="#cb60-800" aria-hidden="true" tabindex="-1"></a><span class="in">    treated = ifelse(intensity_2000 &gt; 0, 1, 0),</span></span>
<span id="cb60-801"><a href="#cb60-801" aria-hidden="true" tabindex="-1"></a><span class="in">    ebitda_at = ebitda / at,</span></span>
<span id="cb60-802"><a href="#cb60-802" aria-hidden="true" tabindex="-1"></a><span class="in">    at_thousand = at * 10^-3,</span></span>
<span id="cb60-803"><a href="#cb60-803" aria-hidden="true" tabindex="-1"></a><span class="in">    large = ifelse(large, yes = "Large", no = "Small"),</span></span>
<span id="cb60-804"><a href="#cb60-804" aria-hidden="true" tabindex="-1"></a><span class="in">    tangiblity_exbnl = tangibility - bnl_intensity,</span></span>
<span id="cb60-805"><a href="#cb60-805" aria-hidden="true" tabindex="-1"></a><span class="in">    bnl = bnl_intensity * at,</span></span>
<span id="cb60-806"><a href="#cb60-806" aria-hidden="true" tabindex="-1"></a><span class="in">    # large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb60-807"><a href="#cb60-807" aria-hidden="true" tabindex="-1"></a><span class="in">    treated_large = paste(treated, large, sep = "_")</span></span>
<span id="cb60-808"><a href="#cb60-808" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-809"><a href="#cb60-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-810"><a href="#cb60-810" aria-hidden="true" tabindex="-1"></a><span class="in">## store all results</span></span>
<span id="cb60-811"><a href="#cb60-811" aria-hidden="true" tabindex="-1"></a><span class="in">fml_results &lt;- fml_parameters %&gt;%</span></span>
<span id="cb60-812"><a href="#cb60-812" aria-hidden="true" tabindex="-1"></a><span class="in">  apply(MARGIN = 1, FUN = function(parameters) {</span></span>
<span id="cb60-813"><a href="#cb60-813" aria-hidden="true" tabindex="-1"></a><span class="in">    ## parameters:</span></span>
<span id="cb60-814"><a href="#cb60-814" aria-hidden="true" tabindex="-1"></a><span class="in">    is_balanced &lt;- parameters[4]</span></span>
<span id="cb60-815"><a href="#cb60-815" aria-hidden="true" tabindex="-1"></a><span class="in">    fml_formula &lt;- parameters[5]</span></span>
<span id="cb60-816"><a href="#cb60-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-817"><a href="#cb60-817" aria-hidden="true" tabindex="-1"></a><span class="in">    ## data:</span></span>
<span id="cb60-818"><a href="#cb60-818" aria-hidden="true" tabindex="-1"></a><span class="in">    if (is_balanced == TRUE) {</span></span>
<span id="cb60-819"><a href="#cb60-819" aria-hidden="true" tabindex="-1"></a><span class="in">      data &lt;- data_did_loop_balanced</span></span>
<span id="cb60-820"><a href="#cb60-820" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb60-821"><a href="#cb60-821" aria-hidden="true" tabindex="-1"></a><span class="in">      data &lt;- data_did_loop</span></span>
<span id="cb60-822"><a href="#cb60-822" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb60-823"><a href="#cb60-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-824"><a href="#cb60-824" aria-hidden="true" tabindex="-1"></a><span class="in">    ## regression:</span></span>
<span id="cb60-825"><a href="#cb60-825" aria-hidden="true" tabindex="-1"></a><span class="in">    did_model &lt;- fixest::feols(fml = formula(fml_formula),</span></span>
<span id="cb60-826"><a href="#cb60-826" aria-hidden="true" tabindex="-1"></a><span class="in">                  data = data,</span></span>
<span id="cb60-827"><a href="#cb60-827" aria-hidden="true" tabindex="-1"></a><span class="in">                  cluster = c("gvkey", "ff_30ind_name")</span></span>
<span id="cb60-828"><a href="#cb60-828" aria-hidden="true" tabindex="-1"></a><span class="in">                  )</span></span>
<span id="cb60-829"><a href="#cb60-829" aria-hidden="true" tabindex="-1"></a><span class="in">    return(did_model)</span></span>
<span id="cb60-830"><a href="#cb60-830" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb60-831"><a href="#cb60-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-832"><a href="#cb60-832" aria-hidden="true" tabindex="-1"></a><span class="in">### create the table:</span></span>
<span id="cb60-833"><a href="#cb60-833" aria-hidden="true" tabindex="-1"></a><span class="in">fml_results %&gt;%</span></span>
<span id="cb60-834"><a href="#cb60-834" aria-hidden="true" tabindex="-1"></a><span class="in">  `names&lt;-`(value = unlist(fml_parameters[,1])) %&gt;%</span></span>
<span id="cb60-835"><a href="#cb60-835" aria-hidden="true" tabindex="-1"></a><span class="in">  etable(</span></span>
<span id="cb60-836"><a href="#cb60-836" aria-hidden="true" tabindex="-1"></a><span class="in">    order = "indexyear",</span></span>
<span id="cb60-837"><a href="#cb60-837" aria-hidden="true" tabindex="-1"></a><span class="in">    # keep = "post",</span></span>
<span id="cb60-838"><a href="#cb60-838" aria-hidden="true" tabindex="-1"></a><span class="in">    extralines = list(</span></span>
<span id="cb60-839"><a href="#cb60-839" aria-hidden="true" tabindex="-1"></a><span class="in">      ## Controls:</span></span>
<span id="cb60-840"><a href="#cb60-840" aria-hidden="true" tabindex="-1"></a><span class="in">      "^_Controls" = ifelse(unlist(fml_parameters[,3]), yes = "Yes", no = "No"),</span></span>
<span id="cb60-841"><a href="#cb60-841" aria-hidden="true" tabindex="-1"></a><span class="in">      ## the identity of the sample:</span></span>
<span id="cb60-842"><a href="#cb60-842" aria-hidden="true" tabindex="-1"></a><span class="in">      "__Sample" = ifelse(unlist(fml_parameters[,4]), yes = "Balanced Panel", no = "Full Sample") # whether used a balanced panel or a full sample.</span></span>
<span id="cb60-843"><a href="#cb60-843" aria-hidden="true" tabindex="-1"></a><span class="in">  )) %&gt;%</span></span>
<span id="cb60-844"><a href="#cb60-844" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::kable(format = "html", caption = paste("DiD Results with `", intensity_measure_name, "`", sep = "")) %&gt;%</span></span>
<span id="cb60-845"><a href="#cb60-845" aria-hidden="true" tabindex="-1"></a><span class="in">  kableExtra::kable_styling(</span></span>
<span id="cb60-846"><a href="#cb60-846" aria-hidden="true" tabindex="-1"></a><span class="in">    font_size = 8,       # Smaller font (default is 16px)</span></span>
<span id="cb60-847"><a href="#cb60-847" aria-hidden="true" tabindex="-1"></a><span class="in">    full_width = FALSE,   # Table width fits content</span></span>
<span id="cb60-848"><a href="#cb60-848" aria-hidden="true" tabindex="-1"></a><span class="in">    bootstrap_options = c("striped", "condensed")</span></span>
<span id="cb60-849"><a href="#cb60-849" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-850"><a href="#cb60-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-851"><a href="#cb60-851" aria-hidden="true" tabindex="-1"></a><span class="in">### create the plots:</span></span>
<span id="cb60-852"><a href="#cb60-852" aria-hidden="true" tabindex="-1"></a><span class="in"># fml_parameters[which(unlist(fml_parameters$balanced_panel)), ]</span></span>
<span id="cb60-853"><a href="#cb60-853" aria-hidden="true" tabindex="-1"></a><span class="in">fml_results[which(unlist(fml_parameters$balanced_panel))] %&gt;% # choose the balanced panel</span></span>
<span id="cb60-854"><a href="#cb60-854" aria-hidden="true" tabindex="-1"></a><span class="in">  iplot(.,</span></span>
<span id="cb60-855"><a href="#cb60-855" aria-hidden="true" tabindex="-1"></a><span class="in">        xlab = paste("Time to treatment (Year; 0 = ", base_year, ")", sep = ""),</span></span>
<span id="cb60-856"><a href="#cb60-856" aria-hidden="true" tabindex="-1"></a><span class="in">        main = paste("Treatment Effects by fiscal year: `", intensity_measure_name, "`", sep = ""),</span></span>
<span id="cb60-857"><a href="#cb60-857" aria-hidden="true" tabindex="-1"></a><span class="in">        sub = "Data: Balanced Panel",</span></span>
<span id="cb60-858"><a href="#cb60-858" aria-hidden="true" tabindex="-1"></a><span class="in">        ref.line = FALSE,</span></span>
<span id="cb60-859"><a href="#cb60-859" aria-hidden="true" tabindex="-1"></a><span class="in">        ref.line.par = list(col = "red", lty = 2),</span></span>
<span id="cb60-860"><a href="#cb60-860" aria-hidden="true" tabindex="-1"></a><span class="in">        pt.join = FALSE,</span></span>
<span id="cb60-861"><a href="#cb60-861" aria-hidden="true" tabindex="-1"></a><span class="in">        xlim = c(-3.5, 3.5)</span></span>
<span id="cb60-862"><a href="#cb60-862" aria-hidden="true" tabindex="-1"></a><span class="in">        ); axis(1, at = -3:3); abline(v = 0.5, col = "red", lty = 2, lwd = 3); legend('bottomleft', bty = "n", col = c(1, 2, 3, 4), pch = c(20, 17, 15, 21), legend = c('intensity', 'intensity + controls', 'dummy', 'dummy + controls'));</span></span>
<span id="cb60-863"><a href="#cb60-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-864"><a href="#cb60-864" aria-hidden="true" tabindex="-1"></a><span class="in">fml_results[which(!unlist(fml_parameters$balanced_panel))] %&gt;% # choose full sample</span></span>
<span id="cb60-865"><a href="#cb60-865" aria-hidden="true" tabindex="-1"></a><span class="in">  iplot(.,</span></span>
<span id="cb60-866"><a href="#cb60-866" aria-hidden="true" tabindex="-1"></a><span class="in">        xlab = paste("Time to treatment (Year; 0 = ", base_year, ")", sep = ""),</span></span>
<span id="cb60-867"><a href="#cb60-867" aria-hidden="true" tabindex="-1"></a><span class="in">        main = paste("Treatment Effect by fiscal year: `", intensity_measure_name, "`", sep = ""),</span></span>
<span id="cb60-868"><a href="#cb60-868" aria-hidden="true" tabindex="-1"></a><span class="in">        sub = "Data: Full Sample",</span></span>
<span id="cb60-869"><a href="#cb60-869" aria-hidden="true" tabindex="-1"></a><span class="in">        ref.line = FALSE,</span></span>
<span id="cb60-870"><a href="#cb60-870" aria-hidden="true" tabindex="-1"></a><span class="in">        ref.line.par = list(col = "red", lty = 2),</span></span>
<span id="cb60-871"><a href="#cb60-871" aria-hidden="true" tabindex="-1"></a><span class="in">        pt.join = FALSE,</span></span>
<span id="cb60-872"><a href="#cb60-872" aria-hidden="true" tabindex="-1"></a><span class="in">        xlim = c(-3.5, 3.5)</span></span>
<span id="cb60-873"><a href="#cb60-873" aria-hidden="true" tabindex="-1"></a><span class="in">        ); axis(1, at = -3:3); abline(v = 0.5, col = "red", lty = 2, lwd = 3); legend('bottomleft', bty = "n", col = c(1, 2, 3, 4), pch = c(20, 17, 15, 21), legend = c('intensity', 'intensity + controls', 'dummy', 'dummy + controls'))</span></span>
<span id="cb60-874"><a href="#cb60-874" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-875"><a href="#cb60-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-876"><a href="#cb60-876" aria-hidden="true" tabindex="-1"></a>We plot the yearly treatment effect estimates with different model specifications using both the balanced panel and the full sample. As the full sample will contain some firms with extremely high leverage and high <span class="in">`building intensity`</span> before 2004, we believe that it is more reasonable to use a balanced sample for the analysis.</span>
<span id="cb60-877"><a href="#cb60-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-878"><a href="#cb60-878" aria-hidden="true" tabindex="-1"></a>We conclude that the pre-trend assumption is not violated and we can see a significant negative treatment effect around 2005 (end of fiscal year 2004) and after 2005.</span>
<span id="cb60-879"><a href="#cb60-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-880"><a href="#cb60-880" aria-hidden="true" tabindex="-1"></a><span class="fu">### s3.3. land intensity {#sec-s3c-land-intensity}</span></span>
<span id="cb60-881"><a href="#cb60-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-882"><a href="#cb60-882" aria-hidden="true" tabindex="-1"></a><span class="in">`land_intensity`</span> is chosen to measure a firm's long-term exposure to land and improvements at cost under the PPE.</span>
<span id="cb60-883"><a href="#cb60-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-884"><a href="#cb60-884" aria-hidden="true" tabindex="-1"></a><span class="in">```{r s3c-did-data, echo=TRUE, results='hold'}</span></span>
<span id="cb60-885"><a href="#cb60-885" aria-hidden="true" tabindex="-1"></a><span class="in">## choose the group definition:</span></span>
<span id="cb60-886"><a href="#cb60-886" aria-hidden="true" tabindex="-1"></a><span class="in">intensity_measure_name &lt;- candidate_intensity_measure[4]</span></span>
<span id="cb60-887"><a href="#cb60-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-888"><a href="#cb60-888" aria-hidden="true" tabindex="-1"></a><span class="in">data_firm &lt;- data %&gt;%</span></span>
<span id="cb60-889"><a href="#cb60-889" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear == intensity_measure_year) %&gt;% # use `fyear` may create multiple observations for the same firm. E.g. filter(gvkey == 23535, dyear == 2005)</span></span>
<span id="cb60-890"><a href="#cb60-890" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(fyear) %&gt;%</span></span>
<span id="cb60-891"><a href="#cb60-891" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(median_at = median(at, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb60-892"><a href="#cb60-892" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;%</span></span>
<span id="cb60-893"><a href="#cb60-893" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(large = ifelse(at &gt; median_at, 1, 0)) %&gt;%</span></span>
<span id="cb60-894"><a href="#cb60-894" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, intensity_2000 = all_of(intensity_measure_name), large)</span></span>
<span id="cb60-895"><a href="#cb60-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-896"><a href="#cb60-896" aria-hidden="true" tabindex="-1"></a><span class="in">data_did &lt;- data %&gt;%</span></span>
<span id="cb60-897"><a href="#cb60-897" aria-hidden="true" tabindex="-1"></a><span class="in">  ## merge the grouping variable</span></span>
<span id="cb60-898"><a href="#cb60-898" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(y = data_firm, by = join_by(gvkey) ) %&gt;%</span></span>
<span id="cb60-899"><a href="#cb60-899" aria-hidden="true" tabindex="-1"></a><span class="in">  ## merge the FF 30 industry classifiaction</span></span>
<span id="cb60-900"><a href="#cb60-900" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(y = FF_30ind, by = join_by(sic)) %&gt;%</span></span>
<span id="cb60-901"><a href="#cb60-901" aria-hidden="true" tabindex="-1"></a><span class="in">  ## exclude certain industries</span></span>
<span id="cb60-902"><a href="#cb60-902" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(</span></span>
<span id="cb60-903"><a href="#cb60-903" aria-hidden="true" tabindex="-1"></a><span class="in">    ff_30ind != 20, # exclude Utiltiy (number 20)</span></span>
<span id="cb60-904"><a href="#cb60-904" aria-hidden="true" tabindex="-1"></a><span class="in">    !(sic &gt;= 6000 &amp; sic &lt;= 6199) # exclude banks under Banking, Insurance, Real Estate, Trading (number 29)</span></span>
<span id="cb60-905"><a href="#cb60-905" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb60-906"><a href="#cb60-906" aria-hidden="true" tabindex="-1"></a><span class="in">  ## pre- &amp; post-</span></span>
<span id="cb60-907"><a href="#cb60-907" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-908"><a href="#cb60-908" aria-hidden="true" tabindex="-1"></a><span class="in">    indexyear = (fyear - base_year), # year index with 2005 as base 0.</span></span>
<span id="cb60-909"><a href="#cb60-909" aria-hidden="true" tabindex="-1"></a><span class="in">    post_2005 = as.numeric(fyear &gt; base_year)  # whether it is after the 2005 reform</span></span>
<span id="cb60-910"><a href="#cb60-910" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-911"><a href="#cb60-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-912"><a href="#cb60-912" aria-hidden="true" tabindex="-1"></a><span class="in">## gvkey(s) for balanced panel":</span></span>
<span id="cb60-913"><a href="#cb60-913" aria-hidden="true" tabindex="-1"></a><span class="in">data_did_balanced_id &lt;- data_did %&gt;%</span></span>
<span id="cb60-914"><a href="#cb60-914" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;%</span></span>
<span id="cb60-915"><a href="#cb60-915" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= period_start - n_pre &amp; fyear &lt;= period_end) %&gt;%</span></span>
<span id="cb60-916"><a href="#cb60-916" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(gvkey) %&gt;%</span></span>
<span id="cb60-917"><a href="#cb60-917" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(count_obs = sum(!is.na(book_leverage) &amp; !is.na(intensity_2000))) %&gt;%</span></span>
<span id="cb60-918"><a href="#cb60-918" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;%</span></span>
<span id="cb60-919"><a href="#cb60-919" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(count_obs == period_end - period_start + 1 + n_pre) %&gt;%</span></span>
<span id="cb60-920"><a href="#cb60-920" aria-hidden="true" tabindex="-1"></a><span class="in">  .$gvkey</span></span>
<span id="cb60-921"><a href="#cb60-921" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-922"><a href="#cb60-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-923"><a href="#cb60-923" aria-hidden="true" tabindex="-1"></a>DiD Analysis:</span>
<span id="cb60-924"><a href="#cb60-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-925"><a href="#cb60-925" aria-hidden="true" tabindex="-1"></a><span class="in">```{r s3c-did-test, echo=TRUE, warning=FALSE, message=FALSE, results='hold'}</span></span>
<span id="cb60-926"><a href="#cb60-926" aria-hidden="true" tabindex="-1"></a><span class="in">cat(intensity_measure_name); cat(": \n");</span></span>
<span id="cb60-927"><a href="#cb60-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-928"><a href="#cb60-928" aria-hidden="true" tabindex="-1"></a><span class="in">## create the combinations of parameters:</span></span>
<span id="cb60-929"><a href="#cb60-929" aria-hidden="true" tabindex="-1"></a><span class="in">fml_parameters &lt;- expand_grid(</span></span>
<span id="cb60-930"><a href="#cb60-930" aria-hidden="true" tabindex="-1"></a><span class="in">  choice_treatment = c("intensity_2000", "treated"), # what is the treatment measure: continuous/binary</span></span>
<span id="cb60-931"><a href="#cb60-931" aria-hidden="true" tabindex="-1"></a><span class="in">  controls_inclusion = c(FALSE, TRUE),# whether to include controls</span></span>
<span id="cb60-932"><a href="#cb60-932" aria-hidden="true" tabindex="-1"></a><span class="in">  balanced_panel = c(FALSE, TRUE), # whether keep a balanced panel</span></span>
<span id="cb60-933"><a href="#cb60-933" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;%</span></span>
<span id="cb60-934"><a href="#cb60-934" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(balanced_panel) %&gt;%</span></span>
<span id="cb60-935"><a href="#cb60-935" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind.data.frame(.,</span></span>
<span id="cb60-936"><a href="#cb60-936" aria-hidden="true" tabindex="-1"></a><span class="in">    fml = apply(X = ., MARGIN = 1, FUN = function(parameters) {</span></span>
<span id="cb60-937"><a href="#cb60-937" aria-hidden="true" tabindex="-1"></a><span class="in">      ## parameters:</span></span>
<span id="cb60-938"><a href="#cb60-938" aria-hidden="true" tabindex="-1"></a><span class="in">      choice_treatment &lt;- parameters[1]</span></span>
<span id="cb60-939"><a href="#cb60-939" aria-hidden="true" tabindex="-1"></a><span class="in">      add_controls &lt;- parameters[2]</span></span>
<span id="cb60-940"><a href="#cb60-940" aria-hidden="true" tabindex="-1"></a><span class="in">      is_balanced &lt;- parameters[3]</span></span>
<span id="cb60-941"><a href="#cb60-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-942"><a href="#cb60-942" aria-hidden="true" tabindex="-1"></a><span class="in">      ## inputs:</span></span>
<span id="cb60-943"><a href="#cb60-943" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_base &lt;- paste("book_leverage ~ post_2005*", choice_treatment, sep = "") # the baseline model</span></span>
<span id="cb60-944"><a href="#cb60-944" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_base_controls &lt;- " + roa + ebitda_at + log(at_thousand) + altman_Z + tangibility + current_ratio" # the potential controls</span></span>
<span id="cb60-945"><a href="#cb60-945" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_base_fe &lt;- " | gvkey + indexyear + ff_30ind_name^indexyear" # fixed effects</span></span>
<span id="cb60-946"><a href="#cb60-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-947"><a href="#cb60-947" aria-hidden="true" tabindex="-1"></a><span class="in">      ## output formula:</span></span>
<span id="cb60-948"><a href="#cb60-948" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_output &lt;- paste(</span></span>
<span id="cb60-949"><a href="#cb60-949" aria-hidden="true" tabindex="-1"></a><span class="in">        fml_base,</span></span>
<span id="cb60-950"><a href="#cb60-950" aria-hidden="true" tabindex="-1"></a><span class="in">        ifelse(add_controls == TRUE, yes = fml_base_controls, no = ""),</span></span>
<span id="cb60-951"><a href="#cb60-951" aria-hidden="true" tabindex="-1"></a><span class="in">        fml_base_fe,</span></span>
<span id="cb60-952"><a href="#cb60-952" aria-hidden="true" tabindex="-1"></a><span class="in">        sep = ""</span></span>
<span id="cb60-953"><a href="#cb60-953" aria-hidden="true" tabindex="-1"></a><span class="in">      )</span></span>
<span id="cb60-954"><a href="#cb60-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-955"><a href="#cb60-955" aria-hidden="true" tabindex="-1"></a><span class="in">      return(fml_output)</span></span>
<span id="cb60-956"><a href="#cb60-956" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb60-957"><a href="#cb60-957" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb60-958"><a href="#cb60-958" aria-hidden="true" tabindex="-1"></a><span class="in">  as_tibble() %&gt;%</span></span>
<span id="cb60-959"><a href="#cb60-959" aria-hidden="true" tabindex="-1"></a><span class="in">  ## assign a name for each regression:</span></span>
<span id="cb60-960"><a href="#cb60-960" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(name = paste("(", 1:nrow(.), ")", sep = "")) %&gt;%</span></span>
<span id="cb60-961"><a href="#cb60-961" aria-hidden="true" tabindex="-1"></a><span class="in">  select(name, everything())</span></span>
<span id="cb60-962"><a href="#cb60-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-963"><a href="#cb60-963" aria-hidden="true" tabindex="-1"></a><span class="in">## construct the data used for the loop:</span></span>
<span id="cb60-964"><a href="#cb60-964" aria-hidden="true" tabindex="-1"></a><span class="in">data_did_loop &lt;- data_did %&gt;%</span></span>
<span id="cb60-965"><a href="#cb60-965" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;%</span></span>
<span id="cb60-966"><a href="#cb60-966" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb60-967"><a href="#cb60-967" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb60-968"><a href="#cb60-968" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, fyear, indexyear, intensity_2000, post_2005,</span></span>
<span id="cb60-969"><a href="#cb60-969" aria-hidden="true" tabindex="-1"></a><span class="in">         book_leverage, debt_ebitda, sic, ff_30ind_name,</span></span>
<span id="cb60-970"><a href="#cb60-970" aria-hidden="true" tabindex="-1"></a><span class="in">         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span></span>
<span id="cb60-971"><a href="#cb60-971" aria-hidden="true" tabindex="-1"></a><span class="in">         altman_Z, kz, market_book, tangibility, current_ratio) %&gt;%</span></span>
<span id="cb60-972"><a href="#cb60-972" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= period_start &amp; fyear &lt;= period_end) %&gt;%</span></span>
<span id="cb60-973"><a href="#cb60-973" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(intensity_2000) &amp; !is.na(at)) %&gt;%</span></span>
<span id="cb60-974"><a href="#cb60-974" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-975"><a href="#cb60-975" aria-hidden="true" tabindex="-1"></a><span class="in">    gvkey = as.factor(gvkey),</span></span>
<span id="cb60-976"><a href="#cb60-976" aria-hidden="true" tabindex="-1"></a><span class="in">    fyear = as.factor(fyear),</span></span>
<span id="cb60-977"><a href="#cb60-977" aria-hidden="true" tabindex="-1"></a><span class="in">    # treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb60-978"><a href="#cb60-978" aria-hidden="true" tabindex="-1"></a><span class="in">    treated = ifelse(intensity_2000 &gt; 0, 1, 0),</span></span>
<span id="cb60-979"><a href="#cb60-979" aria-hidden="true" tabindex="-1"></a><span class="in">    ebitda_at = ebitda / at,</span></span>
<span id="cb60-980"><a href="#cb60-980" aria-hidden="true" tabindex="-1"></a><span class="in">    at_thousand = at * 10^-3,</span></span>
<span id="cb60-981"><a href="#cb60-981" aria-hidden="true" tabindex="-1"></a><span class="in">    large = ifelse(large, yes = "Large", no = "Small"),</span></span>
<span id="cb60-982"><a href="#cb60-982" aria-hidden="true" tabindex="-1"></a><span class="in">    tangiblity_exbnl = tangibility - bnl_intensity,</span></span>
<span id="cb60-983"><a href="#cb60-983" aria-hidden="true" tabindex="-1"></a><span class="in">    bnl = bnl_intensity * at,</span></span>
<span id="cb60-984"><a href="#cb60-984" aria-hidden="true" tabindex="-1"></a><span class="in">    # large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb60-985"><a href="#cb60-985" aria-hidden="true" tabindex="-1"></a><span class="in">    treated_large = paste(treated, large, sep = "_")</span></span>
<span id="cb60-986"><a href="#cb60-986" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-987"><a href="#cb60-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-988"><a href="#cb60-988" aria-hidden="true" tabindex="-1"></a><span class="in">data_did_loop_balanced &lt;- data_did %&gt;%</span></span>
<span id="cb60-989"><a href="#cb60-989" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;%</span></span>
<span id="cb60-990"><a href="#cb60-990" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb60-991"><a href="#cb60-991" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb60-992"><a href="#cb60-992" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, fyear, indexyear, intensity_2000, post_2005,</span></span>
<span id="cb60-993"><a href="#cb60-993" aria-hidden="true" tabindex="-1"></a><span class="in">         book_leverage, debt_ebitda, sic, ff_30ind_name,</span></span>
<span id="cb60-994"><a href="#cb60-994" aria-hidden="true" tabindex="-1"></a><span class="in">         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span></span>
<span id="cb60-995"><a href="#cb60-995" aria-hidden="true" tabindex="-1"></a><span class="in">         altman_Z, kz, market_book, tangibility, current_ratio) %&gt;%</span></span>
<span id="cb60-996"><a href="#cb60-996" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= period_start &amp; fyear &lt;= period_end) %&gt;%</span></span>
<span id="cb60-997"><a href="#cb60-997" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(intensity_2000) &amp; !is.na(at)) %&gt;%</span></span>
<span id="cb60-998"><a href="#cb60-998" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-999"><a href="#cb60-999" aria-hidden="true" tabindex="-1"></a><span class="in">    gvkey = as.factor(gvkey),</span></span>
<span id="cb60-1000"><a href="#cb60-1000" aria-hidden="true" tabindex="-1"></a><span class="in">    fyear = as.factor(fyear),</span></span>
<span id="cb60-1001"><a href="#cb60-1001" aria-hidden="true" tabindex="-1"></a><span class="in">    # treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb60-1002"><a href="#cb60-1002" aria-hidden="true" tabindex="-1"></a><span class="in">    treated = ifelse(intensity_2000 &gt; 0, 1, 0),</span></span>
<span id="cb60-1003"><a href="#cb60-1003" aria-hidden="true" tabindex="-1"></a><span class="in">    ebitda_at = ebitda / at,</span></span>
<span id="cb60-1004"><a href="#cb60-1004" aria-hidden="true" tabindex="-1"></a><span class="in">    at_thousand = at * 10^-3,</span></span>
<span id="cb60-1005"><a href="#cb60-1005" aria-hidden="true" tabindex="-1"></a><span class="in">    large = ifelse(large, yes = "Large", no = "Small"),</span></span>
<span id="cb60-1006"><a href="#cb60-1006" aria-hidden="true" tabindex="-1"></a><span class="in">    tangiblity_exbnl = tangibility - bnl_intensity,</span></span>
<span id="cb60-1007"><a href="#cb60-1007" aria-hidden="true" tabindex="-1"></a><span class="in">    bnl = bnl_intensity * at,</span></span>
<span id="cb60-1008"><a href="#cb60-1008" aria-hidden="true" tabindex="-1"></a><span class="in">    # large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb60-1009"><a href="#cb60-1009" aria-hidden="true" tabindex="-1"></a><span class="in">    treated_large = paste(treated, large, sep = "_")</span></span>
<span id="cb60-1010"><a href="#cb60-1010" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-1011"><a href="#cb60-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1012"><a href="#cb60-1012" aria-hidden="true" tabindex="-1"></a><span class="in">## store all results</span></span>
<span id="cb60-1013"><a href="#cb60-1013" aria-hidden="true" tabindex="-1"></a><span class="in">fml_results &lt;- fml_parameters %&gt;%</span></span>
<span id="cb60-1014"><a href="#cb60-1014" aria-hidden="true" tabindex="-1"></a><span class="in">  apply(MARGIN = 1, FUN = function(parameters) {</span></span>
<span id="cb60-1015"><a href="#cb60-1015" aria-hidden="true" tabindex="-1"></a><span class="in">    ## parameters:</span></span>
<span id="cb60-1016"><a href="#cb60-1016" aria-hidden="true" tabindex="-1"></a><span class="in">    is_balanced &lt;- parameters[4]</span></span>
<span id="cb60-1017"><a href="#cb60-1017" aria-hidden="true" tabindex="-1"></a><span class="in">    fml_formula &lt;- parameters[5]</span></span>
<span id="cb60-1018"><a href="#cb60-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1019"><a href="#cb60-1019" aria-hidden="true" tabindex="-1"></a><span class="in">    ## data:</span></span>
<span id="cb60-1020"><a href="#cb60-1020" aria-hidden="true" tabindex="-1"></a><span class="in">    if (is_balanced == TRUE) {</span></span>
<span id="cb60-1021"><a href="#cb60-1021" aria-hidden="true" tabindex="-1"></a><span class="in">      data &lt;- data_did_loop_balanced</span></span>
<span id="cb60-1022"><a href="#cb60-1022" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb60-1023"><a href="#cb60-1023" aria-hidden="true" tabindex="-1"></a><span class="in">      data &lt;- data_did_loop</span></span>
<span id="cb60-1024"><a href="#cb60-1024" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb60-1025"><a href="#cb60-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1026"><a href="#cb60-1026" aria-hidden="true" tabindex="-1"></a><span class="in">    ## regression:</span></span>
<span id="cb60-1027"><a href="#cb60-1027" aria-hidden="true" tabindex="-1"></a><span class="in">    did_model &lt;- fixest::feols(fml = formula(fml_formula),</span></span>
<span id="cb60-1028"><a href="#cb60-1028" aria-hidden="true" tabindex="-1"></a><span class="in">                  data = data,</span></span>
<span id="cb60-1029"><a href="#cb60-1029" aria-hidden="true" tabindex="-1"></a><span class="in">                  cluster = c("gvkey", "ff_30ind_name")</span></span>
<span id="cb60-1030"><a href="#cb60-1030" aria-hidden="true" tabindex="-1"></a><span class="in">                  )</span></span>
<span id="cb60-1031"><a href="#cb60-1031" aria-hidden="true" tabindex="-1"></a><span class="in">    return(did_model)</span></span>
<span id="cb60-1032"><a href="#cb60-1032" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb60-1033"><a href="#cb60-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1034"><a href="#cb60-1034" aria-hidden="true" tabindex="-1"></a><span class="in">### DiD result using post-:</span></span>
<span id="cb60-1035"><a href="#cb60-1035" aria-hidden="true" tabindex="-1"></a><span class="in">fml_results %&gt;%</span></span>
<span id="cb60-1036"><a href="#cb60-1036" aria-hidden="true" tabindex="-1"></a><span class="in">  `names&lt;-`(value = unlist(fml_parameters[,1])) %&gt;%</span></span>
<span id="cb60-1037"><a href="#cb60-1037" aria-hidden="true" tabindex="-1"></a><span class="in">  etable(</span></span>
<span id="cb60-1038"><a href="#cb60-1038" aria-hidden="true" tabindex="-1"></a><span class="in">    order = "post",</span></span>
<span id="cb60-1039"><a href="#cb60-1039" aria-hidden="true" tabindex="-1"></a><span class="in">    # keep = "post",</span></span>
<span id="cb60-1040"><a href="#cb60-1040" aria-hidden="true" tabindex="-1"></a><span class="in">    extralines = list(</span></span>
<span id="cb60-1041"><a href="#cb60-1041" aria-hidden="true" tabindex="-1"></a><span class="in">      ## Controls:</span></span>
<span id="cb60-1042"><a href="#cb60-1042" aria-hidden="true" tabindex="-1"></a><span class="in">      "^_Controls" = ifelse(unlist(fml_parameters[,3]), yes = "Yes", no = "No"),</span></span>
<span id="cb60-1043"><a href="#cb60-1043" aria-hidden="true" tabindex="-1"></a><span class="in">      ## the identity of the sample:</span></span>
<span id="cb60-1044"><a href="#cb60-1044" aria-hidden="true" tabindex="-1"></a><span class="in">      "__Sample" = ifelse(unlist(fml_parameters[,4]), yes = "Balanced Panel", no = "Full Sample") # whether used a balanced panel or a full sample.</span></span>
<span id="cb60-1045"><a href="#cb60-1045" aria-hidden="true" tabindex="-1"></a><span class="in">  )) %&gt;%</span></span>
<span id="cb60-1046"><a href="#cb60-1046" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::kable(format = "html", caption = paste("DiD Results with `", intensity_measure_name, "`", sep = "")) %&gt;%</span></span>
<span id="cb60-1047"><a href="#cb60-1047" aria-hidden="true" tabindex="-1"></a><span class="in">  kableExtra::kable_styling(</span></span>
<span id="cb60-1048"><a href="#cb60-1048" aria-hidden="true" tabindex="-1"></a><span class="in">    font_size = 8,       # Smaller font (default is 16px)</span></span>
<span id="cb60-1049"><a href="#cb60-1049" aria-hidden="true" tabindex="-1"></a><span class="in">    full_width = FALSE,   # Table width fits content</span></span>
<span id="cb60-1050"><a href="#cb60-1050" aria-hidden="true" tabindex="-1"></a><span class="in">    bootstrap_options = c("striped", "condensed")</span></span>
<span id="cb60-1051"><a href="#cb60-1051" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-1052"><a href="#cb60-1052" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1053"><a href="#cb60-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1054"><a href="#cb60-1054" aria-hidden="true" tabindex="-1"></a>From the table results using <span class="in">`land_intensity`</span>, the treatment effect is indifferent from zero if using the intensity measure and the it is significantly negative if we use the treatment dummy, which is one if the intensity is positive and zero otherwise.</span>
<span id="cb60-1055"><a href="#cb60-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1056"><a href="#cb60-1056" aria-hidden="true" tabindex="-1"></a>DiD plot:</span>
<span id="cb60-1057"><a href="#cb60-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1058"><a href="#cb60-1058" aria-hidden="true" tabindex="-1"></a><span class="in">```{r s3c-did-plot, echo=TRUE}</span></span>
<span id="cb60-1059"><a href="#cb60-1059" aria-hidden="true" tabindex="-1"></a><span class="in">## create the combinations of parameters:</span></span>
<span id="cb60-1060"><a href="#cb60-1060" aria-hidden="true" tabindex="-1"></a><span class="in">fml_parameters &lt;- expand_grid(</span></span>
<span id="cb60-1061"><a href="#cb60-1061" aria-hidden="true" tabindex="-1"></a><span class="in">  choice_treatment = c("intensity_2000", "treated"), # what is the treatment measure: continuous/binary</span></span>
<span id="cb60-1062"><a href="#cb60-1062" aria-hidden="true" tabindex="-1"></a><span class="in">  controls_inclusion = c(FALSE, TRUE),# whether to include controls</span></span>
<span id="cb60-1063"><a href="#cb60-1063" aria-hidden="true" tabindex="-1"></a><span class="in">  balanced_panel = c(FALSE, TRUE), # whether keep a balanced panel</span></span>
<span id="cb60-1064"><a href="#cb60-1064" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;%</span></span>
<span id="cb60-1065"><a href="#cb60-1065" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(balanced_panel) %&gt;%</span></span>
<span id="cb60-1066"><a href="#cb60-1066" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind.data.frame(.,</span></span>
<span id="cb60-1067"><a href="#cb60-1067" aria-hidden="true" tabindex="-1"></a><span class="in">    fml = apply(X = ., MARGIN = 1, FUN = function(parameters) {</span></span>
<span id="cb60-1068"><a href="#cb60-1068" aria-hidden="true" tabindex="-1"></a><span class="in">      ## parameters:</span></span>
<span id="cb60-1069"><a href="#cb60-1069" aria-hidden="true" tabindex="-1"></a><span class="in">      choice_treatment &lt;- parameters[1]</span></span>
<span id="cb60-1070"><a href="#cb60-1070" aria-hidden="true" tabindex="-1"></a><span class="in">      add_controls &lt;- parameters[2]</span></span>
<span id="cb60-1071"><a href="#cb60-1071" aria-hidden="true" tabindex="-1"></a><span class="in">      is_balanced &lt;- parameters[3]</span></span>
<span id="cb60-1072"><a href="#cb60-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1073"><a href="#cb60-1073" aria-hidden="true" tabindex="-1"></a><span class="in">      ## inputs:</span></span>
<span id="cb60-1074"><a href="#cb60-1074" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_base &lt;- paste("book_leverage ~ i(indexyear, ", choice_treatment, ", ref = -1)", sep = "") # the baseline model</span></span>
<span id="cb60-1075"><a href="#cb60-1075" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_base_controls &lt;- " + roa + ebitda_at + log(at_thousand) + altman_Z + tangibility + current_ratio" # the potential controls</span></span>
<span id="cb60-1076"><a href="#cb60-1076" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_base_fe &lt;- " | gvkey + indexyear + ff_30ind_name^indexyear" # fixed effects</span></span>
<span id="cb60-1077"><a href="#cb60-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1078"><a href="#cb60-1078" aria-hidden="true" tabindex="-1"></a><span class="in">      ## output formula:</span></span>
<span id="cb60-1079"><a href="#cb60-1079" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_output &lt;- paste(</span></span>
<span id="cb60-1080"><a href="#cb60-1080" aria-hidden="true" tabindex="-1"></a><span class="in">        fml_base,</span></span>
<span id="cb60-1081"><a href="#cb60-1081" aria-hidden="true" tabindex="-1"></a><span class="in">        ifelse(add_controls == TRUE, yes = fml_base_controls, no = ""),</span></span>
<span id="cb60-1082"><a href="#cb60-1082" aria-hidden="true" tabindex="-1"></a><span class="in">        fml_base_fe,</span></span>
<span id="cb60-1083"><a href="#cb60-1083" aria-hidden="true" tabindex="-1"></a><span class="in">        sep = ""</span></span>
<span id="cb60-1084"><a href="#cb60-1084" aria-hidden="true" tabindex="-1"></a><span class="in">      )</span></span>
<span id="cb60-1085"><a href="#cb60-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1086"><a href="#cb60-1086" aria-hidden="true" tabindex="-1"></a><span class="in">      return(fml_output)</span></span>
<span id="cb60-1087"><a href="#cb60-1087" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb60-1088"><a href="#cb60-1088" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb60-1089"><a href="#cb60-1089" aria-hidden="true" tabindex="-1"></a><span class="in">  as_tibble() %&gt;%</span></span>
<span id="cb60-1090"><a href="#cb60-1090" aria-hidden="true" tabindex="-1"></a><span class="in">  ## assign a name for each regression:</span></span>
<span id="cb60-1091"><a href="#cb60-1091" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(name = paste("(", letters[1:nrow(.)], ")", sep = "")) %&gt;%</span></span>
<span id="cb60-1092"><a href="#cb60-1092" aria-hidden="true" tabindex="-1"></a><span class="in">  select(name, everything())</span></span>
<span id="cb60-1093"><a href="#cb60-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1094"><a href="#cb60-1094" aria-hidden="true" tabindex="-1"></a><span class="in">fml_parameters</span></span>
<span id="cb60-1095"><a href="#cb60-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1096"><a href="#cb60-1096" aria-hidden="true" tabindex="-1"></a><span class="in">## construct the data used for the loop:</span></span>
<span id="cb60-1097"><a href="#cb60-1097" aria-hidden="true" tabindex="-1"></a><span class="in">data_did_loop &lt;- data_did %&gt;%</span></span>
<span id="cb60-1098"><a href="#cb60-1098" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;%</span></span>
<span id="cb60-1099"><a href="#cb60-1099" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb60-1100"><a href="#cb60-1100" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb60-1101"><a href="#cb60-1101" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, fyear, indexyear, intensity_2000, post_2005,</span></span>
<span id="cb60-1102"><a href="#cb60-1102" aria-hidden="true" tabindex="-1"></a><span class="in">         book_leverage, debt_ebitda, sic, ff_30ind_name,</span></span>
<span id="cb60-1103"><a href="#cb60-1103" aria-hidden="true" tabindex="-1"></a><span class="in">         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span></span>
<span id="cb60-1104"><a href="#cb60-1104" aria-hidden="true" tabindex="-1"></a><span class="in">         altman_Z, kz, market_book, tangibility, current_ratio) %&gt;%</span></span>
<span id="cb60-1105"><a href="#cb60-1105" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= period_start - n_pre &amp; fyear &lt;= period_end) %&gt;%</span></span>
<span id="cb60-1106"><a href="#cb60-1106" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(intensity_2000) &amp; !is.na(at)) %&gt;%</span></span>
<span id="cb60-1107"><a href="#cb60-1107" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-1108"><a href="#cb60-1108" aria-hidden="true" tabindex="-1"></a><span class="in">    gvkey = as.factor(gvkey),</span></span>
<span id="cb60-1109"><a href="#cb60-1109" aria-hidden="true" tabindex="-1"></a><span class="in">    fyear = as.factor(fyear),</span></span>
<span id="cb60-1110"><a href="#cb60-1110" aria-hidden="true" tabindex="-1"></a><span class="in">    # treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb60-1111"><a href="#cb60-1111" aria-hidden="true" tabindex="-1"></a><span class="in">    treated = ifelse(intensity_2000 &gt; 0, 1, 0),</span></span>
<span id="cb60-1112"><a href="#cb60-1112" aria-hidden="true" tabindex="-1"></a><span class="in">    ebitda_at = ebitda / at,</span></span>
<span id="cb60-1113"><a href="#cb60-1113" aria-hidden="true" tabindex="-1"></a><span class="in">    at_thousand = at * 10^-3,</span></span>
<span id="cb60-1114"><a href="#cb60-1114" aria-hidden="true" tabindex="-1"></a><span class="in">    large = ifelse(large, yes = "Large", no = "Small"),</span></span>
<span id="cb60-1115"><a href="#cb60-1115" aria-hidden="true" tabindex="-1"></a><span class="in">    tangiblity_exbnl = tangibility - bnl_intensity,</span></span>
<span id="cb60-1116"><a href="#cb60-1116" aria-hidden="true" tabindex="-1"></a><span class="in">    bnl = bnl_intensity * at,</span></span>
<span id="cb60-1117"><a href="#cb60-1117" aria-hidden="true" tabindex="-1"></a><span class="in">    # large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb60-1118"><a href="#cb60-1118" aria-hidden="true" tabindex="-1"></a><span class="in">    treated_large = paste(treated, large, sep = "_")</span></span>
<span id="cb60-1119"><a href="#cb60-1119" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-1120"><a href="#cb60-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1121"><a href="#cb60-1121" aria-hidden="true" tabindex="-1"></a><span class="in">data_did_loop_balanced &lt;- data_did %&gt;%</span></span>
<span id="cb60-1122"><a href="#cb60-1122" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;%</span></span>
<span id="cb60-1123"><a href="#cb60-1123" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb60-1124"><a href="#cb60-1124" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb60-1125"><a href="#cb60-1125" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, fyear, indexyear, intensity_2000, post_2005,</span></span>
<span id="cb60-1126"><a href="#cb60-1126" aria-hidden="true" tabindex="-1"></a><span class="in">         book_leverage, debt_ebitda, sic, ff_30ind_name,</span></span>
<span id="cb60-1127"><a href="#cb60-1127" aria-hidden="true" tabindex="-1"></a><span class="in">         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span></span>
<span id="cb60-1128"><a href="#cb60-1128" aria-hidden="true" tabindex="-1"></a><span class="in">         altman_Z, kz, market_book, tangibility, current_ratio) %&gt;%</span></span>
<span id="cb60-1129"><a href="#cb60-1129" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= period_start - n_pre &amp; fyear &lt;= period_end) %&gt;%</span></span>
<span id="cb60-1130"><a href="#cb60-1130" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(intensity_2000) &amp; !is.na(at)) %&gt;%</span></span>
<span id="cb60-1131"><a href="#cb60-1131" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-1132"><a href="#cb60-1132" aria-hidden="true" tabindex="-1"></a><span class="in">    gvkey = as.factor(gvkey),</span></span>
<span id="cb60-1133"><a href="#cb60-1133" aria-hidden="true" tabindex="-1"></a><span class="in">    fyear = as.factor(fyear),</span></span>
<span id="cb60-1134"><a href="#cb60-1134" aria-hidden="true" tabindex="-1"></a><span class="in">    # treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb60-1135"><a href="#cb60-1135" aria-hidden="true" tabindex="-1"></a><span class="in">    treated = ifelse(intensity_2000 &gt; 0, 1, 0),</span></span>
<span id="cb60-1136"><a href="#cb60-1136" aria-hidden="true" tabindex="-1"></a><span class="in">    ebitda_at = ebitda / at,</span></span>
<span id="cb60-1137"><a href="#cb60-1137" aria-hidden="true" tabindex="-1"></a><span class="in">    at_thousand = at * 10^-3,</span></span>
<span id="cb60-1138"><a href="#cb60-1138" aria-hidden="true" tabindex="-1"></a><span class="in">    large = ifelse(large, yes = "Large", no = "Small"),</span></span>
<span id="cb60-1139"><a href="#cb60-1139" aria-hidden="true" tabindex="-1"></a><span class="in">    tangiblity_exbnl = tangibility - bnl_intensity,</span></span>
<span id="cb60-1140"><a href="#cb60-1140" aria-hidden="true" tabindex="-1"></a><span class="in">    bnl = bnl_intensity * at,</span></span>
<span id="cb60-1141"><a href="#cb60-1141" aria-hidden="true" tabindex="-1"></a><span class="in">    # large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb60-1142"><a href="#cb60-1142" aria-hidden="true" tabindex="-1"></a><span class="in">    treated_large = paste(treated, large, sep = "_")</span></span>
<span id="cb60-1143"><a href="#cb60-1143" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-1144"><a href="#cb60-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1145"><a href="#cb60-1145" aria-hidden="true" tabindex="-1"></a><span class="in">## store all results</span></span>
<span id="cb60-1146"><a href="#cb60-1146" aria-hidden="true" tabindex="-1"></a><span class="in">fml_results &lt;- fml_parameters %&gt;%</span></span>
<span id="cb60-1147"><a href="#cb60-1147" aria-hidden="true" tabindex="-1"></a><span class="in">  apply(MARGIN = 1, FUN = function(parameters) {</span></span>
<span id="cb60-1148"><a href="#cb60-1148" aria-hidden="true" tabindex="-1"></a><span class="in">    ## parameters:</span></span>
<span id="cb60-1149"><a href="#cb60-1149" aria-hidden="true" tabindex="-1"></a><span class="in">    is_balanced &lt;- parameters[4]</span></span>
<span id="cb60-1150"><a href="#cb60-1150" aria-hidden="true" tabindex="-1"></a><span class="in">    fml_formula &lt;- parameters[5]</span></span>
<span id="cb60-1151"><a href="#cb60-1151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1152"><a href="#cb60-1152" aria-hidden="true" tabindex="-1"></a><span class="in">    ## data:</span></span>
<span id="cb60-1153"><a href="#cb60-1153" aria-hidden="true" tabindex="-1"></a><span class="in">    if (is_balanced == TRUE) {</span></span>
<span id="cb60-1154"><a href="#cb60-1154" aria-hidden="true" tabindex="-1"></a><span class="in">      data &lt;- data_did_loop_balanced</span></span>
<span id="cb60-1155"><a href="#cb60-1155" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb60-1156"><a href="#cb60-1156" aria-hidden="true" tabindex="-1"></a><span class="in">      data &lt;- data_did_loop</span></span>
<span id="cb60-1157"><a href="#cb60-1157" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb60-1158"><a href="#cb60-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1159"><a href="#cb60-1159" aria-hidden="true" tabindex="-1"></a><span class="in">    ## regression:</span></span>
<span id="cb60-1160"><a href="#cb60-1160" aria-hidden="true" tabindex="-1"></a><span class="in">    did_model &lt;- fixest::feols(fml = formula(fml_formula),</span></span>
<span id="cb60-1161"><a href="#cb60-1161" aria-hidden="true" tabindex="-1"></a><span class="in">                  data = data,</span></span>
<span id="cb60-1162"><a href="#cb60-1162" aria-hidden="true" tabindex="-1"></a><span class="in">                  cluster = c("gvkey", "ff_30ind_name")</span></span>
<span id="cb60-1163"><a href="#cb60-1163" aria-hidden="true" tabindex="-1"></a><span class="in">                  )</span></span>
<span id="cb60-1164"><a href="#cb60-1164" aria-hidden="true" tabindex="-1"></a><span class="in">    return(did_model)</span></span>
<span id="cb60-1165"><a href="#cb60-1165" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb60-1166"><a href="#cb60-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1167"><a href="#cb60-1167" aria-hidden="true" tabindex="-1"></a><span class="in">### create the table:</span></span>
<span id="cb60-1168"><a href="#cb60-1168" aria-hidden="true" tabindex="-1"></a><span class="in">fml_results %&gt;%</span></span>
<span id="cb60-1169"><a href="#cb60-1169" aria-hidden="true" tabindex="-1"></a><span class="in">  `names&lt;-`(value = unlist(fml_parameters[,1])) %&gt;%</span></span>
<span id="cb60-1170"><a href="#cb60-1170" aria-hidden="true" tabindex="-1"></a><span class="in">  etable(</span></span>
<span id="cb60-1171"><a href="#cb60-1171" aria-hidden="true" tabindex="-1"></a><span class="in">    order = "indexyear",</span></span>
<span id="cb60-1172"><a href="#cb60-1172" aria-hidden="true" tabindex="-1"></a><span class="in">    # keep = "post",</span></span>
<span id="cb60-1173"><a href="#cb60-1173" aria-hidden="true" tabindex="-1"></a><span class="in">    extralines = list(</span></span>
<span id="cb60-1174"><a href="#cb60-1174" aria-hidden="true" tabindex="-1"></a><span class="in">      ## Controls:</span></span>
<span id="cb60-1175"><a href="#cb60-1175" aria-hidden="true" tabindex="-1"></a><span class="in">      "^_Controls" = ifelse(unlist(fml_parameters[,3]), yes = "Yes", no = "No"),</span></span>
<span id="cb60-1176"><a href="#cb60-1176" aria-hidden="true" tabindex="-1"></a><span class="in">      ## the identity of the sample:</span></span>
<span id="cb60-1177"><a href="#cb60-1177" aria-hidden="true" tabindex="-1"></a><span class="in">      "__Sample" = ifelse(unlist(fml_parameters[,4]), yes = "Balanced Panel", no = "Full Sample") # whether used a balanced panel or a full sample.</span></span>
<span id="cb60-1178"><a href="#cb60-1178" aria-hidden="true" tabindex="-1"></a><span class="in">  )) %&gt;%</span></span>
<span id="cb60-1179"><a href="#cb60-1179" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::kable(format = "html", caption = paste("DiD Results with `", intensity_measure_name, "`", sep = "")) %&gt;%</span></span>
<span id="cb60-1180"><a href="#cb60-1180" aria-hidden="true" tabindex="-1"></a><span class="in">  kableExtra::kable_styling(</span></span>
<span id="cb60-1181"><a href="#cb60-1181" aria-hidden="true" tabindex="-1"></a><span class="in">    font_size = 8,       # Smaller font (default is 16px)</span></span>
<span id="cb60-1182"><a href="#cb60-1182" aria-hidden="true" tabindex="-1"></a><span class="in">    full_width = FALSE,   # Table width fits content</span></span>
<span id="cb60-1183"><a href="#cb60-1183" aria-hidden="true" tabindex="-1"></a><span class="in">    bootstrap_options = c("striped", "condensed")</span></span>
<span id="cb60-1184"><a href="#cb60-1184" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-1185"><a href="#cb60-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1186"><a href="#cb60-1186" aria-hidden="true" tabindex="-1"></a><span class="in">### create the plots:</span></span>
<span id="cb60-1187"><a href="#cb60-1187" aria-hidden="true" tabindex="-1"></a><span class="in"># fml_parameters[which(unlist(fml_parameters$balanced_panel)), ]</span></span>
<span id="cb60-1188"><a href="#cb60-1188" aria-hidden="true" tabindex="-1"></a><span class="in">fml_results[which(unlist(fml_parameters$balanced_panel))] %&gt;% # choose the balanced panel</span></span>
<span id="cb60-1189"><a href="#cb60-1189" aria-hidden="true" tabindex="-1"></a><span class="in">  iplot(.,</span></span>
<span id="cb60-1190"><a href="#cb60-1190" aria-hidden="true" tabindex="-1"></a><span class="in">        xlab = paste("Time to treatment (Year; 0 = ", base_year, ")", sep = ""),</span></span>
<span id="cb60-1191"><a href="#cb60-1191" aria-hidden="true" tabindex="-1"></a><span class="in">        main = paste("Treatment Effects by fiscal year: `", intensity_measure_name, "`", sep = ""),</span></span>
<span id="cb60-1192"><a href="#cb60-1192" aria-hidden="true" tabindex="-1"></a><span class="in">        sub = "Data: Balanced Panel",</span></span>
<span id="cb60-1193"><a href="#cb60-1193" aria-hidden="true" tabindex="-1"></a><span class="in">        ref.line = FALSE,</span></span>
<span id="cb60-1194"><a href="#cb60-1194" aria-hidden="true" tabindex="-1"></a><span class="in">        ref.line.par = list(col = "red", lty = 2),</span></span>
<span id="cb60-1195"><a href="#cb60-1195" aria-hidden="true" tabindex="-1"></a><span class="in">        pt.join = FALSE,</span></span>
<span id="cb60-1196"><a href="#cb60-1196" aria-hidden="true" tabindex="-1"></a><span class="in">        xlim = c(-3.5, 3.5)</span></span>
<span id="cb60-1197"><a href="#cb60-1197" aria-hidden="true" tabindex="-1"></a><span class="in">        ); axis(1, at = -3:3); abline(v = 0.5, col = "red", lty = 2, lwd = 3); legend('bottomleft', bty = "n", col = c(1, 2, 3, 4), pch = c(20, 17, 15, 21), legend = c('intensity', 'intensity + controls', 'dummy', 'dummy + controls'));</span></span>
<span id="cb60-1198"><a href="#cb60-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1199"><a href="#cb60-1199" aria-hidden="true" tabindex="-1"></a><span class="in">fml_results[which(!unlist(fml_parameters$balanced_panel))] %&gt;% # choose full sample</span></span>
<span id="cb60-1200"><a href="#cb60-1200" aria-hidden="true" tabindex="-1"></a><span class="in">  iplot(.,</span></span>
<span id="cb60-1201"><a href="#cb60-1201" aria-hidden="true" tabindex="-1"></a><span class="in">        xlab = paste("Time to treatment (Year; 0 = ", base_year, ")", sep = ""),</span></span>
<span id="cb60-1202"><a href="#cb60-1202" aria-hidden="true" tabindex="-1"></a><span class="in">        main = paste("Treatment Effect by fiscal year: `", intensity_measure_name, "`", sep = ""),</span></span>
<span id="cb60-1203"><a href="#cb60-1203" aria-hidden="true" tabindex="-1"></a><span class="in">        sub = "Data: Full Sample",</span></span>
<span id="cb60-1204"><a href="#cb60-1204" aria-hidden="true" tabindex="-1"></a><span class="in">        ref.line = FALSE,</span></span>
<span id="cb60-1205"><a href="#cb60-1205" aria-hidden="true" tabindex="-1"></a><span class="in">        ref.line.par = list(col = "red", lty = 2),</span></span>
<span id="cb60-1206"><a href="#cb60-1206" aria-hidden="true" tabindex="-1"></a><span class="in">        pt.join = FALSE,</span></span>
<span id="cb60-1207"><a href="#cb60-1207" aria-hidden="true" tabindex="-1"></a><span class="in">        xlim = c(-3.5, 3.5)</span></span>
<span id="cb60-1208"><a href="#cb60-1208" aria-hidden="true" tabindex="-1"></a><span class="in">        ); axis(1, at = -3:3); abline(v = 0.5, col = "red", lty = 2, lwd = 3); legend('bottomleft', bty = "n", col = c(1, 2, 3, 4), pch = c(20, 17, 15, 21), legend = c('intensity', 'intensity + controls', 'dummy', 'dummy + controls'))</span></span>
<span id="cb60-1209"><a href="#cb60-1209" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1210"><a href="#cb60-1210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1211"><a href="#cb60-1211" aria-hidden="true" tabindex="-1"></a>Results using <span class="in">`land_intensity`</span> are much noisier. The treatment effects are indifferent from zero when using the intensity measure and are negative when using the treatment dummy. However, there seems to be a pre-trend before the time of treatment. This is further shown in the plots.</span>
<span id="cb60-1212"><a href="#cb60-1212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1213"><a href="#cb60-1213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1214"><a href="#cb60-1214" aria-hidden="true" tabindex="-1"></a><span class="fu">### s3.4. builindg and land intensity {#sec-s3c-building-and-land-intensity}</span></span>
<span id="cb60-1215"><a href="#cb60-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1216"><a href="#cb60-1216" aria-hidden="true" tabindex="-1"></a><span class="in">`bnl_intensity`</span> is chosen to measure a firm's long-term exposure to buildings, land and their improvements at cost under the PPE.</span>
<span id="cb60-1217"><a href="#cb60-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1218"><a href="#cb60-1218" aria-hidden="true" tabindex="-1"></a><span class="in">```{r s3d-did-data, echo=TRUE, results='hold'}</span></span>
<span id="cb60-1219"><a href="#cb60-1219" aria-hidden="true" tabindex="-1"></a><span class="in">## choose the group definition:</span></span>
<span id="cb60-1220"><a href="#cb60-1220" aria-hidden="true" tabindex="-1"></a><span class="in">intensity_measure_name &lt;- candidate_intensity_measure[5]</span></span>
<span id="cb60-1221"><a href="#cb60-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1222"><a href="#cb60-1222" aria-hidden="true" tabindex="-1"></a><span class="in">data_firm &lt;- data %&gt;%</span></span>
<span id="cb60-1223"><a href="#cb60-1223" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear == intensity_measure_year) %&gt;% # use `fyear` may create multiple observations for the same firm. E.g. filter(gvkey == 23535, dyear == 2005)</span></span>
<span id="cb60-1224"><a href="#cb60-1224" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(fyear) %&gt;%</span></span>
<span id="cb60-1225"><a href="#cb60-1225" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-1226"><a href="#cb60-1226" aria-hidden="true" tabindex="-1"></a><span class="in">    median_at = median(at, na.rm = TRUE),</span></span>
<span id="cb60-1227"><a href="#cb60-1227" aria-hidden="true" tabindex="-1"></a><span class="in">    # median_cf = median(debt_ebitda, na.rm = TRUE)</span></span>
<span id="cb60-1228"><a href="#cb60-1228" aria-hidden="true" tabindex="-1"></a><span class="in">    ) %&gt;%</span></span>
<span id="cb60-1229"><a href="#cb60-1229" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;%</span></span>
<span id="cb60-1230"><a href="#cb60-1230" aria-hidden="true" tabindex="-1"></a><span class="in">  ## different grouping variables in DDD analysis:</span></span>
<span id="cb60-1231"><a href="#cb60-1231" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-1232"><a href="#cb60-1232" aria-hidden="true" tabindex="-1"></a><span class="in">    large = ifelse(at &gt; median_at, 1, 0),</span></span>
<span id="cb60-1233"><a href="#cb60-1233" aria-hidden="true" tabindex="-1"></a><span class="in">    # tangible = ifelse(tangibility &gt; 0, yes = "tangible", no = "non-tangible"),</span></span>
<span id="cb60-1234"><a href="#cb60-1234" aria-hidden="true" tabindex="-1"></a><span class="in">    # high_cf = ifelse(debt_ebitda &lt; median_cf, yes = "high CF", no = "low CF")</span></span>
<span id="cb60-1235"><a href="#cb60-1235" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb60-1236"><a href="#cb60-1236" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, intensity_2000 = all_of(intensity_measure_name), large)</span></span>
<span id="cb60-1237"><a href="#cb60-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1238"><a href="#cb60-1238" aria-hidden="true" tabindex="-1"></a><span class="in">data_did &lt;- data %&gt;%</span></span>
<span id="cb60-1239"><a href="#cb60-1239" aria-hidden="true" tabindex="-1"></a><span class="in">  ## merge the grouping variable</span></span>
<span id="cb60-1240"><a href="#cb60-1240" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(y = data_firm, by = join_by(gvkey) ) %&gt;%</span></span>
<span id="cb60-1241"><a href="#cb60-1241" aria-hidden="true" tabindex="-1"></a><span class="in">  ## merge the FF 30 industry classifiaction</span></span>
<span id="cb60-1242"><a href="#cb60-1242" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(y = FF_30ind, by = join_by(sic)) %&gt;%</span></span>
<span id="cb60-1243"><a href="#cb60-1243" aria-hidden="true" tabindex="-1"></a><span class="in">  ## exclude certain industries</span></span>
<span id="cb60-1244"><a href="#cb60-1244" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(</span></span>
<span id="cb60-1245"><a href="#cb60-1245" aria-hidden="true" tabindex="-1"></a><span class="in">    ff_30ind != 20, # exclude Utiltiy (number 20)</span></span>
<span id="cb60-1246"><a href="#cb60-1246" aria-hidden="true" tabindex="-1"></a><span class="in">    !(sic &gt;= 6000 &amp; sic &lt;= 6199) # exclude banks under Banking, Insurance, Real Estate, Trading (number 29)</span></span>
<span id="cb60-1247"><a href="#cb60-1247" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb60-1248"><a href="#cb60-1248" aria-hidden="true" tabindex="-1"></a><span class="in">  ## pre- &amp; post-</span></span>
<span id="cb60-1249"><a href="#cb60-1249" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-1250"><a href="#cb60-1250" aria-hidden="true" tabindex="-1"></a><span class="in">    indexyear = (fyear - base_year), # year index with 2005 as base 0.</span></span>
<span id="cb60-1251"><a href="#cb60-1251" aria-hidden="true" tabindex="-1"></a><span class="in">    post_2005 = as.numeric(fyear &gt; base_year)  # whether it is after the 2005 reform</span></span>
<span id="cb60-1252"><a href="#cb60-1252" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-1253"><a href="#cb60-1253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1254"><a href="#cb60-1254" aria-hidden="true" tabindex="-1"></a><span class="in">## gvkey(s) for balanced panel":</span></span>
<span id="cb60-1255"><a href="#cb60-1255" aria-hidden="true" tabindex="-1"></a><span class="in">data_did_balanced_id &lt;- data_did %&gt;%</span></span>
<span id="cb60-1256"><a href="#cb60-1256" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;%</span></span>
<span id="cb60-1257"><a href="#cb60-1257" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= period_start - n_pre &amp; fyear &lt;= period_end) %&gt;%</span></span>
<span id="cb60-1258"><a href="#cb60-1258" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(gvkey) %&gt;%</span></span>
<span id="cb60-1259"><a href="#cb60-1259" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(count_obs = sum(!is.na(book_leverage) &amp; !is.na(intensity_2000))) %&gt;%</span></span>
<span id="cb60-1260"><a href="#cb60-1260" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;%</span></span>
<span id="cb60-1261"><a href="#cb60-1261" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(count_obs == period_end - period_start + 1 + n_pre) %&gt;%</span></span>
<span id="cb60-1262"><a href="#cb60-1262" aria-hidden="true" tabindex="-1"></a><span class="in">  .$gvkey</span></span>
<span id="cb60-1263"><a href="#cb60-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1264"><a href="#cb60-1264" aria-hidden="true" tabindex="-1"></a><span class="in">data_intensity_panel &lt;- data %&gt;%</span></span>
<span id="cb60-1265"><a href="#cb60-1265" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &lt; 2007) %&gt;%</span></span>
<span id="cb60-1266"><a href="#cb60-1266" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, fyear, all_of(intensity_measure_name)) %&gt;%</span></span>
<span id="cb60-1267"><a href="#cb60-1267" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_wider(names_from = fyear, values_from = all_of(intensity_measure_name))</span></span>
<span id="cb60-1268"><a href="#cb60-1268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1269"><a href="#cb60-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1270"><a href="#cb60-1270" aria-hidden="true" tabindex="-1"></a>DiD Analysis:</span>
<span id="cb60-1271"><a href="#cb60-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1272"><a href="#cb60-1272" aria-hidden="true" tabindex="-1"></a>In this part of the analysis, I also added the firm-year controls in the DiD and triple difference analyses. The first is called <span class="in">`àt_thousand`</span>, which is the total asset of firm $i$ in fiscal year $t$ in thousand of dollars. The second is the <span class="in">`ebitda_at`</span>, which is the EBITDA of firm $i$ in fiscal year $t$ divided by its total asset. Adding both controls positively correlated with the book leverage, they do not have a significant impact on the coefficient estimate of interest, which is the coefficient on <span class="in">`treated x post_2005`</span> and <span class="in">`intensity_2000 x post_2005`</span>.</span>
<span id="cb60-1273"><a href="#cb60-1273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1274"><a href="#cb60-1274" aria-hidden="true" tabindex="-1"></a><span class="in">```{r s3d-did-test, echo=TRUE, warning=FALSE, message=FALSE, results='hold'}</span></span>
<span id="cb60-1275"><a href="#cb60-1275" aria-hidden="true" tabindex="-1"></a><span class="in">cat(intensity_measure_name); cat(": \n");</span></span>
<span id="cb60-1276"><a href="#cb60-1276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1277"><a href="#cb60-1277" aria-hidden="true" tabindex="-1"></a><span class="in">## create the combinations of parameters:</span></span>
<span id="cb60-1278"><a href="#cb60-1278" aria-hidden="true" tabindex="-1"></a><span class="in">fml_parameters &lt;- expand_grid(</span></span>
<span id="cb60-1279"><a href="#cb60-1279" aria-hidden="true" tabindex="-1"></a><span class="in">  choice_treatment = c("intensity_2000", "treated"), # what is the treatment measure: continuous/binary</span></span>
<span id="cb60-1280"><a href="#cb60-1280" aria-hidden="true" tabindex="-1"></a><span class="in">  controls_inclusion = c(FALSE, TRUE),# whether to include controls</span></span>
<span id="cb60-1281"><a href="#cb60-1281" aria-hidden="true" tabindex="-1"></a><span class="in">  balanced_panel = c(FALSE, TRUE), # whether keep a balanced panel</span></span>
<span id="cb60-1282"><a href="#cb60-1282" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;%</span></span>
<span id="cb60-1283"><a href="#cb60-1283" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(balanced_panel) %&gt;%</span></span>
<span id="cb60-1284"><a href="#cb60-1284" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind.data.frame(.,</span></span>
<span id="cb60-1285"><a href="#cb60-1285" aria-hidden="true" tabindex="-1"></a><span class="in">    fml = apply(X = ., MARGIN = 1, FUN = function(parameters) {</span></span>
<span id="cb60-1286"><a href="#cb60-1286" aria-hidden="true" tabindex="-1"></a><span class="in">      ## parameters:</span></span>
<span id="cb60-1287"><a href="#cb60-1287" aria-hidden="true" tabindex="-1"></a><span class="in">      choice_treatment &lt;- parameters[1]</span></span>
<span id="cb60-1288"><a href="#cb60-1288" aria-hidden="true" tabindex="-1"></a><span class="in">      add_controls &lt;- parameters[2]</span></span>
<span id="cb60-1289"><a href="#cb60-1289" aria-hidden="true" tabindex="-1"></a><span class="in">      is_balanced &lt;- parameters[3]</span></span>
<span id="cb60-1290"><a href="#cb60-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1291"><a href="#cb60-1291" aria-hidden="true" tabindex="-1"></a><span class="in">      ## inputs:</span></span>
<span id="cb60-1292"><a href="#cb60-1292" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_base &lt;- paste("book_leverage ~ post_2005*", choice_treatment, sep = "") # the baseline model</span></span>
<span id="cb60-1293"><a href="#cb60-1293" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_base_controls &lt;- " + roa + ebitda_at + log(at_thousand) + altman_Z + tangibility + current_ratio" # the potential controls</span></span>
<span id="cb60-1294"><a href="#cb60-1294" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_base_fe &lt;- " | gvkey + indexyear + ff_30ind_name^indexyear" # fixed effects</span></span>
<span id="cb60-1295"><a href="#cb60-1295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1296"><a href="#cb60-1296" aria-hidden="true" tabindex="-1"></a><span class="in">      ## output formula:</span></span>
<span id="cb60-1297"><a href="#cb60-1297" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_output &lt;- paste(</span></span>
<span id="cb60-1298"><a href="#cb60-1298" aria-hidden="true" tabindex="-1"></a><span class="in">        fml_base,</span></span>
<span id="cb60-1299"><a href="#cb60-1299" aria-hidden="true" tabindex="-1"></a><span class="in">        ifelse(add_controls == TRUE, yes = fml_base_controls, no = ""),</span></span>
<span id="cb60-1300"><a href="#cb60-1300" aria-hidden="true" tabindex="-1"></a><span class="in">        fml_base_fe,</span></span>
<span id="cb60-1301"><a href="#cb60-1301" aria-hidden="true" tabindex="-1"></a><span class="in">        sep = ""</span></span>
<span id="cb60-1302"><a href="#cb60-1302" aria-hidden="true" tabindex="-1"></a><span class="in">      )</span></span>
<span id="cb60-1303"><a href="#cb60-1303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1304"><a href="#cb60-1304" aria-hidden="true" tabindex="-1"></a><span class="in">      return(fml_output)</span></span>
<span id="cb60-1305"><a href="#cb60-1305" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb60-1306"><a href="#cb60-1306" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb60-1307"><a href="#cb60-1307" aria-hidden="true" tabindex="-1"></a><span class="in">  as_tibble() %&gt;%</span></span>
<span id="cb60-1308"><a href="#cb60-1308" aria-hidden="true" tabindex="-1"></a><span class="in">  ## assign a name for each regression:</span></span>
<span id="cb60-1309"><a href="#cb60-1309" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(name = paste("(", 1:nrow(.), ")", sep = "")) %&gt;%</span></span>
<span id="cb60-1310"><a href="#cb60-1310" aria-hidden="true" tabindex="-1"></a><span class="in">  select(name, everything())</span></span>
<span id="cb60-1311"><a href="#cb60-1311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1312"><a href="#cb60-1312" aria-hidden="true" tabindex="-1"></a><span class="in">## construct the data used for the loop:</span></span>
<span id="cb60-1313"><a href="#cb60-1313" aria-hidden="true" tabindex="-1"></a><span class="in">data_did_loop &lt;- data_did %&gt;%</span></span>
<span id="cb60-1314"><a href="#cb60-1314" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;%</span></span>
<span id="cb60-1315"><a href="#cb60-1315" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb60-1316"><a href="#cb60-1316" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb60-1317"><a href="#cb60-1317" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, fyear, indexyear, intensity_2000, post_2005,</span></span>
<span id="cb60-1318"><a href="#cb60-1318" aria-hidden="true" tabindex="-1"></a><span class="in">         book_leverage, debt_ebitda, sic, ff_30ind_name,</span></span>
<span id="cb60-1319"><a href="#cb60-1319" aria-hidden="true" tabindex="-1"></a><span class="in">         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span></span>
<span id="cb60-1320"><a href="#cb60-1320" aria-hidden="true" tabindex="-1"></a><span class="in">         altman_Z, kz, market_book, tangibility, current_ratio) %&gt;%</span></span>
<span id="cb60-1321"><a href="#cb60-1321" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= period_start &amp; fyear &lt;= period_end) %&gt;%</span></span>
<span id="cb60-1322"><a href="#cb60-1322" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(intensity_2000) &amp; !is.na(at)) %&gt;%</span></span>
<span id="cb60-1323"><a href="#cb60-1323" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-1324"><a href="#cb60-1324" aria-hidden="true" tabindex="-1"></a><span class="in">    gvkey = as.factor(gvkey),</span></span>
<span id="cb60-1325"><a href="#cb60-1325" aria-hidden="true" tabindex="-1"></a><span class="in">    fyear = as.factor(fyear),</span></span>
<span id="cb60-1326"><a href="#cb60-1326" aria-hidden="true" tabindex="-1"></a><span class="in">    # treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb60-1327"><a href="#cb60-1327" aria-hidden="true" tabindex="-1"></a><span class="in">    treated = ifelse(intensity_2000 &gt; 0, 1, 0),</span></span>
<span id="cb60-1328"><a href="#cb60-1328" aria-hidden="true" tabindex="-1"></a><span class="in">    ebitda_at = ebitda / at,</span></span>
<span id="cb60-1329"><a href="#cb60-1329" aria-hidden="true" tabindex="-1"></a><span class="in">    at_thousand = at * 10^-3,</span></span>
<span id="cb60-1330"><a href="#cb60-1330" aria-hidden="true" tabindex="-1"></a><span class="in">    large = ifelse(large, yes = "Large", no = "Small"),</span></span>
<span id="cb60-1331"><a href="#cb60-1331" aria-hidden="true" tabindex="-1"></a><span class="in">    tangiblity_exbnl = tangibility - bnl_intensity,</span></span>
<span id="cb60-1332"><a href="#cb60-1332" aria-hidden="true" tabindex="-1"></a><span class="in">    bnl = bnl_intensity * at,</span></span>
<span id="cb60-1333"><a href="#cb60-1333" aria-hidden="true" tabindex="-1"></a><span class="in">    # large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb60-1334"><a href="#cb60-1334" aria-hidden="true" tabindex="-1"></a><span class="in">    treated_large = paste(treated, large, sep = "_")</span></span>
<span id="cb60-1335"><a href="#cb60-1335" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-1336"><a href="#cb60-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1337"><a href="#cb60-1337" aria-hidden="true" tabindex="-1"></a><span class="in">data_did_loop_balanced &lt;- data_did %&gt;%</span></span>
<span id="cb60-1338"><a href="#cb60-1338" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;%</span></span>
<span id="cb60-1339"><a href="#cb60-1339" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb60-1340"><a href="#cb60-1340" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb60-1341"><a href="#cb60-1341" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, fyear, indexyear, intensity_2000, post_2005,</span></span>
<span id="cb60-1342"><a href="#cb60-1342" aria-hidden="true" tabindex="-1"></a><span class="in">         book_leverage, debt_ebitda, sic, ff_30ind_name,</span></span>
<span id="cb60-1343"><a href="#cb60-1343" aria-hidden="true" tabindex="-1"></a><span class="in">         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span></span>
<span id="cb60-1344"><a href="#cb60-1344" aria-hidden="true" tabindex="-1"></a><span class="in">         altman_Z, kz, market_book, tangibility, current_ratio) %&gt;%</span></span>
<span id="cb60-1345"><a href="#cb60-1345" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= period_start &amp; fyear &lt;= period_end) %&gt;%</span></span>
<span id="cb60-1346"><a href="#cb60-1346" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(intensity_2000) &amp; !is.na(at)) %&gt;%</span></span>
<span id="cb60-1347"><a href="#cb60-1347" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-1348"><a href="#cb60-1348" aria-hidden="true" tabindex="-1"></a><span class="in">    gvkey = as.factor(gvkey),</span></span>
<span id="cb60-1349"><a href="#cb60-1349" aria-hidden="true" tabindex="-1"></a><span class="in">    fyear = as.factor(fyear),</span></span>
<span id="cb60-1350"><a href="#cb60-1350" aria-hidden="true" tabindex="-1"></a><span class="in">    # treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb60-1351"><a href="#cb60-1351" aria-hidden="true" tabindex="-1"></a><span class="in">    treated = ifelse(intensity_2000 &gt; 0, 1, 0),</span></span>
<span id="cb60-1352"><a href="#cb60-1352" aria-hidden="true" tabindex="-1"></a><span class="in">    ebitda_at = ebitda / at,</span></span>
<span id="cb60-1353"><a href="#cb60-1353" aria-hidden="true" tabindex="-1"></a><span class="in">    at_thousand = at * 10^-3,</span></span>
<span id="cb60-1354"><a href="#cb60-1354" aria-hidden="true" tabindex="-1"></a><span class="in">    large = ifelse(large, yes = "Large", no = "Small"),</span></span>
<span id="cb60-1355"><a href="#cb60-1355" aria-hidden="true" tabindex="-1"></a><span class="in">    tangiblity_exbnl = tangibility - bnl_intensity,</span></span>
<span id="cb60-1356"><a href="#cb60-1356" aria-hidden="true" tabindex="-1"></a><span class="in">    bnl = bnl_intensity * at,</span></span>
<span id="cb60-1357"><a href="#cb60-1357" aria-hidden="true" tabindex="-1"></a><span class="in">    # large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb60-1358"><a href="#cb60-1358" aria-hidden="true" tabindex="-1"></a><span class="in">    treated_large = paste(treated, large, sep = "_")</span></span>
<span id="cb60-1359"><a href="#cb60-1359" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-1360"><a href="#cb60-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1361"><a href="#cb60-1361" aria-hidden="true" tabindex="-1"></a><span class="in">## store all results</span></span>
<span id="cb60-1362"><a href="#cb60-1362" aria-hidden="true" tabindex="-1"></a><span class="in">fml_results &lt;- fml_parameters %&gt;%</span></span>
<span id="cb60-1363"><a href="#cb60-1363" aria-hidden="true" tabindex="-1"></a><span class="in">  apply(MARGIN = 1, FUN = function(parameters) {</span></span>
<span id="cb60-1364"><a href="#cb60-1364" aria-hidden="true" tabindex="-1"></a><span class="in">    ## parameters:</span></span>
<span id="cb60-1365"><a href="#cb60-1365" aria-hidden="true" tabindex="-1"></a><span class="in">    is_balanced &lt;- parameters[4]</span></span>
<span id="cb60-1366"><a href="#cb60-1366" aria-hidden="true" tabindex="-1"></a><span class="in">    fml_formula &lt;- parameters[5]</span></span>
<span id="cb60-1367"><a href="#cb60-1367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1368"><a href="#cb60-1368" aria-hidden="true" tabindex="-1"></a><span class="in">    ## data:</span></span>
<span id="cb60-1369"><a href="#cb60-1369" aria-hidden="true" tabindex="-1"></a><span class="in">    if (is_balanced == TRUE) {</span></span>
<span id="cb60-1370"><a href="#cb60-1370" aria-hidden="true" tabindex="-1"></a><span class="in">      data &lt;- data_did_loop_balanced</span></span>
<span id="cb60-1371"><a href="#cb60-1371" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb60-1372"><a href="#cb60-1372" aria-hidden="true" tabindex="-1"></a><span class="in">      data &lt;- data_did_loop</span></span>
<span id="cb60-1373"><a href="#cb60-1373" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb60-1374"><a href="#cb60-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1375"><a href="#cb60-1375" aria-hidden="true" tabindex="-1"></a><span class="in">    ## regression:</span></span>
<span id="cb60-1376"><a href="#cb60-1376" aria-hidden="true" tabindex="-1"></a><span class="in">    did_model &lt;- fixest::feols(fml = formula(fml_formula),</span></span>
<span id="cb60-1377"><a href="#cb60-1377" aria-hidden="true" tabindex="-1"></a><span class="in">                  data = data,</span></span>
<span id="cb60-1378"><a href="#cb60-1378" aria-hidden="true" tabindex="-1"></a><span class="in">                  cluster = c("gvkey", "ff_30ind_name")</span></span>
<span id="cb60-1379"><a href="#cb60-1379" aria-hidden="true" tabindex="-1"></a><span class="in">                  )</span></span>
<span id="cb60-1380"><a href="#cb60-1380" aria-hidden="true" tabindex="-1"></a><span class="in">    return(did_model)</span></span>
<span id="cb60-1381"><a href="#cb60-1381" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb60-1382"><a href="#cb60-1382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1383"><a href="#cb60-1383" aria-hidden="true" tabindex="-1"></a><span class="in">### DiD result using post-:</span></span>
<span id="cb60-1384"><a href="#cb60-1384" aria-hidden="true" tabindex="-1"></a><span class="in">fml_results %&gt;%</span></span>
<span id="cb60-1385"><a href="#cb60-1385" aria-hidden="true" tabindex="-1"></a><span class="in">  `names&lt;-`(value = unlist(fml_parameters[,1])) %&gt;%</span></span>
<span id="cb60-1386"><a href="#cb60-1386" aria-hidden="true" tabindex="-1"></a><span class="in">  etable(</span></span>
<span id="cb60-1387"><a href="#cb60-1387" aria-hidden="true" tabindex="-1"></a><span class="in">    order = "post",</span></span>
<span id="cb60-1388"><a href="#cb60-1388" aria-hidden="true" tabindex="-1"></a><span class="in">    # keep = "post",</span></span>
<span id="cb60-1389"><a href="#cb60-1389" aria-hidden="true" tabindex="-1"></a><span class="in">    extralines = list(</span></span>
<span id="cb60-1390"><a href="#cb60-1390" aria-hidden="true" tabindex="-1"></a><span class="in">      ## Controls:</span></span>
<span id="cb60-1391"><a href="#cb60-1391" aria-hidden="true" tabindex="-1"></a><span class="in">      "^_Controls" = ifelse(unlist(fml_parameters[,3]), yes = "Yes", no = "No"),</span></span>
<span id="cb60-1392"><a href="#cb60-1392" aria-hidden="true" tabindex="-1"></a><span class="in">      ## the identity of the sample:</span></span>
<span id="cb60-1393"><a href="#cb60-1393" aria-hidden="true" tabindex="-1"></a><span class="in">      "__Sample" = ifelse(unlist(fml_parameters[,4]), yes = "Balanced Panel", no = "Full Sample") # whether used a balanced panel or a full sample.</span></span>
<span id="cb60-1394"><a href="#cb60-1394" aria-hidden="true" tabindex="-1"></a><span class="in">  )) %&gt;%</span></span>
<span id="cb60-1395"><a href="#cb60-1395" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::kable(format = "html", caption = paste("DiD Results with `", intensity_measure_name, "`", sep = "")) %&gt;%</span></span>
<span id="cb60-1396"><a href="#cb60-1396" aria-hidden="true" tabindex="-1"></a><span class="in">  kableExtra::kable_styling(</span></span>
<span id="cb60-1397"><a href="#cb60-1397" aria-hidden="true" tabindex="-1"></a><span class="in">    font_size = 8,       # Smaller font (default is 16px)</span></span>
<span id="cb60-1398"><a href="#cb60-1398" aria-hidden="true" tabindex="-1"></a><span class="in">    full_width = FALSE,   # Table width fits content</span></span>
<span id="cb60-1399"><a href="#cb60-1399" aria-hidden="true" tabindex="-1"></a><span class="in">    bootstrap_options = c("striped", "condensed")</span></span>
<span id="cb60-1400"><a href="#cb60-1400" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb60-1401"><a href="#cb60-1401" aria-hidden="true" tabindex="-1"></a><span class="in">  kableExtra::footnote(</span></span>
<span id="cb60-1402"><a href="#cb60-1402" aria-hidden="true" tabindex="-1"></a><span class="in">    general = "Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1",</span></span>
<span id="cb60-1403"><a href="#cb60-1403" aria-hidden="true" tabindex="-1"></a><span class="in">    general_title = "Note:"</span></span>
<span id="cb60-1404"><a href="#cb60-1404" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-1405"><a href="#cb60-1405" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1406"><a href="#cb60-1406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1407"><a href="#cb60-1407" aria-hidden="true" tabindex="-1"></a>DiD analysis:</span>
<span id="cb60-1408"><a href="#cb60-1408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1409"><a href="#cb60-1409" aria-hidden="true" tabindex="-1"></a><span class="in">```{r s3d-did-plot, echo=TRUE}</span></span>
<span id="cb60-1410"><a href="#cb60-1410" aria-hidden="true" tabindex="-1"></a><span class="in">## create the combinations of parameters:</span></span>
<span id="cb60-1411"><a href="#cb60-1411" aria-hidden="true" tabindex="-1"></a><span class="in">fml_parameters &lt;- expand_grid(</span></span>
<span id="cb60-1412"><a href="#cb60-1412" aria-hidden="true" tabindex="-1"></a><span class="in">  choice_treatment = c("intensity_2000", "treated"), # what is the treatment measure: continuous/binary</span></span>
<span id="cb60-1413"><a href="#cb60-1413" aria-hidden="true" tabindex="-1"></a><span class="in">  controls_inclusion = c(FALSE, TRUE),# whether to include controls</span></span>
<span id="cb60-1414"><a href="#cb60-1414" aria-hidden="true" tabindex="-1"></a><span class="in">  balanced_panel = c(FALSE, TRUE), # whether keep a balanced panel</span></span>
<span id="cb60-1415"><a href="#cb60-1415" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;%</span></span>
<span id="cb60-1416"><a href="#cb60-1416" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(balanced_panel) %&gt;%</span></span>
<span id="cb60-1417"><a href="#cb60-1417" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind.data.frame(.,</span></span>
<span id="cb60-1418"><a href="#cb60-1418" aria-hidden="true" tabindex="-1"></a><span class="in">    fml = apply(X = ., MARGIN = 1, FUN = function(parameters) {</span></span>
<span id="cb60-1419"><a href="#cb60-1419" aria-hidden="true" tabindex="-1"></a><span class="in">      ## parameters:</span></span>
<span id="cb60-1420"><a href="#cb60-1420" aria-hidden="true" tabindex="-1"></a><span class="in">      choice_treatment &lt;- parameters[1]</span></span>
<span id="cb60-1421"><a href="#cb60-1421" aria-hidden="true" tabindex="-1"></a><span class="in">      add_controls &lt;- parameters[2]</span></span>
<span id="cb60-1422"><a href="#cb60-1422" aria-hidden="true" tabindex="-1"></a><span class="in">      is_balanced &lt;- parameters[3]</span></span>
<span id="cb60-1423"><a href="#cb60-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1424"><a href="#cb60-1424" aria-hidden="true" tabindex="-1"></a><span class="in">      ## inputs:</span></span>
<span id="cb60-1425"><a href="#cb60-1425" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_base &lt;- paste("book_leverage ~ i(indexyear, ", choice_treatment, ", ref = -1)", sep = "") # the baseline model</span></span>
<span id="cb60-1426"><a href="#cb60-1426" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_base_controls &lt;- " + roa + ebitda_at + log(at_thousand) + altman_Z + tangibility + current_ratio" # the potential controls</span></span>
<span id="cb60-1427"><a href="#cb60-1427" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_base_fe &lt;- " | gvkey + indexyear + ff_30ind_name^indexyear" # fixed effects</span></span>
<span id="cb60-1428"><a href="#cb60-1428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1429"><a href="#cb60-1429" aria-hidden="true" tabindex="-1"></a><span class="in">      ## output formula:</span></span>
<span id="cb60-1430"><a href="#cb60-1430" aria-hidden="true" tabindex="-1"></a><span class="in">      fml_output &lt;- paste(</span></span>
<span id="cb60-1431"><a href="#cb60-1431" aria-hidden="true" tabindex="-1"></a><span class="in">        fml_base,</span></span>
<span id="cb60-1432"><a href="#cb60-1432" aria-hidden="true" tabindex="-1"></a><span class="in">        ifelse(add_controls == TRUE, yes = fml_base_controls, no = ""),</span></span>
<span id="cb60-1433"><a href="#cb60-1433" aria-hidden="true" tabindex="-1"></a><span class="in">        fml_base_fe,</span></span>
<span id="cb60-1434"><a href="#cb60-1434" aria-hidden="true" tabindex="-1"></a><span class="in">        sep = ""</span></span>
<span id="cb60-1435"><a href="#cb60-1435" aria-hidden="true" tabindex="-1"></a><span class="in">      )</span></span>
<span id="cb60-1436"><a href="#cb60-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1437"><a href="#cb60-1437" aria-hidden="true" tabindex="-1"></a><span class="in">      return(fml_output)</span></span>
<span id="cb60-1438"><a href="#cb60-1438" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb60-1439"><a href="#cb60-1439" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb60-1440"><a href="#cb60-1440" aria-hidden="true" tabindex="-1"></a><span class="in">  as_tibble() %&gt;%</span></span>
<span id="cb60-1441"><a href="#cb60-1441" aria-hidden="true" tabindex="-1"></a><span class="in">  ## assign a name for each regression:</span></span>
<span id="cb60-1442"><a href="#cb60-1442" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(name = paste("(", letters[1:nrow(.)], ")", sep = "")) %&gt;%</span></span>
<span id="cb60-1443"><a href="#cb60-1443" aria-hidden="true" tabindex="-1"></a><span class="in">  select(name, everything())</span></span>
<span id="cb60-1444"><a href="#cb60-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1445"><a href="#cb60-1445" aria-hidden="true" tabindex="-1"></a><span class="in">fml_parameters</span></span>
<span id="cb60-1446"><a href="#cb60-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1447"><a href="#cb60-1447" aria-hidden="true" tabindex="-1"></a><span class="in">## construct the data used for the loop:</span></span>
<span id="cb60-1448"><a href="#cb60-1448" aria-hidden="true" tabindex="-1"></a><span class="in">data_did_loop &lt;- data_did %&gt;%</span></span>
<span id="cb60-1449"><a href="#cb60-1449" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;%</span></span>
<span id="cb60-1450"><a href="#cb60-1450" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb60-1451"><a href="#cb60-1451" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb60-1452"><a href="#cb60-1452" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, fyear, indexyear, intensity_2000, post_2005,</span></span>
<span id="cb60-1453"><a href="#cb60-1453" aria-hidden="true" tabindex="-1"></a><span class="in">         book_leverage, debt_ebitda, sic, ff_30ind_name,</span></span>
<span id="cb60-1454"><a href="#cb60-1454" aria-hidden="true" tabindex="-1"></a><span class="in">         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span></span>
<span id="cb60-1455"><a href="#cb60-1455" aria-hidden="true" tabindex="-1"></a><span class="in">         altman_Z, kz, market_book, tangibility, current_ratio) %&gt;%</span></span>
<span id="cb60-1456"><a href="#cb60-1456" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= period_start - n_pre &amp; fyear &lt;= period_end) %&gt;%</span></span>
<span id="cb60-1457"><a href="#cb60-1457" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(intensity_2000) &amp; !is.na(at)) %&gt;%</span></span>
<span id="cb60-1458"><a href="#cb60-1458" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-1459"><a href="#cb60-1459" aria-hidden="true" tabindex="-1"></a><span class="in">    gvkey = as.factor(gvkey),</span></span>
<span id="cb60-1460"><a href="#cb60-1460" aria-hidden="true" tabindex="-1"></a><span class="in">    fyear = as.factor(fyear),</span></span>
<span id="cb60-1461"><a href="#cb60-1461" aria-hidden="true" tabindex="-1"></a><span class="in">    # treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb60-1462"><a href="#cb60-1462" aria-hidden="true" tabindex="-1"></a><span class="in">    treated = ifelse(intensity_2000 &gt; 0, 1, 0),</span></span>
<span id="cb60-1463"><a href="#cb60-1463" aria-hidden="true" tabindex="-1"></a><span class="in">    ebitda_at = ebitda / at,</span></span>
<span id="cb60-1464"><a href="#cb60-1464" aria-hidden="true" tabindex="-1"></a><span class="in">    at_thousand = at * 10^-3,</span></span>
<span id="cb60-1465"><a href="#cb60-1465" aria-hidden="true" tabindex="-1"></a><span class="in">    large = ifelse(large, yes = "Large", no = "Small"),</span></span>
<span id="cb60-1466"><a href="#cb60-1466" aria-hidden="true" tabindex="-1"></a><span class="in">    tangiblity_exbnl = tangibility - bnl_intensity,</span></span>
<span id="cb60-1467"><a href="#cb60-1467" aria-hidden="true" tabindex="-1"></a><span class="in">    bnl = bnl_intensity * at,</span></span>
<span id="cb60-1468"><a href="#cb60-1468" aria-hidden="true" tabindex="-1"></a><span class="in">    # large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb60-1469"><a href="#cb60-1469" aria-hidden="true" tabindex="-1"></a><span class="in">    treated_large = paste(treated, large, sep = "_")</span></span>
<span id="cb60-1470"><a href="#cb60-1470" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-1471"><a href="#cb60-1471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1472"><a href="#cb60-1472" aria-hidden="true" tabindex="-1"></a><span class="in">data_did_loop_balanced &lt;- data_did %&gt;%</span></span>
<span id="cb60-1473"><a href="#cb60-1473" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;%</span></span>
<span id="cb60-1474"><a href="#cb60-1474" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb60-1475"><a href="#cb60-1475" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb60-1476"><a href="#cb60-1476" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, fyear, indexyear, intensity_2000, post_2005,</span></span>
<span id="cb60-1477"><a href="#cb60-1477" aria-hidden="true" tabindex="-1"></a><span class="in">         book_leverage, debt_ebitda, sic, ff_30ind_name,</span></span>
<span id="cb60-1478"><a href="#cb60-1478" aria-hidden="true" tabindex="-1"></a><span class="in">         at, ebitda, large, roa, ppent, bnl_intensity, ppe_lease_intensity,</span></span>
<span id="cb60-1479"><a href="#cb60-1479" aria-hidden="true" tabindex="-1"></a><span class="in">         altman_Z, kz, market_book, tangibility, current_ratio) %&gt;%</span></span>
<span id="cb60-1480"><a href="#cb60-1480" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= period_start - n_pre &amp; fyear &lt;= period_end) %&gt;%</span></span>
<span id="cb60-1481"><a href="#cb60-1481" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(intensity_2000) &amp; !is.na(at)) %&gt;%</span></span>
<span id="cb60-1482"><a href="#cb60-1482" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-1483"><a href="#cb60-1483" aria-hidden="true" tabindex="-1"></a><span class="in">    gvkey = as.factor(gvkey),</span></span>
<span id="cb60-1484"><a href="#cb60-1484" aria-hidden="true" tabindex="-1"></a><span class="in">    fyear = as.factor(fyear),</span></span>
<span id="cb60-1485"><a href="#cb60-1485" aria-hidden="true" tabindex="-1"></a><span class="in">    # treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb60-1486"><a href="#cb60-1486" aria-hidden="true" tabindex="-1"></a><span class="in">    treated = ifelse(intensity_2000 &gt; 0, 1, 0),</span></span>
<span id="cb60-1487"><a href="#cb60-1487" aria-hidden="true" tabindex="-1"></a><span class="in">    ebitda_at = ebitda / at,</span></span>
<span id="cb60-1488"><a href="#cb60-1488" aria-hidden="true" tabindex="-1"></a><span class="in">    at_thousand = at * 10^-3,</span></span>
<span id="cb60-1489"><a href="#cb60-1489" aria-hidden="true" tabindex="-1"></a><span class="in">    tangiblity_exbnl = tangibility - bnl_intensity,</span></span>
<span id="cb60-1490"><a href="#cb60-1490" aria-hidden="true" tabindex="-1"></a><span class="in">    bnl = bnl_intensity * at,</span></span>
<span id="cb60-1491"><a href="#cb60-1491" aria-hidden="true" tabindex="-1"></a><span class="in">    treated_large = paste(treated, large, sep = "_"),</span></span>
<span id="cb60-1492"><a href="#cb60-1492" aria-hidden="true" tabindex="-1"></a><span class="in">    ## grouping variables</span></span>
<span id="cb60-1493"><a href="#cb60-1493" aria-hidden="true" tabindex="-1"></a><span class="in">    large = ifelse(large, yes = "Large", no = "Small")</span></span>
<span id="cb60-1494"><a href="#cb60-1494" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-1495"><a href="#cb60-1495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1496"><a href="#cb60-1496" aria-hidden="true" tabindex="-1"></a><span class="in">## store all results</span></span>
<span id="cb60-1497"><a href="#cb60-1497" aria-hidden="true" tabindex="-1"></a><span class="in">fml_results &lt;- fml_parameters %&gt;%</span></span>
<span id="cb60-1498"><a href="#cb60-1498" aria-hidden="true" tabindex="-1"></a><span class="in">  apply(MARGIN = 1, FUN = function(parameters) {</span></span>
<span id="cb60-1499"><a href="#cb60-1499" aria-hidden="true" tabindex="-1"></a><span class="in">    ## parameters:</span></span>
<span id="cb60-1500"><a href="#cb60-1500" aria-hidden="true" tabindex="-1"></a><span class="in">    is_balanced &lt;- parameters[4]</span></span>
<span id="cb60-1501"><a href="#cb60-1501" aria-hidden="true" tabindex="-1"></a><span class="in">    fml_formula &lt;- parameters[5]</span></span>
<span id="cb60-1502"><a href="#cb60-1502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1503"><a href="#cb60-1503" aria-hidden="true" tabindex="-1"></a><span class="in">    ## data:</span></span>
<span id="cb60-1504"><a href="#cb60-1504" aria-hidden="true" tabindex="-1"></a><span class="in">    if (is_balanced == TRUE) {</span></span>
<span id="cb60-1505"><a href="#cb60-1505" aria-hidden="true" tabindex="-1"></a><span class="in">      data &lt;- data_did_loop_balanced</span></span>
<span id="cb60-1506"><a href="#cb60-1506" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb60-1507"><a href="#cb60-1507" aria-hidden="true" tabindex="-1"></a><span class="in">      data &lt;- data_did_loop</span></span>
<span id="cb60-1508"><a href="#cb60-1508" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb60-1509"><a href="#cb60-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1510"><a href="#cb60-1510" aria-hidden="true" tabindex="-1"></a><span class="in">    ## regression:</span></span>
<span id="cb60-1511"><a href="#cb60-1511" aria-hidden="true" tabindex="-1"></a><span class="in">    did_model &lt;- fixest::feols(fml = formula(fml_formula),</span></span>
<span id="cb60-1512"><a href="#cb60-1512" aria-hidden="true" tabindex="-1"></a><span class="in">                  data = data,</span></span>
<span id="cb60-1513"><a href="#cb60-1513" aria-hidden="true" tabindex="-1"></a><span class="in">                  cluster = c("gvkey", "ff_30ind_name")</span></span>
<span id="cb60-1514"><a href="#cb60-1514" aria-hidden="true" tabindex="-1"></a><span class="in">                  )</span></span>
<span id="cb60-1515"><a href="#cb60-1515" aria-hidden="true" tabindex="-1"></a><span class="in">    return(did_model)</span></span>
<span id="cb60-1516"><a href="#cb60-1516" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb60-1517"><a href="#cb60-1517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1518"><a href="#cb60-1518" aria-hidden="true" tabindex="-1"></a><span class="in">### create the table:</span></span>
<span id="cb60-1519"><a href="#cb60-1519" aria-hidden="true" tabindex="-1"></a><span class="in">fml_results %&gt;%</span></span>
<span id="cb60-1520"><a href="#cb60-1520" aria-hidden="true" tabindex="-1"></a><span class="in">  `names&lt;-`(value = unlist(fml_parameters[,1])) %&gt;%</span></span>
<span id="cb60-1521"><a href="#cb60-1521" aria-hidden="true" tabindex="-1"></a><span class="in">  etable(</span></span>
<span id="cb60-1522"><a href="#cb60-1522" aria-hidden="true" tabindex="-1"></a><span class="in">    order = "indexyear",</span></span>
<span id="cb60-1523"><a href="#cb60-1523" aria-hidden="true" tabindex="-1"></a><span class="in">    # keep = "post",</span></span>
<span id="cb60-1524"><a href="#cb60-1524" aria-hidden="true" tabindex="-1"></a><span class="in">    extralines = list(</span></span>
<span id="cb60-1525"><a href="#cb60-1525" aria-hidden="true" tabindex="-1"></a><span class="in">      ## Controls:</span></span>
<span id="cb60-1526"><a href="#cb60-1526" aria-hidden="true" tabindex="-1"></a><span class="in">      "^_Controls" = ifelse(unlist(fml_parameters[,3]), yes = "Yes", no = "No"),</span></span>
<span id="cb60-1527"><a href="#cb60-1527" aria-hidden="true" tabindex="-1"></a><span class="in">      ## the identity of the sample:</span></span>
<span id="cb60-1528"><a href="#cb60-1528" aria-hidden="true" tabindex="-1"></a><span class="in">      "__Sample" = ifelse(unlist(fml_parameters[,4]), yes = "Balanced Panel", no = "Full Sample") # whether used a balanced panel or a full sample.</span></span>
<span id="cb60-1529"><a href="#cb60-1529" aria-hidden="true" tabindex="-1"></a><span class="in">  )) %&gt;%</span></span>
<span id="cb60-1530"><a href="#cb60-1530" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::kable(format = "html", caption = paste("DiD Results with `", intensity_measure_name, "`", sep = "")) %&gt;%</span></span>
<span id="cb60-1531"><a href="#cb60-1531" aria-hidden="true" tabindex="-1"></a><span class="in">  kableExtra::kable_styling(</span></span>
<span id="cb60-1532"><a href="#cb60-1532" aria-hidden="true" tabindex="-1"></a><span class="in">    font_size = 8,       # Smaller font (default is 16px)</span></span>
<span id="cb60-1533"><a href="#cb60-1533" aria-hidden="true" tabindex="-1"></a><span class="in">    full_width = FALSE,   # Table width fits content</span></span>
<span id="cb60-1534"><a href="#cb60-1534" aria-hidden="true" tabindex="-1"></a><span class="in">    bootstrap_options = c("striped", "condensed")</span></span>
<span id="cb60-1535"><a href="#cb60-1535" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-1536"><a href="#cb60-1536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1537"><a href="#cb60-1537" aria-hidden="true" tabindex="-1"></a><span class="in">### create the plots:</span></span>
<span id="cb60-1538"><a href="#cb60-1538" aria-hidden="true" tabindex="-1"></a><span class="in"># fml_parameters[which(unlist(fml_parameters$balanced_panel)), ]</span></span>
<span id="cb60-1539"><a href="#cb60-1539" aria-hidden="true" tabindex="-1"></a><span class="in">fml_results[which(unlist(fml_parameters$balanced_panel))] %&gt;% # choose the balanced panel</span></span>
<span id="cb60-1540"><a href="#cb60-1540" aria-hidden="true" tabindex="-1"></a><span class="in">  iplot(.,</span></span>
<span id="cb60-1541"><a href="#cb60-1541" aria-hidden="true" tabindex="-1"></a><span class="in">        xlab = paste("Time to treatment (Year; 0 = ", base_year, ")", sep = ""),</span></span>
<span id="cb60-1542"><a href="#cb60-1542" aria-hidden="true" tabindex="-1"></a><span class="in">        main = paste("Treatment Effects by fiscal year: `", intensity_measure_name, "`", sep = ""),</span></span>
<span id="cb60-1543"><a href="#cb60-1543" aria-hidden="true" tabindex="-1"></a><span class="in">        sub = "Data: Balanced Panel",</span></span>
<span id="cb60-1544"><a href="#cb60-1544" aria-hidden="true" tabindex="-1"></a><span class="in">        ref.line = FALSE,</span></span>
<span id="cb60-1545"><a href="#cb60-1545" aria-hidden="true" tabindex="-1"></a><span class="in">        ref.line.par = list(col = "red", lty = 2),</span></span>
<span id="cb60-1546"><a href="#cb60-1546" aria-hidden="true" tabindex="-1"></a><span class="in">        pt.join = FALSE,</span></span>
<span id="cb60-1547"><a href="#cb60-1547" aria-hidden="true" tabindex="-1"></a><span class="in">        xlim = c(-3.5, 3.5)</span></span>
<span id="cb60-1548"><a href="#cb60-1548" aria-hidden="true" tabindex="-1"></a><span class="in">        ); axis(1, at = -3:3); abline(v = 0.5, col = "red", lty = 2, lwd = 3); legend('bottomleft', bty = "n", col = c(1, 2, 3, 4), pch = c(20, 17, 15, 21), legend = c('intensity', 'intensity + controls', 'dummy', 'dummy + controls'));</span></span>
<span id="cb60-1549"><a href="#cb60-1549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1550"><a href="#cb60-1550" aria-hidden="true" tabindex="-1"></a><span class="in">fml_results[which(!unlist(fml_parameters$balanced_panel))] %&gt;% # choose full sample</span></span>
<span id="cb60-1551"><a href="#cb60-1551" aria-hidden="true" tabindex="-1"></a><span class="in">  iplot(.,</span></span>
<span id="cb60-1552"><a href="#cb60-1552" aria-hidden="true" tabindex="-1"></a><span class="in">        xlab = paste("Time to treatment (Year; 0 = ", base_year, ")", sep = ""),</span></span>
<span id="cb60-1553"><a href="#cb60-1553" aria-hidden="true" tabindex="-1"></a><span class="in">        main = paste("Treatment Effect by fiscal year: `", intensity_measure_name, "`", sep = ""),</span></span>
<span id="cb60-1554"><a href="#cb60-1554" aria-hidden="true" tabindex="-1"></a><span class="in">        sub = "Data: Full Sample",</span></span>
<span id="cb60-1555"><a href="#cb60-1555" aria-hidden="true" tabindex="-1"></a><span class="in">        ref.line = FALSE,</span></span>
<span id="cb60-1556"><a href="#cb60-1556" aria-hidden="true" tabindex="-1"></a><span class="in">        ref.line.par = list(col = "red", lty = 2),</span></span>
<span id="cb60-1557"><a href="#cb60-1557" aria-hidden="true" tabindex="-1"></a><span class="in">        pt.join = FALSE,</span></span>
<span id="cb60-1558"><a href="#cb60-1558" aria-hidden="true" tabindex="-1"></a><span class="in">        xlim = c(-3.5, 3.5)</span></span>
<span id="cb60-1559"><a href="#cb60-1559" aria-hidden="true" tabindex="-1"></a><span class="in">        ); axis(1, at = -3:3); abline(v = 0.5, col = "red", lty = 2, lwd = 3); legend('bottomleft', bty = "n", col = c(1, 2, 3, 4), pch = c(20, 17, 15, 21), legend = c('intensity', 'intensity + controls', 'dummy', 'dummy + controls'))</span></span>
<span id="cb60-1560"><a href="#cb60-1560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1561"><a href="#cb60-1561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1562"><a href="#cb60-1562" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Other tests and summary stat: --&gt;</span></span>
<span id="cb60-1563"><a href="#cb60-1563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1564"><a href="#cb60-1564" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ```{r s3d-test-run, echo=TRUE, results='asis'} --&gt;</span></span>
<span id="cb60-1565"><a href="#cb60-1565" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- cat('#### ', "Big versus Small", '   \n') --&gt;</span></span>
<span id="cb60-1566"><a href="#cb60-1566" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- did_model_subsample &lt;- data_did_loop_balanced %&gt;% --&gt;</span></span>
<span id="cb60-1567"><a href="#cb60-1567" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   fixest::feols(fml = book_leverage ~ i(fyear, intensity_2000, ref = base_year - 1) + --&gt;</span></span>
<span id="cb60-1568"><a href="#cb60-1568" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--                   roa + ebitda_at + log(at_thousand) + --&gt;</span></span>
<span id="cb60-1569"><a href="#cb60-1569" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--                   altman_Z + tangibility + current_ratio | --&gt;</span></span>
<span id="cb60-1570"><a href="#cb60-1570" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--                   gvkey + fyear + ff_30ind_name^fyear, --&gt;</span></span>
<span id="cb60-1571"><a href="#cb60-1571" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--                 data = ., --&gt;</span></span>
<span id="cb60-1572"><a href="#cb60-1572" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--                 cluster = c("gvkey", "ff_30ind_name"), --&gt;</span></span>
<span id="cb60-1573"><a href="#cb60-1573" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--                 split = ~ large # large --&gt;</span></span>
<span id="cb60-1574"><a href="#cb60-1574" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--                 ) --&gt;</span></span>
<span id="cb60-1575"><a href="#cb60-1575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1576"><a href="#cb60-1576" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- did_model_subsample %&gt;% etable(se.below = TRUE) --&gt;</span></span>
<span id="cb60-1577"><a href="#cb60-1577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1578"><a href="#cb60-1578" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- { --&gt;</span></span>
<span id="cb60-1579"><a href="#cb60-1579" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   # Calculate the Wald statistics --&gt;</span></span>
<span id="cb60-1580"><a href="#cb60-1580" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   model_large &lt;- did_model_subsample[[1]] --&gt;</span></span>
<span id="cb60-1581"><a href="#cb60-1581" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   model_small &lt;- did_model_subsample[[2]] --&gt;</span></span>
<span id="cb60-1582"><a href="#cb60-1582" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   ## get the name of the coefficnet of interests --&gt;</span></span>
<span id="cb60-1583"><a href="#cb60-1583" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   coef_names &lt;- names(model_large$coefficients) %&gt;% --&gt;</span></span>
<span id="cb60-1584"><a href="#cb60-1584" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--     .[str_detect(string = ., pattern = "::")] --&gt;</span></span>
<span id="cb60-1585"><a href="#cb60-1585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1586"><a href="#cb60-1586" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   coef_large &lt;- coef(model_large)[coef_names] --&gt;</span></span>
<span id="cb60-1587"><a href="#cb60-1587" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   coef_small &lt;- coef(model_small)[coef_names] --&gt;</span></span>
<span id="cb60-1588"><a href="#cb60-1588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1589"><a href="#cb60-1589" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   # Difference in treatment effects --&gt;</span></span>
<span id="cb60-1590"><a href="#cb60-1590" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   diff_coef &lt;- coef_large - coef_small --&gt;</span></span>
<span id="cb60-1591"><a href="#cb60-1591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1592"><a href="#cb60-1592" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   # Variance of the difference --&gt;</span></span>
<span id="cb60-1593"><a href="#cb60-1593" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   var_diff &lt;- vcov(model_large)[coef_names, coef_names] + vcov(model_small)[coef_names, coef_names] --&gt;</span></span>
<span id="cb60-1594"><a href="#cb60-1594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1595"><a href="#cb60-1595" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   # Wald statistic for each treatment effect estimate --&gt;</span></span>
<span id="cb60-1596"><a href="#cb60-1596" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   wald_stat &lt;- (diff_coef)^2 / diag(var_diff) --&gt;</span></span>
<span id="cb60-1597"><a href="#cb60-1597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1598"><a href="#cb60-1598" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   wald_stat_vector &lt;- c(t(diff_coef) %*% solve(var_diff) %*% (diff_coef)) --&gt;</span></span>
<span id="cb60-1599"><a href="#cb60-1599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1600"><a href="#cb60-1600" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   # Degrees of freedom --&gt;</span></span>
<span id="cb60-1601"><a href="#cb60-1601" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   df &lt;- 1 --&gt;</span></span>
<span id="cb60-1602"><a href="#cb60-1602" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   df_vector &lt;- length(diff_coef) --&gt;</span></span>
<span id="cb60-1603"><a href="#cb60-1603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1604"><a href="#cb60-1604" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   # P-value --&gt;</span></span>
<span id="cb60-1605"><a href="#cb60-1605" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   p_value &lt;- 1 - pchisq(wald_stat, df) --&gt;</span></span>
<span id="cb60-1606"><a href="#cb60-1606" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   p_value_vector &lt;- 1 - pchisq(wald_stat_vector, df_vector) --&gt;</span></span>
<span id="cb60-1607"><a href="#cb60-1607" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- } --&gt;</span></span>
<span id="cb60-1608"><a href="#cb60-1608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1609"><a href="#cb60-1609" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- convert_p_to_stars &lt;- function(p_values) { --&gt;</span></span>
<span id="cb60-1610"><a href="#cb60-1610" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   # Initialize a character vector to store the significance stars --&gt;</span></span>
<span id="cb60-1611"><a href="#cb60-1611" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   stars &lt;- character(length(p_values)) --&gt;</span></span>
<span id="cb60-1612"><a href="#cb60-1612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1613"><a href="#cb60-1613" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   # Assign stars based on p-value thresholds --&gt;</span></span>
<span id="cb60-1614"><a href="#cb60-1614" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   stars[p_values &lt; 0.001] &lt;- "***" --&gt;</span></span>
<span id="cb60-1615"><a href="#cb60-1615" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   stars[p_values &gt;= 0.001 &amp; p_values &lt; 0.01] &lt;- "**" --&gt;</span></span>
<span id="cb60-1616"><a href="#cb60-1616" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   stars[p_values &gt;= 0.01 &amp; p_values &lt; 0.05] &lt;- "*" --&gt;</span></span>
<span id="cb60-1617"><a href="#cb60-1617" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   stars[p_values &gt;= 0.05 &amp; p_values &lt; 0.1] &lt;- "." --&gt;</span></span>
<span id="cb60-1618"><a href="#cb60-1618" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   stars[p_values &gt;= 0.1] &lt;- "" --&gt;</span></span>
<span id="cb60-1619"><a href="#cb60-1619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1620"><a href="#cb60-1620" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   return(stars) --&gt;</span></span>
<span id="cb60-1621"><a href="#cb60-1621" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- } --&gt;</span></span>
<span id="cb60-1622"><a href="#cb60-1622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1623"><a href="#cb60-1623" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- # Output results --&gt;</span></span>
<span id="cb60-1624"><a href="#cb60-1624" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- cat("Wald test for the difference in the treatment effect\n between the Large firms and Small firms: \n\n"); --&gt;</span></span>
<span id="cb60-1625"><a href="#cb60-1625" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- data.frame( --&gt;</span></span>
<span id="cb60-1626"><a href="#cb60-1626" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   Diff = diff_coef, --&gt;</span></span>
<span id="cb60-1627"><a href="#cb60-1627" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   `Std. Error` = sqrt(diag(var_diff)), --&gt;</span></span>
<span id="cb60-1628"><a href="#cb60-1628" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   `Wald stat` = wald_stat, --&gt;</span></span>
<span id="cb60-1629"><a href="#cb60-1629" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   `P value` = p_value, --&gt;</span></span>
<span id="cb60-1630"><a href="#cb60-1630" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   Star = convert_p_to_stars(p_value) --&gt;</span></span>
<span id="cb60-1631"><a href="#cb60-1631" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ) --&gt;</span></span>
<span id="cb60-1632"><a href="#cb60-1632" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- cat("Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 \n") --&gt;</span></span>
<span id="cb60-1633"><a href="#cb60-1633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1634"><a href="#cb60-1634" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Interacting with Large/Small: --&gt;</span></span>
<span id="cb60-1635"><a href="#cb60-1635" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- data_did_loop_balanced %&gt;% --&gt;</span></span>
<span id="cb60-1636"><a href="#cb60-1636" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   fixest::feols(fml = book_leverage ~ intensity_2000 + post_2005 + large + post_2005*large + intensity_2000*large + intensity_2000:post_2005:i(large) --&gt;</span></span>
<span id="cb60-1637"><a href="#cb60-1637" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--                 + roa + ebitda_at + log(at_thousand) + altman_Z + tangibility + current_ratio --&gt;</span></span>
<span id="cb60-1638"><a href="#cb60-1638" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--                 | --&gt;</span></span>
<span id="cb60-1639"><a href="#cb60-1639" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--                   gvkey + fyear + ff_30ind_name^fyear, data = ., cluster = c("gvkey", "ff_30ind_name")) %&gt;% --&gt;</span></span>
<span id="cb60-1640"><a href="#cb60-1640" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   etable() --&gt;</span></span>
<span id="cb60-1641"><a href="#cb60-1641" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ``` --&gt;</span></span>
<span id="cb60-1642"><a href="#cb60-1642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1643"><a href="#cb60-1643" aria-hidden="true" tabindex="-1"></a>Check the trend of movement in the intensity measure:</span>
<span id="cb60-1644"><a href="#cb60-1644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1645"><a href="#cb60-1645" aria-hidden="true" tabindex="-1"></a><span class="in">```{r s3d-trend, echo=TRUE, warning=FALSE, message=FALSE}</span></span>
<span id="cb60-1646"><a href="#cb60-1646" aria-hidden="true" tabindex="-1"></a><span class="in">### Observation summary:</span></span>
<span id="cb60-1647"><a href="#cb60-1647" aria-hidden="true" tabindex="-1"></a><span class="in">cat("#### Number of Observations in Each Group over time (Full Sample): \n")</span></span>
<span id="cb60-1648"><a href="#cb60-1648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1649"><a href="#cb60-1649" aria-hidden="true" tabindex="-1"></a><span class="in">data_did %&gt;%</span></span>
<span id="cb60-1650"><a href="#cb60-1650" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;%</span></span>
<span id="cb60-1651"><a href="#cb60-1651" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb60-1652"><a href="#cb60-1652" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb60-1653"><a href="#cb60-1653" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, fyear, indexyear, intensity_2000, post_2005, book_leverage, debt_ebitda, sic, ff_30ind_name, at, ebitda, large, roa) %&gt;%</span></span>
<span id="cb60-1654"><a href="#cb60-1654" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= period_start &amp; fyear &lt;= period_end) %&gt;%</span></span>
<span id="cb60-1655"><a href="#cb60-1655" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(intensity_2000) &amp; !is.na(at)) %&gt;%</span></span>
<span id="cb60-1656"><a href="#cb60-1656" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-1657"><a href="#cb60-1657" aria-hidden="true" tabindex="-1"></a><span class="in">  gvkey = as.factor(gvkey),</span></span>
<span id="cb60-1658"><a href="#cb60-1658" aria-hidden="true" tabindex="-1"></a><span class="in">  fyear = as.factor(fyear),</span></span>
<span id="cb60-1659"><a href="#cb60-1659" aria-hidden="true" tabindex="-1"></a><span class="in">  treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb60-1660"><a href="#cb60-1660" aria-hidden="true" tabindex="-1"></a><span class="in">  # treated = ifelse(intensity_2000 &gt; 0, 1, 0),</span></span>
<span id="cb60-1661"><a href="#cb60-1661" aria-hidden="true" tabindex="-1"></a><span class="in">  ebitda_at = ebitda / at,</span></span>
<span id="cb60-1662"><a href="#cb60-1662" aria-hidden="true" tabindex="-1"></a><span class="in">  at_thousand = at * 10^-3,</span></span>
<span id="cb60-1663"><a href="#cb60-1663" aria-hidden="true" tabindex="-1"></a><span class="in">  large = factor(ifelse(large, yes = "Large", no = "Small"), levels = c("Large", "Small") ),</span></span>
<span id="cb60-1664"><a href="#cb60-1664" aria-hidden="true" tabindex="-1"></a><span class="in">  # large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb60-1665"><a href="#cb60-1665" aria-hidden="true" tabindex="-1"></a><span class="in">  treated_large = paste(treated, large, sep = "_")</span></span>
<span id="cb60-1666"><a href="#cb60-1666" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb60-1667"><a href="#cb60-1667" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(treated_large, fyear) %&gt;%</span></span>
<span id="cb60-1668"><a href="#cb60-1668" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(n = n()) %&gt;%</span></span>
<span id="cb60-1669"><a href="#cb60-1669" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;%</span></span>
<span id="cb60-1670"><a href="#cb60-1670" aria-hidden="true" tabindex="-1"></a><span class="in">  # mutate(</span></span>
<span id="cb60-1671"><a href="#cb60-1671" aria-hidden="true" tabindex="-1"></a><span class="in">  #   Treated = str_extract(string = treated_large, pattern = "^[^_]+"),</span></span>
<span id="cb60-1672"><a href="#cb60-1672" aria-hidden="true" tabindex="-1"></a><span class="in">  #   Size = str_extract(string = treated_large, pattern = "[^_]+$")</span></span>
<span id="cb60-1673"><a href="#cb60-1673" aria-hidden="true" tabindex="-1"></a><span class="in">  #   ) %&gt;%</span></span>
<span id="cb60-1674"><a href="#cb60-1674" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_wider(names_from = treated_large, values_from = n) %&gt;%</span></span>
<span id="cb60-1675"><a href="#cb60-1675" aria-hidden="true" tabindex="-1"></a><span class="in">  gt(caption = "Number of Observations in each group between 2002 and 2007") %&gt;%</span></span>
<span id="cb60-1676"><a href="#cb60-1676" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_style(</span></span>
<span id="cb60-1677"><a href="#cb60-1677" aria-hidden="true" tabindex="-1"></a><span class="in">    style = cell_text(size = "x-small"),  # Reduce font size</span></span>
<span id="cb60-1678"><a href="#cb60-1678" aria-hidden="true" tabindex="-1"></a><span class="in">    locations = cells_column_labels(columns = everything()) # reduce the size of tab headers</span></span>
<span id="cb60-1679"><a href="#cb60-1679" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb60-1680"><a href="#cb60-1680" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_style(</span></span>
<span id="cb60-1681"><a href="#cb60-1681" aria-hidden="true" tabindex="-1"></a><span class="in">    style = cell_text(size = "x-small"),  # Reduce font size</span></span>
<span id="cb60-1682"><a href="#cb60-1682" aria-hidden="true" tabindex="-1"></a><span class="in">    locations = cells_body()</span></span>
<span id="cb60-1683"><a href="#cb60-1683" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-1684"><a href="#cb60-1684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1685"><a href="#cb60-1685" aria-hidden="true" tabindex="-1"></a><span class="in">cat("#### Number of Observations in Each Group over time (Balanced Panel): \n")</span></span>
<span id="cb60-1686"><a href="#cb60-1686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1687"><a href="#cb60-1687" aria-hidden="true" tabindex="-1"></a><span class="in">data_did %&gt;%</span></span>
<span id="cb60-1688"><a href="#cb60-1688" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;%</span></span>
<span id="cb60-1689"><a href="#cb60-1689" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(gvkey %in% data_did_balanced_id) %&gt;%</span></span>
<span id="cb60-1690"><a href="#cb60-1690" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(intensity_2000 &gt; 0) %&gt;%</span></span>
<span id="cb60-1691"><a href="#cb60-1691" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, fyear, indexyear, intensity_2000, post_2005, book_leverage, debt_ebitda, sic, ff_30ind_name, at, ebitda, large, roa) %&gt;%</span></span>
<span id="cb60-1692"><a href="#cb60-1692" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= period_start &amp; fyear &lt;= period_end) %&gt;%</span></span>
<span id="cb60-1693"><a href="#cb60-1693" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(intensity_2000) &amp; !is.na(at)) %&gt;%</span></span>
<span id="cb60-1694"><a href="#cb60-1694" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb60-1695"><a href="#cb60-1695" aria-hidden="true" tabindex="-1"></a><span class="in">  gvkey = as.factor(gvkey),</span></span>
<span id="cb60-1696"><a href="#cb60-1696" aria-hidden="true" tabindex="-1"></a><span class="in">  fyear = as.factor(fyear),</span></span>
<span id="cb60-1697"><a href="#cb60-1697" aria-hidden="true" tabindex="-1"></a><span class="in">  treated = ifelse(intensity_2000 &gt; 0, "Treated", "Untreated"),</span></span>
<span id="cb60-1698"><a href="#cb60-1698" aria-hidden="true" tabindex="-1"></a><span class="in">  # treated = ifelse(intensity_2000 &gt; 0, 1, 0),</span></span>
<span id="cb60-1699"><a href="#cb60-1699" aria-hidden="true" tabindex="-1"></a><span class="in">  ebitda_at = ebitda / at,</span></span>
<span id="cb60-1700"><a href="#cb60-1700" aria-hidden="true" tabindex="-1"></a><span class="in">  at_thousand = at * 10^-3,</span></span>
<span id="cb60-1701"><a href="#cb60-1701" aria-hidden="true" tabindex="-1"></a><span class="in">  large = factor(ifelse(large, yes = "Large", no = "Small"), levels = c("Large", "Small") ),</span></span>
<span id="cb60-1702"><a href="#cb60-1702" aria-hidden="true" tabindex="-1"></a><span class="in">  # large = ifelse(large, yes = 1, no = 0),</span></span>
<span id="cb60-1703"><a href="#cb60-1703" aria-hidden="true" tabindex="-1"></a><span class="in">  treated_large = paste(treated, large, sep = "_")</span></span>
<span id="cb60-1704"><a href="#cb60-1704" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb60-1705"><a href="#cb60-1705" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(treated_large, fyear) %&gt;%</span></span>
<span id="cb60-1706"><a href="#cb60-1706" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(n = n()) %&gt;%</span></span>
<span id="cb60-1707"><a href="#cb60-1707" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;%</span></span>
<span id="cb60-1708"><a href="#cb60-1708" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_wider(names_from = treated_large, values_from = n) %&gt;%</span></span>
<span id="cb60-1709"><a href="#cb60-1709" aria-hidden="true" tabindex="-1"></a><span class="in">  gt(caption = "Number of Observations in each group between 2002 and 2007") %&gt;%</span></span>
<span id="cb60-1710"><a href="#cb60-1710" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_style(</span></span>
<span id="cb60-1711"><a href="#cb60-1711" aria-hidden="true" tabindex="-1"></a><span class="in">    style = cell_text(size = "x-small"),  # Reduce font size</span></span>
<span id="cb60-1712"><a href="#cb60-1712" aria-hidden="true" tabindex="-1"></a><span class="in">    locations = cells_column_labels(columns = everything()) # reduce the size of tab headers</span></span>
<span id="cb60-1713"><a href="#cb60-1713" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb60-1714"><a href="#cb60-1714" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_style(</span></span>
<span id="cb60-1715"><a href="#cb60-1715" aria-hidden="true" tabindex="-1"></a><span class="in">    style = cell_text(size = "x-small"),  # Reduce font size</span></span>
<span id="cb60-1716"><a href="#cb60-1716" aria-hidden="true" tabindex="-1"></a><span class="in">    locations = cells_body()</span></span>
<span id="cb60-1717"><a href="#cb60-1717" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb60-1718"><a href="#cb60-1718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1719"><a href="#cb60-1719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1720"><a href="#cb60-1720" aria-hidden="true" tabindex="-1"></a><span class="in">cat("`bnl_intensity`: \n")</span></span>
<span id="cb60-1721"><a href="#cb60-1721" aria-hidden="true" tabindex="-1"></a><span class="in">data %&gt;%</span></span>
<span id="cb60-1722"><a href="#cb60-1722" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;%</span></span>
<span id="cb60-1723"><a href="#cb60-1723" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= intensity_measure_year &amp; fyear &lt;= period_end) %&gt;%</span></span>
<span id="cb60-1724"><a href="#cb60-1724" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, fyear, all_of(intensity_measure_name)) %&gt;%</span></span>
<span id="cb60-1725"><a href="#cb60-1725" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_wider(names_from = fyear, values_from = all_of(intensity_measure_name)) %&gt;%</span></span>
<span id="cb60-1726"><a href="#cb60-1726" aria-hidden="true" tabindex="-1"></a><span class="in">  column_to_rownames(var = "gvkey") %&gt;% # convert into rownames</span></span>
<span id="cb60-1727"><a href="#cb60-1727" aria-hidden="true" tabindex="-1"></a><span class="in">  round(digits = 6) %&gt;%</span></span>
<span id="cb60-1728"><a href="#cb60-1728" aria-hidden="true" tabindex="-1"></a><span class="in">  na.omit() %&gt;%</span></span>
<span id="cb60-1729"><a href="#cb60-1729" aria-hidden="true" tabindex="-1"></a><span class="in">  head(20)</span></span>
<span id="cb60-1730"><a href="#cb60-1730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1731"><a href="#cb60-1731" aria-hidden="true" tabindex="-1"></a><span class="in">cat("`book_leverage`: \n")</span></span>
<span id="cb60-1732"><a href="#cb60-1732" aria-hidden="true" tabindex="-1"></a><span class="in">data %&gt;%</span></span>
<span id="cb60-1733"><a href="#cb60-1733" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(book_leverage &gt;= 0 &amp; book_leverage &lt;= 1) %&gt;%</span></span>
<span id="cb60-1734"><a href="#cb60-1734" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fyear &gt;= intensity_measure_year &amp; fyear &lt;= period_end) %&gt;%</span></span>
<span id="cb60-1735"><a href="#cb60-1735" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, fyear, book_leverage) %&gt;%</span></span>
<span id="cb60-1736"><a href="#cb60-1736" aria-hidden="true" tabindex="-1"></a><span class="in">  pivot_wider(names_from = fyear, values_from = book_leverage) %&gt;%</span></span>
<span id="cb60-1737"><a href="#cb60-1737" aria-hidden="true" tabindex="-1"></a><span class="in">  column_to_rownames(var = "gvkey") %&gt;% # convert into rownames</span></span>
<span id="cb60-1738"><a href="#cb60-1738" aria-hidden="true" tabindex="-1"></a><span class="in">  round(digits = 6) %&gt;%</span></span>
<span id="cb60-1739"><a href="#cb60-1739" aria-hidden="true" tabindex="-1"></a><span class="in">  na.omit() %&gt;%</span></span>
<span id="cb60-1740"><a href="#cb60-1740" aria-hidden="true" tabindex="-1"></a><span class="in">  head(20)</span></span>
<span id="cb60-1741"><a href="#cb60-1741" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb60-1742"><a href="#cb60-1742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1743"><a href="#cb60-1743" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb60-1744"><a href="#cb60-1744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1745"><a href="#cb60-1745" aria-hidden="true" tabindex="-1"></a><span class="fu">## EndNotes {#sec-EndNotes}</span></span>
<span id="cb60-1746"><a href="#cb60-1746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1747"><a href="#cb60-1747" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[ ]</span> If the land and building lease obligations (<span class="in">`bnl_lease`</span>) are not constantly renewed, it will decrease over time. Therefore, the lease intensity should go down over time as well. Relative to those untreated firms, i.e. w/o <span class="in">`bnl_lease`</span>, treated firms should generally have a higher leverage.</span>
<span id="cb60-1748"><a href="#cb60-1748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1749"><a href="#cb60-1749" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Use small firms with zero <span class="in">`bnl_lease`</span> as the benchmark.</span>
<span id="cb60-1750"><a href="#cb60-1750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1751"><a href="#cb60-1751" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>big firms with zero <span class="in">`bnl_lease`</span> have similar level of leverage over time.</span>
<span id="cb60-1752"><a href="#cb60-1752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1753"><a href="#cb60-1753" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>small firms with positive <span class="in">`bnl_lease`</span> have significantly higher leverage before the treatment and significantly lower leverage afterwards.</span>
<span id="cb60-1754"><a href="#cb60-1754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1755"><a href="#cb60-1755" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>big firms with positive <span class="in">`bnl_lease`</span> have significantly higher leverage before the treatment and are indifferent from the benchmark after the treatment.</span>
<span id="cb60-1756"><a href="#cb60-1756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1757"><a href="#cb60-1757" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>parallel trend assumption should hold.</span>
<span id="cb60-1758"><a href="#cb60-1758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1759"><a href="#cb60-1759" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For nice plots: <span class="co">[</span><span class="ot">`ggiplot()`</span><span class="co">](https://grantmcdermott.com/ggfixest/articles/ggiplot.html)</span></span>
<span id="cb60-1760"><a href="#cb60-1760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1761"><a href="#cb60-1761" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Measures for financial constraints are from <span class="co">[</span><span class="ot">Appendix A.2</span><span class="co">](https://academic.oup.com/rfs/article/29/2/271/1902640?searchresult=1#114343035)</span> <span class="sc">\&gt;</span> @sec-s2-clean-prep</span>
<span id="cb60-1762"><a href="#cb60-1762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1763"><a href="#cb60-1763" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Joan Farre-Mensa, Alexander Ljungqvist, Do Measures of Financial Constraints Measure Financial Constraints?, The Review of Financial Studies, Volume 29, Issue 2, February 2016, Pages 271–308, <span class="ot">&lt;https://doi.org/10.1093/rfs/hhv052&gt;</span></span>
<span id="cb60-1764"><a href="#cb60-1764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-1765"><a href="#cb60-1765" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="va">[ ]</span> Should we still use <span class="in">`fyear = 2005`</span> as the base year with <span class="in">`indexyear = 0`</span>? As it came into effect in Oct 2005, most of the treatment effect will show up in 2005. &lt;mark&gt;Should we choose 2004 as the base year&lt;/mark&gt;?</span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>