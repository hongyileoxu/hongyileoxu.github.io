<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hongyi Xu">
<meta name="dcterms.date" content="2024-06-19">

<title>DealScan Loan Path</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="DealScan_Loan_Path_files/libs/clipboard/clipboard.min.js"></script>
<script src="DealScan_Loan_Path_files/libs/quarto-html/quarto.js"></script>
<script src="DealScan_Loan_Path_files/libs/quarto-html/popper.min.js"></script>
<script src="DealScan_Loan_Path_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="DealScan_Loan_Path_files/libs/quarto-html/anchor.min.js"></script>
<link href="DealScan_Loan_Path_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="DealScan_Loan_Path_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="DealScan_Loan_Path_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="DealScan_Loan_Path_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="DealScan_Loan_Path_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-s1.-objective" id="toc-sec-s1.-objective" class="nav-link active" data-scroll-target="#sec-s1.-objective">S1. Objective</a></li>
  <li><a href="#sec-s2.-firms-lift-cycle-identifier" id="toc-sec-s2.-firms-lift-cycle-identifier" class="nav-link" data-scroll-target="#sec-s2.-firms-lift-cycle-identifier">S2. Firm’s Life-cycle Identifier</a></li>
  <li><a href="#s3.-connect-and-build-the-loan-paths" id="toc-s3.-connect-and-build-the-loan-paths" class="nav-link" data-scroll-target="#s3.-connect-and-build-the-loan-paths">S3. Connect and build the loan paths</a></li>
  <li><a href="#s4.-clean-the-loan-renegotiation-data" id="toc-s4.-clean-the-loan-renegotiation-data" class="nav-link" data-scroll-target="#s4.-clean-the-loan-renegotiation-data">S4. Clean the loan renegotiation data</a></li>
  <li><a href="#sec-reference" id="toc-sec-reference" class="nav-link" data-scroll-target="#sec-reference">Reference</a></li>
  <li><a href="#to-do-list" id="toc-to-do-list" class="nav-link" data-scroll-target="#to-do-list">To-do list:</a></li>
  <li><a href="#trashbin" id="toc-trashbin" class="nav-link" data-scroll-target="#trashbin">Trashbin:</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">DealScan Loan Path</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Hongyi Xu </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 19, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><a href="https://hongyileoxu.github.io/research/">&gt; Back to research</a></p>
<style type="text/css">
body, td {
   font-size: 16px;
}
code.r{
  font-size: 12px;
}
pre {
  font-size: 12px
}
</style>
<section id="sec-s1.-objective" class="level2">
<h2 class="anchored" data-anchor-id="sec-s1.-objective">S1. Objective</h2>
<p>This file follows file “DealScan_Data_Renegotiation.html”. The aim of this file is to extract the loan path and I also further clean the file <code>Link_table_2024.RData</code> to gather all pair of identifiers for a unique firm over its life-cycle.</p>
<p>Here is a notes on the <a href="https://wrds-www.wharton.upenn.edu/pages/support/support-articles/thomson-reuters/dealscan/wrds-financial-covenants-table/">WRDS Financial Covenants Table</a>. The document there provides names and definitions on each financial covenants terms in the new DealScan data.</p>
</section>
<section id="sec-s2.-firms-lift-cycle-identifier" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sec-s2.-firms-lift-cycle-identifier">S2. Firm’s Life-cycle Identifier</h2>
<p>In order to identify the loan path (or deal path), I first need to identify the life-cycle of a firm’s identifiers, including <code>gvkey</code>, <code>Borrower_Id</code>, <code>borrowercompanyid</code>, etc. So, I start with the link table created in the first section &gt; <a href="https://hongyileoxu.github.io/research/project-2024/DealScan2024/DealScan_Link_Table_Compustat.html">HTML Manual</a>.</p>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## import dataset </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"Link_table_2024.RData"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">## get the new company identifiers from network analysis </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>Link_table.newgroups <span class="ot">&lt;-</span> Link_table <span class="sc">%&gt;%</span> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_or</span>(<span class="at">id1 =</span> <span class="st">"gvkey"</span>, <span class="at">id2 =</span> <span class="st">"borrowercompanyid"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="do">## join back to the original dataset </span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>dt.Link_table <span class="ot">&lt;-</span> Link_table <span class="sc">%&gt;%</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">facilitystartdate =</span> <span class="fu">as.Date</span>(facilitystartdate),</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">LoanConnector Company ID</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.integer</span>(<span class="st">`</span><span class="at">LoanConnector Company ID</span><span class="st">`</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(Link_table.newgroups, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"gvkey"</span>, <span class="st">"borrowercompanyid"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"facility"</span>), gvkey_group1, <span class="fu">everything</span>(.)) </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="do">## a preview </span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>dt.Link_table <span class="sc">%&gt;%</span> </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(facilitystartdate) <span class="sc">%&gt;%</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gvkey_group1 <span class="sc">==</span> <span class="dv">22</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="st">"New Link table for Aeroflex Inc. (previously known as ARX Inc.)"</span>, </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">subtitle =</span> <span class="fu">html</span>(<span class="st">'&lt;span class="red-star"&gt;★&lt;/span&gt;Now the variable `gvkey_group1` is used to track the loan path'</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>             ) <span class="sc">%&gt;%</span> </span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(<span class="at">table.font.size =</span> <span class="dv">10</span>, <span class="at">heading.align =</span> <span class="st">'left'</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>( <span class="co"># update the font size for table cells. </span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">size =</span> <span class="fu">px</span>(<span class="dv">10</span>)),</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_body</span>()</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data_color</span>(</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"gvkey"</span>, <span class="st">"borrowercompanyid"</span>),</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"factor"</span>,</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"viridis"</span>, </span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">reverse =</span> <span class="cn">TRUE</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_hide</span>(<span class="at">columns =</span> <span class="fu">matches</span>(<span class="st">"score|match"</span>) ) <span class="co"># hide columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display column-screen-inset">
<div id="zhscycdkld" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#zhscycdkld table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#zhscycdkld thead, #zhscycdkld tbody, #zhscycdkld tfoot, #zhscycdkld tr, #zhscycdkld td, #zhscycdkld th {
  border-style: none;
}

#zhscycdkld p {
  margin: 0;
  padding: 0;
}

#zhscycdkld .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 10px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#zhscycdkld .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#zhscycdkld .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#zhscycdkld .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#zhscycdkld .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zhscycdkld .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zhscycdkld .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zhscycdkld .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#zhscycdkld .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#zhscycdkld .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#zhscycdkld .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#zhscycdkld .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#zhscycdkld .gt_spanner_row {
  border-bottom-style: hidden;
}

#zhscycdkld .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#zhscycdkld .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#zhscycdkld .gt_from_md > :first-child {
  margin-top: 0;
}

#zhscycdkld .gt_from_md > :last-child {
  margin-bottom: 0;
}

#zhscycdkld .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#zhscycdkld .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#zhscycdkld .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#zhscycdkld .gt_row_group_first td {
  border-top-width: 2px;
}

#zhscycdkld .gt_row_group_first th {
  border-top-width: 2px;
}

#zhscycdkld .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zhscycdkld .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#zhscycdkld .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#zhscycdkld .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zhscycdkld .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zhscycdkld .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#zhscycdkld .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#zhscycdkld .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#zhscycdkld .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zhscycdkld .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zhscycdkld .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zhscycdkld .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zhscycdkld .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zhscycdkld .gt_left {
  text-align: left;
}

#zhscycdkld .gt_center {
  text-align: center;
}

#zhscycdkld .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#zhscycdkld .gt_font_normal {
  font-weight: normal;
}

#zhscycdkld .gt_font_bold {
  font-weight: bold;
}

#zhscycdkld .gt_font_italic {
  font-style: italic;
}

#zhscycdkld .gt_super {
  font-size: 65%;
}

#zhscycdkld .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#zhscycdkld .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#zhscycdkld .gt_indent_1 {
  text-indent: 5px;
}

#zhscycdkld .gt_indent_2 {
  text-indent: 10px;
}

#zhscycdkld .gt_indent_3 {
  text-indent: 15px;
}

#zhscycdkld .gt_indent_4 {
  text-indent: 20px;
}

#zhscycdkld .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="11" class="gt_heading gt_title gt_font_normal">New Link table for Aeroflex Inc. (previously known as ARX Inc.)</th>
</tr>
<tr class="odd gt_heading">
<th colspan="11" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border"><span class="red-star">★</span>Now the variable `gvkey_group1` is used to track the loan path</th>
</tr>
<tr class="header gt_col_headings">
<th id="facilityid" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">facilityid</th>
<th id="facilitystartdate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">facilitystartdate</th>
<th id="gvkey_group1" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">gvkey_group1</th>
<th id="gvkey" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">gvkey</th>
<th id="borrowercompanyid" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">borrowercompanyid</th>
<th id="ds_company" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">ds_company</th>
<th id="cs_company" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">cs_company</th>
<th id="ds_ticker" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">ds_ticker</th>
<th id="cs_ticker" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">cs_ticker</th>
<th id="Company Name" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Company Name</th>
<th id="LoanConnector Company ID" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">LoanConnector Company ID</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">5171</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">1989-04-24</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #000000; background-color: #FDE725">2463</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">ARX Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">ARX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">ARX Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">31224</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">10226</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">1991-10-10</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #000000; background-color: #FDE725">2463</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">ARX Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">ARX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">ARX Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">31224</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">10227</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">1991-10-10</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #000000; background-color: #FDE725">2463</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">ARX Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">ARX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">ARX Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">31224</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">27968</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">1994-04-11</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #000000; background-color: #FDE725">2463</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">ARX Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">ARX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">ARX Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">31224</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">27969</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">1994-04-11</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #000000; background-color: #FDE725">2463</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">ARX Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">ARX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">ARX Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">31224</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">62943</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">1996-03-15</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">62944</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">1996-03-15</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">67177</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">1999-02-25</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">67178</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">1999-02-25</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">67179</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">1999-02-25</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">145204</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2003-02-14</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARXX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">145320</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2003-02-14</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARXX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">194507</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2006-03-21</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARXX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">214917</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2007-04-13</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARXX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">214918</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2007-04-13</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARXX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">214919</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2007-04-13</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARXX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">219384</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2007-08-15</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARXX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">221951</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2007-08-15</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARXX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">223289</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2007-08-15</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARXX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">269533</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2011-05-09</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARXX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">269534</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2011-05-09</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARXX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">303619</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2013-05-28</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #FFFFFF; background-color: #440154">184639</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX HOLDING CORP</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">304052</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2013-05-28</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #FFFFFF; background-color: #440154">184639</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX HOLDING CORP</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
</tbody>
</table>

</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## export the updated link table </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(dt.Link_table, <span class="at">file =</span> <span class="st">"dt.Link_table_2024.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>An example from <a href="https://stackoverflow.com/questions/68947862/grouping-similar-elements-together">the web</a> to use network analysis for more granular grouping assignments.</li>
</ul>

<div class="no-row-height column-margin column-container"><div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the necessary libraries</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Manually generating data</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>Names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">'James,Gordon'</span>,<span class="dv">6</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>          ,<span class="fu">rep</span>(<span class="st">'Amanda'</span>,<span class="dv">3</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>          ,<span class="fu">rep</span>(<span class="st">'Gordon,Amanda'</span>,<span class="dv">8</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>          ,<span class="fu">rep</span>(<span class="st">'Edward,Gordon,Amanda'</span>,<span class="dv">3</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>          ,<span class="fu">rep</span>(<span class="st">'Anna'</span>,<span class="dv">3</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>          ,<span class="fu">rep</span>(<span class="st">'Anna,Leonard'</span>,<span class="dv">3</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>Initial_Group <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>,<span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">3</span>,<span class="dv">8</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>))</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>Final_Group <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">'A'</span>,<span class="st">'B'</span>),<span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">6</span>))</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Names,Initial_Group,Final_Group)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Names)<span class="sc">%&gt;%</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Names, <span class="fu">c</span>(<span class="st">'first'</span>, <span class="st">'second'</span>), <span class="at">extra =</span> <span class="st">'merge'</span>, <span class="at">fill =</span> <span class="st">'right'</span>)<span class="sc">%&gt;%</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(second) <span class="sc">%&gt;%</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">second =</span> <span class="fu">coalesce</span>(second, <span class="fu">as.character</span>(<span class="fu">cumsum</span>(<span class="fu">is.na</span>(second))))) <span class="sc">%&gt;%</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">graph_from_data_frame</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getElement</span>(<span class="st">'membership'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">imap</span>(<span class="sc">~</span><span class="fu">str_detect</span>(data<span class="sc">$</span>Names, .y)<span class="sc">*</span>.x) <span class="sc">%&gt;%</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invoke</span>(pmax, .) <span class="sc">%&gt;%</span> <span class="co"># `invoke` is applied to apply function to the same location in each element under a list </span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(data, <span class="at">value =</span> LETTERS[.], <span class="at">value1 =</span> .) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></div><p>In the above example for Aeroflex Inc.&nbsp;(previously known as ARX Inc.), one company may match multiple combinations of two identifiers - <code>gvkey</code> and <code>borrowercompanyid</code>/<code>LoanConnector Company ID</code> - and I recreate a new identifier <code>gvkey_group1</code> to uniquely identify one firm’s life-cycle in the dataset. <code>borrowercompanyid</code> is the borrower identifier in the Legacy DealScan dataset and <code>LoanConnector Company ID</code> is for the new LPC DealScan.</p>
<!--- .column-margin --->
<div id="tip-loan-path" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip&nbsp;1: A finer link table
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In the current version of the link table, <code>dt.Link_table</code>, facility/tranche level information is also included. A cleaner version of the link table will only include borrower level observations.</p>
</div>
</div>
</div>
<p>One additional thing to notice is that although no missing values observed in variable <code>borrowercompanyid</code> (and also <code>gvkey</code>), <code>LoanConnector Company ID</code> contains missing value, around 66 observations.</p>
</section>
<section id="s3.-connect-and-build-the-loan-paths" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="s3.-connect-and-build-the-loan-paths">S3. Connect and build the loan paths</h2>
<p>Here are the steps to achieve this:</p>
<ol type="1">
<li><p>load the dataset for the new link table - <code>dt.Link_table</code> and for all Deal-Tranches with borrower information - <code>DealScan_borrower</code>. The dataset <code>dt.name_match</code> is used to guide the selection of variables for specific analyses. <a href="https://hongyileoxu.github.io/research/project-2024/DealScan2024/DealScan_Data_Renegotiation.html#sec-s3.4-classify-variable-names">&gt; refer to section s3.4 in this document.</a></p></li>
<li><p>Cross validate the changes in the loan amount using the item <mark>“Cash flows from financing activities”</mark> from the <mark>“CONSOLIDATED STATEMENTS OF CASH FLOWS”</mark>.</p>
<blockquote class="blockquote">
<p>One example from JACO ELECTRONICS INC (<code>gvkey_group1 == 1894</code>) and its <a href="https://www.sec.gov/Archives/edgar/data/52971/0000950123-95-002603.txt">SEC filing</a>. Search <code>Term Loan</code> in the filing and you will much more renegotiations than ones recorded in the DealScan.</p>
</blockquote></li>
</ol>
<p><b>Let’s start!</b></p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## load the necessary tables</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"dt.Link_table"</span>)) {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## check whether the variable `dt.Link_table` is there. &gt; if yes, then .... </span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="at">file =</span> <span class="st">"dt.Link_table_2024.RData"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="do">### load the dealscan data for only borrowers information &gt; DealScan_borrower </span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">"~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Data_Renegotiations_Jun2024/DealScan_borrower.RData"</span>) </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="do">### load the dealscan variable names &gt; dt.name_match </span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">"~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Data_Renegotiations_Jun2024/DealScan_name_match.RData"</span>) </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>name_covenants_17 <span class="ot">&lt;-</span> dt.name_match <span class="sc">%&gt;%</span> <span class="co"># financial covenants </span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="at">pattern =</span> <span class="st">"^17:"</span>, <span class="at">x =</span> group_header)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span>orig_name</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>name_covenants_19 <span class="ot">&lt;-</span> dt.name_match <span class="sc">%&gt;%</span> <span class="co"># general covenants </span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="at">pattern =</span> <span class="st">"^19:"</span>, <span class="at">x =</span> group_header)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span>orig_name</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>name_renegotiation <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="co"># names for the </span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grep</span>(<span class="at">pattern =</span> <span class="st">"LPC|_O_A"</span>, <span class="at">x =</span> <span class="fu">names</span>(DealScan_borrower), <span class="at">value =</span> T), </span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grep</span>(<span class="at">pattern =</span> <span class="st">"Amended"</span>, <span class="at">x =</span> <span class="fu">names</span>(DealScan_borrower), <span class="at">value =</span> T), </span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grep</span>(<span class="at">pattern =</span> <span class="st">"Refinan"</span>, <span class="at">x =</span> <span class="fu">names</span>(DealScan_borrower), <span class="at">value =</span> T)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="do">## link the two data sets </span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>dt.DealScan_borrower <span class="ot">&lt;-</span> DealScan_borrower <span class="sc">%&gt;%</span> </span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Borrower_Id, Borrower_Name, </span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>         (<span class="sc">!!</span> name_renegotiation), <span class="co"># all flags for different kind of renegotiations. </span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>         <span class="fu">grep</span>(<span class="at">x =</span> <span class="fu">names</span>(.), <span class="at">pattern =</span> <span class="st">"Matur"</span>, <span class="at">ignore.case =</span> T, <span class="at">value =</span> T), </span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Deal_Amount"</span>, <span class="st">"Tranche_Amount"</span>, </span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Deal_Active_Date"</span>, <span class="st">"Deal_Input_Date"</span>, <span class="st">"Tranche_Active_Date"</span>, </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Tranche_Type"</span>, <span class="st">"Deal_Purpose"</span>, </span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>         <span class="fu">grep</span>(<span class="at">pattern =</span> <span class="st">"Remark"</span>, <span class="at">x =</span> <span class="fu">names</span>(.), <span class="at">value =</span> T)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"Date"</span>), as.Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">Event_amend =</span> <span class="fu">grepl</span>(<span class="at">x =</span> Deal_Remark, <span class="at">pattern =</span> <span class="st">"amend"</span>, <span class="at">ignore.case =</span> T), <span class="co"># whether the term 'amend' is detected </span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">Event_restate =</span> <span class="fu">grepl</span>(<span class="at">x =</span> Deal_Remark, <span class="at">pattern =</span> <span class="st">"restate"</span>, <span class="at">ignore.case =</span> T), <span class="co"># whether the term 'restate' is detected </span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">Event_refin =</span> <span class="fu">grepl</span>(<span class="at">x =</span> Deal_Remark, <span class="at">pattern =</span> <span class="st">"refin"</span>, <span class="at">ignore.case =</span> T) <span class="co"># whether the term 'refinancing' is detected </span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Event_renegotiation =</span> (Event_amend <span class="sc">|</span> Event_amend <span class="sc">|</span> Event_refin) ) <span class="co"># whether there exists an events identified by contents in `Deal_Remark` </span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="do">### The last several lines collect information about whether an amend or amend/restate event happen. </span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="do">### The `Event_renegotiation` variable detect whether a renegotiation event happens. </span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="do">### Also, I check whether a deal is a refinancing of previous loan. </span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="co"># names(dt.DealScan_borrower) </span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="co"># names(dt.Link_table)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here a summary for the variables <code>Event_amend</code>, <code>Event_restate</code>,<code>Event_refin</code> and <code>Event_renegotiation</code> under each group classified by amendment/refinancing flags in DealScan.</p>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to identify different types of contracts which are defined as "Origination". </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>dt.DealScan_borrower <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="at">pattern =</span> <span class="st">"Orig"</span>, <span class="at">x =</span> Tranche_O_A)) <span class="sc">%&gt;%</span> <span class="co"># only keep tranches classified as "Origination"</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Deal_Amended, Tranche_Amended, Deal_Refinancing, Tranche_Refinancing) <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_Event_amend =</span> <span class="fu">sum</span>(Event_amend), </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_Event_restate =</span> <span class="fu">sum</span>(Event_restate), </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_Event =</span> <span class="fu">sum</span>(Event_renegotiation), </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_Event_refin =</span> <span class="fu">sum</span>(Event_refin) </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> <span class="co"># count the number of each types </span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage_n =</span> (n <span class="sc">/</span> <span class="fu">sum</span>(n))) <span class="sc">%&gt;%</span> </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="st">"Table 2a: WRDS DealScan Deal-Tranche Level Loan Events"</span>, </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">subtitle =</span> <span class="st">"Subgroup: `Tranche_O_A` = Origination"</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>             ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(<span class="at">table.font.size =</span> <span class="dv">11</span>, <span class="at">heading.align =</span> <span class="st">'left'</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>( <span class="co"># update the font size for table cells. </span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">size =</span> <span class="fu">px</span>(<span class="dv">11</span>)),</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_body</span>()</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_percent</span>(<span class="at">columns =</span> percentage_n, <span class="at">decimals =</span> <span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display column-screen-inset">
<div id="fobifllchp" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#fobifllchp table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#fobifllchp thead, #fobifllchp tbody, #fobifllchp tfoot, #fobifllchp tr, #fobifllchp td, #fobifllchp th {
  border-style: none;
}

#fobifllchp p {
  margin: 0;
  padding: 0;
}

#fobifllchp .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 11px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#fobifllchp .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#fobifllchp .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#fobifllchp .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#fobifllchp .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fobifllchp .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fobifllchp .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fobifllchp .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#fobifllchp .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#fobifllchp .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#fobifllchp .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#fobifllchp .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#fobifllchp .gt_spanner_row {
  border-bottom-style: hidden;
}

#fobifllchp .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#fobifllchp .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#fobifllchp .gt_from_md > :first-child {
  margin-top: 0;
}

#fobifllchp .gt_from_md > :last-child {
  margin-bottom: 0;
}

#fobifllchp .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#fobifllchp .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#fobifllchp .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#fobifllchp .gt_row_group_first td {
  border-top-width: 2px;
}

#fobifllchp .gt_row_group_first th {
  border-top-width: 2px;
}

#fobifllchp .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fobifllchp .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#fobifllchp .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#fobifllchp .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fobifllchp .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fobifllchp .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#fobifllchp .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#fobifllchp .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#fobifllchp .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fobifllchp .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fobifllchp .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fobifllchp .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fobifllchp .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fobifllchp .gt_left {
  text-align: left;
}

#fobifllchp .gt_center {
  text-align: center;
}

#fobifllchp .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#fobifllchp .gt_font_normal {
  font-weight: normal;
}

#fobifllchp .gt_font_bold {
  font-weight: bold;
}

#fobifllchp .gt_font_italic {
  font-style: italic;
}

#fobifllchp .gt_super {
  font-size: 65%;
}

#fobifllchp .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#fobifllchp .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#fobifllchp .gt_indent_1 {
  text-indent: 5px;
}

#fobifllchp .gt_indent_2 {
  text-indent: 10px;
}

#fobifllchp .gt_indent_3 {
  text-indent: 15px;
}

#fobifllchp .gt_indent_4 {
  text-indent: 20px;
}

#fobifllchp .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="10" class="gt_heading gt_title gt_font_normal">Table 2a: WRDS DealScan Deal-Tranche Level Loan Events</th>
</tr>
<tr class="odd gt_heading">
<th colspan="10" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Subgroup: `Tranche_O_A` = Origination</th>
</tr>
<tr class="header gt_col_headings">
<th id="Deal_Amended" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Deal_Amended</th>
<th id="Tranche_Amended" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Tranche_Amended</th>
<th id="Deal_Refinancing" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Deal_Refinancing</th>
<th id="Tranche_Refinancing" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Tranche_Refinancing</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n</th>
<th id="n_Event_amend" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_Event_amend</th>
<th id="n_Event_restate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_Event_restate</th>
<th id="n_Event" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_Event</th>
<th id="n_Event_refin" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_Event_refin</th>
<th id="percentage_n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">percentage_n</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px"></td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">240423</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">2974</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">1541</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">5608</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">2806</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">62.95%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">2573</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">4</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">19</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">17</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.67%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">2079</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">2</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">2</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">57</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">57</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.54%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px"></td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">68556</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">3645</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">2716</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">7297</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">3976</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">17.95%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">72</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">2</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">1</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">3</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">1</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.02%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">27318</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">97</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">12</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">602</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">530</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">7.15%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px"></td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">568</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">6</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">7</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">1</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.15%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">11</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.00%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">3</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.00%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px"></td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">450</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">24</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">13</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">55</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">37</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.12%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">82</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">1</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">2</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">1</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.02%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px"></td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">19375</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">514</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">217</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">659</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">200</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">5.07%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">544</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">2</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">2</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">5</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">3</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.14%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">233</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">4</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">7</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">3</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.06%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px"></td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">15319</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">1156</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">881</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">2425</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">1427</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">4.01%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">28</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.01%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">4304</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">35</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">2</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">94</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">63</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">1.13%</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to identify different types of contracts which are defined as "Amendment 1". </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>dt.DealScan_borrower <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="at">pattern =</span> <span class="st">"Amendment"</span>, <span class="at">x =</span> Tranche_O_A)) <span class="sc">%&gt;%</span> <span class="co"># only keep tranches classified as "Origination"</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Deal_Amended, Tranche_Amended, Deal_Refinancing, Tranche_Refinancing) <span class="sc">%&gt;%</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_Event_amend =</span> <span class="fu">sum</span>(Event_amend), </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_Event_restate =</span> <span class="fu">sum</span>(Event_restate), </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_Event =</span> <span class="fu">sum</span>(Event_renegotiation), </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_Event_refin =</span> <span class="fu">sum</span>(Event_refin) </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> <span class="co"># count the number of each types </span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage_n =</span> (n <span class="sc">/</span> <span class="fu">sum</span>(n))) <span class="sc">%&gt;%</span> </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="st">"Table 2b: WRDS DealScan Deal-Tranche Level Loan Events"</span>, </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">subtitle =</span> <span class="st">"Subgroup: `Tranche_O_A` = Amendment(s)"</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>             ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(<span class="at">table.font.size =</span> <span class="dv">11</span>, <span class="at">heading.align =</span> <span class="st">'left'</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>( <span class="co"># update the font size for table cells. </span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">size =</span> <span class="fu">px</span>(<span class="dv">11</span>)),</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_body</span>()</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_percent</span>(<span class="at">columns =</span> percentage_n, <span class="at">decimals =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display column-screen-inset">
<div id="ynuxjnklhd" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ynuxjnklhd table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ynuxjnklhd thead, #ynuxjnklhd tbody, #ynuxjnklhd tfoot, #ynuxjnklhd tr, #ynuxjnklhd td, #ynuxjnklhd th {
  border-style: none;
}

#ynuxjnklhd p {
  margin: 0;
  padding: 0;
}

#ynuxjnklhd .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 11px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ynuxjnklhd .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ynuxjnklhd .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ynuxjnklhd .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ynuxjnklhd .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ynuxjnklhd .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ynuxjnklhd .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ynuxjnklhd .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ynuxjnklhd .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ynuxjnklhd .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ynuxjnklhd .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ynuxjnklhd .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ynuxjnklhd .gt_spanner_row {
  border-bottom-style: hidden;
}

#ynuxjnklhd .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ynuxjnklhd .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ynuxjnklhd .gt_from_md > :first-child {
  margin-top: 0;
}

#ynuxjnklhd .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ynuxjnklhd .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ynuxjnklhd .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ynuxjnklhd .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ynuxjnklhd .gt_row_group_first td {
  border-top-width: 2px;
}

#ynuxjnklhd .gt_row_group_first th {
  border-top-width: 2px;
}

#ynuxjnklhd .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ynuxjnklhd .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ynuxjnklhd .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ynuxjnklhd .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ynuxjnklhd .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ynuxjnklhd .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ynuxjnklhd .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ynuxjnklhd .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ynuxjnklhd .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ynuxjnklhd .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ynuxjnklhd .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ynuxjnklhd .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ynuxjnklhd .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ynuxjnklhd .gt_left {
  text-align: left;
}

#ynuxjnklhd .gt_center {
  text-align: center;
}

#ynuxjnklhd .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ynuxjnklhd .gt_font_normal {
  font-weight: normal;
}

#ynuxjnklhd .gt_font_bold {
  font-weight: bold;
}

#ynuxjnklhd .gt_font_italic {
  font-style: italic;
}

#ynuxjnklhd .gt_super {
  font-size: 65%;
}

#ynuxjnklhd .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ynuxjnklhd .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ynuxjnklhd .gt_indent_1 {
  text-indent: 5px;
}

#ynuxjnklhd .gt_indent_2 {
  text-indent: 10px;
}

#ynuxjnklhd .gt_indent_3 {
  text-indent: 15px;
}

#ynuxjnklhd .gt_indent_4 {
  text-indent: 20px;
}

#ynuxjnklhd .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="10" class="gt_heading gt_title gt_font_normal">Table 2b: WRDS DealScan Deal-Tranche Level Loan Events</th>
</tr>
<tr class="odd gt_heading">
<th colspan="10" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Subgroup: `Tranche_O_A` = Amendment(s)</th>
</tr>
<tr class="header gt_col_headings">
<th id="Deal_Amended" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Deal_Amended</th>
<th id="Tranche_Amended" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Tranche_Amended</th>
<th id="Deal_Refinancing" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Deal_Refinancing</th>
<th id="Tranche_Refinancing" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Tranche_Refinancing</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n</th>
<th id="n_Event_amend" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_Event_amend</th>
<th id="n_Event_restate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_Event_restate</th>
<th id="n_Event" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_Event</th>
<th id="n_Event_refin" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_Event_refin</th>
<th id="percentage_n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">percentage_n</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px"></td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px"></td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">4173</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">7</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">7</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">3.47%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px"></td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">24</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.02%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px"></td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">47</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.04%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px"></td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px"></td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">2507</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">4</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">6</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">2</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">2.09%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px"></td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">3</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.00%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px"></td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">826</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">9</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">9</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.69%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px"></td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">34180</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">77</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">4</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">81</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">8</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">28.44%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">911</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">6</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">7</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">1</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.76%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">2247</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">11</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">1</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">11</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">1.87%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px"></td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">52319</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">224</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">2</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">263</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">46</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">43.53%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">652</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">4</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">4</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.54%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">22294</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">339</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">10</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">385</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">72</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">18.55%</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now we merge the DealScan deal-tranche information with the link table and try to extract the loan path. To facilite data analysis, I create a new variable <b><code>obs_id</code></b>, standing for the id for each observation in the dataset, and will be used as the sole identifier in subsequent data mergers.</p>
<p>Also, I create a new firm-deal level identifier <code>firm_deal_id</code> to facilitate the data cleaning process. Note that this is more of a <u>“firm-deal-time id”</u>.</p>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># merge the deal/tranche information with the link table. </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="do">### direct merge creates the issue of multiple-to-multiple matching. &gt; solve this issue by matching at the deal, not tranche, level. </span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>dt.DealScan_borrower_Linked <span class="ot">&lt;-</span> dt.DealScan_borrower <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">distinct</span>(<span class="fu">select</span>(dt.Link_table, <span class="sc">-</span><span class="fu">c</span>(<span class="st">"facilityid"</span>, <span class="fu">contains</span>(<span class="st">"ticker"</span>)))), <span class="co"># collect deal-level </span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">join_by</span>(Borrower_Id <span class="sc">==</span> <span class="st">`</span><span class="at">LoanConnector Company ID</span><span class="st">`</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                         Tranche_Active_Date <span class="sc">==</span> facilitystartdate))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># dt.DealScan_borrower_Linked %&gt;% filter(Borrower_Id == 17400)</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># names(dt.DealScan_borrower_Linked) </span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># firm-deal-tranche level data </span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"I use the self-created `gvkey_group1` variable as the unique company identifer. (restrict to max 100 observations) Observations are at the firm-deal-tranche-time level."</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>I use the self-created <code>gvkey_group1</code> variable as the unique company identifer. (restrict to max 100 observations) Observations are at the firm-deal-tranche-time level.</p>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>dt.DealScan_borrower_unifirm <span class="ot">&lt;-</span> dt.DealScan_borrower_Linked <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gvkey_group1) <span class="sc">%&gt;%</span> <span class="co"># for each unique firm over the life-cycle </span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Tranche_Active_Date) <span class="sc">%&gt;%</span>  <span class="co"># %&gt;% # arrange by its </span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">"obs_id"</span>) <span class="co"># a new id for each observation in the data </span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the distribution of firms with number of observations in the sample </span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>dt.DealScan_borrower_unifirm <span class="sc">%&gt;%</span> <span class="co"># group firms by the `gvkey_group1` variable </span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(., ) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="fu">aes</span>(n)) <span class="sc">+</span>  <span class="co"># + scale_y_continuous(transform = "log10")</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><img src="DealScan_Loan_Path_files/figure-html/loan_path2-1.png" class="img-fluid" width="672"></p>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># analyse at the firm-deal level (not tranche level) &gt; always for the same firm</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>dt.DealScan_borrower_unifirm_deal <span class="ot">&lt;-</span> dt.DealScan_borrower_unifirm <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">flag_renegotiation =</span> <span class="fu">ifelse</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="at">pattern =</span> <span class="st">"Amendment"</span>, <span class="at">x =</span> Tranche_O_A, <span class="at">fixed =</span> T) <span class="sc">|</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>      (<span class="sc">!</span><span class="fu">grepl</span>(<span class="at">pattern =</span> <span class="st">"Amendment"</span>, <span class="at">x =</span> Tranche_O_A, <span class="at">fixed =</span> T) <span class="sc">&amp;</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>         (Deal_Amended <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> Deal_Refinancing <span class="sc">==</span> <span class="st">"Yes"</span>) ), <span class="co"># the selection criterion: Deal_Refinancing == "Yes" might need further examinations. </span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">yes =</span> <span class="cn">TRUE</span>, <span class="at">no =</span> <span class="cn">FALSE</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  ) ) <span class="sc">%&gt;%</span> <span class="co"># use LPC flags to identify renegotiations *** </span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey_group1, <span class="co"># obs_id </span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>         Deal_Active_Date, Tranche_Active_Date, Tranche_Maturity_Date, Deal_Input_Date, </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>         <span class="fu">contains</span>(<span class="st">"Amount"</span>), (<span class="sc">!!</span> name_renegotiation), </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>         Deal_Remark, Tranche_Remark, <span class="fu">starts_with</span>(<span class="st">"Event"</span>), flag_renegotiation, </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span><span class="fu">contains</span>(<span class="st">"Tranche"</span>), Tranche_O_A, Tranche_Active_Date) <span class="sc">%&gt;%</span> </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">linked_deal_time =</span> <span class="fu">str_extract_all</span>(<span class="at">string =</span> Deal_Remark, <span class="at">pattern =</span> <span class="st">"(?:</span><span class="sc">\\</span><span class="st">b[^.]*)</span><span class="sc">\\</span><span class="st">b(?:amend|restat|refinan)[a-z]*</span><span class="sc">\\</span><span class="st">b[^.]*</span><span class="sc">\\</span><span class="st">."</span>, <span class="at">simplify =</span> F), <span class="co"># "\\d+/\\d+/\\d+"</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="do">## explain the regex: "\\b(amend|restat)[a-z]+\\b(\\s+\\S+){1,10}\\."</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="do">## 1. "\\b ... \\b" means exact match in the pattern.</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="do">## 2. (?:\\s+\\S+){1,10}</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">linked_deal_time_n =</span> <span class="fu">lengths</span>(linked_deal_time)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">"firm_deal_id"</span>) <span class="co"># a new id for each observation in the data - firm-deal level </span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================== (June 17, 2024) </span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Firm a, Deal i, Tranche j, at Time t. </span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>dt.DealScan_borrower_aijt <span class="ot">&lt;-</span> dt.DealScan_borrower_unifirm_deal <span class="sc">%&gt;%</span> <span class="co"># firm a, deal i, tranche j, at time t. </span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(firm_deal_id, gvkey_group1, LPC_Deal_ID, </span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>         Deal_Active_Date, Tranche_Active_Date,</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>         Deal_Remark, linked_deal_time, linked_deal_time_n) <span class="sc">%&gt;%</span> </span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(linked_deal_time_n <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="co"># keep only terms that mentioned dates. </span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">linked_record_time =</span> <span class="fu">sapply</span>(<span class="at">X =</span> linked_deal_time, </span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>                              <span class="at">FUN =</span> <span class="cf">function</span>(x) { </span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>                                extracted_date <span class="ot">=</span> <span class="fu">str_extract_all</span>(<span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">d+/</span><span class="sc">\\</span><span class="st">d+/</span><span class="sc">\\</span><span class="st">d+"</span>, <span class="at">string =</span> x, <span class="at">simplify =</span> T) <span class="co"># extract the date information </span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>                                output <span class="ot">=</span> <span class="fu">paste</span>(extracted_date[<span class="fu">nchar</span>(extracted_date) <span class="sc">&gt;</span> <span class="dv">0</span>], <span class="at">collapse =</span> <span class="st">";"</span>) <span class="co"># the time recorded in the extract text. </span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">return</span>(output) </span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>                              }</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>  ) ) <span class="sc">%&gt;%</span> </span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(linked_record_time, <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span> <span class="co"># break into different rows </span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">related_time =</span> <span class="fu">as.Date</span>(<span class="at">x =</span> linked_record_time, <span class="at">format =</span> <span class="st">"%m/%d/%y"</span>), </span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">time_low =</span> related_time <span class="sc">-</span> <span class="dv">15</span>, </span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">time_high =</span> related_time <span class="sc">+</span> <span class="dv">15</span> <span class="co"># the upper and lower limit for the deal time to match </span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(related_time) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(gvkey_group1))</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="co"># link Deal i, Tranche j, at Time t (_ijt) to the deal before and after: </span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>by_at <span class="ot">&lt;-</span> <span class="fu">join_by</span>(gvkey_group1, <span class="fu">between</span>(Deal_Active_Date, time_low, time_high))</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>dt.manual_renegotiation <span class="ot">&lt;-</span> dt.DealScan_borrower_unifirm_deal <span class="sc">%&gt;%</span> </span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(gvkey_group1)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(<span class="fu">select</span>(dt.DealScan_borrower_aijt, </span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>                    gvkey_group1, <span class="co"># all observations in this has a `gvkey_group1`. </span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Linked_firm_deal_id =</span> firm_deal_id, </span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Linked_LPC_Deal_ID =</span> LPC_Deal_ID, </span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Linked_Deal_Active_Date =</span> Deal_Active_Date, </span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Linked_Tranche_Active_Date =</span> Tranche_Active_Date, </span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">starts_with</span>(<span class="st">"time_"</span>)), </span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> by_at) <span class="sc">%&gt;%</span> </span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="co"># create a new identifier to manually detect renegotiation from `Deal_Remark`: </span></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>    <span class="do">## record the original, unique firm-deal id if the `Linked_Tranche_Active_Date` comes after the `Linked_Tranche_Active_Date`. </span></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>    <span class="do">## and record the linked firm-deal id if otherwise. </span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_before =</span> <span class="fu">ifelse</span>(Tranche_Active_Date <span class="sc">&lt;</span> Linked_Tranche_Active_Date, <span class="at">yes =</span> firm_deal_id, <span class="at">no =</span> Linked_firm_deal_id), <span class="co"># the previous id </span></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_after =</span> <span class="fu">ifelse</span>(Tranche_Active_Date <span class="sc">&lt;</span> Linked_Tranche_Active_Date, <span class="at">yes =</span> Linked_firm_deal_id, <span class="at">no =</span> firm_deal_id) <span class="co"># the id for the deal that linked to `id_before`</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================== (June 18, 2024)</span></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a><span class="co"># merge the manually identified renegotiated contracts back to the full dataset. </span></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a><span class="co"># `dt.DealScan_borrower_unifirm_deal` is updated. </span></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>dt.DealScan_borrower_unifirm_deal <span class="ot">&lt;-</span> dt.DealScan_borrower_unifirm_deal <span class="sc">%&gt;%</span> </span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>    dt.manual_renegotiation <span class="sc">%&gt;%</span> </span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(id_before, id_after) <span class="sc">%&gt;%</span> <span class="co"># only the firm-deal identified by `id_after` will be noted as a renegotiated contract. </span></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">flag_manual_renegotiation =</span> <span class="cn">TRUE</span>), </span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">join_by</span>(firm_deal_id <span class="sc">==</span> id_after) </span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a><span class="co"># ========================================================================</span></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a><span class="co"># ========================================================================</span></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a><span class="co"># gvkey_group1 == 7089; 1894; 1392</span></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>  <span class="co"># gt() %&gt;%</span></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>  <span class="co"># tab_options(table.font.size = 13, heading.align = 'left' ) %&gt;%</span></span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cols_width(Deal_Remark ~ px(1000), linked_deal_time ~ px(1000))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

<div class="no-row-height column-margin column-container"><div id="wrn-loan-path2" class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning&nbsp;1: Identify Loan Renegotiations!
</div>
</div>
<div class="callout-body-container callout-body">
<p>In newly generated data <code>dt.DealScan_borrower_unifirm_deal</code>, the criterion to generate the new variable <code>flag_renegotiation</code> might need more detailed examination. This variable is created to detect whether an amendment happens, even when the <code>Tranch_O_A</code> variable gives <code>"Origination"</code>.</p>
</div>
</div></div><p>Here is a summary table showing the mapping between the amendment/refinancing flags and the <code>flag_renegotiation</code> I created for firm-deal level dataset - <code>dt.DealScan_borrower_unifirm_deal</code>.</p>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to identify different types of contracts which are defined as "Origination". </span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>dt.DealScan_borrower_unifirm_deal <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Orig_Yes =</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="at">pattern =</span> <span class="st">"Orig"</span>, <span class="at">x =</span> Tranche_O_A), </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"`Tranche_O_A` = Origination`"</span>, </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"`Tranche_O_A` = Amendment"</span>)) <span class="sc">%&gt;%</span> <span class="co"># group by "Origination". </span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Orig_Yes, Deal_Amended, Deal_Refinancing) <span class="sc">%&gt;%</span> </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_renegotiationYes =</span> <span class="fu">sum</span>(flag_renegotiation <span class="sc">==</span> <span class="cn">TRUE</span>), </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_renegotiationNo =</span> <span class="fu">sum</span>(flag_renegotiation <span class="sc">==</span> <span class="cn">FALSE</span>), </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> <span class="co"># count the number of each types </span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage_n =</span> (n <span class="sc">/</span> <span class="fu">sum</span>(n))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">groupname_col =</span> <span class="st">"Orig_Yes"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="st">"Table 3: WRDS DealScan Deal-Tranche Level Loan Events"</span>, </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">subtitle =</span> <span class="st">"A summary statistics to show the results of my identifier: `flag_renegotiation`"</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>             ) <span class="sc">%&gt;%</span> </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(<span class="at">table.font.size =</span> <span class="dv">11</span>, <span class="at">heading.align =</span> <span class="st">'left'</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>( <span class="co"># update the font size for table cells. </span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">size =</span> <span class="fu">px</span>(<span class="dv">11</span>)),</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_body</span>()</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_percent</span>(<span class="at">columns =</span> percentage_n, <span class="at">decimals =</span> <span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display column-body">
<div id="meojfmuqil" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#meojfmuqil table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#meojfmuqil thead, #meojfmuqil tbody, #meojfmuqil tfoot, #meojfmuqil tr, #meojfmuqil td, #meojfmuqil th {
  border-style: none;
}

#meojfmuqil p {
  margin: 0;
  padding: 0;
}

#meojfmuqil .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 11px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#meojfmuqil .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#meojfmuqil .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#meojfmuqil .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#meojfmuqil .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#meojfmuqil .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#meojfmuqil .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#meojfmuqil .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#meojfmuqil .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#meojfmuqil .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#meojfmuqil .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#meojfmuqil .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#meojfmuqil .gt_spanner_row {
  border-bottom-style: hidden;
}

#meojfmuqil .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#meojfmuqil .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#meojfmuqil .gt_from_md > :first-child {
  margin-top: 0;
}

#meojfmuqil .gt_from_md > :last-child {
  margin-bottom: 0;
}

#meojfmuqil .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#meojfmuqil .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#meojfmuqil .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#meojfmuqil .gt_row_group_first td {
  border-top-width: 2px;
}

#meojfmuqil .gt_row_group_first th {
  border-top-width: 2px;
}

#meojfmuqil .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#meojfmuqil .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#meojfmuqil .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#meojfmuqil .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#meojfmuqil .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#meojfmuqil .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#meojfmuqil .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#meojfmuqil .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#meojfmuqil .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#meojfmuqil .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#meojfmuqil .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#meojfmuqil .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#meojfmuqil .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#meojfmuqil .gt_left {
  text-align: left;
}

#meojfmuqil .gt_center {
  text-align: center;
}

#meojfmuqil .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#meojfmuqil .gt_font_normal {
  font-weight: normal;
}

#meojfmuqil .gt_font_bold {
  font-weight: bold;
}

#meojfmuqil .gt_font_italic {
  font-style: italic;
}

#meojfmuqil .gt_super {
  font-size: 65%;
}

#meojfmuqil .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#meojfmuqil .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#meojfmuqil .gt_indent_1 {
  text-indent: 5px;
}

#meojfmuqil .gt_indent_2 {
  text-indent: 10px;
}

#meojfmuqil .gt_indent_3 {
  text-indent: 15px;
}

#meojfmuqil .gt_indent_4 {
  text-indent: 20px;
}

#meojfmuqil .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="6" class="gt_heading gt_title gt_font_normal">Table 3: WRDS DealScan Deal-Tranche Level Loan Events</th>
</tr>
<tr class="odd gt_heading">
<th colspan="6" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">A summary statistics to show the results of my identifier: `flag_renegotiation`</th>
</tr>
<tr class="header gt_col_headings">
<th id="Deal_Amended" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Deal_Amended</th>
<th id="Deal_Refinancing" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Deal_Refinancing</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n</th>
<th id="n_renegotiationYes" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_renegotiationYes</th>
<th id="n_renegotiationNo" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_renegotiationNo</th>
<th id="percentage_n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">percentage_n</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd gt_group_heading_row">
<td colspan="6" id="`Tranche_O_A` = Amendment" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">`Tranche_O_A` = Amendment</td>
</tr>
<tr class="even gt_row_group_first">
<td class="gt_row gt_left" headers="`Tranche_O_A` = Amendment  Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="`Tranche_O_A` = Amendment  Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  n" style="font-size: 11px">17843</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  n_renegotiationYes" style="font-size: 11px">17843</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  n_renegotiationNo" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  percentage_n" style="font-size: 11px">5.66%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="`Tranche_O_A` = Amendment  Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="`Tranche_O_A` = Amendment  Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  n" style="font-size: 11px">41216</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  n_renegotiationYes" style="font-size: 11px">41216</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  n_renegotiationNo" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  percentage_n" style="font-size: 11px">13.08%</td>
</tr>
<tr class="even gt_group_heading_row">
<td colspan="6" id="`Tranche_O_A` = Origination`" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">`Tranche_O_A` = Origination`</td>
</tr>
<tr class="odd gt_row_group_first">
<td class="gt_row gt_left" headers="`Tranche_O_A` = Origination`  Deal_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="`Tranche_O_A` = Origination`  Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination`  n" style="font-size: 11px">172600</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination`  n_renegotiationYes" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination`  n_renegotiationNo" style="font-size: 11px">172600</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination`  percentage_n" style="font-size: 11px">54.78%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="`Tranche_O_A` = Origination`  Deal_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="`Tranche_O_A` = Origination`  Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination`  n" style="font-size: 11px">59914</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination`  n_renegotiationYes" style="font-size: 11px">59914</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination`  n_renegotiationNo" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination`  percentage_n" style="font-size: 11px">19.01%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="`Tranche_O_A` = Origination`  Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="`Tranche_O_A` = Origination`  Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination`  n" style="font-size: 11px">11668</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination`  n_renegotiationYes" style="font-size: 11px">11668</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination`  n_renegotiationNo" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination`  percentage_n" style="font-size: 11px">3.70%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="`Tranche_O_A` = Origination`  Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="`Tranche_O_A` = Origination`  Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination`  n" style="font-size: 11px">11864</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination`  n_renegotiationYes" style="font-size: 11px">11864</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination`  n_renegotiationNo" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination`  percentage_n" style="font-size: 11px">3.77%</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="s4.-clean-the-loan-renegotiation-data" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="s4.-clean-the-loan-renegotiation-data">S4. Clean the loan renegotiation data</h2>
<p>Then, I will create a more detailed <code>flag_Renegotiated</code> variable in the dataset to more thoroughly cover all renegotiations at the firm-deal level.</p>
<p>A recap about the definition of different renegotiation flags:</p>
<ul>
<li><code>Event_renegotiation</code>: word detection in the variable <code>Deal_Remark</code>.<br>
</li>
<li><code>flag_renegotiation</code>: detected renegotiations based on the amendment/refinancing/_O_A flags in DealScan.</li>
<li><code>flag_manual_renegotiation</code>: manually matched renegotiated deals based on <code>Deal_Remark</code>.</li>
</ul>

<div class="no-row-height column-margin column-container"><div id="wrn-loan-path3" class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning&nbsp;2: Still! A lot of renegotiations are missing.
</div>
</div>
<div class="callout-body-container callout-body">
<p>For company <a href="2015https://www.sec.gov/Archives/edgar/data/200155/000020015515000003/0000200155-15-000003.txt">COLORADO INTERSTATE GAS COMPANY, L.L.C.</a>, it is previously known as “COLORADO INTERSTATE CORP” (ex 1976/01/19) and “COLORADO INTERSTATE GAS CO” (ex 1992/07/03) and was subsequently potentially (?) merged with KINDER MORGAN, INC, in maybe 2014. The firm is a subsidiary of El Paso Corporation (NYSE: EP).</p>
<p>Even with these, there are still a lot of missing amendment/restatements in the DealScan. E.g. <a href="https://www.sec.gov/edgar/search/#exhibit99a.htm">8-K</a>. However, this issue may be because it is just a subsidiary and thus we may need to connect these dot and build this family-subsidiary connections.</p>
</div>
</div></div><div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>dt.DealScan_borrower_unifirm_deal <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"linked_"</span>), <span class="sc">-</span><span class="fu">contains</span>(<span class="st">"Remark"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">flag_manual_renegotiation =</span> <span class="fu">replace_na</span>(flag_manual_renegotiation, <span class="at">replace =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gvkey_group1) <span class="sc">%&gt;%</span> <span class="do">## (1) collect all observations within the same group </span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Tranche_Active_Date) <span class="sc">%&gt;%</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">flag_Renegotiated =</span> (Event_renegotiation <span class="sc">|</span> flag_renegotiation <span class="sc">|</span> flag_manual_renegotiation) ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 315,105 × 18
# Groups:   gvkey_group1 [21,424]
   firm_deal_id gvkey_group1 Deal_Active_Date Deal_Input_Date Deal_Amount
          &lt;int&gt;        &lt;dbl&gt; &lt;date&gt;           &lt;date&gt;                &lt;dbl&gt;
 1            1           NA 1981-06-15       1991-12-25              122
 2            2         4697 1982-04-20       1991-12-25              750
 3            3         2178 1982-06-29       1992-04-29              690
 4            4         2563 1982-11-18       1992-04-29              850
 5            5         2284 1982-12-27       1991-12-31             1000
 6            6          788 1983-12-15       1991-12-31              600
 7            7          765 1984-01-01       1992-04-29             1600
 8            8         3427 1984-02-13       1992-04-29             8000
 9            9          306 1984-03-05       1992-04-29            12000
10           10         2351 1984-03-15       1992-04-29             2500
# ℹ 315,095 more rows
# ℹ 13 more variables: LPC_Deal_ID &lt;int&gt;, Deal_Amended &lt;chr&gt;,
#   Deal_Refinancing &lt;chr&gt;, Event_amend &lt;lgl&gt;, Event_restate &lt;lgl&gt;,
#   Event_refin &lt;lgl&gt;, Event_renegotiation &lt;lgl&gt;, flag_renegotiation &lt;lgl&gt;,
#   Tranche_O_A &lt;chr&gt;, Tranche_Active_Date &lt;date&gt;, id_before &lt;int&gt;,
#   flag_manual_renegotiation &lt;lgl&gt;, flag_Renegotiated &lt;lgl&gt;</code></pre>
</div>
</div>
</section>
<section id="sec-reference" class="level2">
<h2 class="anchored" data-anchor-id="sec-reference">Reference</h2>
<ul>
<li>Related <a href="https://peterdemerjian.weebly.com/research.html">Peter Demerjian</a>
<ul>
<li>Measuring the Probability of Financial Covenant Violation in Private Debt Contracts (with E. Owens). Journal of Accounting and Economics 61: 433-447 (2016). &gt; <a href="https://peterdemerjian.weebly.com/managerialability.html">CODE</a></li>
</ul></li>
<li></li>
</ul>
</section>
<section id="to-do-list" class="level2">
<h2 class="anchored" data-anchor-id="to-do-list">To-do list:</h2>
<ul>
<li><a href="">June 13, 2024</a></li>
</ul>
</section>
<section id="trashbin" class="level2">
<h2 class="anchored" data-anchor-id="trashbin">Trashbin:</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">### </span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="do">### from section S2 - June 13, 2024 </span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="do">## create a dataset for the unique id for each unique observations. </span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>dt.Link_table_id <span class="ot">&lt;-</span> Link_table <span class="sc">%&gt;%</span> </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, <span class="st">`</span><span class="at">LoanConnector Company ID</span><span class="st">`</span>, borrowercompanyid, facilitystartdate) <span class="sc">%&gt;%</span> </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gvkey, <span class="st">`</span><span class="at">LoanConnector Company ID</span><span class="st">`</span>, borrowercompanyid) <span class="sc">%&gt;%</span> </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">facilitystartdate_min =</span> <span class="fu">min</span>(facilitystartdate)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gvkey) <span class="sc">%&gt;%</span> </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(facilitystartdate_min) <span class="sc">%&gt;%</span> </span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gvkey_group =</span> <span class="fu">cur_group_id</span>()) <span class="sc">%&gt;%</span> <span class="co"># generate the group_id based on `gvkey` </span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="do">## only contain self-created prelimiary gvkey_group(s):</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>comp_id_gvkey <span class="ot">&lt;-</span> dt.Link_table_id <span class="sc">%&gt;%</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, <span class="st">`</span><span class="at">LoanConnector Company ID</span><span class="st">`</span>, gvkey_group) <span class="sc">%&gt;%</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">LoanConnector Company ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">company_id_to_gvkey =</span> <span class="fu">paste0</span>(<span class="fu">paste0</span>(<span class="fu">unique</span>(gvkey), <span class="at">collapse =</span> <span class="st">";"</span>), <span class="st">";"</span>), <span class="co"># for `gvkey`</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">company_id_to_gvkey_group =</span> <span class="fu">paste0</span>(<span class="fu">paste0</span>(<span class="fu">unique</span>(gvkey_group), <span class="at">collapse =</span> <span class="st">";"</span>), <span class="st">";"</span>), <span class="co"># for `gvkey_group`</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_gvkey =</span> <span class="fu">length</span>(<span class="fu">unique</span>(gvkey)) <span class="co"># number of gvkey(s) within each `company_ID` group.</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>comp_id_gvkey</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>dt.gvkey_group1 <span class="ot">&lt;-</span> dt.Link_table_id <span class="sc">%&gt;%</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(comp_id_gvkey, <span class="at">by =</span> <span class="st">"LoanConnector Company ID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(gvkey) <span class="sc">%&gt;%</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># head(30) %&gt;%</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gvkey) <span class="sc">%&gt;%</span> <span class="co"># for each given `gvkey`, find the associated `gvkey`(s) based on `company_ID`.</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="co"># re-construct the list of linked `gvkey`(s)</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">connected_gvkey =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(company_id_to_gvkey, <span class="at">split =</span> <span class="st">";"</span>))), <span class="at">collapse =</span> <span class="st">";"</span>)</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(connected_gvkey) <span class="sc">%&gt;%</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gvkey_group1 =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.))</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>dt.Link_table_gvkey <span class="ot">&lt;-</span> <span class="fu">str_split</span>(<span class="at">string =</span> dt.gvkey_group1<span class="sc">$</span>connected_gvkey, <span class="at">pattern =</span> <span class="st">";"</span>, <span class="at">simplify =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">names&lt;-</span><span class="st">`</span>(<span class="at">value =</span> dt.gvkey_group1<span class="sc">$</span>gvkey_group1) <span class="sc">%&gt;%</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">gvkey =</span> ., <span class="at">gvkey_group1 =</span> <span class="fu">names</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gvkey =</span> <span class="fu">as.numeric</span>(gvkey))</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a><span class="do">### merge back to the link table</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>dt.Link_table_id2 <span class="ot">&lt;-</span> dt.Link_table_id <span class="sc">%&gt;%</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>facilitystartdate_min, <span class="sc">-</span>gvkey_group) <span class="sc">%&gt;%</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dt.Link_table_gvkey, <span class="at">by =</span> <span class="st">"gvkey"</span>)</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>dt.Link_table_id2</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a><span class="do">## second round checking</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a><span class="do">### the arguement here is that for all `company ID` previously identified from the same gvkey, I now map it back based on the `company ID` and double check whether the new `gvkey_group` is the same as the original ones. </span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a><span class="do">### i.e. I am checking whether the same `comapny ID` maps to multiple `gvkey`(s). </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- ## Notes  -->
<!-- color: <span style="color: red;"> text </span> // {style="color: red;"} -->
<!-- ## Quarto -->
<!-- Quarto enables you to weave together content and executable code into a finished document. To learn more about Quarto see <https://quarto.org>. -->
<!-- ## Running Code -->
<!-- When you click the **Render** button a document will be generated that includes both content and the output of embedded code. You can embed code like this: -->
<!-- ```{r} -->
<!-- 1 + 1 -->
<!-- ``` -->
<!-- You can add options to executable code like this -->
<!-- ```{r} -->
<!-- #| echo: false -->
<!-- 2 * 2 -->
<!-- ``` -->
<!-- The `echo: false` option disables the printing of code (only output is displayed). -->
<!-- -------- -->
<!-- ### s3.6 Leverage Covenants {#sec-s3.6-leverage-covenants} -->
<!-- Look into the changes in covenants related to the leverage restrictions and cash flow related restrictions (e.g. ICR: interest rate coverage ratio). -->
<!-- ### s3.7 Spreads and Fees {#sec-s3.7-spreads-and-fees} -->
<!-- Look into the changes in spread and fees. -->
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb14" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "DealScan Loan Path"</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Hongyi Xu"</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> today </span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: flatly</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true </span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Show the code"</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">    html-math-method: katex</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left </span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">\&gt; Back to research</span><span class="co">](https://hongyileoxu.github.io/research/)</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;style type="text/css"&gt;</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="in">body, td {</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="in">   font-size: 16px;</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="in">code.r{</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="in">  font-size: 12px;</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="in">pre {</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="in">  font-size: 12px</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/style&gt;</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(echo = TRUE) </span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="in">setwd("~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Loan_Path_Jun2024")</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="in">library(readxl)</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a><span class="in">library(data.table)</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggthemes)</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a><span class="in">library(shadowtext)</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a><span class="in">library(egg)</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a><span class="in">library(gt)</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a><span class="in">library(psych)</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a><span class="in">library(zoo)</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a><span class="in">library(fedmatch)</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a><span class="in">library(igraph) # for network analysis </span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a><span class="in"># library(arrow)</span></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a><span class="in">source(file = "~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Functions/DealScan_functions.R", encoding = "UTF-8")</span></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a><span class="fu">## S1. Objective {#sec-s1.-objective}</span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>This file follows file "DealScan_Data_Renegotiation.html". The aim of this file is to extract the loan path and I also further clean the file <span class="in">`Link_table_2024.RData`</span> to gather all pair of identifiers for a unique firm over its life-cycle.</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>Here is a notes on the <span class="co">[</span><span class="ot">WRDS Financial Covenants Table</span><span class="co">](https://wrds-www.wharton.upenn.edu/pages/support/support-articles/thomson-reuters/dealscan/wrds-financial-covenants-table/)</span>. The document there provides names and definitions on each financial covenants terms in the new DealScan data.</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a><span class="fu">## S2. Firm's Life-cycle Identifier {#sec-s2.-firms-lift-cycle-identifier}</span></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>In order to identify the loan path (or deal path), I first need to identify the life-cycle of a firm's identifiers, including <span class="in">`gvkey`</span>, <span class="in">`Borrower_Id`</span>, <span class="in">`borrowercompanyid`</span>, etc. So, I start with the link table created in the first section <span class="sc">\&gt;</span> <span class="co">[</span><span class="ot">HTML Manual</span><span class="co">](https://hongyileoxu.github.io/research/project-2024/DealScan2024/DealScan_Link_Table_Compustat.html)</span>.</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a><span class="in">```{r firm_identifiers, echo=TRUE}</span></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: screen-inset</span></span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a><span class="in">## import dataset </span></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a><span class="in">load("Link_table_2024.RData")</span></span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a><span class="in">## get the new company identifiers from network analysis </span></span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a><span class="in">Link_table.newgroups &lt;- Link_table %&gt;% </span></span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a><span class="in">  group_or(id1 = "gvkey", id2 = "borrowercompanyid")</span></span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a><span class="in">## join back to the original dataset </span></span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a><span class="in">dt.Link_table &lt;- Link_table %&gt;%</span></span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(facilitystartdate = as.Date(facilitystartdate),</span></span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a><span class="in">         `LoanConnector Company ID` = as.integer(`LoanConnector Company ID`)</span></span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a><span class="in">         ) %&gt;% </span></span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(Link_table.newgroups, by = c("gvkey", "borrowercompanyid")) %&gt;% </span></span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a><span class="in">  select(starts_with("facility"), gvkey_group1, everything(.)) </span></span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a><span class="in">## a preview </span></span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a><span class="in">dt.Link_table %&gt;% </span></span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(facilitystartdate) %&gt;%</span></span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(gvkey_group1 == 22) %&gt;% </span></span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a><span class="in">  gt() %&gt;% </span></span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_header(title = "New Link table for Aeroflex Inc. (previously known as ARX Inc.)", </span></span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a><span class="in">             subtitle = html('&lt;span class="red-star"&gt;★&lt;/span&gt;Now the variable `gvkey_group1` is used to track the loan path')</span></span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a><span class="in">             ) %&gt;% </span></span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_options(table.font.size = 10, heading.align = 'left' ) %&gt;% </span></span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_style( # update the font size for table cells. </span></span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a><span class="in">    style = cell_text(size = px(10)),</span></span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a><span class="in">    locations = cells_body()</span></span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a><span class="in">  data_color(</span></span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a><span class="in">    columns = c("gvkey", "borrowercompanyid"),</span></span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a><span class="in">    method = "factor",</span></span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a><span class="in">    palette = "viridis", </span></span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a><span class="in">    reverse = TRUE</span></span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a><span class="in">    ) %&gt;% </span></span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a><span class="in">  cols_hide(columns = matches("score|match") ) # hide columns</span></span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a><span class="in">## export the updated link table </span></span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a><span class="in">save(dt.Link_table, file = "dt.Link_table_2024.RData")</span></span>
<span id="cb14-108"><a href="#cb14-108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-109"><a href="#cb14-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-110"><a href="#cb14-110" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>An example from <span class="co">[</span><span class="ot">the web</span><span class="co">](https://stackoverflow.com/questions/68947862/grouping-similar-elements-together)</span> to use network analysis for more granular grouping assignments.</span>
<span id="cb14-111"><a href="#cb14-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-112"><a href="#cb14-112" aria-hidden="true" tabindex="-1"></a><span class="in">```{r network_example, eval=FALSE}</span></span>
<span id="cb14-113"><a href="#cb14-113" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: margin</span></span>
<span id="cb14-114"><a href="#cb14-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-115"><a href="#cb14-115" aria-hidden="true" tabindex="-1"></a><span class="in"># Load the necessary libraries</span></span>
<span id="cb14-116"><a href="#cb14-116" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb14-117"><a href="#cb14-117" aria-hidden="true" tabindex="-1"></a><span class="in">library(igraph)</span></span>
<span id="cb14-118"><a href="#cb14-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-119"><a href="#cb14-119" aria-hidden="true" tabindex="-1"></a><span class="in"># Manually generating data</span></span>
<span id="cb14-120"><a href="#cb14-120" aria-hidden="true" tabindex="-1"></a><span class="in">Names &lt;- c(rep('James,Gordon',6)</span></span>
<span id="cb14-121"><a href="#cb14-121" aria-hidden="true" tabindex="-1"></a><span class="in">          ,rep('Amanda',3)</span></span>
<span id="cb14-122"><a href="#cb14-122" aria-hidden="true" tabindex="-1"></a><span class="in">          ,rep('Gordon,Amanda',8)</span></span>
<span id="cb14-123"><a href="#cb14-123" aria-hidden="true" tabindex="-1"></a><span class="in">          ,rep('Edward,Gordon,Amanda',3)</span></span>
<span id="cb14-124"><a href="#cb14-124" aria-hidden="true" tabindex="-1"></a><span class="in">          ,rep('Anna',3)</span></span>
<span id="cb14-125"><a href="#cb14-125" aria-hidden="true" tabindex="-1"></a><span class="in">          ,rep('Anna,Leonard',3)</span></span>
<span id="cb14-126"><a href="#cb14-126" aria-hidden="true" tabindex="-1"></a><span class="in">          )</span></span>
<span id="cb14-127"><a href="#cb14-127" aria-hidden="true" tabindex="-1"></a><span class="in">Initial_Group &lt;- rep(1:6,c(6,3,8,3,3,3))</span></span>
<span id="cb14-128"><a href="#cb14-128" aria-hidden="true" tabindex="-1"></a><span class="in">Final_Group &lt;- rep(c('A','B'),c(20,6))</span></span>
<span id="cb14-129"><a href="#cb14-129" aria-hidden="true" tabindex="-1"></a><span class="in">data &lt;- data.frame(Names,Initial_Group,Final_Group)</span></span>
<span id="cb14-130"><a href="#cb14-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-131"><a href="#cb14-131" aria-hidden="true" tabindex="-1"></a><span class="in">data %&gt;%</span></span>
<span id="cb14-132"><a href="#cb14-132" aria-hidden="true" tabindex="-1"></a><span class="in">  select(Names)%&gt;%</span></span>
<span id="cb14-133"><a href="#cb14-133" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct() %&gt;%</span></span>
<span id="cb14-134"><a href="#cb14-134" aria-hidden="true" tabindex="-1"></a><span class="in">  separate(Names, c('first', 'second'), extra = 'merge', fill = 'right')%&gt;%</span></span>
<span id="cb14-135"><a href="#cb14-135" aria-hidden="true" tabindex="-1"></a><span class="in">  separate_rows(second) %&gt;%</span></span>
<span id="cb14-136"><a href="#cb14-136" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(second = coalesce(second, as.character(cumsum(is.na(second))))) %&gt;%</span></span>
<span id="cb14-137"><a href="#cb14-137" aria-hidden="true" tabindex="-1"></a><span class="in">  graph_from_data_frame()%&gt;%</span></span>
<span id="cb14-138"><a href="#cb14-138" aria-hidden="true" tabindex="-1"></a><span class="in">  components() %&gt;%</span></span>
<span id="cb14-139"><a href="#cb14-139" aria-hidden="true" tabindex="-1"></a><span class="in">  getElement('membership') %&gt;%</span></span>
<span id="cb14-140"><a href="#cb14-140" aria-hidden="true" tabindex="-1"></a><span class="in">  imap(~str_detect(data$Names, .y)*.x) %&gt;%</span></span>
<span id="cb14-141"><a href="#cb14-141" aria-hidden="true" tabindex="-1"></a><span class="in">  invoke(pmax, .) %&gt;% # `invoke` is applied to apply function to the same location in each element under a list </span></span>
<span id="cb14-142"><a href="#cb14-142" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(data, value = LETTERS[.], value1 = .) </span></span>
<span id="cb14-143"><a href="#cb14-143" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-144"><a href="#cb14-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-145"><a href="#cb14-145" aria-hidden="true" tabindex="-1"></a>In the above example for Aeroflex Inc. (previously known as ARX Inc.), one company may match multiple combinations of two identifiers - <span class="in">`gvkey`</span> and <span class="in">`borrowercompanyid`</span>/<span class="in">`LoanConnector Company ID`</span> - and I recreate a new identifier <span class="in">`gvkey_group1`</span> to uniquely identify one firm's life-cycle in the dataset. <span class="in">`borrowercompanyid`</span> is the borrower identifier in the Legacy DealScan dataset and <span class="in">`LoanConnector Company ID`</span> is for the new LPC DealScan.</span>
<span id="cb14-146"><a href="#cb14-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-147"><a href="#cb14-147" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--- .column-margin ---&gt;</span></span>
<span id="cb14-148"><a href="#cb14-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-149"><a href="#cb14-149" aria-hidden="true" tabindex="-1"></a>::: {#tip-loan-path .callout-tip collapse="true"}</span>
<span id="cb14-150"><a href="#cb14-150" aria-hidden="true" tabindex="-1"></a><span class="fu">## A finer link table</span></span>
<span id="cb14-151"><a href="#cb14-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-152"><a href="#cb14-152" aria-hidden="true" tabindex="-1"></a>In the current version of the link table, <span class="in">`dt.Link_table`</span>, facility/tranche level information is also included. A cleaner version of the link table will only include borrower level observations.</span>
<span id="cb14-153"><a href="#cb14-153" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb14-154"><a href="#cb14-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-155"><a href="#cb14-155" aria-hidden="true" tabindex="-1"></a>One additional thing to notice is that although no missing values observed in variable <span class="in">`borrowercompanyid`</span> (and also <span class="in">`gvkey`</span>), <span class="in">`LoanConnector Company ID`</span> contains missing value, around 66 observations.</span>
<span id="cb14-156"><a href="#cb14-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-157"><a href="#cb14-157" aria-hidden="true" tabindex="-1"></a><span class="fu">## S3. Connect and build the loan paths</span></span>
<span id="cb14-158"><a href="#cb14-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-159"><a href="#cb14-159" aria-hidden="true" tabindex="-1"></a>Here are the steps to achieve this:</span>
<span id="cb14-160"><a href="#cb14-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-161"><a href="#cb14-161" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>load the dataset for the new link table - <span class="in">`dt.Link_table`</span> and for all Deal-Tranches with borrower information - <span class="in">`DealScan_borrower`</span>. The dataset <span class="in">`dt.name_match`</span> is used to guide the selection of variables for specific analyses. <span class="co">[</span><span class="ot">\&gt; refer to section s3.4 in this document.</span><span class="co">](https://hongyileoxu.github.io/research/project-2024/DealScan2024/DealScan_Data_Renegotiation.html#sec-s3.4-classify-variable-names)</span></span>
<span id="cb14-162"><a href="#cb14-162" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Cross validate the changes in the loan amount using the item &lt;mark&gt;"Cash flows from financing activities"&lt;/mark&gt; from the &lt;mark&gt;"CONSOLIDATED STATEMENTS OF CASH FLOWS"&lt;/mark&gt;. </span>
<span id="cb14-163"><a href="#cb14-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-164"><a href="#cb14-164" aria-hidden="true" tabindex="-1"></a><span class="at">    &gt;   One example from JACO ELECTRONICS INC (</span><span class="in">`gvkey_group1 == 1894`</span><span class="at">) and its </span><span class="co">[</span><span class="ot">SEC filing</span><span class="co">](https://www.sec.gov/Archives/edgar/data/52971/0000950123-95-002603.txt)</span><span class="at">. Search </span><span class="in">`Term Loan`</span><span class="at"> in the filing and you will much more renegotiations than ones recorded in the DealScan. </span></span>
<span id="cb14-165"><a href="#cb14-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-166"><a href="#cb14-166" aria-hidden="true" tabindex="-1"></a>&lt;b&gt;Let's start!&lt;/b&gt;</span>
<span id="cb14-167"><a href="#cb14-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-168"><a href="#cb14-168" aria-hidden="true" tabindex="-1"></a><span class="in">```{r laon_path, echo=TRUE}</span></span>
<span id="cb14-169"><a href="#cb14-169" aria-hidden="true" tabindex="-1"></a><span class="in">## load the necessary tables</span></span>
<span id="cb14-170"><a href="#cb14-170" aria-hidden="true" tabindex="-1"></a><span class="in">if (!exists("dt.Link_table")) {</span></span>
<span id="cb14-171"><a href="#cb14-171" aria-hidden="true" tabindex="-1"></a><span class="in">  ## check whether the variable `dt.Link_table` is there. &gt; if yes, then .... </span></span>
<span id="cb14-172"><a href="#cb14-172" aria-hidden="true" tabindex="-1"></a><span class="in">  load(file = "dt.Link_table_2024.RData")</span></span>
<span id="cb14-173"><a href="#cb14-173" aria-hidden="true" tabindex="-1"></a><span class="in">} </span></span>
<span id="cb14-174"><a href="#cb14-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-175"><a href="#cb14-175" aria-hidden="true" tabindex="-1"></a><span class="in">### load the dealscan data for only borrowers information &gt; DealScan_borrower </span></span>
<span id="cb14-176"><a href="#cb14-176" aria-hidden="true" tabindex="-1"></a><span class="in">load(file = "~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Data_Renegotiations_Jun2024/DealScan_borrower.RData") </span></span>
<span id="cb14-177"><a href="#cb14-177" aria-hidden="true" tabindex="-1"></a><span class="in">### load the dealscan variable names &gt; dt.name_match </span></span>
<span id="cb14-178"><a href="#cb14-178" aria-hidden="true" tabindex="-1"></a><span class="in">load(file = "~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Data_Renegotiations_Jun2024/DealScan_name_match.RData") </span></span>
<span id="cb14-179"><a href="#cb14-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-180"><a href="#cb14-180" aria-hidden="true" tabindex="-1"></a><span class="in">name_covenants_17 &lt;- dt.name_match %&gt;% # financial covenants </span></span>
<span id="cb14-181"><a href="#cb14-181" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(grepl(pattern = "^17:", x = group_header)) %&gt;% </span></span>
<span id="cb14-182"><a href="#cb14-182" aria-hidden="true" tabindex="-1"></a><span class="in">  .$orig_name</span></span>
<span id="cb14-183"><a href="#cb14-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-184"><a href="#cb14-184" aria-hidden="true" tabindex="-1"></a><span class="in">name_covenants_19 &lt;- dt.name_match %&gt;% # general covenants </span></span>
<span id="cb14-185"><a href="#cb14-185" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(grepl(pattern = "^19:", x = group_header)) %&gt;% </span></span>
<span id="cb14-186"><a href="#cb14-186" aria-hidden="true" tabindex="-1"></a><span class="in">  .$orig_name</span></span>
<span id="cb14-187"><a href="#cb14-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-188"><a href="#cb14-188" aria-hidden="true" tabindex="-1"></a><span class="in">name_renegotiation &lt;- c( # names for the </span></span>
<span id="cb14-189"><a href="#cb14-189" aria-hidden="true" tabindex="-1"></a><span class="in">    grep(pattern = "LPC|_O_A", x = names(DealScan_borrower), value = T), </span></span>
<span id="cb14-190"><a href="#cb14-190" aria-hidden="true" tabindex="-1"></a><span class="in">    grep(pattern = "Amended", x = names(DealScan_borrower), value = T), </span></span>
<span id="cb14-191"><a href="#cb14-191" aria-hidden="true" tabindex="-1"></a><span class="in">    grep(pattern = "Refinan", x = names(DealScan_borrower), value = T)</span></span>
<span id="cb14-192"><a href="#cb14-192" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb14-193"><a href="#cb14-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-194"><a href="#cb14-194" aria-hidden="true" tabindex="-1"></a><span class="in">## link the two data sets </span></span>
<span id="cb14-195"><a href="#cb14-195" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_borrower &lt;- DealScan_borrower %&gt;% </span></span>
<span id="cb14-196"><a href="#cb14-196" aria-hidden="true" tabindex="-1"></a><span class="in">  select(Borrower_Id, Borrower_Name, </span></span>
<span id="cb14-197"><a href="#cb14-197" aria-hidden="true" tabindex="-1"></a><span class="in">         (!! name_renegotiation), # all flags for different kind of renegotiations. </span></span>
<span id="cb14-198"><a href="#cb14-198" aria-hidden="true" tabindex="-1"></a><span class="in">         grep(x = names(.), pattern = "Matur", ignore.case = T, value = T), </span></span>
<span id="cb14-199"><a href="#cb14-199" aria-hidden="true" tabindex="-1"></a><span class="in">         "Deal_Amount", "Tranche_Amount", </span></span>
<span id="cb14-200"><a href="#cb14-200" aria-hidden="true" tabindex="-1"></a><span class="in">         "Deal_Active_Date", "Deal_Input_Date", "Tranche_Active_Date", </span></span>
<span id="cb14-201"><a href="#cb14-201" aria-hidden="true" tabindex="-1"></a><span class="in">         "Tranche_Type", "Deal_Purpose", </span></span>
<span id="cb14-202"><a href="#cb14-202" aria-hidden="true" tabindex="-1"></a><span class="in">         grep(pattern = "Remark", x = names(.), value = T)</span></span>
<span id="cb14-203"><a href="#cb14-203" aria-hidden="true" tabindex="-1"></a><span class="in">         ) %&gt;% </span></span>
<span id="cb14-204"><a href="#cb14-204" aria-hidden="true" tabindex="-1"></a><span class="in">  as_tibble() %&gt;% </span></span>
<span id="cb14-205"><a href="#cb14-205" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(contains("Date"), as.Date)) %&gt;% </span></span>
<span id="cb14-206"><a href="#cb14-206" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb14-207"><a href="#cb14-207" aria-hidden="true" tabindex="-1"></a><span class="in">    Event_amend = grepl(x = Deal_Remark, pattern = "amend", ignore.case = T), # whether the term 'amend' is detected </span></span>
<span id="cb14-208"><a href="#cb14-208" aria-hidden="true" tabindex="-1"></a><span class="in">    Event_restate = grepl(x = Deal_Remark, pattern = "restate", ignore.case = T), # whether the term 'restate' is detected </span></span>
<span id="cb14-209"><a href="#cb14-209" aria-hidden="true" tabindex="-1"></a><span class="in">    Event_refin = grepl(x = Deal_Remark, pattern = "refin", ignore.case = T) # whether the term 'refinancing' is detected </span></span>
<span id="cb14-210"><a href="#cb14-210" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb14-211"><a href="#cb14-211" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Event_renegotiation = (Event_amend | Event_amend | Event_refin) ) # whether there exists an events identified by contents in `Deal_Remark` </span></span>
<span id="cb14-212"><a href="#cb14-212" aria-hidden="true" tabindex="-1"></a><span class="in">### The last several lines collect information about whether an amend or amend/restate event happen. </span></span>
<span id="cb14-213"><a href="#cb14-213" aria-hidden="true" tabindex="-1"></a><span class="in">### The `Event_renegotiation` variable detect whether a renegotiation event happens. </span></span>
<span id="cb14-214"><a href="#cb14-214" aria-hidden="true" tabindex="-1"></a><span class="in">### Also, I check whether a deal is a refinancing of previous loan. </span></span>
<span id="cb14-215"><a href="#cb14-215" aria-hidden="true" tabindex="-1"></a><span class="in"># names(dt.DealScan_borrower) </span></span>
<span id="cb14-216"><a href="#cb14-216" aria-hidden="true" tabindex="-1"></a><span class="in"># names(dt.Link_table)</span></span>
<span id="cb14-217"><a href="#cb14-217" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-218"><a href="#cb14-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-219"><a href="#cb14-219" aria-hidden="true" tabindex="-1"></a>Here a summary for the variables <span class="in">`Event_amend`</span>, <span class="in">`Event_restate`</span>,<span class="in">`Event_refin`</span> and <span class="in">`Event_renegotiation`</span> under each group classified by amendment/refinancing flags in DealScan.</span>
<span id="cb14-220"><a href="#cb14-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-221"><a href="#cb14-221" aria-hidden="true" tabindex="-1"></a><span class="in">```{r event_groups1, echo=TRUE, message=FALSE}</span></span>
<span id="cb14-222"><a href="#cb14-222" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: screen-inset</span></span>
<span id="cb14-223"><a href="#cb14-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-224"><a href="#cb14-224" aria-hidden="true" tabindex="-1"></a><span class="in"># to identify different types of contracts which are defined as "Origination". </span></span>
<span id="cb14-225"><a href="#cb14-225" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_borrower %&gt;% </span></span>
<span id="cb14-226"><a href="#cb14-226" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(grepl(pattern = "Orig", x = Tranche_O_A)) %&gt;% # only keep tranches classified as "Origination"</span></span>
<span id="cb14-227"><a href="#cb14-227" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(Deal_Amended, Tranche_Amended, Deal_Refinancing, Tranche_Refinancing) %&gt;% </span></span>
<span id="cb14-228"><a href="#cb14-228" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(n = n(), </span></span>
<span id="cb14-229"><a href="#cb14-229" aria-hidden="true" tabindex="-1"></a><span class="in">            n_Event_amend = sum(Event_amend), </span></span>
<span id="cb14-230"><a href="#cb14-230" aria-hidden="true" tabindex="-1"></a><span class="in">            n_Event_restate = sum(Event_restate), </span></span>
<span id="cb14-231"><a href="#cb14-231" aria-hidden="true" tabindex="-1"></a><span class="in">            n_Event = sum(Event_renegotiation), </span></span>
<span id="cb14-232"><a href="#cb14-232" aria-hidden="true" tabindex="-1"></a><span class="in">            n_Event_refin = sum(Event_refin) </span></span>
<span id="cb14-233"><a href="#cb14-233" aria-hidden="true" tabindex="-1"></a><span class="in">            ) %&gt;% # count the number of each types </span></span>
<span id="cb14-234"><a href="#cb14-234" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb14-235"><a href="#cb14-235" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(percentage_n = (n / sum(n))) %&gt;% </span></span>
<span id="cb14-236"><a href="#cb14-236" aria-hidden="true" tabindex="-1"></a><span class="in">  gt() %&gt;% </span></span>
<span id="cb14-237"><a href="#cb14-237" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_header(title = "Table 2a: WRDS DealScan Deal-Tranche Level Loan Events", </span></span>
<span id="cb14-238"><a href="#cb14-238" aria-hidden="true" tabindex="-1"></a><span class="in">             subtitle = "Subgroup: `Tranche_O_A` = Origination"</span></span>
<span id="cb14-239"><a href="#cb14-239" aria-hidden="true" tabindex="-1"></a><span class="in">             ) %&gt;% </span></span>
<span id="cb14-240"><a href="#cb14-240" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_options(table.font.size = 11, heading.align = 'left' ) %&gt;% </span></span>
<span id="cb14-241"><a href="#cb14-241" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_style( # update the font size for table cells. </span></span>
<span id="cb14-242"><a href="#cb14-242" aria-hidden="true" tabindex="-1"></a><span class="in">    style = cell_text(size = px(11)),</span></span>
<span id="cb14-243"><a href="#cb14-243" aria-hidden="true" tabindex="-1"></a><span class="in">    locations = cells_body()</span></span>
<span id="cb14-244"><a href="#cb14-244" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb14-245"><a href="#cb14-245" aria-hidden="true" tabindex="-1"></a><span class="in">  fmt_percent(columns = percentage_n, decimals = 2) </span></span>
<span id="cb14-246"><a href="#cb14-246" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-247"><a href="#cb14-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-248"><a href="#cb14-248" aria-hidden="true" tabindex="-1"></a><span class="in">```{r event_groups2, echo=TRUE, message=FALSE}</span></span>
<span id="cb14-249"><a href="#cb14-249" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: screen-inset</span></span>
<span id="cb14-250"><a href="#cb14-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-251"><a href="#cb14-251" aria-hidden="true" tabindex="-1"></a><span class="in"># to identify different types of contracts which are defined as "Amendment 1". </span></span>
<span id="cb14-252"><a href="#cb14-252" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_borrower %&gt;% </span></span>
<span id="cb14-253"><a href="#cb14-253" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(grepl(pattern = "Amendment", x = Tranche_O_A)) %&gt;% # only keep tranches classified as "Origination"</span></span>
<span id="cb14-254"><a href="#cb14-254" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(Deal_Amended, Tranche_Amended, Deal_Refinancing, Tranche_Refinancing) %&gt;% </span></span>
<span id="cb14-255"><a href="#cb14-255" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(n = n(), </span></span>
<span id="cb14-256"><a href="#cb14-256" aria-hidden="true" tabindex="-1"></a><span class="in">            n_Event_amend = sum(Event_amend), </span></span>
<span id="cb14-257"><a href="#cb14-257" aria-hidden="true" tabindex="-1"></a><span class="in">            n_Event_restate = sum(Event_restate), </span></span>
<span id="cb14-258"><a href="#cb14-258" aria-hidden="true" tabindex="-1"></a><span class="in">            n_Event = sum(Event_renegotiation), </span></span>
<span id="cb14-259"><a href="#cb14-259" aria-hidden="true" tabindex="-1"></a><span class="in">            n_Event_refin = sum(Event_refin) </span></span>
<span id="cb14-260"><a href="#cb14-260" aria-hidden="true" tabindex="-1"></a><span class="in">            ) %&gt;% # count the number of each types </span></span>
<span id="cb14-261"><a href="#cb14-261" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb14-262"><a href="#cb14-262" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(percentage_n = (n / sum(n))) %&gt;% </span></span>
<span id="cb14-263"><a href="#cb14-263" aria-hidden="true" tabindex="-1"></a><span class="in">  gt() %&gt;% </span></span>
<span id="cb14-264"><a href="#cb14-264" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_header(title = "Table 2b: WRDS DealScan Deal-Tranche Level Loan Events", </span></span>
<span id="cb14-265"><a href="#cb14-265" aria-hidden="true" tabindex="-1"></a><span class="in">             subtitle = "Subgroup: `Tranche_O_A` = Amendment(s)"</span></span>
<span id="cb14-266"><a href="#cb14-266" aria-hidden="true" tabindex="-1"></a><span class="in">             ) %&gt;% </span></span>
<span id="cb14-267"><a href="#cb14-267" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_options(table.font.size = 11, heading.align = 'left' ) %&gt;% </span></span>
<span id="cb14-268"><a href="#cb14-268" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_style( # update the font size for table cells. </span></span>
<span id="cb14-269"><a href="#cb14-269" aria-hidden="true" tabindex="-1"></a><span class="in">    style = cell_text(size = px(11)),</span></span>
<span id="cb14-270"><a href="#cb14-270" aria-hidden="true" tabindex="-1"></a><span class="in">    locations = cells_body()</span></span>
<span id="cb14-271"><a href="#cb14-271" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb14-272"><a href="#cb14-272" aria-hidden="true" tabindex="-1"></a><span class="in">  fmt_percent(columns = percentage_n, decimals = 2)</span></span>
<span id="cb14-273"><a href="#cb14-273" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-274"><a href="#cb14-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-275"><a href="#cb14-275" aria-hidden="true" tabindex="-1"></a>Now we merge the DealScan deal-tranche information with the link table and try to extract the loan path. To facilite data analysis, I create a new variable &lt;b&gt;<span class="in">`obs_id`</span>&lt;/b&gt;, standing for the id for each observation in the dataset, and will be used as the sole identifier in subsequent data mergers.  </span>
<span id="cb14-276"><a href="#cb14-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-277"><a href="#cb14-277" aria-hidden="true" tabindex="-1"></a>Also, I create a new firm-deal level identifier <span class="in">`firm_deal_id`</span> to facilitate the data cleaning process. Note that this is more of a &lt;u&gt;"firm-deal-time id"&lt;/u&gt;. </span>
<span id="cb14-278"><a href="#cb14-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-279"><a href="#cb14-279" aria-hidden="true" tabindex="-1"></a><span class="in">```{r loan_path2, echo=TRUE, results='asis', warning=FALSE}</span></span>
<span id="cb14-280"><a href="#cb14-280" aria-hidden="true" tabindex="-1"></a><span class="in"># merge the deal/tranche information with the link table. </span></span>
<span id="cb14-281"><a href="#cb14-281" aria-hidden="true" tabindex="-1"></a><span class="in">### direct merge creates the issue of multiple-to-multiple matching. &gt; solve this issue by matching at the deal, not tranche, level. </span></span>
<span id="cb14-282"><a href="#cb14-282" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_borrower_Linked &lt;- dt.DealScan_borrower %&gt;% </span></span>
<span id="cb14-283"><a href="#cb14-283" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(distinct(select(dt.Link_table, -c("facilityid", contains("ticker")))), # collect deal-level </span></span>
<span id="cb14-284"><a href="#cb14-284" aria-hidden="true" tabindex="-1"></a><span class="in">            by = join_by(Borrower_Id == `LoanConnector Company ID`,</span></span>
<span id="cb14-285"><a href="#cb14-285" aria-hidden="true" tabindex="-1"></a><span class="in">                         Tranche_Active_Date == facilitystartdate))</span></span>
<span id="cb14-286"><a href="#cb14-286" aria-hidden="true" tabindex="-1"></a><span class="in"># dt.DealScan_borrower_Linked %&gt;% filter(Borrower_Id == 17400)</span></span>
<span id="cb14-287"><a href="#cb14-287" aria-hidden="true" tabindex="-1"></a><span class="in"># names(dt.DealScan_borrower_Linked) </span></span>
<span id="cb14-288"><a href="#cb14-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-289"><a href="#cb14-289" aria-hidden="true" tabindex="-1"></a><span class="in"># firm-deal-tranche level data </span></span>
<span id="cb14-290"><a href="#cb14-290" aria-hidden="true" tabindex="-1"></a><span class="in">cat("I use the self-created `gvkey_group1` variable as the unique company identifer. (restrict to max 100 observations) Observations are at the firm-deal-tranche-time level.") </span></span>
<span id="cb14-291"><a href="#cb14-291" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_borrower_unifirm &lt;- dt.DealScan_borrower_Linked %&gt;% </span></span>
<span id="cb14-292"><a href="#cb14-292" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(gvkey_group1) %&gt;% # for each unique firm over the life-cycle </span></span>
<span id="cb14-293"><a href="#cb14-293" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(Tranche_Active_Date) %&gt;%  # %&gt;% # arrange by its </span></span>
<span id="cb14-294"><a href="#cb14-294" aria-hidden="true" tabindex="-1"></a><span class="in">  rowid_to_column(var = "obs_id") # a new id for each observation in the data </span></span>
<span id="cb14-295"><a href="#cb14-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-296"><a href="#cb14-296" aria-hidden="true" tabindex="-1"></a><span class="in"># plot the distribution of firms with number of observations in the sample </span></span>
<span id="cb14-297"><a href="#cb14-297" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_borrower_unifirm %&gt;% # group firms by the `gvkey_group1` variable </span></span>
<span id="cb14-298"><a href="#cb14-298" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(n = n()) %&gt;% </span></span>
<span id="cb14-299"><a href="#cb14-299" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb14-300"><a href="#cb14-300" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(., ) + geom_bar(aes(n)) +  # + scale_y_continuous(transform = "log10")</span></span>
<span id="cb14-301"><a href="#cb14-301" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(limits = c(0, 100)) </span></span>
<span id="cb14-302"><a href="#cb14-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-303"><a href="#cb14-303" aria-hidden="true" tabindex="-1"></a><span class="in"># analyse at the firm-deal level (not tranche level) &gt; always for the same firm</span></span>
<span id="cb14-304"><a href="#cb14-304" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_borrower_unifirm_deal &lt;- dt.DealScan_borrower_unifirm %&gt;% </span></span>
<span id="cb14-305"><a href="#cb14-305" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(flag_renegotiation = ifelse(</span></span>
<span id="cb14-306"><a href="#cb14-306" aria-hidden="true" tabindex="-1"></a><span class="in">    grepl(pattern = "Amendment", x = Tranche_O_A, fixed = T) |</span></span>
<span id="cb14-307"><a href="#cb14-307" aria-hidden="true" tabindex="-1"></a><span class="in">      (!grepl(pattern = "Amendment", x = Tranche_O_A, fixed = T) &amp; </span></span>
<span id="cb14-308"><a href="#cb14-308" aria-hidden="true" tabindex="-1"></a><span class="in">         (Deal_Amended == "Yes" | Deal_Refinancing == "Yes") ), # the selection criterion: Deal_Refinancing == "Yes" might need further examinations. </span></span>
<span id="cb14-309"><a href="#cb14-309" aria-hidden="true" tabindex="-1"></a><span class="in">    yes = TRUE, no = FALSE</span></span>
<span id="cb14-310"><a href="#cb14-310" aria-hidden="true" tabindex="-1"></a><span class="in">  ) ) %&gt;% # use LPC flags to identify renegotiations *** </span></span>
<span id="cb14-311"><a href="#cb14-311" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey_group1, # obs_id </span></span>
<span id="cb14-312"><a href="#cb14-312" aria-hidden="true" tabindex="-1"></a><span class="in">         Deal_Active_Date, Tranche_Active_Date, Tranche_Maturity_Date, Deal_Input_Date, </span></span>
<span id="cb14-313"><a href="#cb14-313" aria-hidden="true" tabindex="-1"></a><span class="in">         contains("Amount"), (!! name_renegotiation), </span></span>
<span id="cb14-314"><a href="#cb14-314" aria-hidden="true" tabindex="-1"></a><span class="in">         Deal_Remark, Tranche_Remark, starts_with("Event"), flag_renegotiation, </span></span>
<span id="cb14-315"><a href="#cb14-315" aria-hidden="true" tabindex="-1"></a><span class="in">         -contains("Tranche"), Tranche_O_A, Tranche_Active_Date) %&gt;% </span></span>
<span id="cb14-316"><a href="#cb14-316" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb14-317"><a href="#cb14-317" aria-hidden="true" tabindex="-1"></a><span class="in">    linked_deal_time = str_extract_all(string = Deal_Remark, pattern = "(?:\\b[^.]*)\\b(?:amend|restat|refinan)[a-z]*\\b[^.]*\\.", simplify = F), # "\\d+/\\d+/\\d+"</span></span>
<span id="cb14-318"><a href="#cb14-318" aria-hidden="true" tabindex="-1"></a><span class="in">    ## explain the regex: "\\b(amend|restat)[a-z]+\\b(\\s+\\S+){1,10}\\."</span></span>
<span id="cb14-319"><a href="#cb14-319" aria-hidden="true" tabindex="-1"></a><span class="in">    ## 1. "\\b ... \\b" means exact match in the pattern.</span></span>
<span id="cb14-320"><a href="#cb14-320" aria-hidden="true" tabindex="-1"></a><span class="in">    ## 2. (?:\\s+\\S+){1,10}</span></span>
<span id="cb14-321"><a href="#cb14-321" aria-hidden="true" tabindex="-1"></a><span class="in">    linked_deal_time_n = lengths(linked_deal_time)</span></span>
<span id="cb14-322"><a href="#cb14-322" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb14-323"><a href="#cb14-323" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb14-324"><a href="#cb14-324" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct() %&gt;% </span></span>
<span id="cb14-325"><a href="#cb14-325" aria-hidden="true" tabindex="-1"></a><span class="in">  rowid_to_column(var = "firm_deal_id") # a new id for each observation in the data - firm-deal level </span></span>
<span id="cb14-326"><a href="#cb14-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-327"><a href="#cb14-327" aria-hidden="true" tabindex="-1"></a><span class="in"># ======================================================================== (June 17, 2024) </span></span>
<span id="cb14-328"><a href="#cb14-328" aria-hidden="true" tabindex="-1"></a><span class="in"># Firm a, Deal i, Tranche j, at Time t. </span></span>
<span id="cb14-329"><a href="#cb14-329" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_borrower_aijt &lt;- dt.DealScan_borrower_unifirm_deal %&gt;% # firm a, deal i, tranche j, at time t. </span></span>
<span id="cb14-330"><a href="#cb14-330" aria-hidden="true" tabindex="-1"></a><span class="in">  select(firm_deal_id, gvkey_group1, LPC_Deal_ID, </span></span>
<span id="cb14-331"><a href="#cb14-331" aria-hidden="true" tabindex="-1"></a><span class="in">         Deal_Active_Date, Tranche_Active_Date,</span></span>
<span id="cb14-332"><a href="#cb14-332" aria-hidden="true" tabindex="-1"></a><span class="in">         Deal_Remark, linked_deal_time, linked_deal_time_n) %&gt;% </span></span>
<span id="cb14-333"><a href="#cb14-333" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(linked_deal_time_n &gt; 0) %&gt;% # keep only terms that mentioned dates. </span></span>
<span id="cb14-334"><a href="#cb14-334" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(linked_record_time = sapply(X = linked_deal_time, </span></span>
<span id="cb14-335"><a href="#cb14-335" aria-hidden="true" tabindex="-1"></a><span class="in">                              FUN = function(x) { </span></span>
<span id="cb14-336"><a href="#cb14-336" aria-hidden="true" tabindex="-1"></a><span class="in">                                extracted_date = str_extract_all(pattern = "\\d+/\\d+/\\d+", string = x, simplify = T) # extract the date information </span></span>
<span id="cb14-337"><a href="#cb14-337" aria-hidden="true" tabindex="-1"></a><span class="in">                                output = paste(extracted_date[nchar(extracted_date) &gt; 0], collapse = ";") # the time recorded in the extract text. </span></span>
<span id="cb14-338"><a href="#cb14-338" aria-hidden="true" tabindex="-1"></a><span class="in">                                return(output) </span></span>
<span id="cb14-339"><a href="#cb14-339" aria-hidden="true" tabindex="-1"></a><span class="in">                              }</span></span>
<span id="cb14-340"><a href="#cb14-340" aria-hidden="true" tabindex="-1"></a><span class="in">  ) ) %&gt;% </span></span>
<span id="cb14-341"><a href="#cb14-341" aria-hidden="true" tabindex="-1"></a><span class="in">  separate_rows(linked_record_time, sep = ";") %&gt;% # break into different rows </span></span>
<span id="cb14-342"><a href="#cb14-342" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(related_time = as.Date(x = linked_record_time, format = "%m/%d/%y"), </span></span>
<span id="cb14-343"><a href="#cb14-343" aria-hidden="true" tabindex="-1"></a><span class="in">         time_low = related_time - 15, </span></span>
<span id="cb14-344"><a href="#cb14-344" aria-hidden="true" tabindex="-1"></a><span class="in">         time_high = related_time + 15 # the upper and lower limit for the deal time to match </span></span>
<span id="cb14-345"><a href="#cb14-345" aria-hidden="true" tabindex="-1"></a><span class="in">         ) %&gt;% </span></span>
<span id="cb14-346"><a href="#cb14-346" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(related_time) &amp; !is.na(gvkey_group1))</span></span>
<span id="cb14-347"><a href="#cb14-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-348"><a href="#cb14-348" aria-hidden="true" tabindex="-1"></a><span class="in"># link Deal i, Tranche j, at Time t (_ijt) to the deal before and after: </span></span>
<span id="cb14-349"><a href="#cb14-349" aria-hidden="true" tabindex="-1"></a><span class="in">by_at &lt;- join_by(gvkey_group1, between(Deal_Active_Date, time_low, time_high))</span></span>
<span id="cb14-350"><a href="#cb14-350" aria-hidden="true" tabindex="-1"></a><span class="in">dt.manual_renegotiation &lt;- dt.DealScan_borrower_unifirm_deal %&gt;% </span></span>
<span id="cb14-351"><a href="#cb14-351" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(gvkey_group1)) %&gt;% </span></span>
<span id="cb14-352"><a href="#cb14-352" aria-hidden="true" tabindex="-1"></a><span class="in">  inner_join(select(dt.DealScan_borrower_aijt, </span></span>
<span id="cb14-353"><a href="#cb14-353" aria-hidden="true" tabindex="-1"></a><span class="in">                    gvkey_group1, # all observations in this has a `gvkey_group1`. </span></span>
<span id="cb14-354"><a href="#cb14-354" aria-hidden="true" tabindex="-1"></a><span class="in">                    Linked_firm_deal_id = firm_deal_id, </span></span>
<span id="cb14-355"><a href="#cb14-355" aria-hidden="true" tabindex="-1"></a><span class="in">                    Linked_LPC_Deal_ID = LPC_Deal_ID, </span></span>
<span id="cb14-356"><a href="#cb14-356" aria-hidden="true" tabindex="-1"></a><span class="in">                    Linked_Deal_Active_Date = Deal_Active_Date, </span></span>
<span id="cb14-357"><a href="#cb14-357" aria-hidden="true" tabindex="-1"></a><span class="in">                    Linked_Tranche_Active_Date = Tranche_Active_Date, </span></span>
<span id="cb14-358"><a href="#cb14-358" aria-hidden="true" tabindex="-1"></a><span class="in">                    starts_with("time_")), </span></span>
<span id="cb14-359"><a href="#cb14-359" aria-hidden="true" tabindex="-1"></a><span class="in">             by = by_at) %&gt;% </span></span>
<span id="cb14-360"><a href="#cb14-360" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate( # create a new identifier to manually detect renegotiation from `Deal_Remark`: </span></span>
<span id="cb14-361"><a href="#cb14-361" aria-hidden="true" tabindex="-1"></a><span class="in">    ## record the original, unique firm-deal id if the `Linked_Tranche_Active_Date` comes after the `Linked_Tranche_Active_Date`. </span></span>
<span id="cb14-362"><a href="#cb14-362" aria-hidden="true" tabindex="-1"></a><span class="in">    ## and record the linked firm-deal id if otherwise. </span></span>
<span id="cb14-363"><a href="#cb14-363" aria-hidden="true" tabindex="-1"></a><span class="in">    id_before = ifelse(Tranche_Active_Date &lt; Linked_Tranche_Active_Date, yes = firm_deal_id, no = Linked_firm_deal_id), # the previous id </span></span>
<span id="cb14-364"><a href="#cb14-364" aria-hidden="true" tabindex="-1"></a><span class="in">    id_after = ifelse(Tranche_Active_Date &lt; Linked_Tranche_Active_Date, yes = Linked_firm_deal_id, no = firm_deal_id) # the id for the deal that linked to `id_before`</span></span>
<span id="cb14-365"><a href="#cb14-365" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb14-366"><a href="#cb14-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-367"><a href="#cb14-367" aria-hidden="true" tabindex="-1"></a><span class="in"># ======================================================================== (June 18, 2024)</span></span>
<span id="cb14-368"><a href="#cb14-368" aria-hidden="true" tabindex="-1"></a><span class="in"># merge the manually identified renegotiated contracts back to the full dataset. </span></span>
<span id="cb14-369"><a href="#cb14-369" aria-hidden="true" tabindex="-1"></a><span class="in"># `dt.DealScan_borrower_unifirm_deal` is updated. </span></span>
<span id="cb14-370"><a href="#cb14-370" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_borrower_unifirm_deal &lt;- dt.DealScan_borrower_unifirm_deal %&gt;% </span></span>
<span id="cb14-371"><a href="#cb14-371" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(</span></span>
<span id="cb14-372"><a href="#cb14-372" aria-hidden="true" tabindex="-1"></a><span class="in">    dt.manual_renegotiation %&gt;% </span></span>
<span id="cb14-373"><a href="#cb14-373" aria-hidden="true" tabindex="-1"></a><span class="in">      select(id_before, id_after) %&gt;% # only the firm-deal identified by `id_after` will be noted as a renegotiated contract. </span></span>
<span id="cb14-374"><a href="#cb14-374" aria-hidden="true" tabindex="-1"></a><span class="in">      mutate(flag_manual_renegotiation = TRUE), </span></span>
<span id="cb14-375"><a href="#cb14-375" aria-hidden="true" tabindex="-1"></a><span class="in">    by = join_by(firm_deal_id == id_after) </span></span>
<span id="cb14-376"><a href="#cb14-376" aria-hidden="true" tabindex="-1"></a><span class="in">  ) </span></span>
<span id="cb14-377"><a href="#cb14-377" aria-hidden="true" tabindex="-1"></a><span class="in"># ========================================================================</span></span>
<span id="cb14-378"><a href="#cb14-378" aria-hidden="true" tabindex="-1"></a><span class="in"># ========================================================================</span></span>
<span id="cb14-379"><a href="#cb14-379" aria-hidden="true" tabindex="-1"></a><span class="in"># gvkey_group1 == 7089; 1894; 1392</span></span>
<span id="cb14-380"><a href="#cb14-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-381"><a href="#cb14-381" aria-hidden="true" tabindex="-1"></a><span class="in">  # gt() %&gt;%</span></span>
<span id="cb14-382"><a href="#cb14-382" aria-hidden="true" tabindex="-1"></a><span class="in">  # tab_options(table.font.size = 13, heading.align = 'left' ) %&gt;%</span></span>
<span id="cb14-383"><a href="#cb14-383" aria-hidden="true" tabindex="-1"></a><span class="in">  # cols_width(Deal_Remark ~ px(1000), linked_deal_time ~ px(1000))</span></span>
<span id="cb14-384"><a href="#cb14-384" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-385"><a href="#cb14-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-386"><a href="#cb14-386" aria-hidden="true" tabindex="-1"></a>::: {#wrn-loan-path2 .callout-warning .column-margin}</span>
<span id="cb14-387"><a href="#cb14-387" aria-hidden="true" tabindex="-1"></a><span class="fu">## Identify Loan Renegotiations!</span></span>
<span id="cb14-388"><a href="#cb14-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-389"><a href="#cb14-389" aria-hidden="true" tabindex="-1"></a>In newly generated data <span class="in">`dt.DealScan_borrower_unifirm_deal`</span>, the criterion to generate the new variable <span class="in">`flag_renegotiation`</span> might need more detailed examination. This variable is created to detect whether an amendment happens, even when the <span class="in">`Tranch_O_A`</span> variable gives <span class="in">`"Origination"`</span>. </span>
<span id="cb14-390"><a href="#cb14-390" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb14-391"><a href="#cb14-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-392"><a href="#cb14-392" aria-hidden="true" tabindex="-1"></a>Here is a summary table showing the mapping between the amendment/refinancing flags and the <span class="in">`flag_renegotiation`</span> I created for firm-deal level dataset - <span class="in">`dt.DealScan_borrower_unifirm_deal`</span>. </span>
<span id="cb14-393"><a href="#cb14-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-394"><a href="#cb14-394" aria-hidden="true" tabindex="-1"></a><span class="in">```{r flag_renegotiation_group1, echo=TRUE, message=FALSE, warning=FALSE}</span></span>
<span id="cb14-395"><a href="#cb14-395" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: body</span></span>
<span id="cb14-396"><a href="#cb14-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-397"><a href="#cb14-397" aria-hidden="true" tabindex="-1"></a><span class="in"># to identify different types of contracts which are defined as "Origination". </span></span>
<span id="cb14-398"><a href="#cb14-398" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_borrower_unifirm_deal %&gt;% </span></span>
<span id="cb14-399"><a href="#cb14-399" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Orig_Yes = ifelse(grepl(pattern = "Orig", x = Tranche_O_A), </span></span>
<span id="cb14-400"><a href="#cb14-400" aria-hidden="true" tabindex="-1"></a><span class="in">                           "`Tranche_O_A` = Origination`", </span></span>
<span id="cb14-401"><a href="#cb14-401" aria-hidden="true" tabindex="-1"></a><span class="in">                           "`Tranche_O_A` = Amendment")) %&gt;% # group by "Origination". </span></span>
<span id="cb14-402"><a href="#cb14-402" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(Orig_Yes, Deal_Amended, Deal_Refinancing) %&gt;% </span></span>
<span id="cb14-403"><a href="#cb14-403" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(n = n(), </span></span>
<span id="cb14-404"><a href="#cb14-404" aria-hidden="true" tabindex="-1"></a><span class="in">            n_renegotiationYes = sum(flag_renegotiation == TRUE), </span></span>
<span id="cb14-405"><a href="#cb14-405" aria-hidden="true" tabindex="-1"></a><span class="in">            n_renegotiationNo = sum(flag_renegotiation == FALSE), </span></span>
<span id="cb14-406"><a href="#cb14-406" aria-hidden="true" tabindex="-1"></a><span class="in">            ) %&gt;% # count the number of each types </span></span>
<span id="cb14-407"><a href="#cb14-407" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb14-408"><a href="#cb14-408" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(percentage_n = (n / sum(n))) %&gt;% </span></span>
<span id="cb14-409"><a href="#cb14-409" aria-hidden="true" tabindex="-1"></a><span class="in">  gt(groupname_col = "Orig_Yes") %&gt;% </span></span>
<span id="cb14-410"><a href="#cb14-410" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_header(title = "Table 3: WRDS DealScan Deal-Tranche Level Loan Events", </span></span>
<span id="cb14-411"><a href="#cb14-411" aria-hidden="true" tabindex="-1"></a><span class="in">             subtitle = "A summary statistics to show the results of my identifier: `flag_renegotiation`"</span></span>
<span id="cb14-412"><a href="#cb14-412" aria-hidden="true" tabindex="-1"></a><span class="in">             ) %&gt;% </span></span>
<span id="cb14-413"><a href="#cb14-413" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_options(table.font.size = 11, heading.align = 'left' ) %&gt;% </span></span>
<span id="cb14-414"><a href="#cb14-414" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_style( # update the font size for table cells. </span></span>
<span id="cb14-415"><a href="#cb14-415" aria-hidden="true" tabindex="-1"></a><span class="in">    style = cell_text(size = px(11)),</span></span>
<span id="cb14-416"><a href="#cb14-416" aria-hidden="true" tabindex="-1"></a><span class="in">    locations = cells_body()</span></span>
<span id="cb14-417"><a href="#cb14-417" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb14-418"><a href="#cb14-418" aria-hidden="true" tabindex="-1"></a><span class="in">  fmt_percent(columns = percentage_n, decimals = 2) </span></span>
<span id="cb14-419"><a href="#cb14-419" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-420"><a href="#cb14-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-421"><a href="#cb14-421" aria-hidden="true" tabindex="-1"></a><span class="fu">## S4. Clean the loan renegotiation data</span></span>
<span id="cb14-422"><a href="#cb14-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-423"><a href="#cb14-423" aria-hidden="true" tabindex="-1"></a>Then, I will create a more detailed <span class="in">`flag_Renegotiated`</span> variable in the dataset to more thoroughly cover all renegotiations at the firm-deal level. </span>
<span id="cb14-424"><a href="#cb14-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-425"><a href="#cb14-425" aria-hidden="true" tabindex="-1"></a>A recap about the definition of different renegotiation flags: </span>
<span id="cb14-426"><a href="#cb14-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-427"><a href="#cb14-427" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Event_renegotiation`</span>: word detection in the variable <span class="in">`Deal_Remark`</span>.  </span>
<span id="cb14-428"><a href="#cb14-428" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`flag_renegotiation`</span>: detected renegotiations based on the amendment/refinancing/_O_A flags in DealScan. </span>
<span id="cb14-429"><a href="#cb14-429" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`flag_manual_renegotiation`</span>: manually matched renegotiated deals based on <span class="in">`Deal_Remark`</span>. </span>
<span id="cb14-430"><a href="#cb14-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-431"><a href="#cb14-431" aria-hidden="true" tabindex="-1"></a>::: {#wrn-loan-path3 .callout-warning .column-margin}</span>
<span id="cb14-432"><a href="#cb14-432" aria-hidden="true" tabindex="-1"></a><span class="fu">## Still! A lot of renegotiations are missing. </span></span>
<span id="cb14-433"><a href="#cb14-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-434"><a href="#cb14-434" aria-hidden="true" tabindex="-1"></a>For company <span class="co">[</span><span class="ot">COLORADO INTERSTATE GAS COMPANY, L.L.C.</span><span class="co">](2015https://www.sec.gov/Archives/edgar/data/200155/000020015515000003/0000200155-15-000003.txt)</span>, it is previously known as "COLORADO INTERSTATE CORP" (ex 1976/01/19) and "COLORADO INTERSTATE GAS CO" (ex 1992/07/03) and was subsequently potentially (?) merged with KINDER MORGAN, INC, in maybe 2014. The firm is a subsidiary of El Paso Corporation (NYSE: EP). </span>
<span id="cb14-435"><a href="#cb14-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-436"><a href="#cb14-436" aria-hidden="true" tabindex="-1"></a>Even with these, there are still a lot of missing amendment/restatements in the DealScan. E.g. <span class="co">[</span><span class="ot">8-K</span><span class="co">](https://www.sec.gov/edgar/search/#exhibit99a.htm)</span>. However, this issue may be because it is just a subsidiary and thus we may need to connect these dot and build this family-subsidiary connections. </span>
<span id="cb14-437"><a href="#cb14-437" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb14-438"><a href="#cb14-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-439"><a href="#cb14-439" aria-hidden="true" tabindex="-1"></a><span class="in">```{r loan_path3, echo=TRUE}</span></span>
<span id="cb14-440"><a href="#cb14-440" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_borrower_unifirm_deal %&gt;% </span></span>
<span id="cb14-441"><a href="#cb14-441" aria-hidden="true" tabindex="-1"></a><span class="in">  select(-contains("linked_"), -contains("Remark")) %&gt;% </span></span>
<span id="cb14-442"><a href="#cb14-442" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(flag_manual_renegotiation = replace_na(flag_manual_renegotiation, replace = FALSE)) %&gt;% </span></span>
<span id="cb14-443"><a href="#cb14-443" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(gvkey_group1) %&gt;% ## (1) collect all observations within the same group </span></span>
<span id="cb14-444"><a href="#cb14-444" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(Tranche_Active_Date) %&gt;% </span></span>
<span id="cb14-445"><a href="#cb14-445" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(flag_Renegotiated = (Event_renegotiation | flag_renegotiation | flag_manual_renegotiation) ) </span></span>
<span id="cb14-446"><a href="#cb14-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-447"><a href="#cb14-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-448"><a href="#cb14-448" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-449"><a href="#cb14-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-450"><a href="#cb14-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-451"><a href="#cb14-451" aria-hidden="true" tabindex="-1"></a><span class="fu">## Reference {#sec-reference}</span></span>
<span id="cb14-452"><a href="#cb14-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-453"><a href="#cb14-453" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Related <span class="co">[</span><span class="ot">Peter Demerjian</span><span class="co">](https://peterdemerjian.weebly.com/research.html)</span></span>
<span id="cb14-454"><a href="#cb14-454" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Measuring the Probability of Financial Covenant Violation in Private Debt Contracts (with E. Owens). Journal of Accounting and Economics 61: 433-447 (2016). <span class="sc">\&gt;</span> <span class="co">[</span><span class="ot">CODE</span><span class="co">](https://peterdemerjian.weebly.com/managerialability.html)</span></span>
<span id="cb14-455"><a href="#cb14-455" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span></span>
<span id="cb14-456"><a href="#cb14-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-457"><a href="#cb14-457" aria-hidden="true" tabindex="-1"></a><span class="fu">## To-do list:</span></span>
<span id="cb14-458"><a href="#cb14-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-459"><a href="#cb14-459" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">June 13, 2024</span><span class="co">]()</span></span>
<span id="cb14-460"><a href="#cb14-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-461"><a href="#cb14-461" aria-hidden="true" tabindex="-1"></a><span class="fu">## Trashbin:</span></span>
<span id="cb14-462"><a href="#cb14-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-463"><a href="#cb14-463" aria-hidden="true" tabindex="-1"></a><span class="in">```{r trash, eval=FALSE}</span></span>
<span id="cb14-464"><a href="#cb14-464" aria-hidden="true" tabindex="-1"></a><span class="in">### </span></span>
<span id="cb14-465"><a href="#cb14-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-466"><a href="#cb14-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-467"><a href="#cb14-467" aria-hidden="true" tabindex="-1"></a><span class="in"># ------------------------------------------------------------------</span></span>
<span id="cb14-468"><a href="#cb14-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-469"><a href="#cb14-469" aria-hidden="true" tabindex="-1"></a><span class="in">### from section S2 - June 13, 2024 </span></span>
<span id="cb14-470"><a href="#cb14-470" aria-hidden="true" tabindex="-1"></a><span class="in">## create a dataset for the unique id for each unique observations. </span></span>
<span id="cb14-471"><a href="#cb14-471" aria-hidden="true" tabindex="-1"></a><span class="in">dt.Link_table_id &lt;- Link_table %&gt;% </span></span>
<span id="cb14-472"><a href="#cb14-472" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, `LoanConnector Company ID`, borrowercompanyid, facilitystartdate) %&gt;% </span></span>
<span id="cb14-473"><a href="#cb14-473" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(gvkey, `LoanConnector Company ID`, borrowercompanyid) %&gt;% </span></span>
<span id="cb14-474"><a href="#cb14-474" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(facilitystartdate_min = min(facilitystartdate)) %&gt;% </span></span>
<span id="cb14-475"><a href="#cb14-475" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb14-476"><a href="#cb14-476" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(gvkey) %&gt;% </span></span>
<span id="cb14-477"><a href="#cb14-477" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(facilitystartdate_min) %&gt;% </span></span>
<span id="cb14-478"><a href="#cb14-478" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(gvkey_group = cur_group_id()) %&gt;% # generate the group_id based on `gvkey` </span></span>
<span id="cb14-479"><a href="#cb14-479" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() </span></span>
<span id="cb14-480"><a href="#cb14-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-481"><a href="#cb14-481" aria-hidden="true" tabindex="-1"></a><span class="in">## only contain self-created prelimiary gvkey_group(s):</span></span>
<span id="cb14-482"><a href="#cb14-482" aria-hidden="true" tabindex="-1"></a><span class="in">comp_id_gvkey &lt;- dt.Link_table_id %&gt;%</span></span>
<span id="cb14-483"><a href="#cb14-483" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, `LoanConnector Company ID`, gvkey_group) %&gt;%</span></span>
<span id="cb14-484"><a href="#cb14-484" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(`LoanConnector Company ID`) %&gt;%</span></span>
<span id="cb14-485"><a href="#cb14-485" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(company_id_to_gvkey = paste0(paste0(unique(gvkey), collapse = ";"), ";"), # for `gvkey`</span></span>
<span id="cb14-486"><a href="#cb14-486" aria-hidden="true" tabindex="-1"></a><span class="in">            company_id_to_gvkey_group = paste0(paste0(unique(gvkey_group), collapse = ";"), ";"), # for `gvkey_group`</span></span>
<span id="cb14-487"><a href="#cb14-487" aria-hidden="true" tabindex="-1"></a><span class="in">            n_gvkey = length(unique(gvkey)) # number of gvkey(s) within each `company_ID` group.</span></span>
<span id="cb14-488"><a href="#cb14-488" aria-hidden="true" tabindex="-1"></a><span class="in">            ) %&gt;%</span></span>
<span id="cb14-489"><a href="#cb14-489" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup()</span></span>
<span id="cb14-490"><a href="#cb14-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-491"><a href="#cb14-491" aria-hidden="true" tabindex="-1"></a><span class="in">comp_id_gvkey</span></span>
<span id="cb14-492"><a href="#cb14-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-493"><a href="#cb14-493" aria-hidden="true" tabindex="-1"></a><span class="in">dt.gvkey_group1 &lt;- dt.Link_table_id %&gt;%</span></span>
<span id="cb14-494"><a href="#cb14-494" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(comp_id_gvkey, by = "LoanConnector Company ID") %&gt;%</span></span>
<span id="cb14-495"><a href="#cb14-495" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(gvkey) %&gt;%</span></span>
<span id="cb14-496"><a href="#cb14-496" aria-hidden="true" tabindex="-1"></a><span class="in">  # head(30) %&gt;%</span></span>
<span id="cb14-497"><a href="#cb14-497" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(gvkey) %&gt;% # for each given `gvkey`, find the associated `gvkey`(s) based on `company_ID`.</span></span>
<span id="cb14-498"><a href="#cb14-498" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise( # re-construct the list of linked `gvkey`(s)</span></span>
<span id="cb14-499"><a href="#cb14-499" aria-hidden="true" tabindex="-1"></a><span class="in">    connected_gvkey = paste(unique(unlist(strsplit(company_id_to_gvkey, split = ";"))), collapse = ";")</span></span>
<span id="cb14-500"><a href="#cb14-500" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb14-501"><a href="#cb14-501" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;%</span></span>
<span id="cb14-502"><a href="#cb14-502" aria-hidden="true" tabindex="-1"></a><span class="in">  select(connected_gvkey) %&gt;%</span></span>
<span id="cb14-503"><a href="#cb14-503" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct() %&gt;%</span></span>
<span id="cb14-504"><a href="#cb14-504" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(gvkey_group1 = 1:nrow(.))</span></span>
<span id="cb14-505"><a href="#cb14-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-506"><a href="#cb14-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-507"><a href="#cb14-507" aria-hidden="true" tabindex="-1"></a><span class="in">dt.Link_table_gvkey &lt;- str_split(string = dt.gvkey_group1$connected_gvkey, pattern = ";", simplify = F) %&gt;%</span></span>
<span id="cb14-508"><a href="#cb14-508" aria-hidden="true" tabindex="-1"></a><span class="in">  `names&lt;-`(value = dt.gvkey_group1$gvkey_group1) %&gt;%</span></span>
<span id="cb14-509"><a href="#cb14-509" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist(.) %&gt;%</span></span>
<span id="cb14-510"><a href="#cb14-510" aria-hidden="true" tabindex="-1"></a><span class="in">  data.frame(gvkey = ., gvkey_group1 = names(.)) %&gt;%</span></span>
<span id="cb14-511"><a href="#cb14-511" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(gvkey = as.numeric(gvkey))</span></span>
<span id="cb14-512"><a href="#cb14-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-513"><a href="#cb14-513" aria-hidden="true" tabindex="-1"></a><span class="in">### merge back to the link table</span></span>
<span id="cb14-514"><a href="#cb14-514" aria-hidden="true" tabindex="-1"></a><span class="in">dt.Link_table_id2 &lt;- dt.Link_table_id %&gt;%</span></span>
<span id="cb14-515"><a href="#cb14-515" aria-hidden="true" tabindex="-1"></a><span class="in">  select(-facilitystartdate_min, -gvkey_group) %&gt;%</span></span>
<span id="cb14-516"><a href="#cb14-516" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(dt.Link_table_gvkey, by = "gvkey")</span></span>
<span id="cb14-517"><a href="#cb14-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-518"><a href="#cb14-518" aria-hidden="true" tabindex="-1"></a><span class="in">dt.Link_table_id2</span></span>
<span id="cb14-519"><a href="#cb14-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-520"><a href="#cb14-520" aria-hidden="true" tabindex="-1"></a><span class="in">## second round checking</span></span>
<span id="cb14-521"><a href="#cb14-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-522"><a href="#cb14-522" aria-hidden="true" tabindex="-1"></a><span class="in">### the arguement here is that for all `company ID` previously identified from the same gvkey, I now map it back based on the `company ID` and double check whether the new `gvkey_group` is the same as the original ones. </span></span>
<span id="cb14-523"><a href="#cb14-523" aria-hidden="true" tabindex="-1"></a><span class="in">### i.e. I am checking whether the same `comapny ID` maps to multiple `gvkey`(s). </span></span>
<span id="cb14-524"><a href="#cb14-524" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-525"><a href="#cb14-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-526"><a href="#cb14-526" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Notes  --&gt;</span></span>
<span id="cb14-527"><a href="#cb14-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-528"><a href="#cb14-528" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- color: &lt;span style="color: red;"&gt; text &lt;/span&gt; // {style="color: red;"} --&gt;</span></span>
<span id="cb14-529"><a href="#cb14-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-530"><a href="#cb14-530" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Quarto --&gt;</span></span>
<span id="cb14-531"><a href="#cb14-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-532"><a href="#cb14-532" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Quarto enables you to weave together content and executable code into a finished document. To learn more about Quarto see &lt;https://quarto.org&gt;. --&gt;</span></span>
<span id="cb14-533"><a href="#cb14-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-534"><a href="#cb14-534" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Running Code --&gt;</span></span>
<span id="cb14-535"><a href="#cb14-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-536"><a href="#cb14-536" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- When you click the **Render** button a document will be generated that includes both content and the output of embedded code. You can embed code like this: --&gt;</span></span>
<span id="cb14-537"><a href="#cb14-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-538"><a href="#cb14-538" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ```{r} --&gt;</span></span>
<span id="cb14-539"><a href="#cb14-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-540"><a href="#cb14-540" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 1 + 1 --&gt;</span></span>
<span id="cb14-541"><a href="#cb14-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-542"><a href="#cb14-542" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ``` --&gt;</span></span>
<span id="cb14-543"><a href="#cb14-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-544"><a href="#cb14-544" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- You can add options to executable code like this --&gt;</span></span>
<span id="cb14-545"><a href="#cb14-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-546"><a href="#cb14-546" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ```{r} --&gt;</span></span>
<span id="cb14-547"><a href="#cb14-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-548"><a href="#cb14-548" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- #| echo: false --&gt;</span></span>
<span id="cb14-549"><a href="#cb14-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-550"><a href="#cb14-550" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 2 * 2 --&gt;</span></span>
<span id="cb14-551"><a href="#cb14-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-552"><a href="#cb14-552" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ``` --&gt;</span></span>
<span id="cb14-553"><a href="#cb14-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-554"><a href="#cb14-554" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- The `echo: false` option disables the printing of code (only output is displayed). --&gt;</span></span>
<span id="cb14-555"><a href="#cb14-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-556"><a href="#cb14-556" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- -------- --&gt;</span></span>
<span id="cb14-557"><a href="#cb14-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-558"><a href="#cb14-558" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">###</span><span class="co"> s3.6 Leverage Covenants {#sec-s3.6-leverage-covenants} --&gt;</span></span>
<span id="cb14-559"><a href="#cb14-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-560"><a href="#cb14-560" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Look into the changes in covenants related to the leverage restrictions and cash flow related restrictions (e.g. ICR: interest rate coverage ratio). --&gt;</span></span>
<span id="cb14-561"><a href="#cb14-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-562"><a href="#cb14-562" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">###</span><span class="co"> s3.7 Spreads and Fees {#sec-s3.7-spreads-and-fees} --&gt;</span></span>
<span id="cb14-563"><a href="#cb14-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-564"><a href="#cb14-564" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Look into the changes in spread and fees. --&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>