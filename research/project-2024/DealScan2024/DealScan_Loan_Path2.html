<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hongyi Xu">
<meta name="dcterms.date" content="2024-07-03">

<title>DealScan Loan Path</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="DealScan_Loan_Path2_files/libs/clipboard/clipboard.min.js"></script>
<script src="DealScan_Loan_Path2_files/libs/quarto-html/quarto.js"></script>
<script src="DealScan_Loan_Path2_files/libs/quarto-html/popper.min.js"></script>
<script src="DealScan_Loan_Path2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="DealScan_Loan_Path2_files/libs/quarto-html/anchor.min.js"></script>
<link href="DealScan_Loan_Path2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="DealScan_Loan_Path2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="DealScan_Loan_Path2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="DealScan_Loan_Path2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="DealScan_Loan_Path2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-s1.-objective" id="toc-sec-s1.-objective" class="nav-link active" data-scroll-target="#sec-s1.-objective">S1. Objective</a></li>
  <li><a href="#sec-s2.-firms-lift-cycle-identifier" id="toc-sec-s2.-firms-lift-cycle-identifier" class="nav-link" data-scroll-target="#sec-s2.-firms-lift-cycle-identifier">S2. Firm’s Life-cycle Identifier</a></li>
  <li><a href="#s3.-connect-and-build-the-loan-paths" id="toc-s3.-connect-and-build-the-loan-paths" class="nav-link" data-scroll-target="#s3.-connect-and-build-the-loan-paths">S3. Connect and build the loan paths</a></li>
  <li><a href="#s4.-clean-the-loan-renegotiation-data" id="toc-s4.-clean-the-loan-renegotiation-data" class="nav-link" data-scroll-target="#s4.-clean-the-loan-renegotiation-data">S4. Clean the loan renegotiation data</a></li>
  <li><a href="#refine-the-deal-path-identification" id="toc-refine-the-deal-path-identification" class="nav-link" data-scroll-target="#refine-the-deal-path-identification">Refine the deal path identification</a></li>
  <li><a href="#sec-reference" id="toc-sec-reference" class="nav-link" data-scroll-target="#sec-reference">Reference</a></li>
  <li><a href="#to-do-list" id="toc-to-do-list" class="nav-link" data-scroll-target="#to-do-list">To-do list:</a></li>
  <li><a href="#trashbin" id="toc-trashbin" class="nav-link" data-scroll-target="#trashbin">Trashbin:</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">DealScan Loan Path</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Hongyi Xu </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 3, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">July 14, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<p><a href="https://hongyileoxu.github.io/research/">&gt; Back to research</a></p>
<style type="text/css">
body, td {
   font-size: 16px;
}
code.r{
  font-size: 12px;
}
pre {
  font-size: 12px
}
</style>
<section id="sec-s1.-objective" class="level2">
<h2 class="anchored" data-anchor-id="sec-s1.-objective">S1. Objective</h2>
<p>This file follows file “DealScan_Data_Renegotiation.html” and file “DealScan_Loan_Path.qmd”. The aim of this file is to extract the loan path and I also further clean the file <code>Link_table_2024.RData</code> to gather all pair of identifiers for a unique firm over its life-cycle.</p>
<p>Here is a notes on the <a href="https://wrds-www.wharton.upenn.edu/pages/support/support-articles/thomson-reuters/dealscan/wrds-financial-covenants-table/">WRDS Financial Covenants Table</a>. The document there provides names and definitions on each financial covenants terms in the new DealScan data.</p>
<p>Codes and variables in <a href="#s3.-connect-and-build-the-loan-paths">S3. Connect and build the loan paths</a> are updated relative to file “DealScan_Loan_Path.qmd”.</p>
</section>
<section id="sec-s2.-firms-lift-cycle-identifier" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sec-s2.-firms-lift-cycle-identifier">S2. Firm’s Life-cycle Identifier</h2>
<p>In order to identify the loan path (or deal path), I first need to identify the life-cycle of a firm’s identifiers, including <code>gvkey</code>, <code>Borrower_Id</code>, <code>borrowercompanyid</code>, etc. So, I start with the link table created in the first section &gt; <a href="https://hongyileoxu.github.io/research/project-2024/DealScan2024/DealScan_Link_Table_Compustat.html">HTML Manual</a>.</p>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"dt.Link_table_2024.RData"</span>)) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## import dataset </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="st">"Link_table_2024.RData"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## get the new company identifiers from network analysis </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  Link_table.newgroups <span class="ot">&lt;-</span> Link_table <span class="sc">%&gt;%</span> </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_or</span>(<span class="at">id1 =</span> <span class="st">"gvkey"</span>, <span class="at">id2 =</span> <span class="st">"borrowercompanyid"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## join back to the original dataset </span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  dt.Link_table <span class="ot">&lt;-</span> Link_table <span class="sc">%&gt;%</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">facilitystartdate =</span> <span class="fu">as.Date</span>(facilitystartdate),</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">LoanConnector Company ID</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.integer</span>(<span class="st">`</span><span class="at">LoanConnector Company ID</span><span class="st">`</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">%&gt;%</span> </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(Link_table.newgroups, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"gvkey"</span>, <span class="st">"borrowercompanyid"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"facility"</span>), gvkey_group1, <span class="fu">everything</span>(.)) </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="do">## export the updated link table </span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(dt.Link_table, <span class="at">file =</span> <span class="st">"dt.Link_table_2024.RData"</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="st">"dt.Link_table_2024.RData"</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="do">## a preview </span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>dt.Link_table <span class="sc">%&gt;%</span> </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(facilitystartdate) <span class="sc">%&gt;%</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gvkey_group1 <span class="sc">==</span> <span class="dv">22</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="st">"New Link table for Aeroflex Inc. (previously known as ARX Inc.)"</span>, </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>             <span class="at">subtitle =</span> <span class="fu">html</span>(<span class="st">'&lt;span class="red-star"&gt;★&lt;/span&gt;Now the variable `gvkey_group1` is used to identify all loan level observations from the same firm.'</span>)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>             ) <span class="sc">%&gt;%</span> </span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(<span class="at">table.font.size =</span> <span class="dv">10</span>, <span class="at">heading.align =</span> <span class="st">'left'</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>( <span class="co"># update the font size for table cells. </span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">size =</span> <span class="fu">px</span>(<span class="dv">10</span>)),</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_body</span>()</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data_color</span>(</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"gvkey"</span>, <span class="st">"borrowercompanyid"</span>),</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"factor"</span>,</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">"viridis"</span>, </span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">reverse =</span> <span class="cn">TRUE</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_hide</span>(<span class="at">columns =</span> <span class="fu">matches</span>(<span class="st">"score|match"</span>) ) <span class="co"># hide columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display column-screen-inset">
<div id="axggweshqj" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#axggweshqj table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#axggweshqj thead, #axggweshqj tbody, #axggweshqj tfoot, #axggweshqj tr, #axggweshqj td, #axggweshqj th {
  border-style: none;
}

#axggweshqj p {
  margin: 0;
  padding: 0;
}

#axggweshqj .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 10px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#axggweshqj .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#axggweshqj .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#axggweshqj .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#axggweshqj .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#axggweshqj .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#axggweshqj .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#axggweshqj .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#axggweshqj .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#axggweshqj .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#axggweshqj .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#axggweshqj .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#axggweshqj .gt_spanner_row {
  border-bottom-style: hidden;
}

#axggweshqj .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#axggweshqj .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#axggweshqj .gt_from_md > :first-child {
  margin-top: 0;
}

#axggweshqj .gt_from_md > :last-child {
  margin-bottom: 0;
}

#axggweshqj .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#axggweshqj .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#axggweshqj .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#axggweshqj .gt_row_group_first td {
  border-top-width: 2px;
}

#axggweshqj .gt_row_group_first th {
  border-top-width: 2px;
}

#axggweshqj .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#axggweshqj .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#axggweshqj .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#axggweshqj .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#axggweshqj .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#axggweshqj .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#axggweshqj .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#axggweshqj .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#axggweshqj .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#axggweshqj .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#axggweshqj .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#axggweshqj .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#axggweshqj .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#axggweshqj .gt_left {
  text-align: left;
}

#axggweshqj .gt_center {
  text-align: center;
}

#axggweshqj .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#axggweshqj .gt_font_normal {
  font-weight: normal;
}

#axggweshqj .gt_font_bold {
  font-weight: bold;
}

#axggweshqj .gt_font_italic {
  font-style: italic;
}

#axggweshqj .gt_super {
  font-size: 65%;
}

#axggweshqj .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#axggweshqj .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#axggweshqj .gt_indent_1 {
  text-indent: 5px;
}

#axggweshqj .gt_indent_2 {
  text-indent: 10px;
}

#axggweshqj .gt_indent_3 {
  text-indent: 15px;
}

#axggweshqj .gt_indent_4 {
  text-indent: 20px;
}

#axggweshqj .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="11" class="gt_heading gt_title gt_font_normal">New Link table for Aeroflex Inc. (previously known as ARX Inc.)</th>
</tr>
<tr class="odd gt_heading">
<th colspan="11" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border"><span class="red-star">★</span>Now the variable `gvkey_group1` is used to identify all loan level observations from the same firm.</th>
</tr>
<tr class="header gt_col_headings">
<th id="facilityid" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">facilityid</th>
<th id="facilitystartdate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">facilitystartdate</th>
<th id="gvkey_group1" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">gvkey_group1</th>
<th id="gvkey" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">gvkey</th>
<th id="borrowercompanyid" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">borrowercompanyid</th>
<th id="ds_company" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">ds_company</th>
<th id="cs_company" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">cs_company</th>
<th id="ds_ticker" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">ds_ticker</th>
<th id="cs_ticker" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">cs_ticker</th>
<th id="Company Name" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Company Name</th>
<th id="LoanConnector Company ID" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">LoanConnector Company ID</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">5171</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">1989-04-24</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #000000; background-color: #FDE725">2463</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">ARX Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">ARX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">ARX Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">31224</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">10226</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">1991-10-10</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #000000; background-color: #FDE725">2463</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">ARX Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">ARX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">ARX Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">31224</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">10227</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">1991-10-10</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #000000; background-color: #FDE725">2463</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">ARX Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">ARX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">ARX Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">31224</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">27968</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">1994-04-11</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #000000; background-color: #FDE725">2463</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">ARX Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">ARX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">ARX Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">31224</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">27969</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">1994-04-11</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #000000; background-color: #FDE725">2463</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">ARX Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">ARX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">ARX Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">31224</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">62943</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">1996-03-15</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">62944</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">1996-03-15</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">67177</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">1999-02-25</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">67178</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">1999-02-25</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">67179</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">1999-02-25</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">145204</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2003-02-14</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARXX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">145320</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2003-02-14</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARXX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">194507</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2006-03-21</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARXX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">214917</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2007-04-13</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARXX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">214918</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2007-04-13</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARXX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">214919</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2007-04-13</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARXX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">219384</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2007-08-15</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARXX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">221951</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2007-08-15</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARXX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">223289</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2007-08-15</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARXX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">269533</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2011-05-09</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARXX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">269534</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2011-05-09</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #000000; background-color: #FDE725">1056</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX INC</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARXX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">303619</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2013-05-28</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #FFFFFF; background-color: #440154">184639</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX HOLDING CORP</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="facilityid" style="font-size: 10px">304052</td>
<td class="gt_row gt_right" headers="facilitystartdate" style="font-size: 10px">2013-05-28</td>
<td class="gt_row gt_right" headers="gvkey_group1" style="font-size: 10px">22</td>
<td class="gt_row gt_right" headers="gvkey" style="font-size: 10px; color: #FFFFFF; background-color: #440154">184639</td>
<td class="gt_row gt_right" headers="borrowercompanyid" style="font-size: 10px; color: #FFFFFF; background-color: #440154">30274</td>
<td class="gt_row gt_left" headers="ds_company" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_left" headers="cs_company" style="font-size: 10px">AEROFLEX HOLDING CORP</td>
<td class="gt_row gt_left" headers="ds_ticker" style="font-size: 10px">NA</td>
<td class="gt_row gt_left" headers="cs_ticker" style="font-size: 10px">ARX</td>
<td class="gt_row gt_left" headers="Company Name" style="font-size: 10px">Aeroflex Inc</td>
<td class="gt_row gt_right" headers="LoanConnector Company ID" style="font-size: 10px">8532</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<ul>
<li>An example from <a href="https://stackoverflow.com/questions/68947862/grouping-similar-elements-together">the web</a> to use network analysis for more granular grouping assignments.</li>
</ul>

<div class="no-row-height column-margin column-container"><div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the necessary libraries</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Manually generating data</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>Names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">'James,Gordon'</span>,<span class="dv">6</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>          ,<span class="fu">rep</span>(<span class="st">'Amanda'</span>,<span class="dv">3</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>          ,<span class="fu">rep</span>(<span class="st">'Gordon,Amanda'</span>,<span class="dv">8</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>          ,<span class="fu">rep</span>(<span class="st">'Edward,Gordon,Amanda'</span>,<span class="dv">3</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>          ,<span class="fu">rep</span>(<span class="st">'Anna'</span>,<span class="dv">3</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>          ,<span class="fu">rep</span>(<span class="st">'Anna,Leonard'</span>,<span class="dv">3</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>Initial_Group <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>,<span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">3</span>,<span class="dv">8</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>))</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>Final_Group <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">'A'</span>,<span class="st">'B'</span>),<span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">6</span>))</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Names,Initial_Group,Final_Group)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Names)<span class="sc">%&gt;%</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Names, <span class="fu">c</span>(<span class="st">'first'</span>, <span class="st">'second'</span>), <span class="at">extra =</span> <span class="st">'merge'</span>, <span class="at">fill =</span> <span class="st">'right'</span>)<span class="sc">%&gt;%</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(second) <span class="sc">%&gt;%</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">second =</span> <span class="fu">coalesce</span>(second, <span class="fu">as.character</span>(<span class="fu">cumsum</span>(<span class="fu">is.na</span>(second))))) <span class="sc">%&gt;%</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">graph_from_data_frame</span>()<span class="sc">%&gt;%</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getElement</span>(<span class="st">'membership'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">imap</span>(<span class="sc">~</span><span class="fu">str_detect</span>(data<span class="sc">$</span>Names, .y)<span class="sc">*</span>.x) <span class="sc">%&gt;%</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invoke</span>(pmax, .) <span class="sc">%&gt;%</span> <span class="co"># `invoke` is applied to apply function to the same location in each element under a list </span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(data, <span class="at">value =</span> LETTERS[.], <span class="at">value1 =</span> .) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div></div><p>In the above example for Aeroflex Inc.&nbsp;(previously known as ARX Inc.), one company may match multiple combinations of two identifiers - <code>gvkey</code> and <code>borrowercompanyid</code>/<code>LoanConnector Company ID</code> - and I recreate a new identifier <code>gvkey_group1</code> to uniquely identify one firm’s life-cycle in the dataset. <code>borrowercompanyid</code> is the borrower identifier in the Legacy DealScan dataset and <code>LoanConnector Company ID</code> is for the new LPC DealScan.</p>
<!--- .column-margin --->
<div id="tip-loan-path" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip&nbsp;1: A finer link table
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In the current version of the link table, <code>dt.Link_table</code>, facility/tranche level information is also included. A cleaner version of the link table will only include borrower level observations.</p>
</div>
</div>
</div>
<p>One additional thing to notice is that although no missing values observed in variable <code>borrowercompanyid</code> (and also <code>gvkey</code>), <code>LoanConnector Company ID</code> contains missing value, around 66 observations.</p>
</section>
<section id="s3.-connect-and-build-the-loan-paths" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="s3.-connect-and-build-the-loan-paths">S3. Connect and build the loan paths</h2>
<p>Here are the steps to achieve this:</p>
<ol type="1">
<li><p>load the dataset for the new link table - <code>dt.Link_table</code> and for all Deal-Tranches with borrower information - <code>DealScan_borrower</code>. The dataset <code>dt.name_match</code> is used to guide the selection of variables for specific analyses. <a href="https://hongyileoxu.github.io/research/project-2024/DealScan2024/DealScan_Data_Renegotiation.html#sec-s3.4-classify-variable-names">&gt; refer to section s3.4 in this document.</a></p></li>
<li><p>Cross validate the changes in the loan amount using the item <mark>“Cash flows from financing activities”</mark> from the <mark>“CONSOLIDATED STATEMENTS OF CASH FLOWS”</mark>.</p>
<blockquote class="blockquote">
<p>One example from JACO ELECTRONICS INC (<code>gvkey_group1 == 1894</code>) and its <a href="https://www.sec.gov/Archives/edgar/data/52971/0000950123-95-002603.txt">SEC filing</a>. Search <code>Term Loan</code> in the filing and you will much more renegotiations than ones recorded in the DealScan.</p>
</blockquote>
</li>
<li></li>
</ol>
<div class="no-row-height column-margin column-container"><div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Also in 10-K/Q !!!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Alternatively, go to the 10-K/Q and find the information about all debts in the <code>Note</code> section. Normally this information is in the Exhibit. <br> <br> E.g. <a href="https://www.sec.gov/Archives/edgar/data/1045810/000104581024000029/nvda-20240128.htm#i13eac97307cc485c971e826acbda8be7_184">Form 10-K from Nvidia</a> listed its detailed debt profile in its <a href="https://www.sec.gov/Archives/edgar/data/1045810/000104581024000029/nvda-20240128.htm#i13eac97307cc485c971e826acbda8be7_91">Note 12 - Debt</a>.</p>
</div>
</div>
</div></div><p><b>Let’s start!</b></p>
<p>Condense all remarks - <code>Purpose_Remark</code>,<code>Deal_Remark</code>,<code>Tranche_Remark</code>,<code>Performance_Pricing_Remark</code> - into varible <code>All_Remark</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## load the necessary tables</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"dt.Link_table"</span>)) {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## check whether the variable `dt.Link_table` is there. &gt; if yes, then .... </span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="at">file =</span> <span class="st">"dt.Link_table_2024.RData"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # file &lt;- "DealScan_borrower.Rdata"</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # from &lt;- "~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Data_Renegotiations_Jun2024"</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># # to &lt;- "~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Loan_Path_Jun2024"</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>{ <span class="co"># Procedure to check and copy necessary files: </span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">copy_file</span>(<span class="at">from =</span> <span class="st">"~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Data_Renegotiations_Jun2024"</span>, <span class="at">to =</span> <span class="st">"~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Loan_Path_Jun2024"</span>, <span class="at">file =</span> <span class="st">"DealScan_borrower.Rdata"</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">copy_file</span>(<span class="at">from =</span> <span class="st">"~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Data_Renegotiations_Jun2024"</span>, <span class="at">to =</span> <span class="st">"~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Loan_Path_Jun2024"</span>, <span class="at">file =</span> <span class="st">"DealScan_name_match.RData"</span>) </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## load the dealscan data for only borrowers information &gt; DealScan_borrower </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">"~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Data_Renegotiations_Jun2024/DealScan_borrower.RData"</span>) </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="do">### load the dealscan variable names &gt; dt.name_match </span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="st">"~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Data_Renegotiations_Jun2024/DealScan_name_match.RData"</span>) </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>name_covenants_17 <span class="ot">&lt;-</span> dt.name_match <span class="sc">%&gt;%</span> <span class="co"># financial covenants </span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="at">pattern =</span> <span class="st">"^17:"</span>, <span class="at">x =</span> group_header)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span>orig_name</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>name_covenants_19 <span class="ot">&lt;-</span> dt.name_match <span class="sc">%&gt;%</span> <span class="co"># general covenants </span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="at">pattern =</span> <span class="st">"^19:"</span>, <span class="at">x =</span> group_header)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span>orig_name</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>name_renegotiation <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="co"># names for the </span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grep</span>(<span class="at">pattern =</span> <span class="st">"LPC|_O_A"</span>, <span class="at">x =</span> <span class="fu">names</span>(DealScan_borrower), <span class="at">value =</span> T), </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grep</span>(<span class="at">pattern =</span> <span class="st">"Amended"</span>, <span class="at">x =</span> <span class="fu">names</span>(DealScan_borrower), <span class="at">value =</span> T), </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grep</span>(<span class="at">pattern =</span> <span class="st">"Refinan"</span>, <span class="at">x =</span> <span class="fu">names</span>(DealScan_borrower), <span class="at">value =</span> T)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="do">## link the two data sets </span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>dt.DealScan_borrower <span class="ot">&lt;-</span> DealScan_borrower <span class="sc">%&gt;%</span> </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Borrower_Id, Borrower_Name, </span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>         <span class="fu">all_of</span>(name_renegotiation), <span class="co"># all flags for different kind of renegotiations. </span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>         <span class="fu">grep</span>(<span class="at">x =</span> <span class="fu">names</span>(.), <span class="at">pattern =</span> <span class="st">"Matur"</span>, <span class="at">ignore.case =</span> T, <span class="at">value =</span> T), </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Deal_Amount"</span>, <span class="st">"Tranche_Amount"</span>, </span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Deal_Active_Date"</span>, <span class="st">"Deal_Input_Date"</span>, <span class="st">"Tranche_Active_Date"</span>, </span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Tranche_Type"</span>, <span class="st">"Deal_Purpose"</span>, </span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>         <span class="fu">grep</span>(<span class="at">pattern =</span> <span class="st">"Remark"</span>, <span class="at">x =</span> <span class="fu">names</span>(.), <span class="at">value =</span> T)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"Date"</span>), as.Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"All_Remark"</span>, <span class="fu">contains</span>(<span class="st">"Remark"</span>), <span class="at">sep =</span> <span class="st">"&lt;br&gt;"</span>, <span class="at">na.rm =</span> T, <span class="at">remove =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">All_Remark_am =</span> <span class="fu">str_replace_all</span>(<span class="at">string =</span> All_Remark, <span class="at">pattern =</span> <span class="st">"(?i)</span><span class="sc">\\</span><span class="st">bAmend(ment)? Fee</span><span class="sc">\\</span><span class="st">b"</span>, <span class="at">replacement =</span> <span class="st">""</span>), </span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">Event_amend =</span> <span class="fu">grepl</span>(<span class="at">x =</span> All_Remark_am, <span class="at">pattern =</span> <span class="st">"amend"</span>, <span class="at">ignore.case =</span> T), <span class="co"># whether the term 'amend' is detected </span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">Event_restate =</span> <span class="fu">grepl</span>(<span class="at">x =</span> All_Remark, <span class="at">pattern =</span> <span class="st">"restate"</span>, <span class="at">ignore.case =</span> T), <span class="co"># whether the term 'restate' is detected </span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">Event_refin =</span> <span class="fu">grepl</span>(<span class="at">x =</span> All_Remark, <span class="at">pattern =</span> <span class="st">"refin"</span>, <span class="at">ignore.case =</span> T) <span class="co"># whether the term 'refinancing' is detected </span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Event_renegotiation =</span> (Event_amend <span class="sc">|</span> Event_amend <span class="sc">|</span> Event_refin) ) <span class="co"># whether there exists an events identified by contents in `Deal_Remark` </span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a><span class="do">### The last several lines collect information about whether an amend or restate or refinance event happen. </span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="do">### The `Event_renegotiation` variable detect whether a renegotiation event happens. </span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a><span class="do">### Also, I check whether a loan is a refinancing of a previous loan. </span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a><span class="co"># names(dt.DealScan_borrower) </span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a><span class="co"># names(dt.Link_table)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here a summary for the variables <code>Event_amend</code>, <code>Event_restate</code>,<code>Event_refin</code> and <code>Event_renegotiation</code> under each group classified by amendment/refinancing flags in DealScan.</p>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to identify different types of contracts which are defined as "Origination". </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>dt.DealScan_borrower <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="at">pattern =</span> <span class="st">"Orig"</span>, <span class="at">x =</span> Tranche_O_A)) <span class="sc">%&gt;%</span> <span class="co"># only keep tranches classified as "Origination"</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Deal_Amended, Tranche_Amended, Deal_Refinancing, Tranche_Refinancing) <span class="sc">%&gt;%</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_Event_amend =</span> <span class="fu">sum</span>(Event_amend), </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_Event_restate =</span> <span class="fu">sum</span>(Event_restate), </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_Event_refin =</span> <span class="fu">sum</span>(Event_refin), </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_Event =</span> <span class="fu">sum</span>(Event_renegotiation)  </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> <span class="co"># count the number of each types </span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage_n =</span> (n <span class="sc">/</span> <span class="fu">sum</span>(n))) <span class="sc">%&gt;%</span> </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="st">"Table 2a: WRDS DealScan Deal-Tranche Level Loan Events"</span>, </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">subtitle =</span> <span class="st">"Subgroup: `Tranche_O_A` = Origination"</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>             ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(<span class="at">table.font.size =</span> <span class="dv">11</span>, <span class="at">heading.align =</span> <span class="st">'left'</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>( <span class="co"># update the font size for table cells. </span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">size =</span> <span class="fu">px</span>(<span class="dv">11</span>)),</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_body</span>()</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_percent</span>(<span class="at">columns =</span> percentage_n, <span class="at">decimals =</span> <span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display column-screen-inset">
<div id="xkvtkmaidg" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#xkvtkmaidg table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#xkvtkmaidg thead, #xkvtkmaidg tbody, #xkvtkmaidg tfoot, #xkvtkmaidg tr, #xkvtkmaidg td, #xkvtkmaidg th {
  border-style: none;
}

#xkvtkmaidg p {
  margin: 0;
  padding: 0;
}

#xkvtkmaidg .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 11px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xkvtkmaidg .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#xkvtkmaidg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xkvtkmaidg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xkvtkmaidg .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xkvtkmaidg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xkvtkmaidg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xkvtkmaidg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xkvtkmaidg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xkvtkmaidg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xkvtkmaidg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xkvtkmaidg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xkvtkmaidg .gt_spanner_row {
  border-bottom-style: hidden;
}

#xkvtkmaidg .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#xkvtkmaidg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xkvtkmaidg .gt_from_md > :first-child {
  margin-top: 0;
}

#xkvtkmaidg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xkvtkmaidg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xkvtkmaidg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#xkvtkmaidg .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#xkvtkmaidg .gt_row_group_first td {
  border-top-width: 2px;
}

#xkvtkmaidg .gt_row_group_first th {
  border-top-width: 2px;
}

#xkvtkmaidg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xkvtkmaidg .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#xkvtkmaidg .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#xkvtkmaidg .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xkvtkmaidg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xkvtkmaidg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xkvtkmaidg .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#xkvtkmaidg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xkvtkmaidg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xkvtkmaidg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xkvtkmaidg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xkvtkmaidg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xkvtkmaidg .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xkvtkmaidg .gt_left {
  text-align: left;
}

#xkvtkmaidg .gt_center {
  text-align: center;
}

#xkvtkmaidg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xkvtkmaidg .gt_font_normal {
  font-weight: normal;
}

#xkvtkmaidg .gt_font_bold {
  font-weight: bold;
}

#xkvtkmaidg .gt_font_italic {
  font-style: italic;
}

#xkvtkmaidg .gt_super {
  font-size: 65%;
}

#xkvtkmaidg .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#xkvtkmaidg .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#xkvtkmaidg .gt_indent_1 {
  text-indent: 5px;
}

#xkvtkmaidg .gt_indent_2 {
  text-indent: 10px;
}

#xkvtkmaidg .gt_indent_3 {
  text-indent: 15px;
}

#xkvtkmaidg .gt_indent_4 {
  text-indent: 20px;
}

#xkvtkmaidg .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="10" class="gt_heading gt_title gt_font_normal">Table 2a: WRDS DealScan Deal-Tranche Level Loan Events</th>
</tr>
<tr class="odd gt_heading">
<th colspan="10" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Subgroup: `Tranche_O_A` = Origination</th>
</tr>
<tr class="header gt_col_headings">
<th id="Deal_Amended" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Deal_Amended</th>
<th id="Tranche_Amended" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Tranche_Amended</th>
<th id="Deal_Refinancing" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Deal_Refinancing</th>
<th id="Tranche_Refinancing" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Tranche_Refinancing</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n</th>
<th id="n_Event_amend" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_Event_amend</th>
<th id="n_Event_restate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_Event_restate</th>
<th id="n_Event_refin" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_Event_refin</th>
<th id="n_Event" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_Event</th>
<th id="percentage_n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">percentage_n</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px"></td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">240423</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">5615</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">2583</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">8154</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">13475</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">62.95%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">2573</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">34</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">7</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">66</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">97</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.67%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">2079</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">26</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">4</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">893</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">914</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.54%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px"></td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">68556</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">8492</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">6052</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">28273</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">35966</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">17.95%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">72</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">4</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">2</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">39</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">42</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.02%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">27318</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">718</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">261</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">16948</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">17401</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">7.15%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px"></td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">568</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">8</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">20</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">28</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.15%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">11</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.00%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">3</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.00%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px"></td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">450</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">63</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">33</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">245</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">287</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.12%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">82</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">8</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">6</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">46</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">54</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.02%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px"></td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">19375</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">686</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">318</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">688</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">1295</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">5.07%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">544</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">7</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">3</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">16</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">23</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.14%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">233</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">11</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">2</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">66</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">77</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.06%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px"></td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">15319</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">2564</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">1928</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">8072</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">10275</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">4.01%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">28</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">3</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">2</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">8</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">11</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.01%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">4304</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">388</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">245</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">2451</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">2739</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">1.13%</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to identify different types of contracts which are defined as "Amendment 1". </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>dt.DealScan_borrower <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="at">pattern =</span> <span class="st">"Amendment"</span>, <span class="at">x =</span> Tranche_O_A)) <span class="sc">%&gt;%</span> <span class="co"># only keep tranches classified as "Origination"</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Deal_Amended, Tranche_Amended, Deal_Refinancing, Tranche_Refinancing) <span class="sc">%&gt;%</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_Event_amend =</span> <span class="fu">sum</span>(Event_amend), </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_Event_restate =</span> <span class="fu">sum</span>(Event_restate), </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_Event_refin =</span> <span class="fu">sum</span>(Event_refin), </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_Event =</span> <span class="fu">sum</span>(Event_renegotiation)  </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> <span class="co"># count the number of each types </span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage_n =</span> (n <span class="sc">/</span> <span class="fu">sum</span>(n))) <span class="sc">%&gt;%</span> </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="st">"Table 2b: WRDS DealScan Deal-Tranche Level Loan Events"</span>, </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">subtitle =</span> <span class="st">"Subgroup: `Tranche_O_A` = Amendment(s)"</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>             ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(<span class="at">table.font.size =</span> <span class="dv">11</span>, <span class="at">heading.align =</span> <span class="st">'left'</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>( <span class="co"># update the font size for table cells. </span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">size =</span> <span class="fu">px</span>(<span class="dv">11</span>)),</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_body</span>()</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_percent</span>(<span class="at">columns =</span> percentage_n, <span class="at">decimals =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display column-screen-inset">
<div id="stwkilayek" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#stwkilayek table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#stwkilayek thead, #stwkilayek tbody, #stwkilayek tfoot, #stwkilayek tr, #stwkilayek td, #stwkilayek th {
  border-style: none;
}

#stwkilayek p {
  margin: 0;
  padding: 0;
}

#stwkilayek .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 11px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#stwkilayek .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#stwkilayek .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#stwkilayek .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#stwkilayek .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#stwkilayek .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#stwkilayek .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#stwkilayek .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#stwkilayek .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#stwkilayek .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#stwkilayek .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#stwkilayek .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#stwkilayek .gt_spanner_row {
  border-bottom-style: hidden;
}

#stwkilayek .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#stwkilayek .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#stwkilayek .gt_from_md > :first-child {
  margin-top: 0;
}

#stwkilayek .gt_from_md > :last-child {
  margin-bottom: 0;
}

#stwkilayek .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#stwkilayek .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#stwkilayek .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#stwkilayek .gt_row_group_first td {
  border-top-width: 2px;
}

#stwkilayek .gt_row_group_first th {
  border-top-width: 2px;
}

#stwkilayek .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#stwkilayek .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#stwkilayek .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#stwkilayek .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#stwkilayek .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#stwkilayek .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#stwkilayek .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#stwkilayek .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#stwkilayek .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#stwkilayek .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#stwkilayek .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#stwkilayek .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#stwkilayek .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#stwkilayek .gt_left {
  text-align: left;
}

#stwkilayek .gt_center {
  text-align: center;
}

#stwkilayek .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#stwkilayek .gt_font_normal {
  font-weight: normal;
}

#stwkilayek .gt_font_bold {
  font-weight: bold;
}

#stwkilayek .gt_font_italic {
  font-style: italic;
}

#stwkilayek .gt_super {
  font-size: 65%;
}

#stwkilayek .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#stwkilayek .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#stwkilayek .gt_indent_1 {
  text-indent: 5px;
}

#stwkilayek .gt_indent_2 {
  text-indent: 10px;
}

#stwkilayek .gt_indent_3 {
  text-indent: 15px;
}

#stwkilayek .gt_indent_4 {
  text-indent: 20px;
}

#stwkilayek .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="10" class="gt_heading gt_title gt_font_normal">Table 2b: WRDS DealScan Deal-Tranche Level Loan Events</th>
</tr>
<tr class="odd gt_heading">
<th colspan="10" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Subgroup: `Tranche_O_A` = Amendment(s)</th>
</tr>
<tr class="header gt_col_headings">
<th id="Deal_Amended" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Deal_Amended</th>
<th id="Tranche_Amended" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Tranche_Amended</th>
<th id="Deal_Refinancing" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Deal_Refinancing</th>
<th id="Tranche_Refinancing" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Tranche_Refinancing</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n</th>
<th id="n_Event_amend" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_Event_amend</th>
<th id="n_Event_restate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_Event_restate</th>
<th id="n_Event_refin" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_Event_refin</th>
<th id="n_Event" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n_Event</th>
<th id="percentage_n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">percentage_n</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px"></td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px"></td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">4173</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">841</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">1</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">13</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">847</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">3.47%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px"></td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">24</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">12</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">1</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">12</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.02%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px"></td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">47</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">39</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">3</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">39</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.04%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px"></td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px"></td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">2507</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">845</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">38</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">268</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">915</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">2.09%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px"></td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">3</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">3</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">0</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">1</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">3</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.00%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px"></td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">826</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">580</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">12</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">174</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">620</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.69%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px"></td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">34180</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">3670</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">154</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">346</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">3957</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">28.44%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">911</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">260</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">2</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">9</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">266</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.76%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">2247</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">800</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">20</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">49</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">818</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">1.87%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px"></td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">52319</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">8250</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">1527</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">8961</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">15792</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">43.53%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">No</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">652</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">220</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">20</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">99</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">276</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">0.54%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Deal_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Amended" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Deal_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_left" headers="Tranche_Refinancing" style="font-size: 11px">Yes</td>
<td class="gt_row gt_right" headers="n" style="font-size: 11px">22294</td>
<td class="gt_row gt_right" headers="n_Event_amend" style="font-size: 11px">8757</td>
<td class="gt_row gt_right" headers="n_Event_restate" style="font-size: 11px">1058</td>
<td class="gt_row gt_right" headers="n_Event_refin" style="font-size: 11px">2763</td>
<td class="gt_row gt_right" headers="n_Event" style="font-size: 11px">10215</td>
<td class="gt_row gt_right" headers="percentage_n" style="font-size: 11px">18.55%</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now we merge the DealScan deal-tranche information with the link table and try to extract the loan path. To facilitate data analysis, I create a new variable <b><code>obs_id</code></b>, which is the id for each observation in the dataset, and will be used as the sole identifier in subsequent data mergers.</p>
<p>Also, I create a new firm-deal level identifier <code>firm_deal_id</code> to facilitate the data cleaning process. Note that this is more of a <u>“firm-deal-time id”</u>.</p>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># merge the deal/tranche information with the link table. </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="do">### direct merge creates the issue of multiple-to-multiple matching. &gt; solve this issue by matching at the deal, not tranche, level. </span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>dt.DealScan_borrower_Linked <span class="ot">&lt;-</span> dt.DealScan_borrower <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">distinct</span>(<span class="fu">select</span>(dt.Link_table, <span class="sc">-</span><span class="fu">c</span>(<span class="st">"facilityid"</span>, <span class="fu">contains</span>(<span class="st">"ticker"</span>)))), <span class="co"># collect deal-level </span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">join_by</span>(Borrower_Id <span class="sc">==</span> <span class="st">`</span><span class="at">LoanConnector Company ID</span><span class="st">`</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                         Tranche_Active_Date <span class="sc">==</span> facilitystartdate) )</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># dt.DealScan_borrower_Linked %&gt;% filter(Borrower_Id == 17400)</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># dt.DealScan_borrower_Linked %&gt;% filter(gvkey_group1 == 9721) </span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># names(dt.DealScan_borrower_Linked) </span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># firm-deal-tranche-time level data </span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"I use the self-created `gvkey_group1` variable as the unique company identifer. Observations are at the firm-deal-tranche-time level."</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>I use the self-created <code>gvkey_group1</code> variable as the unique company identifer. Observations are at the firm-deal-tranche-time level.</p>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dt.DealScan_borrower_unifirm &lt;- </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>dt.DealScan_uniborrower <span class="ot">&lt;-</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  dt.DealScan_borrower_Linked <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gvkey_group1) <span class="sc">%&gt;%</span> <span class="co"># for each unique firm over the life-cycle </span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Tranche_Active_Date) <span class="sc">%&gt;%</span>  <span class="co"># %&gt;% # arrange by its tranche active date </span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">"obs_id"</span>) <span class="sc">%&gt;%</span> <span class="co"># a new id for each observation in the data </span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># a. use LPC flags to identify renegotiations *** </span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create the amendment flag based on `Tranche_O_A` and `Deal_Amended` or `Deal_Refinancing` information: </span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">flag_renegotiation =</span> <span class="fu">ifelse</span>(</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>      <span class="co"># the selection criterion: Deal_Refinancing == "Yes" might need further examinations.</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="at">pattern =</span> <span class="st">"Amendment"</span>, <span class="at">x =</span> Tranche_O_A, <span class="at">fixed =</span> T) <span class="sc">|</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        (<span class="sc">!</span><span class="fu">grepl</span>(<span class="at">pattern =</span> <span class="st">"Amendment"</span>, <span class="at">x =</span> Tranche_O_A, <span class="at">fixed =</span> T) <span class="sc">&amp;</span> </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>           (Deal_Amended <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">|</span> Deal_Refinancing <span class="sc">==</span> <span class="st">"Yes"</span>) ), </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">yes =</span> <span class="cn">TRUE</span>, <span class="at">no =</span> <span class="cn">FALSE</span> </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># b. separate the origination/amendment from `Tranche_O_A`</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">Orig_Yes =</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="at">pattern =</span> <span class="st">"Orig"</span>, <span class="at">x =</span> Tranche_O_A), </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"`Tranche_O_A` = Origination"</span>, </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"`Tranche_O_A` = Amendment"</span>)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the distribution of firms with the number of observations in the sample </span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>dt.DealScan_uniborrower <span class="sc">%&gt;%</span> <span class="co"># group firms by the `gvkey_group1` variable </span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="co"># number of observations for each firm</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(., ) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="fu">aes</span>(n)) <span class="sc">+</span>  <span class="co"># + scale_y_continuous(transform = "log10")</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Loan Observations for Firms"</span>, </span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"restricted to max 100 observations"</span>) <span class="sc">+</span> </span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><img src="DealScan_Loan_Path2_files/figure-html/loan_path2-1.png" class="img-fluid" width="672"></p>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================== (July 3, 2024) </span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Look into the file &gt; "dealscan_loan_path_test.R" </span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># analyse at the firm-deal-time level (not tranche level) &gt; always for the same firm</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>dt.DealScan_uniborrower_deal <span class="ot">&lt;-</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  dt.DealScan_uniborrower <span class="sc">%&gt;%</span> <span class="co"># grouped by `gvkey_group1` -&gt; </span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># as if the deal is just amended/refinaced, `LPC_Deal_ID` won't be updated. -&gt; </span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># in other words, all loans from the same firm/borrower a, recorded under the same deal i, at date `Tranche_Active_Date` </span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># will be considered under the same unique `package`. </span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Tranche_Active_Date, LPC_Deal_ID, <span class="at">.add =</span> T) <span class="sc">%&gt;%</span> <span class="co"># group at the firm-deal-time level </span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. Aggregated Tranche Level Info: </span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Tranche_Info =</span> <span class="fu">list</span>(</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">distinct</span>(</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">data.frame</span>(</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>          <span class="co"># a. store `LPC_Tranche_ID` information </span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">Deal_Tranche_IDs =</span> LPC_Tranche_ID, </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>          <span class="co"># b. store `Tranche_Type` information </span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">Tranche_Types =</span> Tranche_Type, </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>          <span class="co"># c. store `All_Remark` information </span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">All_Remarks =</span> All_Remark </span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        ) </span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>      ) <span class="do">## only keeps the unique loan information to remove potential repetition from previous "join" actions. </span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    ), <span class="do">## filter out information &gt; rowwise(): This function is used to perform operations row by row. </span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. Collect renegotiation flags: </span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">flag_renegotiation =</span> <span class="fu">any</span>(flag_renegotiation), <span class="do">## check whether contain TRUE! </span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">Event_renegotiation =</span> <span class="fu">any</span>(Event_renegotiation), </span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">Event_all =</span> <span class="fu">list</span>(</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data.frame</span>(</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">Event_amend =</span> <span class="fu">any</span>(Event_amend), </span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">Event_restate =</span> <span class="fu">any</span>(Event_restate), </span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">Event_refin =</span> <span class="fu">any</span>(Event_refin) </span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>      ) <span class="do">## record the detail of all `Events` extracted from `All_Remark`!!!  </span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">Orig_Yes =</span> <span class="fu">unique</span>(Orig_Yes)</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sort by the tranche observation time within each firm </span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(gvkey_group1, Tranche_Active_Date) <span class="sc">%&gt;%</span> </span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this dataset creates a unique profile/package for firm-deal-time observation. </span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="at">var =</span> <span class="st">"deal_time_id"</span>) <span class="sc">%&gt;%</span> <span class="co"># create a new id for each observation in the data - at the `firm-deal-tim level` </span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="co"># now for each deal-time observation, </span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="co"># dt.DealScan_uniborrower_deal %&gt;% head(50) %&gt;% tail(10) %&gt;% unnest_wider(col = Tranche_Info)</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="co"># dt.check &lt;- dt.DealScan_uniborrower_deal %&gt;% </span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(<span class="at">col =</span> Tranche_Info) <span class="sc">%&gt;%</span> <span class="co"># split the three columns in the `Tranche_Info`. </span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> <span class="do">## perform function on each row </span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># linked information from the `All_Remark`: </span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">linkedinfo_Remark =</span> <span class="fu">list</span>((</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_sentence_extract</span>(<span class="at">str =</span> (All_Remarks), </span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>                           <span class="at">pattern_sentence =</span> <span class="st">"(?&lt;=(</span><span class="sc">\\</span><span class="st">.|</span><span class="sc">\\</span><span class="st">?|!))</span><span class="sc">\\</span><span class="st">s{1,}(?=[A-Z])|&lt;br&gt;"</span>, </span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>                           <span class="at">pattern_text =</span> <span class="st">"amend|restat|refinan"</span> ) </span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<pre><code>`summarise()` has grouped output by 'gvkey_group1', 'Tranche_Active_Date'. You
can override using the `.groups` argument.</code></pre>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================== (July 3, 2024) </span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Firm a, Deal i, Tranche j, at Time t. </span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>dt.DealScan_uniborrower_aijt <span class="ot">&lt;-</span> dt.DealScan_uniborrower_deal <span class="sc">%&gt;%</span> <span class="co"># firm a, deal i, tranche j, at time t.  </span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract all unique date information </span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">linked_record_time =</span> <span class="fu">str_date_extract</span>(<span class="at">str =</span> linkedinfo_Remark,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">date_format =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">d+/</span><span class="sc">\\</span><span class="st">d+/</span><span class="sc">\\</span><span class="st">d+"</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># break into different rows </span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(linked_record_time, <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">related_time =</span> <span class="fu">as.Date</span>(<span class="at">x =</span> linked_record_time, <span class="at">format =</span> <span class="st">"%m/%d/%y"</span>), </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">time_low =</span> related_time <span class="sc">-</span> <span class="dv">15</span>, </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">time_high =</span> related_time <span class="sc">+</span> <span class="dv">15</span> <span class="co"># the upper and lower limit for the deal time to match</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(related_time) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(gvkey_group1)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter out those linked to its own (e.g. gvkey_group1 == 2933 -&gt; deal_time_id = 24170)</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Tranche_Active_Date <span class="sc">!=</span> related_time) <span class="sc">%&gt;%</span> </span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">Linked_deal_time_id =</span> deal_time_id, <span class="co"># linked to a specific deal-time id </span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>         gvkey_group1, <span class="co"># join identifier </span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">Linked_Tranche_Active_Date =</span> Tranche_Active_Date, </span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">Linked_LPC_Deal_ID =</span> LPC_Deal_ID, </span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>         related_time, time_low, time_high) <span class="co"># join identifier </span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="co"># link Deal i, Tranche j, at Time t (_ijt) to the deal before and after: </span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="do">## the join criterion: for the same firm, if its active date is within 15 days. </span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>by_deal_time <span class="ot">&lt;-</span> <span class="fu">join_by</span>(gvkey_group1,</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">between</span>(Tranche_Active_Date, time_low, time_high))</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="do">## make the manual matching: </span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>dt.manual_renegotiation <span class="ot">&lt;-</span> dt.DealScan_uniborrower_deal <span class="sc">%&gt;%</span> </span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove firms without `gvkey` </span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(gvkey_group1)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(dt.DealScan_uniborrower_aijt, <span class="at">by =</span> by_deal_time) <span class="sc">%&gt;%</span> </span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="co"># create a new identifier to manually track loan path from `Deal_Remark`: </span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="do">## record the original, unique firm-deal id if the `Linked_Tranche_Active_Date` comes after the `Linked_Tranche_Active_Date`. </span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="do">## and record the linked firm-deal id if otherwise. </span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_before =</span> <span class="fu">ifelse</span>(Tranche_Active_Date <span class="sc">&lt;</span> Linked_Tranche_Active_Date,</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>                       <span class="at">yes =</span> deal_time_id, <span class="at">no =</span> Linked_deal_time_id), <span class="co"># the previous id </span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_after =</span> <span class="fu">ifelse</span>(Tranche_Active_Date <span class="sc">&lt;</span> Linked_Tranche_Active_Date,</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>                      <span class="at">yes =</span> Linked_deal_time_id, <span class="at">no =</span> deal_time_id), <span class="co"># the id for the deal that linked to `id_before`</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_loc_linked =</span> <span class="fu">ifelse</span>(Tranche_Active_Date <span class="sc">&lt;</span> Linked_Tranche_Active_Date,</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>                      <span class="at">yes =</span> <span class="st">"after"</span>, <span class="at">no =</span> <span class="st">"before"</span>) <span class="co"># the indicator for which one is the linked ID: if the linked deal time is later, it will be placed in "after" and vice versa. </span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id_before, id_after) <span class="sc">%&gt;%</span> </span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="do">### construct a more refined list of matching between firms: </span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>dt.manual_idonly <span class="ot">&lt;-</span> dt.manual_renegotiation <span class="sc">%&gt;%</span> </span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_before, id_after, id_loc_linked, n) <span class="sc">%&gt;%</span> </span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id_before <span class="sc">!=</span> id_after) <span class="sc">%&gt;%</span> </span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id_before, id_after) <span class="sc">%&gt;%</span> </span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">loc_linked =</span> <span class="fu">sum</span>(id_loc_linked <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"before"</span>, <span class="st">"after"</span>) ), <span class="co"># store all linked info 'after'/'before' </span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_type =</span> <span class="fu">ifelse</span>(loc_linked <span class="sc">==</span> <span class="dv">2</span>, <span class="at">yes =</span> <span class="st">"twoway"</span>, <span class="at">no =</span> <span class="st">"oneway"</span>) </span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># id_type = </span></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<pre><code>`summarise()` has grouped output by 'id_before'. You can override using the
`.groups` argument.</code></pre>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(id_before == 2260) </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## "twoway": deals are basically related, although activated at different time. (e.g. deal_time_id = 6 &amp; 7)</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## "oneway": deals are linked by only one direction, thus a renegotiation. </span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================== (July 4, 2024) </span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># merge the manually identified renegotiated contracts back to the full dataset. </span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>dt.DealScan_uniborrower_deal_updated <span class="ot">&lt;-</span> </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  dt.DealScan_uniborrower_deal <span class="sc">%&gt;%</span> </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(dt.manual_idonly, id_type <span class="sc">==</span> <span class="st">"oneway"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(id_before, id_after) <span class="sc">%&gt;%</span> </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>      <span class="do">## createe a matched sample of id(s) to one firm-deal-time observation in the main data === (July 7, 2024)</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(id_after) <span class="sc">%&gt;%</span> </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">id_before =</span> <span class="fu">list</span>(id_before)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>      <span class="do">## add an identifier </span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>( <span class="at">flag_manual_renegotiation =</span> <span class="cn">TRUE</span> ) , </span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">join_by</span>(deal_time_id <span class="sc">==</span> id_after) </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="do">## create a more accurate flag </span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">flag_manual_renegotiation =</span> <span class="fu">replace_na</span>(flag_manual_renegotiation, <span class="at">replace =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">flag_Renegotiated =</span> (Event_renegotiation <span class="sc">|</span> flag_renegotiation <span class="sc">|</span> flag_manual_renegotiation)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="do">## check the renegotiations </span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="co"># dt.DealScan_uniborrower_deal_updated %&gt;% select(deal_time_id, gvkey_group1, Tranche_Active_Date, flag_renegotiation, Event_renegotiation, flag_manual_renegotiation, flag_Renegotiated)</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================== (June 19, 2024)</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="co"># ========================================================================</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="co"># gvkey_group1 == 7089; 1894; 1392</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

<div class="no-row-height column-margin column-container"><div id="wrn-loan-path2" class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning&nbsp;1: Identify Loan Renegotiations!
</div>
</div>
<div class="callout-body-container callout-body">
<p>In newly generated data <code>dt.DealScan_uniborrower_deal</code>, the criterion to generate the new variable <code>flag_renegotiation</code> might need more detailed examination. This variable is created to detect whether an amendment happens, even when the <code>Tranch_O_A</code> variable gives <code>"Origination"</code>.</p>
</div>
</div></div><p>Here is a summary table showing the mapping between the amendment/refinancing flags and the <code>flag_renegotiated</code> I created for the firm-deal-time level dataset - <code>dt.DealScan_uniborrower_deal_updated</code>.</p>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to identify different types of contracts which are defined as "Origination".</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="do">## for all observations - both public and private. </span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>dt.flg_Rng <span class="ot">&lt;-</span> dt.DealScan_uniborrower_deal_updated <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(!is.na(gvkey_group1)) %&gt;% </span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Orig_Yes, </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>           flag_renegotiation, Event_renegotiation, flag_manual_renegotiation, </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>           flag_Renegotiated) <span class="sc">%&gt;%</span> </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>() <span class="co"># ,</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>            <span class="co"># RngYes = unique(flag_Renegotiated) # for the renegotiation identifier. </span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> <span class="co"># count the number of each types </span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage_n =</span> (n <span class="sc">/</span> <span class="fu">sum</span>(n))) </span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>dt.flg_Rng <span class="sc">%&gt;%</span> </span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">groupname_col =</span> <span class="st">"Orig_Yes"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="st">"Table 3b: WRDS DealScan Deal-Time Level Loan Events"</span>, </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">subtitle =</span> <span class="fu">html</span>(<span class="st">"A summary statistics to show the results of my identifier: `flag_renegotiated`.&lt;br&gt;</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="st">                           All firm-deal-time observations &lt;u&gt;are from the full sample&lt;/u&gt;, including both public and private firms."</span>)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>             ) <span class="sc">%&gt;%</span> </span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(<span class="at">table.font.size =</span> <span class="dv">11</span>, <span class="at">heading.align =</span> <span class="st">'left'</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>( <span class="co"># update the font size for table cells. </span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">size =</span> <span class="fu">px</span>(<span class="dv">11</span>)),</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_body</span>()</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_percent</span>(<span class="at">columns =</span> percentage_n, <span class="at">decimals =</span> <span class="dv">2</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display column-body">
<div id="qtgatexvot" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#qtgatexvot table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#qtgatexvot thead, #qtgatexvot tbody, #qtgatexvot tfoot, #qtgatexvot tr, #qtgatexvot td, #qtgatexvot th {
  border-style: none;
}

#qtgatexvot p {
  margin: 0;
  padding: 0;
}

#qtgatexvot .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 11px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qtgatexvot .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#qtgatexvot .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qtgatexvot .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qtgatexvot .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qtgatexvot .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qtgatexvot .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qtgatexvot .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qtgatexvot .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qtgatexvot .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qtgatexvot .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qtgatexvot .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qtgatexvot .gt_spanner_row {
  border-bottom-style: hidden;
}

#qtgatexvot .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#qtgatexvot .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qtgatexvot .gt_from_md > :first-child {
  margin-top: 0;
}

#qtgatexvot .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qtgatexvot .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qtgatexvot .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qtgatexvot .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qtgatexvot .gt_row_group_first td {
  border-top-width: 2px;
}

#qtgatexvot .gt_row_group_first th {
  border-top-width: 2px;
}

#qtgatexvot .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qtgatexvot .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qtgatexvot .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qtgatexvot .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qtgatexvot .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qtgatexvot .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qtgatexvot .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#qtgatexvot .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qtgatexvot .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qtgatexvot .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qtgatexvot .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qtgatexvot .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qtgatexvot .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qtgatexvot .gt_left {
  text-align: left;
}

#qtgatexvot .gt_center {
  text-align: center;
}

#qtgatexvot .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qtgatexvot .gt_font_normal {
  font-weight: normal;
}

#qtgatexvot .gt_font_bold {
  font-weight: bold;
}

#qtgatexvot .gt_font_italic {
  font-style: italic;
}

#qtgatexvot .gt_super {
  font-size: 65%;
}

#qtgatexvot .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#qtgatexvot .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qtgatexvot .gt_indent_1 {
  text-indent: 5px;
}

#qtgatexvot .gt_indent_2 {
  text-indent: 10px;
}

#qtgatexvot .gt_indent_3 {
  text-indent: 15px;
}

#qtgatexvot .gt_indent_4 {
  text-indent: 20px;
}

#qtgatexvot .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header gt_heading">
<th colspan="6" class="gt_heading gt_title gt_font_normal">Table 3b: WRDS DealScan Deal-Time Level Loan Events</th>
</tr>
<tr class="odd gt_heading">
<th colspan="6" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">A summary statistics to show the results of my identifier: `flag_renegotiated`.<br>
All firm-deal-time observations <u>are from the full sample</u>, including both public and private firms.</th>
</tr>
<tr class="header gt_col_headings">
<th id="flag_renegotiation" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">flag_renegotiation</th>
<th id="Event_renegotiation" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Event_renegotiation</th>
<th id="flag_manual_renegotiation" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">flag_manual_renegotiation</th>
<th id="flag_Renegotiated" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">flag_Renegotiated</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">n</th>
<th id="percentage_n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">percentage_n</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd gt_group_heading_row">
<td colspan="6" id="`Tranche_O_A` = Amendment" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">`Tranche_O_A` = Amendment</td>
</tr>
<tr class="even gt_row_group_first">
<td class="gt_row gt_center" headers="`Tranche_O_A` = Amendment  flag_renegotiation" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Amendment  Event_renegotiation" style="font-size: 11px">FALSE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Amendment  flag_manual_renegotiation" style="font-size: 11px">FALSE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Amendment  flag_Renegotiated" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  n" style="font-size: 11px">43586</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  percentage_n" style="font-size: 11px">13.85%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="`Tranche_O_A` = Amendment  flag_renegotiation" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Amendment  Event_renegotiation" style="font-size: 11px">FALSE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Amendment  flag_manual_renegotiation" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Amendment  flag_Renegotiated" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  n" style="font-size: 11px">51</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  percentage_n" style="font-size: 11px">0.02%</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="`Tranche_O_A` = Amendment  flag_renegotiation" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Amendment  Event_renegotiation" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Amendment  flag_manual_renegotiation" style="font-size: 11px">FALSE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Amendment  flag_Renegotiated" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  n" style="font-size: 11px">14278</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  percentage_n" style="font-size: 11px">4.54%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="`Tranche_O_A` = Amendment  flag_renegotiation" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Amendment  Event_renegotiation" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Amendment  flag_manual_renegotiation" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Amendment  flag_Renegotiated" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  n" style="font-size: 11px">1118</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  percentage_n" style="font-size: 11px">0.36%</td>
</tr>
<tr class="even gt_group_heading_row">
<td colspan="6" id="`Tranche_O_A` = Origination" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">`Tranche_O_A` = Origination</td>
</tr>
<tr class="odd gt_row_group_first">
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_renegotiation" style="font-size: 11px">FALSE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  Event_renegotiation" style="font-size: 11px">FALSE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_manual_renegotiation" style="font-size: 11px">FALSE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_Renegotiated" style="font-size: 11px">FALSE</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  n" style="font-size: 11px">163159</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  percentage_n" style="font-size: 11px">51.83%</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_renegotiation" style="font-size: 11px">FALSE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  Event_renegotiation" style="font-size: 11px">FALSE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_manual_renegotiation" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_Renegotiated" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  n" style="font-size: 11px">192</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  percentage_n" style="font-size: 11px">0.06%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_renegotiation" style="font-size: 11px">FALSE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  Event_renegotiation" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_manual_renegotiation" style="font-size: 11px">FALSE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_Renegotiated" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  n" style="font-size: 11px">8137</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  percentage_n" style="font-size: 11px">2.59%</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_renegotiation" style="font-size: 11px">FALSE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  Event_renegotiation" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_manual_renegotiation" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_Renegotiated" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  n" style="font-size: 11px">1028</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  percentage_n" style="font-size: 11px">0.33%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_renegotiation" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  Event_renegotiation" style="font-size: 11px">FALSE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_manual_renegotiation" style="font-size: 11px">FALSE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_Renegotiated" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  n" style="font-size: 11px">42740</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  percentage_n" style="font-size: 11px">13.58%</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_renegotiation" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  Event_renegotiation" style="font-size: 11px">FALSE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_manual_renegotiation" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_Renegotiated" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  n" style="font-size: 11px">78</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  percentage_n" style="font-size: 11px">0.02%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_renegotiation" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  Event_renegotiation" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_manual_renegotiation" style="font-size: 11px">FALSE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_Renegotiated" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  n" style="font-size: 11px">30483</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  percentage_n" style="font-size: 11px">9.68%</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_renegotiation" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  Event_renegotiation" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_manual_renegotiation" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_center" headers="`Tranche_O_A` = Origination  flag_Renegotiated" style="font-size: 11px">TRUE</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  n" style="font-size: 11px">9919</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  percentage_n" style="font-size: 11px">3.15%</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>One additional thing to note is to check refinancing deals in the data. One way to <b>distinguish between refinancing b/c previous loans mature <mark>and refinancing b/c other reasons</mark></b>, <u>which is classified as renegotiation in my analysis</u>.</p>
</section>
<section id="s4.-clean-the-loan-renegotiation-data" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="s4.-clean-the-loan-renegotiation-data">S4. Clean the loan renegotiation data</h2>
<p>Then, I will create a more detailed <code>flag_Renegotiated</code> variable in the dataset to more thoroughly cover all renegotiations at the firm-deal level.</p>
<p>A recap about the definition of different renegotiation flags:</p>
<ul>
<li><code>flag_renegotiation</code>: detected renegotiations based on the amendment/refinancing/_O_A flags in DealScan.</li>
<li><code>Event_renegotiation</code>: word detection in the variable <code>Deal_Remark</code>.</li>
<li><code>flag_manual_renegotiation</code>: manually matched renegotiated deals based on <code>Deal_Remark</code>.</li>
<li><code>flag_Renegotiated</code>: a more refined flag for renegotiations.</li>
</ul>

<div class="no-row-height column-margin column-container"><div id="wrn-loan-path3" class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning&nbsp;2: Still! A lot of renegotiations are missing.
</div>
</div>
<div class="callout-body-container callout-body">
<p>For company <a href="2015https://www.sec.gov/Archives/edgar/data/200155/000020015515000003/0000200155-15-000003.txt">COLORADO INTERSTATE GAS COMPANY, L.L.C.</a>, it is previously known as “COLORADO INTERSTATE CORP” (ex 1976/01/19) and “COLORADO INTERSTATE GAS CO” (ex 1992/07/03) and was subsequently potentially (?) merged with KINDER MORGAN, INC, in maybe 2014. The firm is a subsidiary of El Paso Corporation (NYSE: EP).</p>
<p>Even with these, there are still a lot of missing amendment/restatements in the DealScan. E.g. this <a href="https://www.sec.gov/edgar/search/#exhibit99a.htm">8-K</a>. However, this issue may come from the missing family-subsidiary connections and I need to rebuild this.</p>
</div>
</div></div><p>Here is a summary on the <code>flag_Renegotiated</code>:</p>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to identify different types of contracts which are defined as "Origination".</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="do">## for all observations - both public and private. </span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>dt.flg_Rng_summary <span class="ot">&lt;-</span> dt.DealScan_uniborrower_deal_updated <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(!is.na(gvkey_group1)) %&gt;% </span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Orig_Yes) <span class="sc">%&gt;%</span> </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_RngYes =</span> <span class="fu">sum</span>(flag_Renegotiated <span class="sc">==</span> <span class="cn">TRUE</span>), </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_RngNo =</span> <span class="fu">sum</span>(flag_Renegotiated <span class="sc">==</span> <span class="cn">FALSE</span>), </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> <span class="co"># count the number of each types </span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage_n =</span> (n <span class="sc">/</span> <span class="fu">sum</span>(n))) </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>dt.flg_Rng_summary <span class="sc">%&gt;%</span> </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">groupname_col =</span> <span class="st">"Orig_Yes"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="st">"Table 3: WRDS DealScan Deal-Time Level Loan Events"</span>, </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">subtitle =</span> <span class="fu">html</span>(<span class="st">"A summary statistics to show the results of my identifier: `flag_renegotiated`.&lt;br&gt; All firm-deal-time observations &lt;u&gt;are from the full sample&lt;/u&gt;, including both public and private firms."</span>) </span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>             ) <span class="sc">%&gt;%</span> </span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(<span class="at">table.font.size =</span> <span class="dv">11</span>, <span class="at">heading.align =</span> <span class="st">'left'</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>( <span class="co"># update the font size for table cells. </span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">size =</span> <span class="fu">px</span>(<span class="dv">11</span>)),</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_body</span>()</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_percent</span>(<span class="at">columns =</span> percentage_n, <span class="at">decimals =</span> <span class="dv">2</span>)  </span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="do">## for public firms only - with a valid GVKEY &amp; gvkey_group1 identifier. </span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>dt.flg_Rng_summary_publiconly <span class="ot">&lt;-</span> dt.DealScan_uniborrower_deal_updated <span class="sc">%&gt;%</span> </span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(gvkey_group1)) <span class="sc">%&gt;%</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Orig_Yes) <span class="sc">%&gt;%</span> </span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), </span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_RngYes =</span> <span class="fu">sum</span>(flag_Renegotiated <span class="sc">==</span> <span class="cn">TRUE</span>), </span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_RngNo =</span> <span class="fu">sum</span>(flag_Renegotiated <span class="sc">==</span> <span class="cn">FALSE</span>), </span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span> <span class="co"># count the number of each types </span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage_n =</span> (n <span class="sc">/</span> <span class="fu">sum</span>(n))) </span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>dt.flg_Rng_summary_publiconly <span class="sc">%&gt;%</span> </span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">groupname_col =</span> <span class="st">"Orig_Yes"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="st">"Table 3b: WRDS DealScan Deal-Time Level Loan Events"</span>, </span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>             <span class="at">subtitle =</span> <span class="fu">html</span>(<span class="st">"A summary statistics to show the results of my identifier: `flag_renegotiated`.&lt;br&gt;</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a><span class="st">                           Firm-deal-time observations &lt;u&gt;are for public firms only&lt;/u&gt;, i.e. with a valid GVKEY."</span>)</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>             ) <span class="sc">%&gt;%</span> </span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(<span class="at">table.font.size =</span> <span class="dv">11</span>, <span class="at">heading.align =</span> <span class="st">'left'</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>( <span class="co"># update the font size for table cells. </span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">size =</span> <span class="fu">px</span>(<span class="dv">11</span>)),</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_body</span>()</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_percent</span>(<span class="at">columns =</span> percentage_n, <span class="at">decimals =</span> <span class="dv">2</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell column-page quarto-layout-panel" data-layout-nrow="1" data-layout-ncol="2">
<div class="quarto-layout-row">
<div id="kyxhocphmm" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#kyxhocphmm table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#kyxhocphmm thead, #kyxhocphmm tbody, #kyxhocphmm tfoot, #kyxhocphmm tr, #kyxhocphmm td, #kyxhocphmm th {
  border-style: none;
}

#kyxhocphmm p {
  margin: 0;
  padding: 0;
}

#kyxhocphmm .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 11px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#kyxhocphmm .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#kyxhocphmm .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#kyxhocphmm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#kyxhocphmm .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kyxhocphmm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kyxhocphmm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kyxhocphmm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#kyxhocphmm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#kyxhocphmm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#kyxhocphmm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#kyxhocphmm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#kyxhocphmm .gt_spanner_row {
  border-bottom-style: hidden;
}

#kyxhocphmm .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#kyxhocphmm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#kyxhocphmm .gt_from_md > :first-child {
  margin-top: 0;
}

#kyxhocphmm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#kyxhocphmm .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#kyxhocphmm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#kyxhocphmm .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#kyxhocphmm .gt_row_group_first td {
  border-top-width: 2px;
}

#kyxhocphmm .gt_row_group_first th {
  border-top-width: 2px;
}

#kyxhocphmm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kyxhocphmm .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#kyxhocphmm .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#kyxhocphmm .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kyxhocphmm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kyxhocphmm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#kyxhocphmm .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#kyxhocphmm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#kyxhocphmm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kyxhocphmm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kyxhocphmm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kyxhocphmm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kyxhocphmm .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kyxhocphmm .gt_left {
  text-align: left;
}

#kyxhocphmm .gt_center {
  text-align: center;
}

#kyxhocphmm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#kyxhocphmm .gt_font_normal {
  font-weight: normal;
}

#kyxhocphmm .gt_font_bold {
  font-weight: bold;
}

#kyxhocphmm .gt_font_italic {
  font-style: italic;
}

#kyxhocphmm .gt_super {
  font-size: 65%;
}

#kyxhocphmm .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#kyxhocphmm .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#kyxhocphmm .gt_indent_1 {
  text-indent: 5px;
}

#kyxhocphmm .gt_indent_2 {
  text-indent: 10px;
}

#kyxhocphmm .gt_indent_3 {
  text-indent: 15px;
}

#kyxhocphmm .gt_indent_4 {
  text-indent: 20px;
}

#kyxhocphmm .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header gt_heading">
<th colspan="4" class="gt_heading gt_title gt_font_normal" style="text-align: left;">Table 3: WRDS DealScan Deal-Time Level Loan Events</th>
</tr>
<tr class="odd gt_heading">
<th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style="text-align: left;">A summary statistics to show the results of my identifier: `flag_renegotiated`.<br>
All firm-deal-time observations <u>are from the full sample</u>, including both public and private firms.</th>
</tr>
<tr class="header gt_col_headings">
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" style="text-align: left;" data-quarto-table-cell-role="th" scope="col">n</th>
<th id="n_RngYes" class="gt_col_heading gt_columns_bottom_border gt_right" style="text-align: left;" data-quarto-table-cell-role="th" scope="col">n_RngYes</th>
<th id="n_RngNo" class="gt_col_heading gt_columns_bottom_border gt_right" style="text-align: left;" data-quarto-table-cell-role="th" scope="col">n_RngNo</th>
<th id="percentage_n" class="gt_col_heading gt_columns_bottom_border gt_right" style="text-align: left;" data-quarto-table-cell-role="th" scope="col">percentage_n</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd gt_group_heading_row">
<td colspan="4" id="`Tranche_O_A` = Amendment" class="gt_group_heading" style="text-align: left;" data-quarto-table-cell-role="th" scope="colgroup">`Tranche_O_A` = Amendment</td>
</tr>
<tr class="even gt_row_group_first">
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  n" style="text-align: left; font-size: 11px;">59033</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  n_RngYes" style="text-align: left; font-size: 11px;">59033</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  n_RngNo" style="text-align: left; font-size: 11px;">0</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  percentage_n" style="text-align: left; font-size: 11px;">18.75%</td>
</tr>
<tr class="odd gt_group_heading_row">
<td colspan="4" id="`Tranche_O_A` = Origination" class="gt_group_heading" style="text-align: left;" data-quarto-table-cell-role="th" scope="colgroup">`Tranche_O_A` = Origination</td>
</tr>
<tr class="even gt_row_group_first">
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  n" style="text-align: left; font-size: 11px;">255736</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  n_RngYes" style="text-align: left; font-size: 11px;">92577</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  n_RngNo" style="text-align: left; font-size: 11px;">163159</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  percentage_n" style="text-align: left; font-size: 11px;">81.25%</td>
</tr>
</tbody>
</table>

</div>
<div id="anfaradecw" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#anfaradecw table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#anfaradecw thead, #anfaradecw tbody, #anfaradecw tfoot, #anfaradecw tr, #anfaradecw td, #anfaradecw th {
  border-style: none;
}

#anfaradecw p {
  margin: 0;
  padding: 0;
}

#anfaradecw .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 11px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#anfaradecw .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#anfaradecw .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#anfaradecw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#anfaradecw .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#anfaradecw .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#anfaradecw .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#anfaradecw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#anfaradecw .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#anfaradecw .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#anfaradecw .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#anfaradecw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#anfaradecw .gt_spanner_row {
  border-bottom-style: hidden;
}

#anfaradecw .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#anfaradecw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#anfaradecw .gt_from_md > :first-child {
  margin-top: 0;
}

#anfaradecw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#anfaradecw .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#anfaradecw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#anfaradecw .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#anfaradecw .gt_row_group_first td {
  border-top-width: 2px;
}

#anfaradecw .gt_row_group_first th {
  border-top-width: 2px;
}

#anfaradecw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#anfaradecw .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#anfaradecw .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#anfaradecw .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#anfaradecw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#anfaradecw .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#anfaradecw .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#anfaradecw .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#anfaradecw .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#anfaradecw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#anfaradecw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#anfaradecw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#anfaradecw .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#anfaradecw .gt_left {
  text-align: left;
}

#anfaradecw .gt_center {
  text-align: center;
}

#anfaradecw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#anfaradecw .gt_font_normal {
  font-weight: normal;
}

#anfaradecw .gt_font_bold {
  font-weight: bold;
}

#anfaradecw .gt_font_italic {
  font-style: italic;
}

#anfaradecw .gt_super {
  font-size: 65%;
}

#anfaradecw .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#anfaradecw .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#anfaradecw .gt_indent_1 {
  text-indent: 5px;
}

#anfaradecw .gt_indent_2 {
  text-indent: 10px;
}

#anfaradecw .gt_indent_3 {
  text-indent: 15px;
}

#anfaradecw .gt_indent_4 {
  text-indent: 20px;
}

#anfaradecw .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header gt_heading">
<th colspan="4" class="gt_heading gt_title gt_font_normal" style="text-align: left;">Table 3b: WRDS DealScan Deal-Time Level Loan Events</th>
</tr>
<tr class="odd gt_heading">
<th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style="text-align: left;">A summary statistics to show the results of my identifier: `flag_renegotiated`.<br>
Firm-deal-time observations <u>are for public firms only</u>, i.e. with a valid GVKEY.</th>
</tr>
<tr class="header gt_col_headings">
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" style="text-align: left;" data-quarto-table-cell-role="th" scope="col">n</th>
<th id="n_RngYes" class="gt_col_heading gt_columns_bottom_border gt_right" style="text-align: left;" data-quarto-table-cell-role="th" scope="col">n_RngYes</th>
<th id="n_RngNo" class="gt_col_heading gt_columns_bottom_border gt_right" style="text-align: left;" data-quarto-table-cell-role="th" scope="col">n_RngNo</th>
<th id="percentage_n" class="gt_col_heading gt_columns_bottom_border gt_right" style="text-align: left;" data-quarto-table-cell-role="th" scope="col">percentage_n</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd gt_group_heading_row">
<td colspan="4" id="`Tranche_O_A` = Amendment" class="gt_group_heading" style="text-align: left;" data-quarto-table-cell-role="th" scope="colgroup">`Tranche_O_A` = Amendment</td>
</tr>
<tr class="even gt_row_group_first">
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  n" style="text-align: left; font-size: 11px;">14552</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  n_RngYes" style="text-align: left; font-size: 11px;">14552</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  n_RngNo" style="text-align: left; font-size: 11px;">0</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Amendment  percentage_n" style="text-align: left; font-size: 11px;">11.30%</td>
</tr>
<tr class="odd gt_group_heading_row">
<td colspan="4" id="`Tranche_O_A` = Origination" class="gt_group_heading" style="text-align: left;" data-quarto-table-cell-role="th" scope="colgroup">`Tranche_O_A` = Origination</td>
</tr>
<tr class="even gt_row_group_first">
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  n" style="text-align: left; font-size: 11px;">114237</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  n_RngYes" style="text-align: left; font-size: 11px;">51565</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  n_RngNo" style="text-align: left; font-size: 11px;">62672</td>
<td class="gt_row gt_right" headers="`Tranche_O_A` = Origination  percentage_n" style="text-align: left; font-size: 11px;">88.70%</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>From Table 3, we can see that all firm-loan-time observations with flagged as <code>Tranche_O_A = Amendment</code> are correctly classified as the renegotiation. For observations classified into <code>Tranche_O_A = Origination</code>, which consists of 81% of total observations, <mark>around 37% of those is actually a renegotiation</mark>. If using the new <code>flag_Renegotiated</code> variable created in my dataset, the total percentage of observations classified as renegotiations will go up to 19% from 48.17%. This is a huge increase in the actual frequency of debt renegotiation. <mark>Please note that Table 3</mark> includes the firm-loan-time observations for both public (with <code>gvkey_group1</code>) and private firms <u>(w/o GVKEY)</u>.</p>
<p>The results for only public firms is in Table 3b and are quantitatively similar. The total percentage of observations classified as renegotiations will go up from 11% to 51.34%, after using my identifier <code>flag_renegotiated</code>. Please note that using obervations from public firms in DealScan data has two potential issues: (1) the sample size is halved and (2) not all US public firms’ observations are included. For the first point, firms not in US do not have GVKEY. For the second point, going directly to the 8-K, 10-K and 10-Q SEC filings will give us a better picture about the renegotiations. However, these are not urgent at the current stage.</p>
<p>Then I try to construct the path for each firm-deal-tranche/loan <span style="color:red;">observation for only US public firms</span> and store in the new dataset - <code>dt.DealScan_uniborrow_public</code>.</p>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ==================================================================================== (July 6, 2024) </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="do">## refine the updated firm-deal-time level data: </span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="do">## prepare to create a better match with the `dt.DealScan_uniborrower` dataset: </span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>dt.DealScan_uniborrower_deal_updated2 <span class="ot">&lt;-</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(dt.DealScan_uniborrower_deal_updated,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span><span class="fu">c</span>(All_Remarks, Event_all, linkedinfo_Remark, Orig_Yes) ) <span class="sc">%&gt;%</span> </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create a yearmonth index for the firm-deal-time level DealScan data. </span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Tranche_Active_YM =</span> <span class="fu">as.yearmon</span>(Tranche_Active_Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_longer</span>(<span class="fu">c</span>(Deal_Tranche_IDs, Tranche_Types) ) <span class="sc">%&gt;%</span> </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">LPC_Tranche_ID =</span> Deal_Tranche_IDs, <span class="at">Tranche_Type =</span> Tranche_Types)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co"># the new firm-deal-tranche-time level data for only US public firms:</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>dt.DealScan_uniborrow_public <span class="ot">&lt;-</span> dt.DealScan_uniborrower <span class="sc">%&gt;%</span> </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># keep only US public firms with GVKEY: </span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(gvkey_group1)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dt.DealScan_uniborrower_deal_updated2,</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">join_by</span>(gvkey_group1, Tranche_Active_Date, </span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>                         LPC_Deal_ID, LPC_Tranche_ID, Tranche_Type, </span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>                         Event_renegotiation, flag_renegotiation) ) <span class="sc">%&gt;%</span> </span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(obs_id, deal_time_id, gvkey_group1, gvkey, <span class="fu">everything</span>() )</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Here are the new variable names for the cleaned dataset:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>Here are the new variable names for the cleaned dataset:</p>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>dt.DealScan_uniborrow_public <span class="sc">%&gt;%</span> <span class="fu">names</span>() <span class="sc">%&gt;%</span> <span class="fu">sort</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>[1] “All_Remark” “All_Remark_am”<br>
[3] “Borrower_Id” “Borrower_Name”<br>
[5] “borrowercompanyid” “Company Name”<br>
[7] “confidence_score” “cs_company”<br>
[9] “Deal_Active_Date” “Deal_Amended”<br>
[11] “Deal_Amount” “Deal_Input_Date”<br>
[13] “Deal_Purpose” “Deal_Refinancing”<br>
[15] “Deal_Remark” “deal_time_id”<br>
[17] “ds_company” “Event_amend”<br>
[19] “Event_refin” “Event_renegotiation”<br>
[21] “Event_restate” “flag_manual_renegotiation” [23] “flag_Renegotiated” “flag_renegotiation”<br>
[25] “gvkey” “gvkey_group1”<br>
[27] “id_before” “LPC_Deal_ID”<br>
[29] “LPC_Tranche_ID” “obs_id”<br>
[31] “Orig_Yes” “Performance_Pricing_Remark” [33] “Purpose_Remark” “score_company_match”<br>
[35] “Tenor_Maturity” “Tranche_Active_Date”<br>
[37] “Tranche_Active_YM” “Tranche_Amended”<br>
[39] “Tranche_Amount” “Tranche_Maturity_Date”<br>
[41] “Tranche_O_A” “Tranche_Refinancing”<br>
[43] “Tranche_Remark” “Tranche_Type”<br>
[45] “vintage_match”</p>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(dt.DealScan_uniborrow_public, <span class="at">file =</span> <span class="st">"DealScan_uniborrow_public_cleaned.RData"</span>) </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="do">## separate the link table into a different file. </span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>dt.DealScan_link_table_public <span class="ot">&lt;-</span> <span class="fu">select</span>(dt.DealScan_uniborrow_public, </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                                        obs_id, <span class="co"># identifier for the firm-deal-tranche/loan-time observations </span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                                        deal_time_id, <span class="co"># identifier for the firm-deal-time observations</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>                                        gvkey_group1, <span class="co"># unique identifier for each firm </span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>                                        gvkey, <span class="co"># unique identifer in Compustat </span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>                                        Tranche_Active_Date, Tranche_Active_YM <span class="co"># observation time </span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>                                        )</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(dt.DealScan_link_table_public, <span class="at">file =</span> <span class="st">"DealScan_link_table.RData"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>From all procedure above, the raw DealScan data, <code>DealScan_borrower.RData</code>, is cleaned and saved into <code>DealScan_uniborrow_public_cleaned.RData</code>, which contains only observations from public firms. The link table is also updated and now saved in file <code>DealScan_link_table.RData</code>. The new link table will be used to link the DealScan dataset to the Compustat dataset.</p>
</section>
<section id="refine-the-deal-path-identification" class="level2">
<h2 class="anchored" data-anchor-id="refine-the-deal-path-identification">Refine the deal path identification</h2>
</section>
<section id="sec-reference" class="level2">
<h2 class="anchored" data-anchor-id="sec-reference">Reference</h2>
<ul>
<li>Related <a href="https://peterdemerjian.weebly.com/research.html">Peter Demerjian</a>
<ul>
<li>Measuring the Probability of Financial Covenant Violation in Private Debt Contracts (with E. Owens). Journal of Accounting and Economics 61: 433-447 (2016). &gt; <a href="https://peterdemerjian.weebly.com/managerialability.html">CODE</a></li>
</ul></li>
<li>Corporate Refinancing, Covenants, and the Agency Cost of Debt - Green (2018)</li>
<li>Covenant removal in corporate bonds - NHH paper (2023)</li>
</ul>
</section>
<section id="to-do-list" class="level2">
<h2 class="anchored" data-anchor-id="to-do-list">To-do list:</h2>
<ul>
<li>Exclude text with <code>amendment fee</code> in <code>Event_renegotiation</code>. &gt; Line 237.</li>
<li><a href="">July 7, 2024</a>
<ul>
<li>Use the maturity time to further distinguish the deals.</li>
<li>Connect to Compustat.</li>
</ul></li>
</ul>
<p>===</p>
</section>
<section id="trashbin" class="level2">
<h2 class="anchored" data-anchor-id="trashbin">Trashbin:</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">### </span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="do">### from section S2 - June 13, 2024 </span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="do">## create a dataset for the unique id for each unique observations. </span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>dt.Link_table_id <span class="ot">&lt;-</span> Link_table <span class="sc">%&gt;%</span> </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, <span class="st">`</span><span class="at">LoanConnector Company ID</span><span class="st">`</span>, borrowercompanyid, facilitystartdate) <span class="sc">%&gt;%</span> </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gvkey, <span class="st">`</span><span class="at">LoanConnector Company ID</span><span class="st">`</span>, borrowercompanyid) <span class="sc">%&gt;%</span> </span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">facilitystartdate_min =</span> <span class="fu">min</span>(facilitystartdate)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gvkey) <span class="sc">%&gt;%</span> </span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(facilitystartdate_min) <span class="sc">%&gt;%</span> </span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gvkey_group =</span> <span class="fu">cur_group_id</span>()) <span class="sc">%&gt;%</span> <span class="co"># generate the group_id based on `gvkey` </span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="do">## only contain self-created prelimiary gvkey_group(s):</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>comp_id_gvkey <span class="ot">&lt;-</span> dt.Link_table_id <span class="sc">%&gt;%</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gvkey, <span class="st">`</span><span class="at">LoanConnector Company ID</span><span class="st">`</span>, gvkey_group) <span class="sc">%&gt;%</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">LoanConnector Company ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">company_id_to_gvkey =</span> <span class="fu">paste0</span>(<span class="fu">paste0</span>(<span class="fu">unique</span>(gvkey), <span class="at">collapse =</span> <span class="st">";"</span>), <span class="st">";"</span>), <span class="co"># for `gvkey`</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">company_id_to_gvkey_group =</span> <span class="fu">paste0</span>(<span class="fu">paste0</span>(<span class="fu">unique</span>(gvkey_group), <span class="at">collapse =</span> <span class="st">";"</span>), <span class="st">";"</span>), <span class="co"># for `gvkey_group`</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_gvkey =</span> <span class="fu">length</span>(<span class="fu">unique</span>(gvkey)) <span class="co"># number of gvkey(s) within each `company_ID` group.</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>comp_id_gvkey</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>dt.gvkey_group1 <span class="ot">&lt;-</span> dt.Link_table_id <span class="sc">%&gt;%</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(comp_id_gvkey, <span class="at">by =</span> <span class="st">"LoanConnector Company ID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(gvkey) <span class="sc">%&gt;%</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># head(30) %&gt;%</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gvkey) <span class="sc">%&gt;%</span> <span class="co"># for each given `gvkey`, find the associated `gvkey`(s) based on `company_ID`.</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="co"># re-construct the list of linked `gvkey`(s)</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">connected_gvkey =</span> <span class="fu">paste</span>(<span class="fu">unique</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(company_id_to_gvkey, <span class="at">split =</span> <span class="st">";"</span>))), <span class="at">collapse =</span> <span class="st">";"</span>)</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(connected_gvkey) <span class="sc">%&gt;%</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gvkey_group1 =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.))</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>dt.Link_table_gvkey <span class="ot">&lt;-</span> <span class="fu">str_split</span>(<span class="at">string =</span> dt.gvkey_group1<span class="sc">$</span>connected_gvkey, <span class="at">pattern =</span> <span class="st">";"</span>, <span class="at">simplify =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">names&lt;-</span><span class="st">`</span>(<span class="at">value =</span> dt.gvkey_group1<span class="sc">$</span>gvkey_group1) <span class="sc">%&gt;%</span></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">gvkey =</span> ., <span class="at">gvkey_group1 =</span> <span class="fu">names</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gvkey =</span> <span class="fu">as.numeric</span>(gvkey))</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a><span class="do">### merge back to the link table</span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>dt.Link_table_id2 <span class="ot">&lt;-</span> dt.Link_table_id <span class="sc">%&gt;%</span></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>facilitystartdate_min, <span class="sc">-</span>gvkey_group) <span class="sc">%&gt;%</span></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(dt.Link_table_gvkey, <span class="at">by =</span> <span class="st">"gvkey"</span>)</span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>dt.Link_table_id2</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="do">## second round checking</span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a><span class="do">### the arguement here is that for all `company ID` previously identified from the same gvkey, I now map it back based on the `company ID` and double check whether the new `gvkey_group` is the same as the original ones. </span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a><span class="do">### i.e. I am checking whether the same `comapny ID` maps to multiple `gvkey`(s). </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- ## Notes  -->
<!-- color: <span style="color: red;"> text </span> // {style="color: red;"} -->
<!-- ## Quarto -->
<!-- Quarto enables you to weave together content and executable code into a finished document. To learn more about Quarto see <https://quarto.org>. -->
<!-- ## Running Code -->
<!-- When you click the **Render** button a document will be generated that includes both content and the output of embedded code. You can embed code like this: -->
<!-- ```{r} -->
<!-- 1 + 1 -->
<!-- ``` -->
<!-- You can add options to executable code like this -->
<!-- ```{r} -->
<!-- #| echo: false -->
<!-- 2 * 2 -->
<!-- ``` -->
<!-- The `echo: false` option disables the printing of code (only output is displayed). -->
<!-- -------- -->
<!-- ### s3.6 Leverage Covenants {#sec-s3.6-leverage-covenants} -->
<!-- Look into the changes in covenants related to the leverage restrictions and cash flow related restrictions (e.g. ICR: interest rate coverage ratio). -->
<!-- ### s3.7 Spreads and Fees {#sec-s3.7-spreads-and-fees} -->
<!-- Look into the changes in spread and fees. -->
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb21" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "DealScan Loan Path"</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Hongyi Xu"</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "July 3, 2024"</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="an">date-modified:</span><span class="co"> last-modified</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: flatly</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true </span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Show the code"</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">    html-math-method: katex</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left </span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: inline</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">\&gt; Back to research</span><span class="co">](https://hongyileoxu.github.io/research/)</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;style type="text/css"&gt;</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="in">body, td {</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="in">   font-size: 16px;</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="in">code.r{</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="in">  font-size: 12px;</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="in">pre {</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a><span class="in">  font-size: 12px</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/style&gt;</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(echo = TRUE) </span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a><span class="in">setwd("~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Loan_Path_Jun2024")</span></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a><span class="in">library(readxl)</span></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a><span class="in">library(data.table)</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggthemes)</span></span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a><span class="in">library(shadowtext)</span></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a><span class="in">library(egg)</span></span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a><span class="in">library(gt)</span></span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a><span class="in">library(psych)</span></span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a><span class="in">library(zoo)</span></span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a><span class="in">library(fedmatch)</span></span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a><span class="in">library(igraph) # for network analysis </span></span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a><span class="in"># library(arrow)</span></span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a><span class="in">source(file = "~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Functions/DealScan_functions.R", encoding = "UTF-8")</span></span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a><span class="fu">## S1. Objective {#sec-s1.-objective}</span></span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>This file follows file "DealScan_Data_Renegotiation.html" and file "DealScan_Loan_Path.qmd". The aim of this file is to extract the loan path and I also further clean the file <span class="in">`Link_table_2024.RData`</span> to gather all pair of identifiers for a unique firm over its life-cycle.</span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>Here is a notes on the <span class="co">[</span><span class="ot">WRDS Financial Covenants Table</span><span class="co">](https://wrds-www.wharton.upenn.edu/pages/support/support-articles/thomson-reuters/dealscan/wrds-financial-covenants-table/)</span>. The document there provides names and definitions on each financial covenants terms in the new DealScan data.</span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>Codes and variables in <span class="co">[</span><span class="ot">S3. Connect and build the loan paths</span><span class="co">]</span> are updated relative to file "DealScan_Loan_Path.qmd".</span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a><span class="fu">## S2. Firm's Life-cycle Identifier {#sec-s2.-firms-lift-cycle-identifier}</span></span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>In order to identify the loan path (or deal path), I first need to identify the life-cycle of a firm's identifiers, including <span class="in">`gvkey`</span>, <span class="in">`Borrower_Id`</span>, <span class="in">`borrowercompanyid`</span>, etc. So, I start with the link table created in the first section <span class="sc">\&gt;</span> <span class="co">[</span><span class="ot">HTML Manual</span><span class="co">](https://hongyileoxu.github.io/research/project-2024/DealScan2024/DealScan_Link_Table_Compustat.html)</span>.</span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{r firm_identifiers, echo=TRUE}</span></span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: screen-inset</span></span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a><span class="in">if (!file.exists("dt.Link_table_2024.RData")) {</span></span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a><span class="in">  ## import dataset </span></span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a><span class="in">  load("Link_table_2024.RData")</span></span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a><span class="in">  ## get the new company identifiers from network analysis </span></span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a><span class="in">  Link_table.newgroups &lt;- Link_table %&gt;% </span></span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a><span class="in">    group_or(id1 = "gvkey", id2 = "borrowercompanyid")</span></span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a><span class="in">  ## join back to the original dataset </span></span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a><span class="in">  dt.Link_table &lt;- Link_table %&gt;%</span></span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a><span class="in">    mutate(facilitystartdate = as.Date(facilitystartdate),</span></span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a><span class="in">           `LoanConnector Company ID` = as.integer(`LoanConnector Company ID`)</span></span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a><span class="in">           ) %&gt;% </span></span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a><span class="in">    left_join(Link_table.newgroups, by = c("gvkey", "borrowercompanyid")) %&gt;% </span></span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a><span class="in">    select(starts_with("facility"), gvkey_group1, everything(.)) </span></span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a><span class="in">  ## export the updated link table </span></span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a><span class="in">  save(dt.Link_table, file = "dt.Link_table_2024.RData")</span></span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a><span class="in">} else {</span></span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a><span class="in">  load("dt.Link_table_2024.RData")</span></span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a><span class="in">} </span></span>
<span id="cb21-96"><a href="#cb21-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-97"><a href="#cb21-97" aria-hidden="true" tabindex="-1"></a><span class="in">## a preview </span></span>
<span id="cb21-98"><a href="#cb21-98" aria-hidden="true" tabindex="-1"></a><span class="in">dt.Link_table %&gt;% </span></span>
<span id="cb21-99"><a href="#cb21-99" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(facilitystartdate) %&gt;%</span></span>
<span id="cb21-100"><a href="#cb21-100" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(gvkey_group1 == 22) %&gt;% </span></span>
<span id="cb21-101"><a href="#cb21-101" aria-hidden="true" tabindex="-1"></a><span class="in">  gt() %&gt;% </span></span>
<span id="cb21-102"><a href="#cb21-102" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_header(title = "New Link table for Aeroflex Inc. (previously known as ARX Inc.)", </span></span>
<span id="cb21-103"><a href="#cb21-103" aria-hidden="true" tabindex="-1"></a><span class="in">             subtitle = html('&lt;span class="red-star"&gt;★&lt;/span&gt;Now the variable `gvkey_group1` is used to identify all loan level observations from the same firm.')</span></span>
<span id="cb21-104"><a href="#cb21-104" aria-hidden="true" tabindex="-1"></a><span class="in">             ) %&gt;% </span></span>
<span id="cb21-105"><a href="#cb21-105" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_options(table.font.size = 10, heading.align = 'left' ) %&gt;% </span></span>
<span id="cb21-106"><a href="#cb21-106" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_style( # update the font size for table cells. </span></span>
<span id="cb21-107"><a href="#cb21-107" aria-hidden="true" tabindex="-1"></a><span class="in">    style = cell_text(size = px(10)),</span></span>
<span id="cb21-108"><a href="#cb21-108" aria-hidden="true" tabindex="-1"></a><span class="in">    locations = cells_body()</span></span>
<span id="cb21-109"><a href="#cb21-109" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb21-110"><a href="#cb21-110" aria-hidden="true" tabindex="-1"></a><span class="in">  data_color(</span></span>
<span id="cb21-111"><a href="#cb21-111" aria-hidden="true" tabindex="-1"></a><span class="in">    columns = c("gvkey", "borrowercompanyid"),</span></span>
<span id="cb21-112"><a href="#cb21-112" aria-hidden="true" tabindex="-1"></a><span class="in">    method = "factor",</span></span>
<span id="cb21-113"><a href="#cb21-113" aria-hidden="true" tabindex="-1"></a><span class="in">    palette = "viridis", </span></span>
<span id="cb21-114"><a href="#cb21-114" aria-hidden="true" tabindex="-1"></a><span class="in">    reverse = TRUE</span></span>
<span id="cb21-115"><a href="#cb21-115" aria-hidden="true" tabindex="-1"></a><span class="in">    ) %&gt;% </span></span>
<span id="cb21-116"><a href="#cb21-116" aria-hidden="true" tabindex="-1"></a><span class="in">  cols_hide(columns = matches("score|match") ) # hide columns</span></span>
<span id="cb21-117"><a href="#cb21-117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-118"><a href="#cb21-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-119"><a href="#cb21-119" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>An example from <span class="co">[</span><span class="ot">the web</span><span class="co">](https://stackoverflow.com/questions/68947862/grouping-similar-elements-together)</span> to use network analysis for more granular grouping assignments.</span>
<span id="cb21-120"><a href="#cb21-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-121"><a href="#cb21-121" aria-hidden="true" tabindex="-1"></a><span class="in">```{r network_example, eval=FALSE}</span></span>
<span id="cb21-122"><a href="#cb21-122" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: margin</span></span>
<span id="cb21-123"><a href="#cb21-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-124"><a href="#cb21-124" aria-hidden="true" tabindex="-1"></a><span class="in"># Load the necessary libraries</span></span>
<span id="cb21-125"><a href="#cb21-125" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb21-126"><a href="#cb21-126" aria-hidden="true" tabindex="-1"></a><span class="in">library(igraph)</span></span>
<span id="cb21-127"><a href="#cb21-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-128"><a href="#cb21-128" aria-hidden="true" tabindex="-1"></a><span class="in"># Manually generating data</span></span>
<span id="cb21-129"><a href="#cb21-129" aria-hidden="true" tabindex="-1"></a><span class="in">Names &lt;- c(rep('James,Gordon',6)</span></span>
<span id="cb21-130"><a href="#cb21-130" aria-hidden="true" tabindex="-1"></a><span class="in">          ,rep('Amanda',3)</span></span>
<span id="cb21-131"><a href="#cb21-131" aria-hidden="true" tabindex="-1"></a><span class="in">          ,rep('Gordon,Amanda',8)</span></span>
<span id="cb21-132"><a href="#cb21-132" aria-hidden="true" tabindex="-1"></a><span class="in">          ,rep('Edward,Gordon,Amanda',3)</span></span>
<span id="cb21-133"><a href="#cb21-133" aria-hidden="true" tabindex="-1"></a><span class="in">          ,rep('Anna',3)</span></span>
<span id="cb21-134"><a href="#cb21-134" aria-hidden="true" tabindex="-1"></a><span class="in">          ,rep('Anna,Leonard',3)</span></span>
<span id="cb21-135"><a href="#cb21-135" aria-hidden="true" tabindex="-1"></a><span class="in">          )</span></span>
<span id="cb21-136"><a href="#cb21-136" aria-hidden="true" tabindex="-1"></a><span class="in">Initial_Group &lt;- rep(1:6,c(6,3,8,3,3,3))</span></span>
<span id="cb21-137"><a href="#cb21-137" aria-hidden="true" tabindex="-1"></a><span class="in">Final_Group &lt;- rep(c('A','B'),c(20,6))</span></span>
<span id="cb21-138"><a href="#cb21-138" aria-hidden="true" tabindex="-1"></a><span class="in">data &lt;- data.frame(Names,Initial_Group,Final_Group)</span></span>
<span id="cb21-139"><a href="#cb21-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-140"><a href="#cb21-140" aria-hidden="true" tabindex="-1"></a><span class="in">data %&gt;%</span></span>
<span id="cb21-141"><a href="#cb21-141" aria-hidden="true" tabindex="-1"></a><span class="in">  select(Names)%&gt;%</span></span>
<span id="cb21-142"><a href="#cb21-142" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct() %&gt;%</span></span>
<span id="cb21-143"><a href="#cb21-143" aria-hidden="true" tabindex="-1"></a><span class="in">  separate(Names, c('first', 'second'), extra = 'merge', fill = 'right')%&gt;%</span></span>
<span id="cb21-144"><a href="#cb21-144" aria-hidden="true" tabindex="-1"></a><span class="in">  separate_rows(second) %&gt;%</span></span>
<span id="cb21-145"><a href="#cb21-145" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(second = coalesce(second, as.character(cumsum(is.na(second))))) %&gt;%</span></span>
<span id="cb21-146"><a href="#cb21-146" aria-hidden="true" tabindex="-1"></a><span class="in">  graph_from_data_frame()%&gt;%</span></span>
<span id="cb21-147"><a href="#cb21-147" aria-hidden="true" tabindex="-1"></a><span class="in">  components() %&gt;%</span></span>
<span id="cb21-148"><a href="#cb21-148" aria-hidden="true" tabindex="-1"></a><span class="in">  getElement('membership') %&gt;%</span></span>
<span id="cb21-149"><a href="#cb21-149" aria-hidden="true" tabindex="-1"></a><span class="in">  imap(~str_detect(data$Names, .y)*.x) %&gt;%</span></span>
<span id="cb21-150"><a href="#cb21-150" aria-hidden="true" tabindex="-1"></a><span class="in">  invoke(pmax, .) %&gt;% # `invoke` is applied to apply function to the same location in each element under a list </span></span>
<span id="cb21-151"><a href="#cb21-151" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(data, value = LETTERS[.], value1 = .) </span></span>
<span id="cb21-152"><a href="#cb21-152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-153"><a href="#cb21-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-154"><a href="#cb21-154" aria-hidden="true" tabindex="-1"></a>In the above example for Aeroflex Inc. (previously known as ARX Inc.), one company may match multiple combinations of two identifiers - <span class="in">`gvkey`</span> and <span class="in">`borrowercompanyid`</span>/<span class="in">`LoanConnector Company ID`</span> - and I recreate a new identifier <span class="in">`gvkey_group1`</span> to uniquely identify one firm's life-cycle in the dataset. <span class="in">`borrowercompanyid`</span> is the borrower identifier in the Legacy DealScan dataset and <span class="in">`LoanConnector Company ID`</span> is for the new LPC DealScan.</span>
<span id="cb21-155"><a href="#cb21-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-156"><a href="#cb21-156" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--- .column-margin ---&gt;</span></span>
<span id="cb21-157"><a href="#cb21-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-158"><a href="#cb21-158" aria-hidden="true" tabindex="-1"></a>::: {#tip-loan-path .callout-tip collapse="true"}</span>
<span id="cb21-159"><a href="#cb21-159" aria-hidden="true" tabindex="-1"></a><span class="fu">## A finer link table</span></span>
<span id="cb21-160"><a href="#cb21-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-161"><a href="#cb21-161" aria-hidden="true" tabindex="-1"></a>In the current version of the link table, <span class="in">`dt.Link_table`</span>, facility/tranche level information is also included. A cleaner version of the link table will only include borrower level observations.</span>
<span id="cb21-162"><a href="#cb21-162" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb21-163"><a href="#cb21-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-164"><a href="#cb21-164" aria-hidden="true" tabindex="-1"></a>One additional thing to notice is that although no missing values observed in variable <span class="in">`borrowercompanyid`</span> (and also <span class="in">`gvkey`</span>), <span class="in">`LoanConnector Company ID`</span> contains missing value, around 66 observations.</span>
<span id="cb21-165"><a href="#cb21-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-166"><a href="#cb21-166" aria-hidden="true" tabindex="-1"></a><span class="fu">## S3. Connect and build the loan paths</span></span>
<span id="cb21-167"><a href="#cb21-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-168"><a href="#cb21-168" aria-hidden="true" tabindex="-1"></a>Here are the steps to achieve this:</span>
<span id="cb21-169"><a href="#cb21-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-170"><a href="#cb21-170" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>load the dataset for the new link table - <span class="in">`dt.Link_table`</span> and for all Deal-Tranches with borrower information - <span class="in">`DealScan_borrower`</span>. The dataset <span class="in">`dt.name_match`</span> is used to guide the selection of variables for specific analyses. <span class="co">[</span><span class="ot">\&gt; refer to section s3.4 in this document.</span><span class="co">](https://hongyileoxu.github.io/research/project-2024/DealScan2024/DealScan_Data_Renegotiation.html#sec-s3.4-classify-variable-names)</span></span>
<span id="cb21-171"><a href="#cb21-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-172"><a href="#cb21-172" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Cross validate the changes in the loan amount using the item &lt;mark&gt;"Cash flows from financing activities"&lt;/mark&gt; from the &lt;mark&gt;"CONSOLIDATED STATEMENTS OF CASH FLOWS"&lt;/mark&gt;.</span>
<span id="cb21-173"><a href="#cb21-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-174"><a href="#cb21-174" aria-hidden="true" tabindex="-1"></a><span class="at">    &gt; One example from JACO ELECTRONICS INC (</span><span class="in">`gvkey_group1 == 1894`</span><span class="at">) and its </span><span class="co">[</span><span class="ot">SEC filing</span><span class="co">](https://www.sec.gov/Archives/edgar/data/52971/0000950123-95-002603.txt)</span><span class="at">. Search </span><span class="in">`Term Loan`</span><span class="at"> in the filing and you will much more renegotiations than ones recorded in the DealScan.</span></span>
<span id="cb21-175"><a href="#cb21-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-176"><a href="#cb21-176" aria-hidden="true" tabindex="-1"></a>    ::: {.callout-tip .column-margin collapse="false"}</span>
<span id="cb21-177"><a href="#cb21-177" aria-hidden="true" tabindex="-1"></a>    ## Also in 10-K/Q !!!</span>
<span id="cb21-178"><a href="#cb21-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-179"><a href="#cb21-179" aria-hidden="true" tabindex="-1"></a>    Alternatively, go to the 10-K/Q and find the information about all debts in the <span class="in">`Note`</span> section. Normally this information is in the Exhibit. &lt;br&gt; &lt;br&gt; E.g. <span class="co">[</span><span class="ot">Form 10-K from Nvidia</span><span class="co">](https://www.sec.gov/Archives/edgar/data/1045810/000104581024000029/nvda-20240128.htm#i13eac97307cc485c971e826acbda8be7_184)</span> listed its detailed debt profile in its <span class="co">[</span><span class="ot">Note 12 - Debt</span><span class="co">](https://www.sec.gov/Archives/edgar/data/1045810/000104581024000029/nvda-20240128.htm#i13eac97307cc485c971e826acbda8be7_91)</span>.</span>
<span id="cb21-180"><a href="#cb21-180" aria-hidden="true" tabindex="-1"></a>    :::</span>
<span id="cb21-181"><a href="#cb21-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-182"><a href="#cb21-182" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span></span>
<span id="cb21-183"><a href="#cb21-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-184"><a href="#cb21-184" aria-hidden="true" tabindex="-1"></a>&lt;b&gt;Let's start!&lt;/b&gt;</span>
<span id="cb21-185"><a href="#cb21-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-186"><a href="#cb21-186" aria-hidden="true" tabindex="-1"></a>Condense all remarks - <span class="in">`Purpose_Remark`</span>,<span class="in">`Deal_Remark`</span>,<span class="in">`Tranche_Remark`</span>,<span class="in">`Performance_Pricing_Remark`</span> - into varible <span class="in">`All_Remark`</span>.</span>
<span id="cb21-187"><a href="#cb21-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-188"><a href="#cb21-188" aria-hidden="true" tabindex="-1"></a><span class="in">```{r laon_path, echo=TRUE}</span></span>
<span id="cb21-189"><a href="#cb21-189" aria-hidden="true" tabindex="-1"></a><span class="in">## load the necessary tables</span></span>
<span id="cb21-190"><a href="#cb21-190" aria-hidden="true" tabindex="-1"></a><span class="in">if (!exists("dt.Link_table")) {</span></span>
<span id="cb21-191"><a href="#cb21-191" aria-hidden="true" tabindex="-1"></a><span class="in">  ## check whether the variable `dt.Link_table` is there. &gt; if yes, then .... </span></span>
<span id="cb21-192"><a href="#cb21-192" aria-hidden="true" tabindex="-1"></a><span class="in">  load(file = "dt.Link_table_2024.RData")</span></span>
<span id="cb21-193"><a href="#cb21-193" aria-hidden="true" tabindex="-1"></a><span class="in">} </span></span>
<span id="cb21-194"><a href="#cb21-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-195"><a href="#cb21-195" aria-hidden="true" tabindex="-1"></a><span class="in"># # file &lt;- "DealScan_borrower.Rdata"</span></span>
<span id="cb21-196"><a href="#cb21-196" aria-hidden="true" tabindex="-1"></a><span class="in"># # from &lt;- "~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Data_Renegotiations_Jun2024"</span></span>
<span id="cb21-197"><a href="#cb21-197" aria-hidden="true" tabindex="-1"></a><span class="in"># # to &lt;- "~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Loan_Path_Jun2024"</span></span>
<span id="cb21-198"><a href="#cb21-198" aria-hidden="true" tabindex="-1"></a><span class="in">{ # Procedure to check and copy necessary files: </span></span>
<span id="cb21-199"><a href="#cb21-199" aria-hidden="true" tabindex="-1"></a><span class="in">  copy_file(from = "~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Data_Renegotiations_Jun2024", to = "~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Loan_Path_Jun2024", file = "DealScan_borrower.Rdata")</span></span>
<span id="cb21-200"><a href="#cb21-200" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb21-201"><a href="#cb21-201" aria-hidden="true" tabindex="-1"></a><span class="in">  copy_file(from = "~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Data_Renegotiations_Jun2024", to = "~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Loan_Path_Jun2024", file = "DealScan_name_match.RData") </span></span>
<span id="cb21-202"><a href="#cb21-202" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb21-203"><a href="#cb21-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-204"><a href="#cb21-204" aria-hidden="true" tabindex="-1"></a><span class="in">## load the dealscan data for only borrowers information &gt; DealScan_borrower </span></span>
<span id="cb21-205"><a href="#cb21-205" aria-hidden="true" tabindex="-1"></a><span class="in">load(file = "~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Data_Renegotiations_Jun2024/DealScan_borrower.RData") </span></span>
<span id="cb21-206"><a href="#cb21-206" aria-hidden="true" tabindex="-1"></a><span class="in">### load the dealscan variable names &gt; dt.name_match </span></span>
<span id="cb21-207"><a href="#cb21-207" aria-hidden="true" tabindex="-1"></a><span class="in">load(file = "~/Library/CloudStorage/OneDrive-HandelshögskolaniStockholm/Projects_2024/Dealscan_LinkTable/DealScan_Data_Renegotiations_Jun2024/DealScan_name_match.RData") </span></span>
<span id="cb21-208"><a href="#cb21-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-209"><a href="#cb21-209" aria-hidden="true" tabindex="-1"></a><span class="in">name_covenants_17 &lt;- dt.name_match %&gt;% # financial covenants </span></span>
<span id="cb21-210"><a href="#cb21-210" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(grepl(pattern = "^17:", x = group_header)) %&gt;% </span></span>
<span id="cb21-211"><a href="#cb21-211" aria-hidden="true" tabindex="-1"></a><span class="in">  .$orig_name</span></span>
<span id="cb21-212"><a href="#cb21-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-213"><a href="#cb21-213" aria-hidden="true" tabindex="-1"></a><span class="in">name_covenants_19 &lt;- dt.name_match %&gt;% # general covenants </span></span>
<span id="cb21-214"><a href="#cb21-214" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(grepl(pattern = "^19:", x = group_header)) %&gt;% </span></span>
<span id="cb21-215"><a href="#cb21-215" aria-hidden="true" tabindex="-1"></a><span class="in">  .$orig_name</span></span>
<span id="cb21-216"><a href="#cb21-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-217"><a href="#cb21-217" aria-hidden="true" tabindex="-1"></a><span class="in">name_renegotiation &lt;- c( # names for the </span></span>
<span id="cb21-218"><a href="#cb21-218" aria-hidden="true" tabindex="-1"></a><span class="in">    grep(pattern = "LPC|_O_A", x = names(DealScan_borrower), value = T), </span></span>
<span id="cb21-219"><a href="#cb21-219" aria-hidden="true" tabindex="-1"></a><span class="in">    grep(pattern = "Amended", x = names(DealScan_borrower), value = T), </span></span>
<span id="cb21-220"><a href="#cb21-220" aria-hidden="true" tabindex="-1"></a><span class="in">    grep(pattern = "Refinan", x = names(DealScan_borrower), value = T)</span></span>
<span id="cb21-221"><a href="#cb21-221" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb21-222"><a href="#cb21-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-223"><a href="#cb21-223" aria-hidden="true" tabindex="-1"></a><span class="in">## link the two data sets </span></span>
<span id="cb21-224"><a href="#cb21-224" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_borrower &lt;- DealScan_borrower %&gt;% </span></span>
<span id="cb21-225"><a href="#cb21-225" aria-hidden="true" tabindex="-1"></a><span class="in">  select(Borrower_Id, Borrower_Name, </span></span>
<span id="cb21-226"><a href="#cb21-226" aria-hidden="true" tabindex="-1"></a><span class="in">         all_of(name_renegotiation), # all flags for different kind of renegotiations. </span></span>
<span id="cb21-227"><a href="#cb21-227" aria-hidden="true" tabindex="-1"></a><span class="in">         grep(x = names(.), pattern = "Matur", ignore.case = T, value = T), </span></span>
<span id="cb21-228"><a href="#cb21-228" aria-hidden="true" tabindex="-1"></a><span class="in">         "Deal_Amount", "Tranche_Amount", </span></span>
<span id="cb21-229"><a href="#cb21-229" aria-hidden="true" tabindex="-1"></a><span class="in">         "Deal_Active_Date", "Deal_Input_Date", "Tranche_Active_Date", </span></span>
<span id="cb21-230"><a href="#cb21-230" aria-hidden="true" tabindex="-1"></a><span class="in">         "Tranche_Type", "Deal_Purpose", </span></span>
<span id="cb21-231"><a href="#cb21-231" aria-hidden="true" tabindex="-1"></a><span class="in">         grep(pattern = "Remark", x = names(.), value = T)</span></span>
<span id="cb21-232"><a href="#cb21-232" aria-hidden="true" tabindex="-1"></a><span class="in">         ) %&gt;% </span></span>
<span id="cb21-233"><a href="#cb21-233" aria-hidden="true" tabindex="-1"></a><span class="in">  as_tibble() %&gt;% </span></span>
<span id="cb21-234"><a href="#cb21-234" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(across(contains("Date"), as.Date)) %&gt;% </span></span>
<span id="cb21-235"><a href="#cb21-235" aria-hidden="true" tabindex="-1"></a><span class="in">  unite("All_Remark", contains("Remark"), sep = "&lt;br&gt;", na.rm = T, remove = F) %&gt;% </span></span>
<span id="cb21-236"><a href="#cb21-236" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb21-237"><a href="#cb21-237" aria-hidden="true" tabindex="-1"></a><span class="in">    All_Remark_am = str_replace_all(string = All_Remark, pattern = "(?i)\\bAmend(ment)? Fee\\b", replacement = ""), </span></span>
<span id="cb21-238"><a href="#cb21-238" aria-hidden="true" tabindex="-1"></a><span class="in">    Event_amend = grepl(x = All_Remark_am, pattern = "amend", ignore.case = T), # whether the term 'amend' is detected </span></span>
<span id="cb21-239"><a href="#cb21-239" aria-hidden="true" tabindex="-1"></a><span class="in">    Event_restate = grepl(x = All_Remark, pattern = "restate", ignore.case = T), # whether the term 'restate' is detected </span></span>
<span id="cb21-240"><a href="#cb21-240" aria-hidden="true" tabindex="-1"></a><span class="in">    Event_refin = grepl(x = All_Remark, pattern = "refin", ignore.case = T) # whether the term 'refinancing' is detected </span></span>
<span id="cb21-241"><a href="#cb21-241" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb21-242"><a href="#cb21-242" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Event_renegotiation = (Event_amend | Event_amend | Event_refin) ) # whether there exists an events identified by contents in `Deal_Remark` </span></span>
<span id="cb21-243"><a href="#cb21-243" aria-hidden="true" tabindex="-1"></a><span class="in">### The last several lines collect information about whether an amend or restate or refinance event happen. </span></span>
<span id="cb21-244"><a href="#cb21-244" aria-hidden="true" tabindex="-1"></a><span class="in">### The `Event_renegotiation` variable detect whether a renegotiation event happens. </span></span>
<span id="cb21-245"><a href="#cb21-245" aria-hidden="true" tabindex="-1"></a><span class="in">### Also, I check whether a loan is a refinancing of a previous loan. </span></span>
<span id="cb21-246"><a href="#cb21-246" aria-hidden="true" tabindex="-1"></a><span class="in"># names(dt.DealScan_borrower) </span></span>
<span id="cb21-247"><a href="#cb21-247" aria-hidden="true" tabindex="-1"></a><span class="in"># names(dt.Link_table)</span></span>
<span id="cb21-248"><a href="#cb21-248" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-249"><a href="#cb21-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-250"><a href="#cb21-250" aria-hidden="true" tabindex="-1"></a>Here a summary for the variables <span class="in">`Event_amend`</span>, <span class="in">`Event_restate`</span>,<span class="in">`Event_refin`</span> and <span class="in">`Event_renegotiation`</span> under each group classified by amendment/refinancing flags in DealScan.</span>
<span id="cb21-251"><a href="#cb21-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-252"><a href="#cb21-252" aria-hidden="true" tabindex="-1"></a><span class="in">```{r event_groups1, echo=TRUE, message=FALSE}</span></span>
<span id="cb21-253"><a href="#cb21-253" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: screen-inset</span></span>
<span id="cb21-254"><a href="#cb21-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-255"><a href="#cb21-255" aria-hidden="true" tabindex="-1"></a><span class="in"># to identify different types of contracts which are defined as "Origination". </span></span>
<span id="cb21-256"><a href="#cb21-256" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_borrower %&gt;% </span></span>
<span id="cb21-257"><a href="#cb21-257" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(grepl(pattern = "Orig", x = Tranche_O_A)) %&gt;% # only keep tranches classified as "Origination"</span></span>
<span id="cb21-258"><a href="#cb21-258" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(Deal_Amended, Tranche_Amended, Deal_Refinancing, Tranche_Refinancing) %&gt;% </span></span>
<span id="cb21-259"><a href="#cb21-259" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(n = n(), </span></span>
<span id="cb21-260"><a href="#cb21-260" aria-hidden="true" tabindex="-1"></a><span class="in">            n_Event_amend = sum(Event_amend), </span></span>
<span id="cb21-261"><a href="#cb21-261" aria-hidden="true" tabindex="-1"></a><span class="in">            n_Event_restate = sum(Event_restate), </span></span>
<span id="cb21-262"><a href="#cb21-262" aria-hidden="true" tabindex="-1"></a><span class="in">            n_Event_refin = sum(Event_refin), </span></span>
<span id="cb21-263"><a href="#cb21-263" aria-hidden="true" tabindex="-1"></a><span class="in">            n_Event = sum(Event_renegotiation)  </span></span>
<span id="cb21-264"><a href="#cb21-264" aria-hidden="true" tabindex="-1"></a><span class="in">            ) %&gt;% # count the number of each types </span></span>
<span id="cb21-265"><a href="#cb21-265" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb21-266"><a href="#cb21-266" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(percentage_n = (n / sum(n))) %&gt;% </span></span>
<span id="cb21-267"><a href="#cb21-267" aria-hidden="true" tabindex="-1"></a><span class="in">  gt() %&gt;% </span></span>
<span id="cb21-268"><a href="#cb21-268" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_header(title = "Table 2a: WRDS DealScan Deal-Tranche Level Loan Events", </span></span>
<span id="cb21-269"><a href="#cb21-269" aria-hidden="true" tabindex="-1"></a><span class="in">             subtitle = "Subgroup: `Tranche_O_A` = Origination"</span></span>
<span id="cb21-270"><a href="#cb21-270" aria-hidden="true" tabindex="-1"></a><span class="in">             ) %&gt;% </span></span>
<span id="cb21-271"><a href="#cb21-271" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_options(table.font.size = 11, heading.align = 'left' ) %&gt;% </span></span>
<span id="cb21-272"><a href="#cb21-272" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_style( # update the font size for table cells. </span></span>
<span id="cb21-273"><a href="#cb21-273" aria-hidden="true" tabindex="-1"></a><span class="in">    style = cell_text(size = px(11)),</span></span>
<span id="cb21-274"><a href="#cb21-274" aria-hidden="true" tabindex="-1"></a><span class="in">    locations = cells_body()</span></span>
<span id="cb21-275"><a href="#cb21-275" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb21-276"><a href="#cb21-276" aria-hidden="true" tabindex="-1"></a><span class="in">  fmt_percent(columns = percentage_n, decimals = 2) </span></span>
<span id="cb21-277"><a href="#cb21-277" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-278"><a href="#cb21-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-279"><a href="#cb21-279" aria-hidden="true" tabindex="-1"></a><span class="in">```{r event_groups2, echo=TRUE, message=FALSE}</span></span>
<span id="cb21-280"><a href="#cb21-280" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: screen-inset</span></span>
<span id="cb21-281"><a href="#cb21-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-282"><a href="#cb21-282" aria-hidden="true" tabindex="-1"></a><span class="in"># to identify different types of contracts which are defined as "Amendment 1". </span></span>
<span id="cb21-283"><a href="#cb21-283" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_borrower %&gt;% </span></span>
<span id="cb21-284"><a href="#cb21-284" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(grepl(pattern = "Amendment", x = Tranche_O_A)) %&gt;% # only keep tranches classified as "Origination"</span></span>
<span id="cb21-285"><a href="#cb21-285" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(Deal_Amended, Tranche_Amended, Deal_Refinancing, Tranche_Refinancing) %&gt;% </span></span>
<span id="cb21-286"><a href="#cb21-286" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(n = n(), </span></span>
<span id="cb21-287"><a href="#cb21-287" aria-hidden="true" tabindex="-1"></a><span class="in">            n_Event_amend = sum(Event_amend), </span></span>
<span id="cb21-288"><a href="#cb21-288" aria-hidden="true" tabindex="-1"></a><span class="in">            n_Event_restate = sum(Event_restate), </span></span>
<span id="cb21-289"><a href="#cb21-289" aria-hidden="true" tabindex="-1"></a><span class="in">            n_Event_refin = sum(Event_refin), </span></span>
<span id="cb21-290"><a href="#cb21-290" aria-hidden="true" tabindex="-1"></a><span class="in">            n_Event = sum(Event_renegotiation)  </span></span>
<span id="cb21-291"><a href="#cb21-291" aria-hidden="true" tabindex="-1"></a><span class="in">            ) %&gt;% # count the number of each types </span></span>
<span id="cb21-292"><a href="#cb21-292" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb21-293"><a href="#cb21-293" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(percentage_n = (n / sum(n))) %&gt;% </span></span>
<span id="cb21-294"><a href="#cb21-294" aria-hidden="true" tabindex="-1"></a><span class="in">  gt() %&gt;% </span></span>
<span id="cb21-295"><a href="#cb21-295" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_header(title = "Table 2b: WRDS DealScan Deal-Tranche Level Loan Events", </span></span>
<span id="cb21-296"><a href="#cb21-296" aria-hidden="true" tabindex="-1"></a><span class="in">             subtitle = "Subgroup: `Tranche_O_A` = Amendment(s)"</span></span>
<span id="cb21-297"><a href="#cb21-297" aria-hidden="true" tabindex="-1"></a><span class="in">             ) %&gt;% </span></span>
<span id="cb21-298"><a href="#cb21-298" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_options(table.font.size = 11, heading.align = 'left' ) %&gt;% </span></span>
<span id="cb21-299"><a href="#cb21-299" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_style( # update the font size for table cells. </span></span>
<span id="cb21-300"><a href="#cb21-300" aria-hidden="true" tabindex="-1"></a><span class="in">    style = cell_text(size = px(11)),</span></span>
<span id="cb21-301"><a href="#cb21-301" aria-hidden="true" tabindex="-1"></a><span class="in">    locations = cells_body()</span></span>
<span id="cb21-302"><a href="#cb21-302" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb21-303"><a href="#cb21-303" aria-hidden="true" tabindex="-1"></a><span class="in">  fmt_percent(columns = percentage_n, decimals = 2)</span></span>
<span id="cb21-304"><a href="#cb21-304" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-305"><a href="#cb21-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-306"><a href="#cb21-306" aria-hidden="true" tabindex="-1"></a>Now we merge the DealScan deal-tranche information with the link table and try to extract the loan path. To facilitate data analysis, I create a new variable &lt;b&gt;<span class="in">`obs_id`</span>&lt;/b&gt;, which is the id for each observation in the dataset, and will be used as the sole identifier in subsequent data mergers.</span>
<span id="cb21-307"><a href="#cb21-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-308"><a href="#cb21-308" aria-hidden="true" tabindex="-1"></a>Also, I create a new firm-deal level identifier <span class="in">`firm_deal_id`</span> to facilitate the data cleaning process. Note that this is more of a &lt;u&gt;"firm-deal-time id"&lt;/u&gt;.</span>
<span id="cb21-309"><a href="#cb21-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-310"><a href="#cb21-310" aria-hidden="true" tabindex="-1"></a><span class="in">```{r loan_path2, echo=TRUE, results='asis', warning=FALSE}</span></span>
<span id="cb21-311"><a href="#cb21-311" aria-hidden="true" tabindex="-1"></a><span class="in"># merge the deal/tranche information with the link table. </span></span>
<span id="cb21-312"><a href="#cb21-312" aria-hidden="true" tabindex="-1"></a><span class="in">### direct merge creates the issue of multiple-to-multiple matching. &gt; solve this issue by matching at the deal, not tranche, level. </span></span>
<span id="cb21-313"><a href="#cb21-313" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_borrower_Linked &lt;- dt.DealScan_borrower %&gt;% </span></span>
<span id="cb21-314"><a href="#cb21-314" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(distinct(select(dt.Link_table, -c("facilityid", contains("ticker")))), # collect deal-level </span></span>
<span id="cb21-315"><a href="#cb21-315" aria-hidden="true" tabindex="-1"></a><span class="in">            by = join_by(Borrower_Id == `LoanConnector Company ID`,</span></span>
<span id="cb21-316"><a href="#cb21-316" aria-hidden="true" tabindex="-1"></a><span class="in">                         Tranche_Active_Date == facilitystartdate) )</span></span>
<span id="cb21-317"><a href="#cb21-317" aria-hidden="true" tabindex="-1"></a><span class="in"># dt.DealScan_borrower_Linked %&gt;% filter(Borrower_Id == 17400)</span></span>
<span id="cb21-318"><a href="#cb21-318" aria-hidden="true" tabindex="-1"></a><span class="in"># dt.DealScan_borrower_Linked %&gt;% filter(gvkey_group1 == 9721) </span></span>
<span id="cb21-319"><a href="#cb21-319" aria-hidden="true" tabindex="-1"></a><span class="in"># names(dt.DealScan_borrower_Linked) </span></span>
<span id="cb21-320"><a href="#cb21-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-321"><a href="#cb21-321" aria-hidden="true" tabindex="-1"></a><span class="in"># firm-deal-tranche-time level data </span></span>
<span id="cb21-322"><a href="#cb21-322" aria-hidden="true" tabindex="-1"></a><span class="in">cat("I use the self-created `gvkey_group1` variable as the unique company identifer. Observations are at the firm-deal-tranche-time level.") </span></span>
<span id="cb21-323"><a href="#cb21-323" aria-hidden="true" tabindex="-1"></a><span class="in"># dt.DealScan_borrower_unifirm &lt;- </span></span>
<span id="cb21-324"><a href="#cb21-324" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_uniborrower &lt;- </span></span>
<span id="cb21-325"><a href="#cb21-325" aria-hidden="true" tabindex="-1"></a><span class="in">  dt.DealScan_borrower_Linked %&gt;% </span></span>
<span id="cb21-326"><a href="#cb21-326" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(gvkey_group1) %&gt;% # for each unique firm over the life-cycle </span></span>
<span id="cb21-327"><a href="#cb21-327" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(Tranche_Active_Date) %&gt;%  # %&gt;% # arrange by its tranche active date </span></span>
<span id="cb21-328"><a href="#cb21-328" aria-hidden="true" tabindex="-1"></a><span class="in">  rowid_to_column(var = "obs_id") %&gt;% # a new id for each observation in the data </span></span>
<span id="cb21-329"><a href="#cb21-329" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb21-330"><a href="#cb21-330" aria-hidden="true" tabindex="-1"></a><span class="in">    # a. use LPC flags to identify renegotiations *** </span></span>
<span id="cb21-331"><a href="#cb21-331" aria-hidden="true" tabindex="-1"></a><span class="in">    # create the amendment flag based on `Tranche_O_A` and `Deal_Amended` or `Deal_Refinancing` information: </span></span>
<span id="cb21-332"><a href="#cb21-332" aria-hidden="true" tabindex="-1"></a><span class="in">    flag_renegotiation = ifelse(</span></span>
<span id="cb21-333"><a href="#cb21-333" aria-hidden="true" tabindex="-1"></a><span class="in">      # the selection criterion: Deal_Refinancing == "Yes" might need further examinations.</span></span>
<span id="cb21-334"><a href="#cb21-334" aria-hidden="true" tabindex="-1"></a><span class="in">      grepl(pattern = "Amendment", x = Tranche_O_A, fixed = T) |</span></span>
<span id="cb21-335"><a href="#cb21-335" aria-hidden="true" tabindex="-1"></a><span class="in">        (!grepl(pattern = "Amendment", x = Tranche_O_A, fixed = T) &amp; </span></span>
<span id="cb21-336"><a href="#cb21-336" aria-hidden="true" tabindex="-1"></a><span class="in">           (Deal_Amended == "Yes" | Deal_Refinancing == "Yes") ), </span></span>
<span id="cb21-337"><a href="#cb21-337" aria-hidden="true" tabindex="-1"></a><span class="in">      yes = TRUE, no = FALSE </span></span>
<span id="cb21-338"><a href="#cb21-338" aria-hidden="true" tabindex="-1"></a><span class="in">    ), </span></span>
<span id="cb21-339"><a href="#cb21-339" aria-hidden="true" tabindex="-1"></a><span class="in">    # b. separate the origination/amendment from `Tranche_O_A`</span></span>
<span id="cb21-340"><a href="#cb21-340" aria-hidden="true" tabindex="-1"></a><span class="in">    Orig_Yes = ifelse(grepl(pattern = "Orig", x = Tranche_O_A), </span></span>
<span id="cb21-341"><a href="#cb21-341" aria-hidden="true" tabindex="-1"></a><span class="in">                           "`Tranche_O_A` = Origination", </span></span>
<span id="cb21-342"><a href="#cb21-342" aria-hidden="true" tabindex="-1"></a><span class="in">                           "`Tranche_O_A` = Amendment")</span></span>
<span id="cb21-343"><a href="#cb21-343" aria-hidden="true" tabindex="-1"></a><span class="in">  ) </span></span>
<span id="cb21-344"><a href="#cb21-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-345"><a href="#cb21-345" aria-hidden="true" tabindex="-1"></a><span class="in"># plot the distribution of firms with the number of observations in the sample </span></span>
<span id="cb21-346"><a href="#cb21-346" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_uniborrower %&gt;% # group firms by the `gvkey_group1` variable </span></span>
<span id="cb21-347"><a href="#cb21-347" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(n = n()) %&gt;% # number of observations for each firm</span></span>
<span id="cb21-348"><a href="#cb21-348" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb21-349"><a href="#cb21-349" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(., ) + geom_bar(aes(n)) +  # + scale_y_continuous(transform = "log10")</span></span>
<span id="cb21-350"><a href="#cb21-350" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Distribution of Loan Observations for Firms", </span></span>
<span id="cb21-351"><a href="#cb21-351" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "restricted to max 100 observations") + </span></span>
<span id="cb21-352"><a href="#cb21-352" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(limits = c(0, 100)) </span></span>
<span id="cb21-353"><a href="#cb21-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-354"><a href="#cb21-354" aria-hidden="true" tabindex="-1"></a><span class="in"># ======================================================================== (July 3, 2024) </span></span>
<span id="cb21-355"><a href="#cb21-355" aria-hidden="true" tabindex="-1"></a><span class="in">## Look into the file &gt; "dealscan_loan_path_test.R" </span></span>
<span id="cb21-356"><a href="#cb21-356" aria-hidden="true" tabindex="-1"></a><span class="in"># analyse at the firm-deal-time level (not tranche level) &gt; always for the same firm</span></span>
<span id="cb21-357"><a href="#cb21-357" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_uniborrower_deal &lt;- </span></span>
<span id="cb21-358"><a href="#cb21-358" aria-hidden="true" tabindex="-1"></a><span class="in">  dt.DealScan_uniborrower %&gt;% # grouped by `gvkey_group1` -&gt; </span></span>
<span id="cb21-359"><a href="#cb21-359" aria-hidden="true" tabindex="-1"></a><span class="in">  # as if the deal is just amended/refinaced, `LPC_Deal_ID` won't be updated. -&gt; </span></span>
<span id="cb21-360"><a href="#cb21-360" aria-hidden="true" tabindex="-1"></a><span class="in">  # in other words, all loans from the same firm/borrower a, recorded under the same deal i, at date `Tranche_Active_Date` </span></span>
<span id="cb21-361"><a href="#cb21-361" aria-hidden="true" tabindex="-1"></a><span class="in">  # will be considered under the same unique `package`. </span></span>
<span id="cb21-362"><a href="#cb21-362" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(Tranche_Active_Date, LPC_Deal_ID, .add = T) %&gt;% # group at the firm-deal-time level </span></span>
<span id="cb21-363"><a href="#cb21-363" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(</span></span>
<span id="cb21-364"><a href="#cb21-364" aria-hidden="true" tabindex="-1"></a><span class="in">    # 1. Aggregated Tranche Level Info: </span></span>
<span id="cb21-365"><a href="#cb21-365" aria-hidden="true" tabindex="-1"></a><span class="in">    Tranche_Info = list(</span></span>
<span id="cb21-366"><a href="#cb21-366" aria-hidden="true" tabindex="-1"></a><span class="in">      distinct(</span></span>
<span id="cb21-367"><a href="#cb21-367" aria-hidden="true" tabindex="-1"></a><span class="in">        data.frame(</span></span>
<span id="cb21-368"><a href="#cb21-368" aria-hidden="true" tabindex="-1"></a><span class="in">          # a. store `LPC_Tranche_ID` information </span></span>
<span id="cb21-369"><a href="#cb21-369" aria-hidden="true" tabindex="-1"></a><span class="in">          Deal_Tranche_IDs = LPC_Tranche_ID, </span></span>
<span id="cb21-370"><a href="#cb21-370" aria-hidden="true" tabindex="-1"></a><span class="in">          # b. store `Tranche_Type` information </span></span>
<span id="cb21-371"><a href="#cb21-371" aria-hidden="true" tabindex="-1"></a><span class="in">          Tranche_Types = Tranche_Type, </span></span>
<span id="cb21-372"><a href="#cb21-372" aria-hidden="true" tabindex="-1"></a><span class="in">          # c. store `All_Remark` information </span></span>
<span id="cb21-373"><a href="#cb21-373" aria-hidden="true" tabindex="-1"></a><span class="in">          All_Remarks = All_Remark </span></span>
<span id="cb21-374"><a href="#cb21-374" aria-hidden="true" tabindex="-1"></a><span class="in">        ) </span></span>
<span id="cb21-375"><a href="#cb21-375" aria-hidden="true" tabindex="-1"></a><span class="in">      ) ## only keeps the unique loan information to remove potential repetition from previous "join" actions. </span></span>
<span id="cb21-376"><a href="#cb21-376" aria-hidden="true" tabindex="-1"></a><span class="in">    ), ## filter out information &gt; rowwise(): This function is used to perform operations row by row. </span></span>
<span id="cb21-377"><a href="#cb21-377" aria-hidden="true" tabindex="-1"></a><span class="in">    # 2. Collect renegotiation flags: </span></span>
<span id="cb21-378"><a href="#cb21-378" aria-hidden="true" tabindex="-1"></a><span class="in">    flag_renegotiation = any(flag_renegotiation), ## check whether contain TRUE! </span></span>
<span id="cb21-379"><a href="#cb21-379" aria-hidden="true" tabindex="-1"></a><span class="in">    Event_renegotiation = any(Event_renegotiation), </span></span>
<span id="cb21-380"><a href="#cb21-380" aria-hidden="true" tabindex="-1"></a><span class="in">    Event_all = list(</span></span>
<span id="cb21-381"><a href="#cb21-381" aria-hidden="true" tabindex="-1"></a><span class="in">      data.frame(</span></span>
<span id="cb21-382"><a href="#cb21-382" aria-hidden="true" tabindex="-1"></a><span class="in">        Event_amend = any(Event_amend), </span></span>
<span id="cb21-383"><a href="#cb21-383" aria-hidden="true" tabindex="-1"></a><span class="in">        Event_restate = any(Event_restate), </span></span>
<span id="cb21-384"><a href="#cb21-384" aria-hidden="true" tabindex="-1"></a><span class="in">        Event_refin = any(Event_refin) </span></span>
<span id="cb21-385"><a href="#cb21-385" aria-hidden="true" tabindex="-1"></a><span class="in">      ) ## record the detail of all `Events` extracted from `All_Remark`!!!  </span></span>
<span id="cb21-386"><a href="#cb21-386" aria-hidden="true" tabindex="-1"></a><span class="in">    ), </span></span>
<span id="cb21-387"><a href="#cb21-387" aria-hidden="true" tabindex="-1"></a><span class="in">    Orig_Yes = unique(Orig_Yes)</span></span>
<span id="cb21-388"><a href="#cb21-388" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb21-389"><a href="#cb21-389" aria-hidden="true" tabindex="-1"></a><span class="in">  # sort by the tranche observation time within each firm </span></span>
<span id="cb21-390"><a href="#cb21-390" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(gvkey_group1, Tranche_Active_Date) %&gt;% </span></span>
<span id="cb21-391"><a href="#cb21-391" aria-hidden="true" tabindex="-1"></a><span class="in">  # this dataset creates a unique profile/package for firm-deal-time observation. </span></span>
<span id="cb21-392"><a href="#cb21-392" aria-hidden="true" tabindex="-1"></a><span class="in">  rowid_to_column(var = "deal_time_id") %&gt;% # create a new id for each observation in the data - at the `firm-deal-tim level` </span></span>
<span id="cb21-393"><a href="#cb21-393" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb21-394"><a href="#cb21-394" aria-hidden="true" tabindex="-1"></a><span class="in"># now for each deal-time observation, </span></span>
<span id="cb21-395"><a href="#cb21-395" aria-hidden="true" tabindex="-1"></a><span class="in"># dt.DealScan_uniborrower_deal %&gt;% head(50) %&gt;% tail(10) %&gt;% unnest_wider(col = Tranche_Info)</span></span>
<span id="cb21-396"><a href="#cb21-396" aria-hidden="true" tabindex="-1"></a><span class="in"># dt.check &lt;- dt.DealScan_uniborrower_deal %&gt;% </span></span>
<span id="cb21-397"><a href="#cb21-397" aria-hidden="true" tabindex="-1"></a><span class="in">  unnest_wider(col = Tranche_Info) %&gt;% # split the three columns in the `Tranche_Info`. </span></span>
<span id="cb21-398"><a href="#cb21-398" aria-hidden="true" tabindex="-1"></a><span class="in">  rowwise() %&gt;% ## perform function on each row </span></span>
<span id="cb21-399"><a href="#cb21-399" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb21-400"><a href="#cb21-400" aria-hidden="true" tabindex="-1"></a><span class="in">    # linked information from the `All_Remark`: </span></span>
<span id="cb21-401"><a href="#cb21-401" aria-hidden="true" tabindex="-1"></a><span class="in">    linkedinfo_Remark = list((</span></span>
<span id="cb21-402"><a href="#cb21-402" aria-hidden="true" tabindex="-1"></a><span class="in">      str_sentence_extract(str = (All_Remarks), </span></span>
<span id="cb21-403"><a href="#cb21-403" aria-hidden="true" tabindex="-1"></a><span class="in">                           pattern_sentence = "(?&lt;=(\\.|\\?|!))\\s{1,}(?=[A-Z])|&lt;br&gt;", </span></span>
<span id="cb21-404"><a href="#cb21-404" aria-hidden="true" tabindex="-1"></a><span class="in">                           pattern_text = "amend|restat|refinan" ) </span></span>
<span id="cb21-405"><a href="#cb21-405" aria-hidden="true" tabindex="-1"></a><span class="in">    ))</span></span>
<span id="cb21-406"><a href="#cb21-406" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb21-407"><a href="#cb21-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-408"><a href="#cb21-408" aria-hidden="true" tabindex="-1"></a><span class="in"># ======================================================================== (July 3, 2024) </span></span>
<span id="cb21-409"><a href="#cb21-409" aria-hidden="true" tabindex="-1"></a><span class="in"># Firm a, Deal i, Tranche j, at Time t. </span></span>
<span id="cb21-410"><a href="#cb21-410" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_uniborrower_aijt &lt;- dt.DealScan_uniborrower_deal %&gt;% # firm a, deal i, tranche j, at time t.  </span></span>
<span id="cb21-411"><a href="#cb21-411" aria-hidden="true" tabindex="-1"></a><span class="in">  # extract all unique date information </span></span>
<span id="cb21-412"><a href="#cb21-412" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(linked_record_time = str_date_extract(str = linkedinfo_Remark,</span></span>
<span id="cb21-413"><a href="#cb21-413" aria-hidden="true" tabindex="-1"></a><span class="in">                                               date_format = "\\d+/\\d+/\\d+") ) %&gt;% </span></span>
<span id="cb21-414"><a href="#cb21-414" aria-hidden="true" tabindex="-1"></a><span class="in">  # break into different rows </span></span>
<span id="cb21-415"><a href="#cb21-415" aria-hidden="true" tabindex="-1"></a><span class="in">  separate_rows(linked_record_time, sep = ";") %&gt;% </span></span>
<span id="cb21-416"><a href="#cb21-416" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct() %&gt;% </span></span>
<span id="cb21-417"><a href="#cb21-417" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(related_time = as.Date(x = linked_record_time, format = "%m/%d/%y"), </span></span>
<span id="cb21-418"><a href="#cb21-418" aria-hidden="true" tabindex="-1"></a><span class="in">         time_low = related_time - 15, </span></span>
<span id="cb21-419"><a href="#cb21-419" aria-hidden="true" tabindex="-1"></a><span class="in">         time_high = related_time + 15 # the upper and lower limit for the deal time to match</span></span>
<span id="cb21-420"><a href="#cb21-420" aria-hidden="true" tabindex="-1"></a><span class="in">         ) %&gt;% </span></span>
<span id="cb21-421"><a href="#cb21-421" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(related_time) &amp; !is.na(gvkey_group1)) %&gt;% </span></span>
<span id="cb21-422"><a href="#cb21-422" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter out those linked to its own (e.g. gvkey_group1 == 2933 -&gt; deal_time_id = 24170)</span></span>
<span id="cb21-423"><a href="#cb21-423" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(Tranche_Active_Date != related_time) %&gt;% </span></span>
<span id="cb21-424"><a href="#cb21-424" aria-hidden="true" tabindex="-1"></a><span class="in">  select(Linked_deal_time_id = deal_time_id, # linked to a specific deal-time id </span></span>
<span id="cb21-425"><a href="#cb21-425" aria-hidden="true" tabindex="-1"></a><span class="in">         gvkey_group1, # join identifier </span></span>
<span id="cb21-426"><a href="#cb21-426" aria-hidden="true" tabindex="-1"></a><span class="in">         Linked_Tranche_Active_Date = Tranche_Active_Date, </span></span>
<span id="cb21-427"><a href="#cb21-427" aria-hidden="true" tabindex="-1"></a><span class="in">         Linked_LPC_Deal_ID = LPC_Deal_ID, </span></span>
<span id="cb21-428"><a href="#cb21-428" aria-hidden="true" tabindex="-1"></a><span class="in">         related_time, time_low, time_high) # join identifier </span></span>
<span id="cb21-429"><a href="#cb21-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-430"><a href="#cb21-430" aria-hidden="true" tabindex="-1"></a><span class="in"># link Deal i, Tranche j, at Time t (_ijt) to the deal before and after: </span></span>
<span id="cb21-431"><a href="#cb21-431" aria-hidden="true" tabindex="-1"></a><span class="in">## the join criterion: for the same firm, if its active date is within 15 days. </span></span>
<span id="cb21-432"><a href="#cb21-432" aria-hidden="true" tabindex="-1"></a><span class="in">by_deal_time &lt;- join_by(gvkey_group1,</span></span>
<span id="cb21-433"><a href="#cb21-433" aria-hidden="true" tabindex="-1"></a><span class="in">                        between(Tranche_Active_Date, time_low, time_high))</span></span>
<span id="cb21-434"><a href="#cb21-434" aria-hidden="true" tabindex="-1"></a><span class="in">## make the manual matching: </span></span>
<span id="cb21-435"><a href="#cb21-435" aria-hidden="true" tabindex="-1"></a><span class="in">dt.manual_renegotiation &lt;- dt.DealScan_uniborrower_deal %&gt;% </span></span>
<span id="cb21-436"><a href="#cb21-436" aria-hidden="true" tabindex="-1"></a><span class="in">  # remove firms without `gvkey` </span></span>
<span id="cb21-437"><a href="#cb21-437" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(gvkey_group1)) %&gt;% </span></span>
<span id="cb21-438"><a href="#cb21-438" aria-hidden="true" tabindex="-1"></a><span class="in">  inner_join(dt.DealScan_uniborrower_aijt, by = by_deal_time) %&gt;% </span></span>
<span id="cb21-439"><a href="#cb21-439" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate( # create a new identifier to manually track loan path from `Deal_Remark`: </span></span>
<span id="cb21-440"><a href="#cb21-440" aria-hidden="true" tabindex="-1"></a><span class="in">    ## record the original, unique firm-deal id if the `Linked_Tranche_Active_Date` comes after the `Linked_Tranche_Active_Date`. </span></span>
<span id="cb21-441"><a href="#cb21-441" aria-hidden="true" tabindex="-1"></a><span class="in">    ## and record the linked firm-deal id if otherwise. </span></span>
<span id="cb21-442"><a href="#cb21-442" aria-hidden="true" tabindex="-1"></a><span class="in">    id_before = ifelse(Tranche_Active_Date &lt; Linked_Tranche_Active_Date,</span></span>
<span id="cb21-443"><a href="#cb21-443" aria-hidden="true" tabindex="-1"></a><span class="in">                       yes = deal_time_id, no = Linked_deal_time_id), # the previous id </span></span>
<span id="cb21-444"><a href="#cb21-444" aria-hidden="true" tabindex="-1"></a><span class="in">    id_after = ifelse(Tranche_Active_Date &lt; Linked_Tranche_Active_Date,</span></span>
<span id="cb21-445"><a href="#cb21-445" aria-hidden="true" tabindex="-1"></a><span class="in">                      yes = Linked_deal_time_id, no = deal_time_id), # the id for the deal that linked to `id_before`</span></span>
<span id="cb21-446"><a href="#cb21-446" aria-hidden="true" tabindex="-1"></a><span class="in">    id_loc_linked = ifelse(Tranche_Active_Date &lt; Linked_Tranche_Active_Date,</span></span>
<span id="cb21-447"><a href="#cb21-447" aria-hidden="true" tabindex="-1"></a><span class="in">                      yes = "after", no = "before") # the indicator for which one is the linked ID: if the linked deal time is later, it will be placed in "after" and vice versa. </span></span>
<span id="cb21-448"><a href="#cb21-448" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb21-449"><a href="#cb21-449" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(id_before, id_after) %&gt;% </span></span>
<span id="cb21-450"><a href="#cb21-450" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(n = n()) %&gt;% </span></span>
<span id="cb21-451"><a href="#cb21-451" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() </span></span>
<span id="cb21-452"><a href="#cb21-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-453"><a href="#cb21-453" aria-hidden="true" tabindex="-1"></a><span class="in">### construct a more refined list of matching between firms: </span></span>
<span id="cb21-454"><a href="#cb21-454" aria-hidden="true" tabindex="-1"></a><span class="in">dt.manual_idonly &lt;- dt.manual_renegotiation %&gt;% </span></span>
<span id="cb21-455"><a href="#cb21-455" aria-hidden="true" tabindex="-1"></a><span class="in">  select(id_before, id_after, id_loc_linked, n) %&gt;% </span></span>
<span id="cb21-456"><a href="#cb21-456" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct() %&gt;% </span></span>
<span id="cb21-457"><a href="#cb21-457" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(id_before != id_after) %&gt;% </span></span>
<span id="cb21-458"><a href="#cb21-458" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(id_before, id_after) %&gt;% </span></span>
<span id="cb21-459"><a href="#cb21-459" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(</span></span>
<span id="cb21-460"><a href="#cb21-460" aria-hidden="true" tabindex="-1"></a><span class="in">    loc_linked = sum(id_loc_linked %in% c("before", "after") ), # store all linked info 'after'/'before' </span></span>
<span id="cb21-461"><a href="#cb21-461" aria-hidden="true" tabindex="-1"></a><span class="in">    id_type = ifelse(loc_linked == 2, yes = "twoway", no = "oneway") </span></span>
<span id="cb21-462"><a href="#cb21-462" aria-hidden="true" tabindex="-1"></a><span class="in">    # id_type = </span></span>
<span id="cb21-463"><a href="#cb21-463" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb21-464"><a href="#cb21-464" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() </span></span>
<span id="cb21-465"><a href="#cb21-465" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(id_before == 2260) </span></span>
<span id="cb21-466"><a href="#cb21-466" aria-hidden="true" tabindex="-1"></a><span class="in">  ## "twoway": deals are basically related, although activated at different time. (e.g. deal_time_id = 6 &amp; 7)</span></span>
<span id="cb21-467"><a href="#cb21-467" aria-hidden="true" tabindex="-1"></a><span class="in">  ## "oneway": deals are linked by only one direction, thus a renegotiation. </span></span>
<span id="cb21-468"><a href="#cb21-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-469"><a href="#cb21-469" aria-hidden="true" tabindex="-1"></a><span class="in"># ======================================================================== (July 4, 2024) </span></span>
<span id="cb21-470"><a href="#cb21-470" aria-hidden="true" tabindex="-1"></a><span class="in"># merge the manually identified renegotiated contracts back to the full dataset. </span></span>
<span id="cb21-471"><a href="#cb21-471" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_uniborrower_deal_updated &lt;- </span></span>
<span id="cb21-472"><a href="#cb21-472" aria-hidden="true" tabindex="-1"></a><span class="in">  dt.DealScan_uniborrower_deal %&gt;% </span></span>
<span id="cb21-473"><a href="#cb21-473" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(</span></span>
<span id="cb21-474"><a href="#cb21-474" aria-hidden="true" tabindex="-1"></a><span class="in">    filter(dt.manual_idonly, id_type == "oneway") %&gt;% </span></span>
<span id="cb21-475"><a href="#cb21-475" aria-hidden="true" tabindex="-1"></a><span class="in">      select(id_before, id_after) %&gt;% </span></span>
<span id="cb21-476"><a href="#cb21-476" aria-hidden="true" tabindex="-1"></a><span class="in">      ## createe a matched sample of id(s) to one firm-deal-time observation in the main data === (July 7, 2024)</span></span>
<span id="cb21-477"><a href="#cb21-477" aria-hidden="true" tabindex="-1"></a><span class="in">      group_by(id_after) %&gt;% </span></span>
<span id="cb21-478"><a href="#cb21-478" aria-hidden="true" tabindex="-1"></a><span class="in">      summarise(id_before = list(id_before)) %&gt;% </span></span>
<span id="cb21-479"><a href="#cb21-479" aria-hidden="true" tabindex="-1"></a><span class="in">      ungroup() %&gt;% </span></span>
<span id="cb21-480"><a href="#cb21-480" aria-hidden="true" tabindex="-1"></a><span class="in">      ## add an identifier </span></span>
<span id="cb21-481"><a href="#cb21-481" aria-hidden="true" tabindex="-1"></a><span class="in">      mutate( flag_manual_renegotiation = TRUE ) , </span></span>
<span id="cb21-482"><a href="#cb21-482" aria-hidden="true" tabindex="-1"></a><span class="in">    by = join_by(deal_time_id == id_after) </span></span>
<span id="cb21-483"><a href="#cb21-483" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb21-484"><a href="#cb21-484" aria-hidden="true" tabindex="-1"></a><span class="in">  ## create a more accurate flag </span></span>
<span id="cb21-485"><a href="#cb21-485" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(flag_manual_renegotiation = replace_na(flag_manual_renegotiation, replace = FALSE)) %&gt;% </span></span>
<span id="cb21-486"><a href="#cb21-486" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb21-487"><a href="#cb21-487" aria-hidden="true" tabindex="-1"></a><span class="in">    flag_Renegotiated = (Event_renegotiation | flag_renegotiation | flag_manual_renegotiation)</span></span>
<span id="cb21-488"><a href="#cb21-488" aria-hidden="true" tabindex="-1"></a><span class="in">  ) </span></span>
<span id="cb21-489"><a href="#cb21-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-490"><a href="#cb21-490" aria-hidden="true" tabindex="-1"></a><span class="in">## check the renegotiations </span></span>
<span id="cb21-491"><a href="#cb21-491" aria-hidden="true" tabindex="-1"></a><span class="in"># dt.DealScan_uniborrower_deal_updated %&gt;% select(deal_time_id, gvkey_group1, Tranche_Active_Date, flag_renegotiation, Event_renegotiation, flag_manual_renegotiation, flag_Renegotiated)</span></span>
<span id="cb21-492"><a href="#cb21-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-493"><a href="#cb21-493" aria-hidden="true" tabindex="-1"></a><span class="in"># ======================================================================== (June 19, 2024)</span></span>
<span id="cb21-494"><a href="#cb21-494" aria-hidden="true" tabindex="-1"></a><span class="in"># ========================================================================</span></span>
<span id="cb21-495"><a href="#cb21-495" aria-hidden="true" tabindex="-1"></a><span class="in"># gvkey_group1 == 7089; 1894; 1392</span></span>
<span id="cb21-496"><a href="#cb21-496" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-497"><a href="#cb21-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-498"><a href="#cb21-498" aria-hidden="true" tabindex="-1"></a>::: {#wrn-loan-path2 .callout-warning .column-margin}</span>
<span id="cb21-499"><a href="#cb21-499" aria-hidden="true" tabindex="-1"></a><span class="fu">## Identify Loan Renegotiations!</span></span>
<span id="cb21-500"><a href="#cb21-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-501"><a href="#cb21-501" aria-hidden="true" tabindex="-1"></a>In newly generated data <span class="in">`dt.DealScan_uniborrower_deal`</span>, the criterion to generate the new variable <span class="in">`flag_renegotiation`</span> might need more detailed examination. This variable is created to detect whether an amendment happens, even when the <span class="in">`Tranch_O_A`</span> variable gives <span class="in">`"Origination"`</span>.</span>
<span id="cb21-502"><a href="#cb21-502" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb21-503"><a href="#cb21-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-504"><a href="#cb21-504" aria-hidden="true" tabindex="-1"></a>Here is a summary table showing the mapping between the amendment/refinancing flags and the <span class="in">`flag_renegotiated`</span> I created for the firm-deal-time level dataset - <span class="in">`dt.DealScan_uniborrower_deal_updated`</span>.</span>
<span id="cb21-505"><a href="#cb21-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-506"><a href="#cb21-506" aria-hidden="true" tabindex="-1"></a><span class="in">```{r flag_renegotiation_group1, echo=TRUE, message=FALSE, warning=FALSE}</span></span>
<span id="cb21-507"><a href="#cb21-507" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: body</span></span>
<span id="cb21-508"><a href="#cb21-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-509"><a href="#cb21-509" aria-hidden="true" tabindex="-1"></a><span class="in"># to identify different types of contracts which are defined as "Origination".</span></span>
<span id="cb21-510"><a href="#cb21-510" aria-hidden="true" tabindex="-1"></a><span class="in">## for all observations - both public and private. </span></span>
<span id="cb21-511"><a href="#cb21-511" aria-hidden="true" tabindex="-1"></a><span class="in">dt.flg_Rng &lt;- dt.DealScan_uniborrower_deal_updated %&gt;% </span></span>
<span id="cb21-512"><a href="#cb21-512" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(!is.na(gvkey_group1)) %&gt;% </span></span>
<span id="cb21-513"><a href="#cb21-513" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(Orig_Yes, </span></span>
<span id="cb21-514"><a href="#cb21-514" aria-hidden="true" tabindex="-1"></a><span class="in">           flag_renegotiation, Event_renegotiation, flag_manual_renegotiation, </span></span>
<span id="cb21-515"><a href="#cb21-515" aria-hidden="true" tabindex="-1"></a><span class="in">           flag_Renegotiated) %&gt;% </span></span>
<span id="cb21-516"><a href="#cb21-516" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(n = n() # ,</span></span>
<span id="cb21-517"><a href="#cb21-517" aria-hidden="true" tabindex="-1"></a><span class="in">            # RngYes = unique(flag_Renegotiated) # for the renegotiation identifier. </span></span>
<span id="cb21-518"><a href="#cb21-518" aria-hidden="true" tabindex="-1"></a><span class="in">            ) %&gt;% # count the number of each types </span></span>
<span id="cb21-519"><a href="#cb21-519" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb21-520"><a href="#cb21-520" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(percentage_n = (n / sum(n))) </span></span>
<span id="cb21-521"><a href="#cb21-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-522"><a href="#cb21-522" aria-hidden="true" tabindex="-1"></a><span class="in">dt.flg_Rng %&gt;% </span></span>
<span id="cb21-523"><a href="#cb21-523" aria-hidden="true" tabindex="-1"></a><span class="in">  gt(groupname_col = "Orig_Yes") %&gt;% </span></span>
<span id="cb21-524"><a href="#cb21-524" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_header(title = "Table 3b: WRDS DealScan Deal-Time Level Loan Events", </span></span>
<span id="cb21-525"><a href="#cb21-525" aria-hidden="true" tabindex="-1"></a><span class="in">             subtitle = html("A summary statistics to show the results of my identifier: `flag_renegotiated`.&lt;br&gt;</span></span>
<span id="cb21-526"><a href="#cb21-526" aria-hidden="true" tabindex="-1"></a><span class="in">                           All firm-deal-time observations &lt;u&gt;are from the full sample&lt;/u&gt;, including both public and private firms.")</span></span>
<span id="cb21-527"><a href="#cb21-527" aria-hidden="true" tabindex="-1"></a><span class="in">             ) %&gt;% </span></span>
<span id="cb21-528"><a href="#cb21-528" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_options(table.font.size = 11, heading.align = 'left' ) %&gt;% </span></span>
<span id="cb21-529"><a href="#cb21-529" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_style( # update the font size for table cells. </span></span>
<span id="cb21-530"><a href="#cb21-530" aria-hidden="true" tabindex="-1"></a><span class="in">    style = cell_text(size = px(11)),</span></span>
<span id="cb21-531"><a href="#cb21-531" aria-hidden="true" tabindex="-1"></a><span class="in">    locations = cells_body()</span></span>
<span id="cb21-532"><a href="#cb21-532" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb21-533"><a href="#cb21-533" aria-hidden="true" tabindex="-1"></a><span class="in">  fmt_percent(columns = percentage_n, decimals = 2)  </span></span>
<span id="cb21-534"><a href="#cb21-534" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-535"><a href="#cb21-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-536"><a href="#cb21-536" aria-hidden="true" tabindex="-1"></a>One additional thing to note is to check refinancing deals in the data. One way to &lt;b&gt;distinguish between refinancing b/c previous loans mature &lt;mark&gt;and refinancing b/c other reasons&lt;/mark&gt;&lt;/b&gt;, &lt;u&gt;which is classified as renegotiation in my analysis&lt;/u&gt;.</span>
<span id="cb21-537"><a href="#cb21-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-538"><a href="#cb21-538" aria-hidden="true" tabindex="-1"></a><span class="fu">## S4. Clean the loan renegotiation data</span></span>
<span id="cb21-539"><a href="#cb21-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-540"><a href="#cb21-540" aria-hidden="true" tabindex="-1"></a>Then, I will create a more detailed <span class="in">`flag_Renegotiated`</span> variable in the dataset to more thoroughly cover all renegotiations at the firm-deal level.</span>
<span id="cb21-541"><a href="#cb21-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-542"><a href="#cb21-542" aria-hidden="true" tabindex="-1"></a>A recap about the definition of different renegotiation flags:</span>
<span id="cb21-543"><a href="#cb21-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-544"><a href="#cb21-544" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`flag_renegotiation`</span>: detected renegotiations based on the amendment/refinancing/<span class="sc">\_</span>O_A flags in DealScan.</span>
<span id="cb21-545"><a href="#cb21-545" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`Event_renegotiation`</span>: word detection in the variable <span class="in">`Deal_Remark`</span>.</span>
<span id="cb21-546"><a href="#cb21-546" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`flag_manual_renegotiation`</span>: manually matched renegotiated deals based on <span class="in">`Deal_Remark`</span>.</span>
<span id="cb21-547"><a href="#cb21-547" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`flag_Renegotiated`</span>: a more refined flag for renegotiations.</span>
<span id="cb21-548"><a href="#cb21-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-549"><a href="#cb21-549" aria-hidden="true" tabindex="-1"></a>::: {#wrn-loan-path3 .callout-warning .column-margin}</span>
<span id="cb21-550"><a href="#cb21-550" aria-hidden="true" tabindex="-1"></a><span class="fu">## Still! A lot of renegotiations are missing.</span></span>
<span id="cb21-551"><a href="#cb21-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-552"><a href="#cb21-552" aria-hidden="true" tabindex="-1"></a>For company <span class="co">[</span><span class="ot">COLORADO INTERSTATE GAS COMPANY, L.L.C.</span><span class="co">](2015https://www.sec.gov/Archives/edgar/data/200155/000020015515000003/0000200155-15-000003.txt)</span>, it is previously known as "COLORADO INTERSTATE CORP" (ex 1976/01/19) and "COLORADO INTERSTATE GAS CO" (ex 1992/07/03) and was subsequently potentially (?) merged with KINDER MORGAN, INC, in maybe 2014. The firm is a subsidiary of El Paso Corporation (NYSE: EP).</span>
<span id="cb21-553"><a href="#cb21-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-554"><a href="#cb21-554" aria-hidden="true" tabindex="-1"></a>Even with these, there are still a lot of missing amendment/restatements in the DealScan. E.g. this <span class="co">[</span><span class="ot">8-K</span><span class="co">](https://www.sec.gov/edgar/search/#exhibit99a.htm)</span>. However, this issue may come from the missing family-subsidiary connections and I need to rebuild this.</span>
<span id="cb21-555"><a href="#cb21-555" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb21-556"><a href="#cb21-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-557"><a href="#cb21-557" aria-hidden="true" tabindex="-1"></a>Here is a summary on the <span class="in">`flag_Renegotiated`</span>: </span>
<span id="cb21-558"><a href="#cb21-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-559"><a href="#cb21-559" aria-hidden="true" tabindex="-1"></a><span class="in">```{r flag_renegotiation_group2, echo=TRUE, message=FALSE, warning=FALSE}</span></span>
<span id="cb21-560"><a href="#cb21-560" aria-hidden="true" tabindex="-1"></a><span class="in">#| column: page</span></span>
<span id="cb21-561"><a href="#cb21-561" aria-hidden="true" tabindex="-1"></a><span class="in">#| layout-nrow: 1</span></span>
<span id="cb21-562"><a href="#cb21-562" aria-hidden="true" tabindex="-1"></a><span class="in">#| layout-ncol: 2</span></span>
<span id="cb21-563"><a href="#cb21-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-564"><a href="#cb21-564" aria-hidden="true" tabindex="-1"></a><span class="in"># to identify different types of contracts which are defined as "Origination".</span></span>
<span id="cb21-565"><a href="#cb21-565" aria-hidden="true" tabindex="-1"></a><span class="in">## for all observations - both public and private. </span></span>
<span id="cb21-566"><a href="#cb21-566" aria-hidden="true" tabindex="-1"></a><span class="in">dt.flg_Rng_summary &lt;- dt.DealScan_uniborrower_deal_updated %&gt;% </span></span>
<span id="cb21-567"><a href="#cb21-567" aria-hidden="true" tabindex="-1"></a><span class="in">  # filter(!is.na(gvkey_group1)) %&gt;% </span></span>
<span id="cb21-568"><a href="#cb21-568" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(Orig_Yes) %&gt;% </span></span>
<span id="cb21-569"><a href="#cb21-569" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(n = n(), </span></span>
<span id="cb21-570"><a href="#cb21-570" aria-hidden="true" tabindex="-1"></a><span class="in">            n_RngYes = sum(flag_Renegotiated == TRUE), </span></span>
<span id="cb21-571"><a href="#cb21-571" aria-hidden="true" tabindex="-1"></a><span class="in">            n_RngNo = sum(flag_Renegotiated == FALSE), </span></span>
<span id="cb21-572"><a href="#cb21-572" aria-hidden="true" tabindex="-1"></a><span class="in">            ) %&gt;% # count the number of each types </span></span>
<span id="cb21-573"><a href="#cb21-573" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb21-574"><a href="#cb21-574" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(percentage_n = (n / sum(n))) </span></span>
<span id="cb21-575"><a href="#cb21-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-576"><a href="#cb21-576" aria-hidden="true" tabindex="-1"></a><span class="in">dt.flg_Rng_summary %&gt;% </span></span>
<span id="cb21-577"><a href="#cb21-577" aria-hidden="true" tabindex="-1"></a><span class="in">  gt(groupname_col = "Orig_Yes") %&gt;% </span></span>
<span id="cb21-578"><a href="#cb21-578" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_header(title = "Table 3: WRDS DealScan Deal-Time Level Loan Events", </span></span>
<span id="cb21-579"><a href="#cb21-579" aria-hidden="true" tabindex="-1"></a><span class="in">             subtitle = html("A summary statistics to show the results of my identifier: `flag_renegotiated`.&lt;br&gt; All firm-deal-time observations &lt;u&gt;are from the full sample&lt;/u&gt;, including both public and private firms.") </span></span>
<span id="cb21-580"><a href="#cb21-580" aria-hidden="true" tabindex="-1"></a><span class="in">             ) %&gt;% </span></span>
<span id="cb21-581"><a href="#cb21-581" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_options(table.font.size = 11, heading.align = 'left' ) %&gt;% </span></span>
<span id="cb21-582"><a href="#cb21-582" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_style( # update the font size for table cells. </span></span>
<span id="cb21-583"><a href="#cb21-583" aria-hidden="true" tabindex="-1"></a><span class="in">    style = cell_text(size = px(11)),</span></span>
<span id="cb21-584"><a href="#cb21-584" aria-hidden="true" tabindex="-1"></a><span class="in">    locations = cells_body()</span></span>
<span id="cb21-585"><a href="#cb21-585" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb21-586"><a href="#cb21-586" aria-hidden="true" tabindex="-1"></a><span class="in">  fmt_percent(columns = percentage_n, decimals = 2)  </span></span>
<span id="cb21-587"><a href="#cb21-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-588"><a href="#cb21-588" aria-hidden="true" tabindex="-1"></a><span class="in">## for public firms only - with a valid GVKEY &amp; gvkey_group1 identifier. </span></span>
<span id="cb21-589"><a href="#cb21-589" aria-hidden="true" tabindex="-1"></a><span class="in">dt.flg_Rng_summary_publiconly &lt;- dt.DealScan_uniborrower_deal_updated %&gt;% </span></span>
<span id="cb21-590"><a href="#cb21-590" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(gvkey_group1)) %&gt;%</span></span>
<span id="cb21-591"><a href="#cb21-591" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(Orig_Yes) %&gt;% </span></span>
<span id="cb21-592"><a href="#cb21-592" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(n = n(), </span></span>
<span id="cb21-593"><a href="#cb21-593" aria-hidden="true" tabindex="-1"></a><span class="in">            n_RngYes = sum(flag_Renegotiated == TRUE), </span></span>
<span id="cb21-594"><a href="#cb21-594" aria-hidden="true" tabindex="-1"></a><span class="in">            n_RngNo = sum(flag_Renegotiated == FALSE), </span></span>
<span id="cb21-595"><a href="#cb21-595" aria-hidden="true" tabindex="-1"></a><span class="in">            ) %&gt;% # count the number of each types </span></span>
<span id="cb21-596"><a href="#cb21-596" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb21-597"><a href="#cb21-597" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(percentage_n = (n / sum(n))) </span></span>
<span id="cb21-598"><a href="#cb21-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-599"><a href="#cb21-599" aria-hidden="true" tabindex="-1"></a><span class="in">dt.flg_Rng_summary_publiconly %&gt;% </span></span>
<span id="cb21-600"><a href="#cb21-600" aria-hidden="true" tabindex="-1"></a><span class="in">  gt(groupname_col = "Orig_Yes") %&gt;% </span></span>
<span id="cb21-601"><a href="#cb21-601" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_header(title = "Table 3b: WRDS DealScan Deal-Time Level Loan Events", </span></span>
<span id="cb21-602"><a href="#cb21-602" aria-hidden="true" tabindex="-1"></a><span class="in">             subtitle = html("A summary statistics to show the results of my identifier: `flag_renegotiated`.&lt;br&gt;</span></span>
<span id="cb21-603"><a href="#cb21-603" aria-hidden="true" tabindex="-1"></a><span class="in">                           Firm-deal-time observations &lt;u&gt;are for public firms only&lt;/u&gt;, i.e. with a valid GVKEY.")</span></span>
<span id="cb21-604"><a href="#cb21-604" aria-hidden="true" tabindex="-1"></a><span class="in">             ) %&gt;% </span></span>
<span id="cb21-605"><a href="#cb21-605" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_options(table.font.size = 11, heading.align = 'left' ) %&gt;% </span></span>
<span id="cb21-606"><a href="#cb21-606" aria-hidden="true" tabindex="-1"></a><span class="in">  tab_style( # update the font size for table cells. </span></span>
<span id="cb21-607"><a href="#cb21-607" aria-hidden="true" tabindex="-1"></a><span class="in">    style = cell_text(size = px(11)),</span></span>
<span id="cb21-608"><a href="#cb21-608" aria-hidden="true" tabindex="-1"></a><span class="in">    locations = cells_body()</span></span>
<span id="cb21-609"><a href="#cb21-609" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;% </span></span>
<span id="cb21-610"><a href="#cb21-610" aria-hidden="true" tabindex="-1"></a><span class="in">  fmt_percent(columns = percentage_n, decimals = 2)  </span></span>
<span id="cb21-611"><a href="#cb21-611" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-612"><a href="#cb21-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-613"><a href="#cb21-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-614"><a href="#cb21-614" aria-hidden="true" tabindex="-1"></a>From Table 3, we can see that all firm-loan-time observations with flagged as <span class="in">`Tranche_O_A = Amendment`</span> are correctly classified as the renegotiation. For observations classified into <span class="in">`Tranche_O_A = Origination`</span>, which consists of <span class="in">`r round(dt.flg_Rng_summary$percentage_n[2] * 100)`</span>% of total observations, &lt;mark&gt;around 37% of those is actually a renegotiation&lt;/mark&gt;. If using the new <span class="in">`flag_Renegotiated`</span> variable created in my dataset, the total percentage of observations classified as renegotiations will go up to <span class="in">`r round(dt.flg_Rng_summary$percentage_n[1] * 100)`</span>% from <span class="in">`r round(sum(dt.flg_Rng_summary$n_RngYes) / sum(dt.flg_Rng_summary$n) * 100, digits = 2)`</span>%. This is a huge increase in the actual frequency of debt renegotiation. &lt;mark&gt;Please note that Table 3&lt;/mark&gt; includes the firm-loan-time observations for both public (with <span class="in">`gvkey_group1`</span>) and private firms &lt;u&gt;(w/o GVKEY)&lt;/u&gt;. </span>
<span id="cb21-615"><a href="#cb21-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-616"><a href="#cb21-616" aria-hidden="true" tabindex="-1"></a>The results for only public firms is in Table 3b and are quantitatively similar. The total percentage of observations classified as renegotiations will go up from <span class="in">`r round(dt.flg_Rng_summary_publiconly$percentage_n[1] * 100)`</span>% to <span class="in">`r round(sum(dt.flg_Rng_summary_publiconly$n_RngYes) / sum(dt.flg_Rng_summary_publiconly$n) * 100, digits = 2)`</span>%, after using my identifier <span class="in">`flag_renegotiated`</span>. Please note that using obervations from public firms in DealScan data has two potential issues: (1) the sample size is halved and (2) not all US public firms' observations are included. For the first point, firms not in US do not have GVKEY. For the second point, going directly to the 8-K, 10-K and 10-Q SEC filings will give us a better picture about the renegotiations. However, these are not urgent at the current stage. </span>
<span id="cb21-617"><a href="#cb21-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-618"><a href="#cb21-618" aria-hidden="true" tabindex="-1"></a>Then I try to construct the path for each firm-deal-tranche/loan <span class="co">[</span><span class="ot">observation for only US public firms</span><span class="co">]</span>{style="color:red;"} and store in the new dataset - <span class="in">`dt.DealScan_uniborrow_public`</span>. </span>
<span id="cb21-619"><a href="#cb21-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-620"><a href="#cb21-620" aria-hidden="true" tabindex="-1"></a><span class="in">```{r loan_path3, echo=TRUE, results='asis'}</span></span>
<span id="cb21-621"><a href="#cb21-621" aria-hidden="true" tabindex="-1"></a><span class="in"># ==================================================================================== (July 6, 2024) </span></span>
<span id="cb21-622"><a href="#cb21-622" aria-hidden="true" tabindex="-1"></a><span class="in">## refine the updated firm-deal-time level data: </span></span>
<span id="cb21-623"><a href="#cb21-623" aria-hidden="true" tabindex="-1"></a><span class="in">## prepare to create a better match with the `dt.DealScan_uniborrower` dataset: </span></span>
<span id="cb21-624"><a href="#cb21-624" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_uniborrower_deal_updated2 &lt;- </span></span>
<span id="cb21-625"><a href="#cb21-625" aria-hidden="true" tabindex="-1"></a><span class="in">  select(dt.DealScan_uniborrower_deal_updated,</span></span>
<span id="cb21-626"><a href="#cb21-626" aria-hidden="true" tabindex="-1"></a><span class="in">         -c(All_Remarks, Event_all, linkedinfo_Remark, Orig_Yes) ) %&gt;% </span></span>
<span id="cb21-627"><a href="#cb21-627" aria-hidden="true" tabindex="-1"></a><span class="in">  # create a yearmonth index for the firm-deal-time level DealScan data. </span></span>
<span id="cb21-628"><a href="#cb21-628" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(Tranche_Active_YM = as.yearmon(Tranche_Active_Date)) %&gt;% </span></span>
<span id="cb21-629"><a href="#cb21-629" aria-hidden="true" tabindex="-1"></a><span class="in">  unnest_longer(c(Deal_Tranche_IDs, Tranche_Types) ) %&gt;% </span></span>
<span id="cb21-630"><a href="#cb21-630" aria-hidden="true" tabindex="-1"></a><span class="in">  rename(LPC_Tranche_ID = Deal_Tranche_IDs, Tranche_Type = Tranche_Types)</span></span>
<span id="cb21-631"><a href="#cb21-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-632"><a href="#cb21-632" aria-hidden="true" tabindex="-1"></a><span class="in"># the new firm-deal-tranche-time level data for only US public firms:</span></span>
<span id="cb21-633"><a href="#cb21-633" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_uniborrow_public &lt;- dt.DealScan_uniborrower %&gt;% </span></span>
<span id="cb21-634"><a href="#cb21-634" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb21-635"><a href="#cb21-635" aria-hidden="true" tabindex="-1"></a><span class="in">  # keep only US public firms with GVKEY: </span></span>
<span id="cb21-636"><a href="#cb21-636" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(gvkey_group1)) %&gt;% </span></span>
<span id="cb21-637"><a href="#cb21-637" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(dt.DealScan_uniborrower_deal_updated2,</span></span>
<span id="cb21-638"><a href="#cb21-638" aria-hidden="true" tabindex="-1"></a><span class="in">            by = join_by(gvkey_group1, Tranche_Active_Date, </span></span>
<span id="cb21-639"><a href="#cb21-639" aria-hidden="true" tabindex="-1"></a><span class="in">                         LPC_Deal_ID, LPC_Tranche_ID, Tranche_Type, </span></span>
<span id="cb21-640"><a href="#cb21-640" aria-hidden="true" tabindex="-1"></a><span class="in">                         Event_renegotiation, flag_renegotiation) ) %&gt;% </span></span>
<span id="cb21-641"><a href="#cb21-641" aria-hidden="true" tabindex="-1"></a><span class="in">  select(obs_id, deal_time_id, gvkey_group1, gvkey, everything() )</span></span>
<span id="cb21-642"><a href="#cb21-642" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb21-643"><a href="#cb21-643" aria-hidden="true" tabindex="-1"></a><span class="in">cat("Here are the new variable names for the cleaned dataset:")</span></span>
<span id="cb21-644"><a href="#cb21-644" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_uniborrow_public %&gt;% names() %&gt;% sort() </span></span>
<span id="cb21-645"><a href="#cb21-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-646"><a href="#cb21-646" aria-hidden="true" tabindex="-1"></a><span class="in">save(dt.DealScan_uniborrow_public, file = "DealScan_uniborrow_public_cleaned.RData") </span></span>
<span id="cb21-647"><a href="#cb21-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-648"><a href="#cb21-648" aria-hidden="true" tabindex="-1"></a><span class="in">## separate the link table into a different file. </span></span>
<span id="cb21-649"><a href="#cb21-649" aria-hidden="true" tabindex="-1"></a><span class="in">dt.DealScan_link_table_public &lt;- select(dt.DealScan_uniborrow_public, </span></span>
<span id="cb21-650"><a href="#cb21-650" aria-hidden="true" tabindex="-1"></a><span class="in">                                        obs_id, # identifier for the firm-deal-tranche/loan-time observations </span></span>
<span id="cb21-651"><a href="#cb21-651" aria-hidden="true" tabindex="-1"></a><span class="in">                                        deal_time_id, # identifier for the firm-deal-time observations</span></span>
<span id="cb21-652"><a href="#cb21-652" aria-hidden="true" tabindex="-1"></a><span class="in">                                        gvkey_group1, # unique identifier for each firm </span></span>
<span id="cb21-653"><a href="#cb21-653" aria-hidden="true" tabindex="-1"></a><span class="in">                                        gvkey, # unique identifer in Compustat </span></span>
<span id="cb21-654"><a href="#cb21-654" aria-hidden="true" tabindex="-1"></a><span class="in">                                        Tranche_Active_Date, Tranche_Active_YM # observation time </span></span>
<span id="cb21-655"><a href="#cb21-655" aria-hidden="true" tabindex="-1"></a><span class="in">                                        )</span></span>
<span id="cb21-656"><a href="#cb21-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-657"><a href="#cb21-657" aria-hidden="true" tabindex="-1"></a><span class="in">save(dt.DealScan_link_table_public, file = "DealScan_link_table.RData") </span></span>
<span id="cb21-658"><a href="#cb21-658" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-659"><a href="#cb21-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-660"><a href="#cb21-660" aria-hidden="true" tabindex="-1"></a>From all procedure above, the raw DealScan data, <span class="in">`DealScan_borrower.RData`</span>, is cleaned and saved into <span class="in">`DealScan_uniborrow_public_cleaned.RData`</span>, which contains only observations from public firms. The link table is also updated and now saved in file <span class="in">`DealScan_link_table.RData`</span>. The new link table will be used to link the DealScan dataset to the Compustat dataset. </span>
<span id="cb21-661"><a href="#cb21-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-662"><a href="#cb21-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-663"><a href="#cb21-663" aria-hidden="true" tabindex="-1"></a><span class="fu">## Refine the deal path identification </span></span>
<span id="cb21-664"><a href="#cb21-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-665"><a href="#cb21-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-666"><a href="#cb21-666" aria-hidden="true" tabindex="-1"></a><span class="fu">## Reference {#sec-reference}</span></span>
<span id="cb21-667"><a href="#cb21-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-668"><a href="#cb21-668" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Related <span class="co">[</span><span class="ot">Peter Demerjian</span><span class="co">](https://peterdemerjian.weebly.com/research.html)</span></span>
<span id="cb21-669"><a href="#cb21-669" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Measuring the Probability of Financial Covenant Violation in Private Debt Contracts (with E. Owens). Journal of Accounting and Economics 61: 433-447 (2016). <span class="sc">\&gt;</span> <span class="co">[</span><span class="ot">CODE</span><span class="co">](https://peterdemerjian.weebly.com/managerialability.html)</span></span>
<span id="cb21-670"><a href="#cb21-670" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Corporate Refinancing, Covenants, and the Agency Cost of Debt - Green (2018) </span>
<span id="cb21-671"><a href="#cb21-671" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Covenant removal in corporate bonds - NHH paper (2023) </span>
<span id="cb21-672"><a href="#cb21-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-673"><a href="#cb21-673" aria-hidden="true" tabindex="-1"></a><span class="fu">## To-do list:</span></span>
<span id="cb21-674"><a href="#cb21-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-675"><a href="#cb21-675" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Exclude text with <span class="in">`amendment fee`</span> in <span class="in">`Event_renegotiation`</span>. &gt; Line 237. </span>
<span id="cb21-676"><a href="#cb21-676" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">July 7, 2024</span><span class="co">]()</span> </span>
<span id="cb21-677"><a href="#cb21-677" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Use the maturity time to further distinguish the deals. </span>
<span id="cb21-678"><a href="#cb21-678" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Connect to Compustat. </span>
<span id="cb21-679"><a href="#cb21-679" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-680"><a href="#cb21-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-681"><a href="#cb21-681" aria-hidden="true" tabindex="-1"></a><span class="fu">===</span></span>
<span id="cb21-682"><a href="#cb21-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-683"><a href="#cb21-683" aria-hidden="true" tabindex="-1"></a><span class="fu">## Trashbin:</span></span>
<span id="cb21-684"><a href="#cb21-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-685"><a href="#cb21-685" aria-hidden="true" tabindex="-1"></a><span class="in">```{r trash, eval=FALSE}</span></span>
<span id="cb21-686"><a href="#cb21-686" aria-hidden="true" tabindex="-1"></a><span class="in">### </span></span>
<span id="cb21-687"><a href="#cb21-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-688"><a href="#cb21-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-689"><a href="#cb21-689" aria-hidden="true" tabindex="-1"></a><span class="in"># ------------------------------------------------------------------</span></span>
<span id="cb21-690"><a href="#cb21-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-691"><a href="#cb21-691" aria-hidden="true" tabindex="-1"></a><span class="in">### from section S2 - June 13, 2024 </span></span>
<span id="cb21-692"><a href="#cb21-692" aria-hidden="true" tabindex="-1"></a><span class="in">## create a dataset for the unique id for each unique observations. </span></span>
<span id="cb21-693"><a href="#cb21-693" aria-hidden="true" tabindex="-1"></a><span class="in">dt.Link_table_id &lt;- Link_table %&gt;% </span></span>
<span id="cb21-694"><a href="#cb21-694" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, `LoanConnector Company ID`, borrowercompanyid, facilitystartdate) %&gt;% </span></span>
<span id="cb21-695"><a href="#cb21-695" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(gvkey, `LoanConnector Company ID`, borrowercompanyid) %&gt;% </span></span>
<span id="cb21-696"><a href="#cb21-696" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(facilitystartdate_min = min(facilitystartdate)) %&gt;% </span></span>
<span id="cb21-697"><a href="#cb21-697" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;% </span></span>
<span id="cb21-698"><a href="#cb21-698" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(gvkey) %&gt;% </span></span>
<span id="cb21-699"><a href="#cb21-699" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(facilitystartdate_min) %&gt;% </span></span>
<span id="cb21-700"><a href="#cb21-700" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(gvkey_group = cur_group_id()) %&gt;% # generate the group_id based on `gvkey` </span></span>
<span id="cb21-701"><a href="#cb21-701" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() </span></span>
<span id="cb21-702"><a href="#cb21-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-703"><a href="#cb21-703" aria-hidden="true" tabindex="-1"></a><span class="in">## only contain self-created prelimiary gvkey_group(s):</span></span>
<span id="cb21-704"><a href="#cb21-704" aria-hidden="true" tabindex="-1"></a><span class="in">comp_id_gvkey &lt;- dt.Link_table_id %&gt;%</span></span>
<span id="cb21-705"><a href="#cb21-705" aria-hidden="true" tabindex="-1"></a><span class="in">  select(gvkey, `LoanConnector Company ID`, gvkey_group) %&gt;%</span></span>
<span id="cb21-706"><a href="#cb21-706" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(`LoanConnector Company ID`) %&gt;%</span></span>
<span id="cb21-707"><a href="#cb21-707" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(company_id_to_gvkey = paste0(paste0(unique(gvkey), collapse = ";"), ";"), # for `gvkey`</span></span>
<span id="cb21-708"><a href="#cb21-708" aria-hidden="true" tabindex="-1"></a><span class="in">            company_id_to_gvkey_group = paste0(paste0(unique(gvkey_group), collapse = ";"), ";"), # for `gvkey_group`</span></span>
<span id="cb21-709"><a href="#cb21-709" aria-hidden="true" tabindex="-1"></a><span class="in">            n_gvkey = length(unique(gvkey)) # number of gvkey(s) within each `company_ID` group.</span></span>
<span id="cb21-710"><a href="#cb21-710" aria-hidden="true" tabindex="-1"></a><span class="in">            ) %&gt;%</span></span>
<span id="cb21-711"><a href="#cb21-711" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup()</span></span>
<span id="cb21-712"><a href="#cb21-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-713"><a href="#cb21-713" aria-hidden="true" tabindex="-1"></a><span class="in">comp_id_gvkey</span></span>
<span id="cb21-714"><a href="#cb21-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-715"><a href="#cb21-715" aria-hidden="true" tabindex="-1"></a><span class="in">dt.gvkey_group1 &lt;- dt.Link_table_id %&gt;%</span></span>
<span id="cb21-716"><a href="#cb21-716" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(comp_id_gvkey, by = "LoanConnector Company ID") %&gt;%</span></span>
<span id="cb21-717"><a href="#cb21-717" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(gvkey) %&gt;%</span></span>
<span id="cb21-718"><a href="#cb21-718" aria-hidden="true" tabindex="-1"></a><span class="in">  # head(30) %&gt;%</span></span>
<span id="cb21-719"><a href="#cb21-719" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(gvkey) %&gt;% # for each given `gvkey`, find the associated `gvkey`(s) based on `company_ID`.</span></span>
<span id="cb21-720"><a href="#cb21-720" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise( # re-construct the list of linked `gvkey`(s)</span></span>
<span id="cb21-721"><a href="#cb21-721" aria-hidden="true" tabindex="-1"></a><span class="in">    connected_gvkey = paste(unique(unlist(strsplit(company_id_to_gvkey, split = ";"))), collapse = ";")</span></span>
<span id="cb21-722"><a href="#cb21-722" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb21-723"><a href="#cb21-723" aria-hidden="true" tabindex="-1"></a><span class="in">  ungroup() %&gt;%</span></span>
<span id="cb21-724"><a href="#cb21-724" aria-hidden="true" tabindex="-1"></a><span class="in">  select(connected_gvkey) %&gt;%</span></span>
<span id="cb21-725"><a href="#cb21-725" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct() %&gt;%</span></span>
<span id="cb21-726"><a href="#cb21-726" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(gvkey_group1 = 1:nrow(.))</span></span>
<span id="cb21-727"><a href="#cb21-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-728"><a href="#cb21-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-729"><a href="#cb21-729" aria-hidden="true" tabindex="-1"></a><span class="in">dt.Link_table_gvkey &lt;- str_split(string = dt.gvkey_group1$connected_gvkey, pattern = ";", simplify = F) %&gt;%</span></span>
<span id="cb21-730"><a href="#cb21-730" aria-hidden="true" tabindex="-1"></a><span class="in">  `names&lt;-`(value = dt.gvkey_group1$gvkey_group1) %&gt;%</span></span>
<span id="cb21-731"><a href="#cb21-731" aria-hidden="true" tabindex="-1"></a><span class="in">  unlist(.) %&gt;%</span></span>
<span id="cb21-732"><a href="#cb21-732" aria-hidden="true" tabindex="-1"></a><span class="in">  data.frame(gvkey = ., gvkey_group1 = names(.)) %&gt;%</span></span>
<span id="cb21-733"><a href="#cb21-733" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(gvkey = as.numeric(gvkey))</span></span>
<span id="cb21-734"><a href="#cb21-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-735"><a href="#cb21-735" aria-hidden="true" tabindex="-1"></a><span class="in">### merge back to the link table</span></span>
<span id="cb21-736"><a href="#cb21-736" aria-hidden="true" tabindex="-1"></a><span class="in">dt.Link_table_id2 &lt;- dt.Link_table_id %&gt;%</span></span>
<span id="cb21-737"><a href="#cb21-737" aria-hidden="true" tabindex="-1"></a><span class="in">  select(-facilitystartdate_min, -gvkey_group) %&gt;%</span></span>
<span id="cb21-738"><a href="#cb21-738" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(dt.Link_table_gvkey, by = "gvkey")</span></span>
<span id="cb21-739"><a href="#cb21-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-740"><a href="#cb21-740" aria-hidden="true" tabindex="-1"></a><span class="in">dt.Link_table_id2</span></span>
<span id="cb21-741"><a href="#cb21-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-742"><a href="#cb21-742" aria-hidden="true" tabindex="-1"></a><span class="in">## second round checking</span></span>
<span id="cb21-743"><a href="#cb21-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-744"><a href="#cb21-744" aria-hidden="true" tabindex="-1"></a><span class="in">### the arguement here is that for all `company ID` previously identified from the same gvkey, I now map it back based on the `company ID` and double check whether the new `gvkey_group` is the same as the original ones. </span></span>
<span id="cb21-745"><a href="#cb21-745" aria-hidden="true" tabindex="-1"></a><span class="in">### i.e. I am checking whether the same `comapny ID` maps to multiple `gvkey`(s). </span></span>
<span id="cb21-746"><a href="#cb21-746" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-747"><a href="#cb21-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-748"><a href="#cb21-748" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Notes  --&gt;</span></span>
<span id="cb21-749"><a href="#cb21-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-750"><a href="#cb21-750" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- color: &lt;span style="color: red;"&gt; text &lt;/span&gt; // {style="color: red;"} --&gt;</span></span>
<span id="cb21-751"><a href="#cb21-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-752"><a href="#cb21-752" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Quarto --&gt;</span></span>
<span id="cb21-753"><a href="#cb21-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-754"><a href="#cb21-754" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Quarto enables you to weave together content and executable code into a finished document. To learn more about Quarto see &lt;https://quarto.org&gt;. --&gt;</span></span>
<span id="cb21-755"><a href="#cb21-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-756"><a href="#cb21-756" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ## Running Code --&gt;</span></span>
<span id="cb21-757"><a href="#cb21-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-758"><a href="#cb21-758" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- When you click the **Render** button a document will be generated that includes both content and the output of embedded code. You can embed code like this: --&gt;</span></span>
<span id="cb21-759"><a href="#cb21-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-760"><a href="#cb21-760" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ```{r} --&gt;</span></span>
<span id="cb21-761"><a href="#cb21-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-762"><a href="#cb21-762" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 1 + 1 --&gt;</span></span>
<span id="cb21-763"><a href="#cb21-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-764"><a href="#cb21-764" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ``` --&gt;</span></span>
<span id="cb21-765"><a href="#cb21-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-766"><a href="#cb21-766" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- You can add options to executable code like this --&gt;</span></span>
<span id="cb21-767"><a href="#cb21-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-768"><a href="#cb21-768" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ```{r} --&gt;</span></span>
<span id="cb21-769"><a href="#cb21-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-770"><a href="#cb21-770" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- #| echo: false --&gt;</span></span>
<span id="cb21-771"><a href="#cb21-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-772"><a href="#cb21-772" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- 2 * 2 --&gt;</span></span>
<span id="cb21-773"><a href="#cb21-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-774"><a href="#cb21-774" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ``` --&gt;</span></span>
<span id="cb21-775"><a href="#cb21-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-776"><a href="#cb21-776" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- The `echo: false` option disables the printing of code (only output is displayed). --&gt;</span></span>
<span id="cb21-777"><a href="#cb21-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-778"><a href="#cb21-778" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- -------- --&gt;</span></span>
<span id="cb21-779"><a href="#cb21-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-780"><a href="#cb21-780" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">###</span><span class="co"> s3.6 Leverage Covenants {#sec-s3.6-leverage-covenants} --&gt;</span></span>
<span id="cb21-781"><a href="#cb21-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-782"><a href="#cb21-782" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Look into the changes in covenants related to the leverage restrictions and cash flow related restrictions (e.g. ICR: interest rate coverage ratio). --&gt;</span></span>
<span id="cb21-783"><a href="#cb21-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-784"><a href="#cb21-784" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">###</span><span class="co"> s3.7 Spreads and Fees {#sec-s3.7-spreads-and-fees} --&gt;</span></span>
<span id="cb21-785"><a href="#cb21-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-786"><a href="#cb21-786" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Look into the changes in spread and fees. --&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>